!function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);function __(){this.constructor=d}d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},THREE=require("three"),STATE_NONE=-1,STATE_ROTATE=0,STATE_DOLLY=1,STATE_PAN=2,STATE_TOUCH_ROTATE=3,STATE_TOUCH_DOLLY=4,STATE_TOUCH_PAN=5,CHANGE_EVENT={type:"change"},START_EVENT={type:"start"},END_EVENT={type:"end"},OrbitControls=function(_super){function OrbitControls(object,domElement,domWindow){var _this=_super.call(this)||this;return _this.object=object,_this.domElement=void 0!==domElement?domElement:document,_this.window=void 0!==domWindow?domWindow:window,_this.enabled=!0,_this.target=new THREE.Vector3,_this.minDistance=0,_this.maxDistance=1/0,_this.minZoom=0,_this.maxZoom=1/0,_this.minPolarAngle=0,_this.maxPolarAngle=Math.PI,_this.minAzimuthAngle=-1/0,_this.maxAzimuthAngle=1/0,_this.enableDamping=!1,_this.dampingFactor=.25,_this.enableZoom=!0,_this.zoomSpeed=1,_this.enableRotate=!0,_this.rotateSpeed=1,_this.enablePan=!0,_this.keyPanSpeed=7,_this.autoRotate=!1,_this.autoRotateSpeed=2,_this.enableKeys=!0,_this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},_this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},_this.target0=_this.target.clone(),_this.position0=_this.object.position.clone(),_this.zoom0=_this.object.zoom,_this.updateOffset=new THREE.Vector3,_this.updateQuat=(new THREE.Quaternion).setFromUnitVectors(object.up,new THREE.Vector3(0,1,0)),_this.updateQuatInverse=_this.updateQuat.clone().inverse(),_this.updateLastPosition=new THREE.Vector3,_this.updateLastQuaternion=new THREE.Quaternion,_this.state=STATE_NONE,_this.scale=1,_this.spherical=new THREE.Spherical,_this.sphericalDelta=new THREE.Spherical,_this.panOffset=new THREE.Vector3,_this.zoomChanged=!1,_this.rotateStart=new THREE.Vector2,_this.rotateEnd=new THREE.Vector2,_this.rotateDelta=new THREE.Vector2,_this.panStart=new THREE.Vector2,_this.panEnd=new THREE.Vector2,_this.panDelta=new THREE.Vector2,_this.dollyStart=new THREE.Vector2,_this.dollyEnd=new THREE.Vector2,_this.dollyDelta=new THREE.Vector2,_this.panLeftV=new THREE.Vector3,_this.panUpV=new THREE.Vector3,_this.panInternalOffset=new THREE.Vector3,_this.onMouseDown=function(event){if(!1!==_this.enabled){if(event.preventDefault(),event.button===_this.mouseButtons.ORBIT){if(!1===_this.enableRotate)return;_this.rotateStart.set(event.clientX,event.clientY),_this.state=STATE_ROTATE}else if(event.button===_this.mouseButtons.ZOOM){if(!1===_this.enableZoom)return;_this.dollyStart.set(event.clientX,event.clientY),_this.state=STATE_DOLLY}else if(event.button===_this.mouseButtons.PAN){if(!1===_this.enablePan)return;_this.panStart.set(event.clientX,event.clientY),_this.state=STATE_PAN}_this.state!==STATE_NONE&&(document.addEventListener("mousemove",_this.onMouseMove,!1),document.addEventListener("mouseup",_this.onMouseUp,!1),_this.dispatchEvent(START_EVENT))}},_this.onMouseMove=function(event){if(!1!==_this.enabled)if(event.preventDefault(),_this.state===STATE_ROTATE){if(!1===_this.enableRotate)return;_this.rotateEnd.set(event.clientX,event.clientY),_this.rotateDelta.subVectors(_this.rotateEnd,_this.rotateStart);var element=_this.domElement===document?_this.domElement.body:_this.domElement;_this.rotateLeft(2*Math.PI*_this.rotateDelta.x/element.clientWidth*_this.rotateSpeed),_this.rotateUp(2*Math.PI*_this.rotateDelta.y/element.clientHeight*_this.rotateSpeed),_this.rotateStart.copy(_this.rotateEnd),_this.update()}else if(_this.state===STATE_DOLLY){if(!1===_this.enableZoom)return;_this.dollyEnd.set(event.clientX,event.clientY),_this.dollyDelta.subVectors(_this.dollyEnd,_this.dollyStart),0<_this.dollyDelta.y?_this.dollyIn(_this.getZoomScale()):_this.dollyDelta.y<0&&_this.dollyOut(_this.getZoomScale()),_this.dollyStart.copy(_this.dollyEnd),_this.update()}else if(_this.state===STATE_PAN){if(!1===_this.enablePan)return;_this.panEnd.set(event.clientX,event.clientY),_this.panDelta.subVectors(_this.panEnd,_this.panStart),_this.pan(_this.panDelta.x,_this.panDelta.y),_this.panStart.copy(_this.panEnd),_this.update()}},_this.onMouseUp=function(event){!1!==_this.enabled&&(document.removeEventListener("mousemove",_this.onMouseMove,!1),document.removeEventListener("mouseup",_this.onMouseUp,!1),_this.dispatchEvent(END_EVENT),_this.state=STATE_NONE)},_this.onMouseWheel=function(event){!1===_this.enabled||!1===_this.enableZoom||_this.state!==STATE_NONE&&_this.state!==STATE_ROTATE||(event.preventDefault(),event.stopPropagation(),event.deltaY<0?_this.dollyOut(_this.getZoomScale()):0<event.deltaY&&_this.dollyIn(_this.getZoomScale()),_this.update(),_this.dispatchEvent(START_EVENT),_this.dispatchEvent(END_EVENT))},_this.onKeyDown=function(event){if(!1!==_this.enabled&&!1!==_this.enableKeys&&!1!==_this.enablePan)switch(event.keyCode){case _this.keys.UP:_this.pan(0,_this.keyPanSpeed),_this.update();break;case _this.keys.BOTTOM:_this.pan(0,-_this.keyPanSpeed),_this.update();break;case _this.keys.LEFT:_this.pan(_this.keyPanSpeed,0),_this.update();break;case _this.keys.RIGHT:_this.pan(-_this.keyPanSpeed,0),_this.update()}},_this.onTouchStart=function(event){if(!1!==_this.enabled){switch(event.touches.length){case 1:if(!1===_this.enableRotate)return;_this.rotateStart.set(event.touches[0].pageX,event.touches[0].pageY),_this.state=STATE_TOUCH_ROTATE;break;case 2:if(!1===_this.enableZoom)return;var dx=event.touches[0].pageX-event.touches[1].pageX,dy=event.touches[0].pageY-event.touches[1].pageY,distance=Math.sqrt(dx*dx+dy*dy);_this.dollyStart.set(0,distance),_this.state=STATE_TOUCH_DOLLY;break;case 3:if(!1===_this.enablePan)return;_this.panStart.set(event.touches[0].pageX,event.touches[0].pageY),_this.state=STATE_TOUCH_PAN;break;default:_this.state=STATE_NONE}_this.state!==STATE_NONE&&_this.dispatchEvent(START_EVENT)}},_this.onTouchMove=function(event){if(!1!==_this.enabled)switch(event.preventDefault(),event.stopPropagation(),event.touches.length){case 1:if(!1===_this.enableRotate)return;if(_this.state!==STATE_TOUCH_ROTATE)return;_this.rotateEnd.set(event.touches[0].pageX,event.touches[0].pageY),_this.rotateDelta.subVectors(_this.rotateEnd,_this.rotateStart);var element=_this.domElement===document?_this.domElement.body:_this.domElement;_this.rotateLeft(2*Math.PI*_this.rotateDelta.x/element.clientWidth*_this.rotateSpeed),_this.rotateUp(2*Math.PI*_this.rotateDelta.y/element.clientHeight*_this.rotateSpeed),_this.rotateStart.copy(_this.rotateEnd),_this.update();break;case 2:if(!1===_this.enableZoom)return;if(_this.state!==STATE_TOUCH_DOLLY)return;var dx=event.touches[0].pageX-event.touches[1].pageX,dy=event.touches[0].pageY-event.touches[1].pageY,distance=Math.sqrt(dx*dx+dy*dy);_this.dollyEnd.set(0,distance),_this.dollyDelta.subVectors(_this.dollyEnd,_this.dollyStart),0<_this.dollyDelta.y?_this.dollyOut(_this.getZoomScale()):_this.dollyDelta.y<0&&_this.dollyIn(_this.getZoomScale()),_this.dollyStart.copy(_this.dollyEnd),_this.update();break;case 3:if(!1===_this.enablePan)return;if(_this.state!==STATE_TOUCH_PAN)return;_this.panEnd.set(event.touches[0].pageX,event.touches[0].pageY),_this.panDelta.subVectors(_this.panEnd,_this.panStart),_this.pan(_this.panDelta.x,_this.panDelta.y),_this.panStart.copy(_this.panEnd),_this.update();break;default:_this.state=STATE_NONE}},_this.onTouchEnd=function(event){!1!==_this.enabled&&(_this.dispatchEvent(END_EVENT),_this.state=STATE_NONE)},_this.onContextMenu=function(event){event.preventDefault()},_this.domElement.addEventListener("contextmenu",_this.onContextMenu,!1),_this.domElement.addEventListener("mousedown",_this.onMouseDown,!1),_this.domElement.addEventListener("wheel",_this.onMouseWheel,!1),_this.domElement.addEventListener("touchstart",_this.onTouchStart,!1),_this.domElement.addEventListener("touchend",_this.onTouchEnd,!1),_this.domElement.addEventListener("touchmove",_this.onTouchMove,!1),_this.window.addEventListener("keydown",_this.onKeyDown,!1),_this.update(),_this}return __extends(OrbitControls,_super),OrbitControls.prototype.update=function(){var position=this.object.position;return this.updateOffset.copy(position).sub(this.target),this.updateOffset.applyQuaternion(this.updateQuat),this.spherical.setFromVector3(this.updateOffset),this.autoRotate&&this.state===STATE_NONE&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi,this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.target.add(this.panOffset),this.updateOffset.setFromSpherical(this.spherical),this.updateOffset.applyQuaternion(this.updateQuatInverse),position.copy(this.target).add(this.updateOffset),this.object.lookAt(this.target),!0===this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.panOffset.set(0,0,0),!!(this.zoomChanged||1e-6<this.updateLastPosition.distanceToSquared(this.object.position)||1e-6<8*(1-this.updateLastQuaternion.dot(this.object.quaternion)))&&(this.dispatchEvent(CHANGE_EVENT),this.updateLastPosition.copy(this.object.position),this.updateLastQuaternion.copy(this.object.quaternion),!(this.zoomChanged=!1))},OrbitControls.prototype.panLeft=function(distance,objectMatrix){this.panLeftV.setFromMatrixColumn(objectMatrix,0),this.panLeftV.multiplyScalar(-distance),this.panOffset.add(this.panLeftV)},OrbitControls.prototype.panUp=function(distance,objectMatrix){this.panUpV.setFromMatrixColumn(objectMatrix,1),this.panUpV.multiplyScalar(distance),this.panOffset.add(this.panUpV)},OrbitControls.prototype.pan=function(deltaX,deltaY){var element=this.domElement===document?this.domElement.body:this.domElement;if(this.object instanceof THREE.PerspectiveCamera){var position=this.object.position;this.panInternalOffset.copy(position).sub(this.target);var targetDistance=this.panInternalOffset.length();targetDistance*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*deltaX*targetDistance/element.clientHeight,this.object.matrix),this.panUp(2*deltaY*targetDistance/element.clientHeight,this.object.matrix)}else this.object instanceof THREE.OrthographicCamera?(this.panLeft(deltaX*(this.object.right-this.object.left)/this.object.zoom/element.clientWidth,this.object.matrix),this.panUp(deltaY*(this.object.top-this.object.bottom)/this.object.zoom/element.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)},OrbitControls.prototype.dollyIn=function(dollyScale){this.object instanceof THREE.PerspectiveCamera?this.scale/=dollyScale:this.object instanceof THREE.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*dollyScale)),this.object.updateProjectionMatrix(),this.zoomChanged=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},OrbitControls.prototype.dollyOut=function(dollyScale){this.object instanceof THREE.PerspectiveCamera?this.scale*=dollyScale:this.object instanceof THREE.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/dollyScale)),this.object.updateProjectionMatrix(),this.zoomChanged=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},OrbitControls.prototype.getAutoRotationAngle=function(){return 2*Math.PI/60/60*this.autoRotateSpeed},OrbitControls.prototype.getZoomScale=function(){return Math.pow(.95,this.zoomSpeed)},OrbitControls.prototype.rotateLeft=function(angle){this.sphericalDelta.theta-=angle},OrbitControls.prototype.rotateUp=function(angle){this.sphericalDelta.phi-=angle},OrbitControls.prototype.getPolarAngle=function(){return this.spherical.phi},OrbitControls.prototype.getAzimuthalAngle=function(){return this.spherical.theta},OrbitControls.prototype.dispose=function(){this.domElement.removeEventListener("contextmenu",this.onContextMenu,!1),this.domElement.removeEventListener("mousedown",this.onMouseDown,!1),this.domElement.removeEventListener("wheel",this.onMouseWheel,!1),this.domElement.removeEventListener("touchstart",this.onTouchStart,!1),this.domElement.removeEventListener("touchend",this.onTouchEnd,!1),this.domElement.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),this.window.removeEventListener("keydown",this.onKeyDown,!1)},OrbitControls.prototype.reset=function(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(CHANGE_EVENT),this.update(),this.state=STATE_NONE},Object.defineProperty(OrbitControls.prototype,"center",{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target},enumerable:!0,configurable:!0}),Object.defineProperty(OrbitControls.prototype,"noZoom",{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(value){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!value},enumerable:!0,configurable:!0}),OrbitControls}(THREE.EventDispatcher);exports.OrbitControls=OrbitControls},{three:2}],2:[function(require,module,exports){var global,factory;global=this,factory=function(exports){"use strict";function EventDispatcher(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(x){return x<0?-1:0<x?1:+x}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(target){if(null==target)throw new TypeError("Cannot convert undefined or null to object");for(var output=Object(target),index=1;index<arguments.length;index++){var source=arguments[index];if(null!=source)for(var nextKey in source)Object.prototype.hasOwnProperty.call(source,nextKey)&&(output[nextKey]=source[nextKey])}return output}),Object.assign(EventDispatcher.prototype,{addEventListener:function(type,listener){void 0===this._listeners&&(this._listeners={});var listeners=this._listeners;void 0===listeners[type]&&(listeners[type]=[]),-1===listeners[type].indexOf(listener)&&listeners[type].push(listener)},hasEventListener:function(type,listener){if(void 0===this._listeners)return!1;var listeners=this._listeners;return void 0!==listeners[type]&&-1!==listeners[type].indexOf(listener)},removeEventListener:function(type,listener){if(void 0!==this._listeners){var listenerArray=this._listeners[type];if(void 0!==listenerArray){var index=listenerArray.indexOf(listener);-1!==index&&listenerArray.splice(index,1)}}},dispatchEvent:function(event){if(void 0!==this._listeners){var listenerArray=this._listeners[event.type];if(void 0!==listenerArray){event.target=this;var array=[],i=0,length=listenerArray.length;for(i=0;i<length;i++)array[i]=listenerArray[i];for(i=0;i<length;i++)array[i].call(this,event)}}}});var r,chars,uuid,rnd,min,max,CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,PCFShadowMap=1,PCFSoftShadowMap=2,FrontSide=0,BackSide=1,DoubleSide=2,FlatShading=1,SmoothShading=2,NoColors=0,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,BlendingMode={NoBlending:NoBlending,NormalBlending:NormalBlending,AdditiveBlending:AdditiveBlending,SubtractiveBlending:SubtractiveBlending,MultiplyBlending:MultiplyBlending,CustomBlending:CustomBlending},AddEquation=100,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,Uncharted2ToneMapping=3,CineonToneMapping=4,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,SphericalReflectionMapping=305,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,TextureMapping={UVMapping:300,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,SphericalReflectionMapping:SphericalReflectionMapping,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping},ClampToEdgeWrapping=1001,TextureWrapping={RepeatWrapping:1e3,ClampToEdgeWrapping:ClampToEdgeWrapping,MirroredRepeatWrapping:1002},NearestFilter=1003,NearestMipMapNearestFilter=1004,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipMapLinearFilter=1008,TextureFilter={NearestFilter:NearestFilter,NearestMipMapNearestFilter:NearestMipMapNearestFilter,NearestMipMapLinearFilter:NearestMipMapLinearFilter,LinearFilter:LinearFilter,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:LinearMipMapLinearFilter},UnsignedByteType=1009,UnsignedShortType=1012,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedInt248Type=1020,RGBFormat=1022,RGBAFormat=1023,RGBEFormat=RGBAFormat,DepthFormat=1026,DepthStencilFormat=1027,TrianglesDrawMode=0,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,_Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:(chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),uuid=new Array(36),rnd=0,function(){for(var i=0;i<36;i++)8===i||13===i||18===i||23===i?uuid[i]="-":14===i?uuid[i]="4":(rnd<=2&&(rnd=33554432+16777216*Math.random()|0),r=15&rnd,rnd>>=4,uuid[i]=chars[19===i?3&r|8:r]);return uuid.join("")}),clamp:function(value,min,max){return Math.max(min,Math.min(max,value))},euclideanModulo:function(n,m){return(n%m+m)%m},mapLinear:function(x,a1,a2,b1,b2){return b1+(x-a1)*(b2-b1)/(a2-a1)},lerp:function(x,y,t){return(1-t)*x+t*y},smoothstep:function(x,min,max){return x<=min?0:max<=x?1:(x=(x-min)/(max-min))*x*(3-2*x)},smootherstep:function(x,min,max){return x<=min?0:max<=x?1:(x=(x-min)/(max-min))*x*x*(x*(6*x-15)+10)},randInt:function(low,high){return low+Math.floor(Math.random()*(high-low+1))},randFloat:function(low,high){return low+Math.random()*(high-low)},randFloatSpread:function(range){return range*(.5-Math.random())},degToRad:function(degrees){return degrees*_Math.DEG2RAD},radToDeg:function(radians){return radians*_Math.RAD2DEG},isPowerOfTwo:function(value){return 0==(value&value-1)&&0!==value},nearestPowerOfTwo:function(value){return Math.pow(2,Math.round(Math.log(value)/Math.LN2))},nextPowerOfTwo:function(value){return value--,value|=value>>1,value|=value>>2,value|=value>>4,value|=value>>8,value|=value>>16,++value}};function Vector2(x,y){this.x=x||0,this.y=y||0}Vector2.prototype={constructor:Vector2,isVector2:!0,get width(){return this.x},set width(value){this.x=value},get height(){return this.y},set height(value){this.y=value},set:function(x,y){return this.x=x,this.y=y,this},setScalar:function(scalar){return this.x=scalar,this.y=scalar,this},setX:function(x){return this.x=x,this},setY:function(y){return this.y=y,this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;default:throw new Error("index is out of range: "+index)}return this},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+index)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(v){return this.x=v.x,this.y=v.y,this},add:function(v,w){return void 0!==w?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(v,w)):(this.x+=v.x,this.y+=v.y,this)},addScalar:function(s){return this.x+=s,this.y+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScaledVector:function(v,s){return this.x+=v.x*s,this.y+=v.y*s,this},sub:function(v,w){return void 0!==w?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(v,w)):(this.x-=v.x,this.y-=v.y,this)},subScalar:function(s){return this.x-=s,this.y-=s,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiply:function(v){return this.x*=v.x,this.y*=v.y,this},multiplyScalar:function(scalar){return isFinite(scalar)?(this.x*=scalar,this.y*=scalar):(this.x=0,this.y=0),this},divide:function(v){return this.x/=v.x,this.y/=v.y,this},divideScalar:function(scalar){return this.multiplyScalar(1/scalar)},min:function(v){return this.x=Math.min(this.x,v.x),this.y=Math.min(this.y,v.y),this},max:function(v){return this.x=Math.max(this.x,v.x),this.y=Math.max(this.y,v.y),this},clamp:function(min,max){return this.x=Math.max(min.x,Math.min(max.x,this.x)),this.y=Math.max(min.y,Math.min(max.y,this.y)),this},clampScalar:function(minVal,maxVal){return void 0===min&&(min=new Vector2,max=new Vector2),min.set(minVal,minVal),max.set(maxVal,maxVal),this.clamp(min,max)},clampLength:function(min,max){var length=this.length();return this.multiplyScalar(Math.max(min,Math.min(max,length))/length)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(v){return this.x*v.x+this.y*v.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var angle=Math.atan2(this.y,this.x);return angle<0&&(angle+=2*Math.PI),angle},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy},distanceToManhattan:function(v){return Math.abs(this.x-v.x)+Math.abs(this.y-v.y)},setLength:function(length){return this.multiplyScalar(length/this.length())},lerp:function(v,alpha){return this.x+=(v.x-this.x)*alpha,this.y+=(v.y-this.y)*alpha,this},lerpVectors:function(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)},equals:function(v){return v.x===this.x&&v.y===this.y},fromArray:function(array,offset){return void 0===offset&&(offset=0),this.x=array[offset],this.y=array[offset+1],this},toArray:function(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.x,array[offset+1]=this.y,array},fromAttribute:function(attribute,index,offset){return void 0!==offset&&console.warn("THREE.Vector2: offset has been removed from .fromAttribute()."),this.x=attribute.getX(index),this.y=attribute.getY(index),this},rotateAround:function(center,angle){var c=Math.cos(angle),s=Math.sin(angle),x=this.x-center.x,y=this.y-center.y;return this.x=x*c-y*s+center.x,this.y=x*s+y*c+center.y,this}};var v1,matrix,quaternion,x,y,z,textureId=0;function Texture(image,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding){Object.defineProperty(this,"id",{value:textureId++}),this.uuid=_Math.generateUUID(),this.name="",this.image=void 0!==image?image:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==mapping?mapping:Texture.DEFAULT_MAPPING,this.wrapS=void 0!==wrapS?wrapS:ClampToEdgeWrapping,this.wrapT=void 0!==wrapT?wrapT:ClampToEdgeWrapping,this.magFilter=void 0!==magFilter?magFilter:LinearFilter,this.minFilter=void 0!==minFilter?minFilter:LinearMipMapLinearFilter,this.anisotropy=void 0!==anisotropy?anisotropy:1,this.format=void 0!==format?format:RGBAFormat,this.type=void 0!==type?type:UnsignedByteType,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==encoding?encoding:LinearEncoding,this.version=0,this.onUpdate=null}function Vector4(x,y,z,w){this.x=x||0,this.y=y||0,this.z=z||0,this.w=void 0!==w?w:1}function WebGLRenderTarget(width,height,options){this.uuid=_Math.generateUUID(),this.width=width,this.height=height,this.scissor=new Vector4(0,0,width,height),this.scissorTest=!1,this.viewport=new Vector4(0,0,width,height),void 0===(options=options||{}).minFilter&&(options.minFilter=LinearFilter),this.texture=new Texture(void 0,void 0,options.wrapS,options.wrapT,options.magFilter,options.minFilter,options.format,options.type,options.anisotropy,options.encoding),this.depthBuffer=void 0===options.depthBuffer||options.depthBuffer,this.stencilBuffer=void 0===options.stencilBuffer||options.stencilBuffer,this.depthTexture=void 0!==options.depthTexture?options.depthTexture:null}function WebGLRenderTargetCube(width,height,options){WebGLRenderTarget.call(this,width,height,options),this.activeCubeFace=0,this.activeMipMapLevel=0}function Quaternion(x,y,z,w){this._x=x||0,this._y=y||0,this._z=z||0,this._w=void 0!==w?w:1}function Vector3(x,y,z){this.x=x||0,this.y=y||0,this.z=z||0}function Matrix4(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function CubeTexture(images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding){Texture.call(this,images=void 0!==images?images:[],mapping=void 0!==mapping?mapping:CubeReflectionMapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding),this.flipY=!1}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=300,Texture.prototype={constructor:Texture,isTexture:!0,set needsUpdate(value){!0===value&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(source){return this.image=source.image,this.mipmaps=source.mipmaps.slice(0),this.mapping=source.mapping,this.wrapS=source.wrapS,this.wrapT=source.wrapT,this.magFilter=source.magFilter,this.minFilter=source.minFilter,this.anisotropy=source.anisotropy,this.format=source.format,this.type=source.type,this.offset.copy(source.offset),this.repeat.copy(source.repeat),this.generateMipmaps=source.generateMipmaps,this.premultiplyAlpha=source.premultiplyAlpha,this.flipY=source.flipY,this.unpackAlignment=source.unpackAlignment,this.encoding=source.encoding,this},toJSON:function(meta){if(void 0!==meta.textures[this.uuid])return meta.textures[this.uuid];var output={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var image=this.image;void 0===image.uuid&&(image.uuid=_Math.generateUUID()),void 0===meta.images[image.uuid]&&(meta.images[image.uuid]={uuid:image.uuid,url:function(image){var canvas;return void 0!==image.toDataURL?canvas=image:((canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=image.width,canvas.height=image.height,canvas.getContext("2d").drawImage(image,0,0,image.width,image.height)),2048<canvas.width||2048<canvas.height?canvas.toDataURL("image/jpeg",.6):canvas.toDataURL("image/png")}(image)}),output.image=image.uuid}return meta.textures[this.uuid]=output},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(uv){if(300===this.mapping){if(uv.multiply(this.repeat),uv.add(this.offset),uv.x<0||1<uv.x)switch(this.wrapS){case 1e3:uv.x=uv.x-Math.floor(uv.x);break;case ClampToEdgeWrapping:uv.x=uv.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(uv.x)%2)?uv.x=Math.ceil(uv.x)-uv.x:uv.x=uv.x-Math.floor(uv.x)}if(uv.y<0||1<uv.y)switch(this.wrapT){case 1e3:uv.y=uv.y-Math.floor(uv.y);break;case ClampToEdgeWrapping:uv.y=uv.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(uv.y)%2)?uv.y=Math.ceil(uv.y)-uv.y:uv.y=uv.y-Math.floor(uv.y)}this.flipY&&(uv.y=1-uv.y)}}},Object.assign(Texture.prototype,EventDispatcher.prototype),Vector4.prototype={constructor:Vector4,isVector4:!0,set:function(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this},setScalar:function(scalar){return this.x=scalar,this.y=scalar,this.z=scalar,this.w=scalar,this},setX:function(x){return this.x=x,this},setY:function(y){return this.y=y,this},setZ:function(z){return this.z=z,this},setW:function(w){return this.w=w,this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;case 3:this.w=value;break;default:throw new Error("index is out of range: "+index)}return this},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+index)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=void 0!==v.w?v.w:1,this},add:function(v,w){return void 0!==w?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(v,w)):(this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this)},addScalar:function(s){return this.x+=s,this.y+=s,this.z+=s,this.w+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},addScaledVector:function(v,s){return this.x+=v.x*s,this.y+=v.y*s,this.z+=v.z*s,this.w+=v.w*s,this},sub:function(v,w){return void 0!==w?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(v,w)):(this.x-=v.x,this.y-=v.y,this.z-=v.z,this.w-=v.w,this)},subScalar:function(s){return this.x-=s,this.y-=s,this.z-=s,this.w-=s,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},multiplyScalar:function(scalar){return isFinite(scalar)?(this.x*=scalar,this.y*=scalar,this.z*=scalar,this.w*=scalar):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(m){var x=this.x,y=this.y,z=this.z,w=this.w,e=m.elements;return this.x=e[0]*x+e[4]*y+e[8]*z+e[12]*w,this.y=e[1]*x+e[5]*y+e[9]*z+e[13]*w,this.z=e[2]*x+e[6]*y+e[10]*z+e[14]*w,this.w=e[3]*x+e[7]*y+e[11]*z+e[15]*w,this},divideScalar:function(scalar){return this.multiplyScalar(1/scalar)},setAxisAngleFromQuaternion:function(q){this.w=2*Math.acos(q.w);var s=Math.sqrt(1-q.w*q.w);return s<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=q.x/s,this.y=q.y/s,this.z=q.z/s),this},setAxisAngleFromRotationMatrix:function(m){var angle,x,y,z,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];if(Math.abs(m12-m21)<.01&&Math.abs(m13-m31)<.01&&Math.abs(m23-m32)<.01){if(Math.abs(m12+m21)<.1&&Math.abs(m13+m31)<.1&&Math.abs(m23+m32)<.1&&Math.abs(m11+m22+m33-3)<.1)return this.set(1,0,0,0),this;angle=Math.PI;var xx=(m11+1)/2,yy=(m22+1)/2,zz=(m33+1)/2,xy=(m12+m21)/4,xz=(m13+m31)/4,yz=(m23+m32)/4;return yy<xx&&zz<xx?z=xx<.01?(x=0,y=.707106781):(y=xy/(x=Math.sqrt(xx)),xz/x):zz<yy?z=yy<.01?(y=0,x=.707106781):(x=xy/(y=Math.sqrt(yy)),yz/y):zz<.01?(y=x=.707106781,z=0):(x=xz/(z=Math.sqrt(zz)),y=yz/z),this.set(x,y,z,angle),this}var s=Math.sqrt((m32-m23)*(m32-m23)+(m13-m31)*(m13-m31)+(m21-m12)*(m21-m12));return Math.abs(s)<.001&&(s=1),this.x=(m32-m23)/s,this.y=(m13-m31)/s,this.z=(m21-m12)/s,this.w=Math.acos((m11+m22+m33-1)/2),this},min:function(v){return this.x=Math.min(this.x,v.x),this.y=Math.min(this.y,v.y),this.z=Math.min(this.z,v.z),this.w=Math.min(this.w,v.w),this},max:function(v){return this.x=Math.max(this.x,v.x),this.y=Math.max(this.y,v.y),this.z=Math.max(this.z,v.z),this.w=Math.max(this.w,v.w),this},clamp:function(min,max){return this.x=Math.max(min.x,Math.min(max.x,this.x)),this.y=Math.max(min.y,Math.min(max.y,this.y)),this.z=Math.max(min.z,Math.min(max.z,this.z)),this.w=Math.max(min.w,Math.min(max.w,this.w)),this},clampScalar:function(){var min,max;return function(minVal,maxVal){return void 0===min&&(min=new Vector4,max=new Vector4),min.set(minVal,minVal,minVal,minVal),max.set(maxVal,maxVal,maxVal,maxVal),this.clamp(min,max)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(length){return this.multiplyScalar(length/this.length())},lerp:function(v,alpha){return this.x+=(v.x-this.x)*alpha,this.y+=(v.y-this.y)*alpha,this.z+=(v.z-this.z)*alpha,this.w+=(v.w-this.w)*alpha,this},lerpVectors:function(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z&&v.w===this.w},fromArray:function(array,offset){return void 0===offset&&(offset=0),this.x=array[offset],this.y=array[offset+1],this.z=array[offset+2],this.w=array[offset+3],this},toArray:function(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.x,array[offset+1]=this.y,array[offset+2]=this.z,array[offset+3]=this.w,array},fromAttribute:function(attribute,index,offset){return void 0!==offset&&console.warn("THREE.Vector4: offset has been removed from .fromAttribute()."),this.x=attribute.getX(index),this.y=attribute.getY(index),this.z=attribute.getZ(index),this.w=attribute.getW(index),this}},Object.assign(WebGLRenderTarget.prototype,EventDispatcher.prototype,{isWebGLRenderTarget:!0,setSize:function(width,height){this.width===width&&this.height===height||(this.width=width,this.height=height,this.dispose()),this.viewport.set(0,0,width,height),this.scissor.set(0,0,width,height)},clone:function(){return(new this.constructor).copy(this)},copy:function(source){return this.width=source.width,this.height=source.height,this.viewport.copy(source.viewport),this.texture=source.texture.clone(),this.depthBuffer=source.depthBuffer,this.stencilBuffer=source.stencilBuffer,this.depthTexture=source.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),((WebGLRenderTargetCube.prototype=Object.create(WebGLRenderTarget.prototype)).constructor=WebGLRenderTargetCube).prototype.isWebGLRenderTargetCube=!0,Quaternion.prototype={constructor:Quaternion,get x(){return this._x},set x(value){this._x=value,this.onChangeCallback()},get y(){return this._y},set y(value){this._y=value,this.onChangeCallback()},get z(){return this._z},set z(value){this._z=value,this.onChangeCallback()},get w(){return this._w},set w(value){this._w=value,this.onChangeCallback()},set:function(x,y,z,w){return this._x=x,this._y=y,this._z=z,this._w=w,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(quaternion){return this._x=quaternion.x,this._y=quaternion.y,this._z=quaternion.z,this._w=quaternion.w,this.onChangeCallback(),this},setFromEuler:function(euler,update){if(!1===(euler&&euler.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var c1=Math.cos(euler._x/2),c2=Math.cos(euler._y/2),c3=Math.cos(euler._z/2),s1=Math.sin(euler._x/2),s2=Math.sin(euler._y/2),s3=Math.sin(euler._z/2),order=euler.order;return"XYZ"===order?(this._x=s1*c2*c3+c1*s2*s3,this._y=c1*s2*c3-s1*c2*s3,this._z=c1*c2*s3+s1*s2*c3,this._w=c1*c2*c3-s1*s2*s3):"YXZ"===order?(this._x=s1*c2*c3+c1*s2*s3,this._y=c1*s2*c3-s1*c2*s3,this._z=c1*c2*s3-s1*s2*c3,this._w=c1*c2*c3+s1*s2*s3):"ZXY"===order?(this._x=s1*c2*c3-c1*s2*s3,this._y=c1*s2*c3+s1*c2*s3,this._z=c1*c2*s3+s1*s2*c3,this._w=c1*c2*c3-s1*s2*s3):"ZYX"===order?(this._x=s1*c2*c3-c1*s2*s3,this._y=c1*s2*c3+s1*c2*s3,this._z=c1*c2*s3-s1*s2*c3,this._w=c1*c2*c3+s1*s2*s3):"YZX"===order?(this._x=s1*c2*c3+c1*s2*s3,this._y=c1*s2*c3+s1*c2*s3,this._z=c1*c2*s3-s1*s2*c3,this._w=c1*c2*c3-s1*s2*s3):"XZY"===order&&(this._x=s1*c2*c3-c1*s2*s3,this._y=c1*s2*c3-s1*c2*s3,this._z=c1*c2*s3+s1*s2*c3,this._w=c1*c2*c3+s1*s2*s3),!1!==update&&this.onChangeCallback(),this},setFromAxisAngle:function(axis,angle){var halfAngle=angle/2,s=Math.sin(halfAngle);return this._x=axis.x*s,this._y=axis.y*s,this._z=axis.z*s,this._w=Math.cos(halfAngle),this.onChangeCallback(),this},setFromRotationMatrix:function(m){var s,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],trace=m11+m22+m33;return 0<trace?(s=.5/Math.sqrt(trace+1),this._w=.25/s,this._x=(m32-m23)*s,this._y=(m13-m31)*s,this._z=(m21-m12)*s):m22<m11&&m33<m11?(s=2*Math.sqrt(1+m11-m22-m33),this._w=(m32-m23)/s,this._x=.25*s,this._y=(m12+m21)/s,this._z=(m13+m31)/s):m33<m22?(s=2*Math.sqrt(1+m22-m11-m33),this._w=(m13-m31)/s,this._x=(m12+m21)/s,this._y=.25*s,this._z=(m23+m32)/s):(s=2*Math.sqrt(1+m33-m11-m22),this._w=(m21-m12)/s,this._x=(m13+m31)/s,this._y=(m23+m32)/s,this._z=.25*s),this.onChangeCallback(),this},setFromUnitVectors:function(){var v1,r;return function(vFrom,vTo){return void 0===v1&&(v1=new Vector3),(r=vFrom.dot(vTo)+1)<1e-6?(r=0,Math.abs(vFrom.x)>Math.abs(vFrom.z)?v1.set(-vFrom.y,vFrom.x,0):v1.set(0,-vFrom.z,vFrom.y)):v1.crossVectors(vFrom,vTo),this._x=v1.x,this._y=v1.y,this._z=v1.z,this._w=r,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(v){return this._x*v._x+this._y*v._y+this._z*v._z+this._w*v._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var l=this.length();return 0===l?(this._x=0,this._y=0,this._z=0,this._w=1):(l=1/l,this._x=this._x*l,this._y=this._y*l,this._z=this._z*l,this._w=this._w*l),this.onChangeCallback(),this},multiply:function(q,p){return void 0!==p?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(q,p)):this.multiplyQuaternions(this,q)},premultiply:function(q){return this.multiplyQuaternions(q,this)},multiplyQuaternions:function(a,b){var qax=a._x,qay=a._y,qaz=a._z,qaw=a._w,qbx=b._x,qby=b._y,qbz=b._z,qbw=b._w;return this._x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby,this._y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz,this._z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx,this._w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz,this.onChangeCallback(),this},slerp:function(qb,t){if(0===t)return this;if(1===t)return this.copy(qb);var x=this._x,y=this._y,z=this._z,w=this._w,cosHalfTheta=w*qb._w+x*qb._x+y*qb._y+z*qb._z;if(cosHalfTheta<0?(this._w=-qb._w,this._x=-qb._x,this._y=-qb._y,this._z=-qb._z,cosHalfTheta=-cosHalfTheta):this.copy(qb),1<=cosHalfTheta)return this._w=w,this._x=x,this._y=y,this._z=z,this;var sinHalfTheta=Math.sqrt(1-cosHalfTheta*cosHalfTheta);if(Math.abs(sinHalfTheta)<.001)return this._w=.5*(w+this._w),this._x=.5*(x+this._x),this._y=.5*(y+this._y),this._z=.5*(z+this._z),this;var halfTheta=Math.atan2(sinHalfTheta,cosHalfTheta),ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,ratioB=Math.sin(t*halfTheta)/sinHalfTheta;return this._w=w*ratioA+this._w*ratioB,this._x=x*ratioA+this._x*ratioB,this._y=y*ratioA+this._y*ratioB,this._z=z*ratioA+this._z*ratioB,this.onChangeCallback(),this},equals:function(quaternion){return quaternion._x===this._x&&quaternion._y===this._y&&quaternion._z===this._z&&quaternion._w===this._w},fromArray:function(array,offset){return void 0===offset&&(offset=0),this._x=array[offset],this._y=array[offset+1],this._z=array[offset+2],this._w=array[offset+3],this.onChangeCallback(),this},toArray:function(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this._x,array[offset+1]=this._y,array[offset+2]=this._z,array[offset+3]=this._w,array},onChange:function(callback){return this.onChangeCallback=callback,this},onChangeCallback:function(){}},Object.assign(Quaternion,{slerp:function(qa,qb,qm,t){return qm.copy(qa).slerp(qb,t)},slerpFlat:function(dst,dstOffset,src0,srcOffset0,src1,srcOffset1,t){var x0=src0[srcOffset0+0],y0=src0[srcOffset0+1],z0=src0[srcOffset0+2],w0=src0[srcOffset0+3],x1=src1[srcOffset1+0],y1=src1[srcOffset1+1],z1=src1[srcOffset1+2],w1=src1[srcOffset1+3];if(w0!==w1||x0!==x1||y0!==y1||z0!==z1){var s=1-t,cos=x0*x1+y0*y1+z0*z1+w0*w1,dir=0<=cos?1:-1,sqrSin=1-cos*cos;if(sqrSin>Number.EPSILON){var sin=Math.sqrt(sqrSin),len=Math.atan2(sin,cos*dir);s=Math.sin(s*len)/sin,t=Math.sin(t*len)/sin}var tDir=t*dir;if(x0=x0*s+x1*tDir,y0=y0*s+y1*tDir,z0=z0*s+z1*tDir,w0=w0*s+w1*tDir,s===1-t){var f=1/Math.sqrt(x0*x0+y0*y0+z0*z0+w0*w0);x0*=f,y0*=f,z0*=f,w0*=f}}dst[dstOffset]=x0,dst[dstOffset+1]=y0,dst[dstOffset+2]=z0,dst[dstOffset+3]=w0}}),Vector3.prototype={constructor:Vector3,isVector3:!0,set:function(x,y,z){return this.x=x,this.y=y,this.z=z,this},setScalar:function(scalar){return this.x=scalar,this.y=scalar,this.z=scalar,this},setX:function(x){return this.x=x,this},setY:function(y){return this.y=y,this},setZ:function(z){return this.z=z,this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;default:throw new Error("index is out of range: "+index)}return this},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+index)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this},add:function(v,w){return void 0!==w?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(v,w)):(this.x+=v.x,this.y+=v.y,this.z+=v.z,this)},addScalar:function(s){return this.x+=s,this.y+=s,this.z+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},addScaledVector:function(v,s){return this.x+=v.x*s,this.y+=v.y*s,this.z+=v.z*s,this},sub:function(v,w){return void 0!==w?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(v,w)):(this.x-=v.x,this.y-=v.y,this.z-=v.z,this)},subScalar:function(s){return this.x-=s,this.y-=s,this.z-=s,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(v,w){return void 0!==w?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(v,w)):(this.x*=v.x,this.y*=v.y,this.z*=v.z,this)},multiplyScalar:function(scalar){return isFinite(scalar)?(this.x*=scalar,this.y*=scalar,this.z*=scalar):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyEuler:function(euler){return!1===(euler&&euler.isEuler)&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),void 0===quaternion&&(quaternion=new Quaternion),this.applyQuaternion(quaternion.setFromEuler(euler))},applyAxisAngle:function(){var quaternion;return function(axis,angle){return void 0===quaternion&&(quaternion=new Quaternion),this.applyQuaternion(quaternion.setFromAxisAngle(axis,angle))}}(),applyMatrix3:function(m){var x=this.x,y=this.y,z=this.z,e=m.elements;return this.x=e[0]*x+e[3]*y+e[6]*z,this.y=e[1]*x+e[4]*y+e[7]*z,this.z=e[2]*x+e[5]*y+e[8]*z,this},applyMatrix4:function(m){var x=this.x,y=this.y,z=this.z,e=m.elements;return this.x=e[0]*x+e[4]*y+e[8]*z+e[12],this.y=e[1]*x+e[5]*y+e[9]*z+e[13],this.z=e[2]*x+e[6]*y+e[10]*z+e[14],this},applyProjection:function(m){var x=this.x,y=this.y,z=this.z,e=m.elements,d=1/(e[3]*x+e[7]*y+e[11]*z+e[15]);return this.x=(e[0]*x+e[4]*y+e[8]*z+e[12])*d,this.y=(e[1]*x+e[5]*y+e[9]*z+e[13])*d,this.z=(e[2]*x+e[6]*y+e[10]*z+e[14])*d,this},applyQuaternion:function(q){var x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,qw=q.w,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy,this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz,this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx,this},project:function(camera){return void 0===matrix&&(matrix=new Matrix4),matrix.multiplyMatrices(camera.projectionMatrix,matrix.getInverse(camera.matrixWorld)),this.applyProjection(matrix)},unproject:function(){var matrix;return function(camera){return void 0===matrix&&(matrix=new Matrix4),matrix.multiplyMatrices(camera.matrixWorld,matrix.getInverse(camera.projectionMatrix)),this.applyProjection(matrix)}}(),transformDirection:function(m){var x=this.x,y=this.y,z=this.z,e=m.elements;return this.x=e[0]*x+e[4]*y+e[8]*z,this.y=e[1]*x+e[5]*y+e[9]*z,this.z=e[2]*x+e[6]*y+e[10]*z,this.normalize()},divide:function(v){return this.x/=v.x,this.y/=v.y,this.z/=v.z,this},divideScalar:function(scalar){return this.multiplyScalar(1/scalar)},min:function(v){return this.x=Math.min(this.x,v.x),this.y=Math.min(this.y,v.y),this.z=Math.min(this.z,v.z),this},max:function(v){return this.x=Math.max(this.x,v.x),this.y=Math.max(this.y,v.y),this.z=Math.max(this.z,v.z),this},clamp:function(min,max){return this.x=Math.max(min.x,Math.min(max.x,this.x)),this.y=Math.max(min.y,Math.min(max.y,this.y)),this.z=Math.max(min.z,Math.min(max.z,this.z)),this},clampScalar:function(){var min,max;return function(minVal,maxVal){return void 0===min&&(min=new Vector3,max=new Vector3),min.set(minVal,minVal,minVal),max.set(maxVal,maxVal,maxVal),this.clamp(min,max)}}(),clampLength:function(min,max){var length=this.length();return this.multiplyScalar(Math.max(min,Math.min(max,length))/length)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(length){return this.multiplyScalar(length/this.length())},lerp:function(v,alpha){return this.x+=(v.x-this.x)*alpha,this.y+=(v.y-this.y)*alpha,this.z+=(v.z-this.z)*alpha,this},lerpVectors:function(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)},cross:function(v,w){if(void 0!==w)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(v,w);var x=this.x,y=this.y,z=this.z;return this.x=y*v.z-z*v.y,this.y=z*v.x-x*v.z,this.z=x*v.y-y*v.x,this},crossVectors:function(a,b){var ax=a.x,ay=a.y,az=a.z,bx=b.x,by=b.y,bz=b.z;return this.x=ay*bz-az*by,this.y=az*bx-ax*bz,this.z=ax*by-ay*bx,this},projectOnVector:function(vector){var scalar=vector.dot(this)/vector.lengthSq();return this.copy(vector).multiplyScalar(scalar)},projectOnPlane:function(planeNormal){return void 0===v1&&(v1=new Vector3),v1.copy(this).projectOnVector(planeNormal),this.sub(v1)},reflect:function(){var v1;return function(normal){return void 0===v1&&(v1=new Vector3),this.sub(v1.copy(normal).multiplyScalar(2*this.dot(normal)))}}(),angleTo:function(v){var theta=this.dot(v)/Math.sqrt(this.lengthSq()*v.lengthSq());return Math.acos(_Math.clamp(theta,-1,1))},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y,dz=this.z-v.z;return dx*dx+dy*dy+dz*dz},distanceToManhattan:function(v){return Math.abs(this.x-v.x)+Math.abs(this.y-v.y)+Math.abs(this.z-v.z)},setFromSpherical:function(s){var sinPhiRadius=Math.sin(s.phi)*s.radius;return this.x=sinPhiRadius*Math.sin(s.theta),this.y=Math.cos(s.phi)*s.radius,this.z=sinPhiRadius*Math.cos(s.theta),this},setFromCylindrical:function(c){return this.x=c.radius*Math.sin(c.theta),this.y=c.y,this.z=c.radius*Math.cos(c.theta),this},setFromMatrixPosition:function(m){return this.setFromMatrixColumn(m,3)},setFromMatrixScale:function(m){var sx=this.setFromMatrixColumn(m,0).length(),sy=this.setFromMatrixColumn(m,1).length(),sz=this.setFromMatrixColumn(m,2).length();return this.x=sx,this.y=sy,this.z=sz,this},setFromMatrixColumn:function(m,index){if("number"==typeof m){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var temp=m;m=index,index=temp}return this.fromArray(m.elements,4*index)},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z},fromArray:function(array,offset){return void 0===offset&&(offset=0),this.x=array[offset],this.y=array[offset+1],this.z=array[offset+2],this},toArray:function(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.x,array[offset+1]=this.y,array[offset+2]=this.z,array},fromAttribute:function(attribute,index,offset){return void 0!==offset&&console.warn("THREE.Vector3: offset has been removed from .fromAttribute()."),this.x=attribute.getX(index),this.y=attribute.getY(index),this.z=attribute.getZ(index),this}},Matrix4.prototype={constructor:Matrix4,isMatrix4:!0,set:function(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){var te=this.elements;return te[0]=n11,te[4]=n12,te[8]=n13,te[12]=n14,te[1]=n21,te[5]=n22,te[9]=n23,te[13]=n24,te[2]=n31,te[6]=n32,te[10]=n33,te[14]=n34,te[3]=n41,te[7]=n42,te[11]=n43,te[15]=n44,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Matrix4).fromArray(this.elements)},copy:function(m){return this.elements.set(m.elements),this},copyPosition:function(m){var te=this.elements,me=m.elements;return te[12]=me[12],te[13]=me[13],te[14]=me[14],this},extractBasis:function(xAxis,yAxis,zAxis){return xAxis.setFromMatrixColumn(this,0),yAxis.setFromMatrixColumn(this,1),zAxis.setFromMatrixColumn(this,2),this},makeBasis:function(xAxis,yAxis,zAxis){return this.set(xAxis.x,yAxis.x,zAxis.x,0,xAxis.y,yAxis.y,zAxis.y,0,xAxis.z,yAxis.z,zAxis.z,0,0,0,0,1),this},extractRotation:function(){var v1;return function(m){void 0===v1&&(v1=new Vector3);var te=this.elements,me=m.elements,scaleX=1/v1.setFromMatrixColumn(m,0).length(),scaleY=1/v1.setFromMatrixColumn(m,1).length(),scaleZ=1/v1.setFromMatrixColumn(m,2).length();return te[0]=me[0]*scaleX,te[1]=me[1]*scaleX,te[2]=me[2]*scaleX,te[4]=me[4]*scaleY,te[5]=me[5]*scaleY,te[6]=me[6]*scaleY,te[8]=me[8]*scaleZ,te[9]=me[9]*scaleZ,te[10]=me[10]*scaleZ,this}}(),makeRotationFromEuler:function(euler){!1===(euler&&euler.isEuler)&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var te=this.elements,x=euler.x,y=euler.y,z=euler.z,a=Math.cos(x),b=Math.sin(x),c=Math.cos(y),d=Math.sin(y),e=Math.cos(z),f=Math.sin(z);if("XYZ"===euler.order){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e,te[4]=-c*f,te[8]=d,te[1]=af+be*d,te[5]=ae-bf*d,te[9]=-b*c,te[2]=bf-ae*d,te[6]=be+af*d,te[10]=a*c}else if("YXZ"===euler.order){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b,te[4]=de*b-cf,te[8]=a*d,te[1]=a*f,te[5]=a*e,te[9]=-b,te[2]=cf*b-de,te[6]=df+ce*b,te[10]=a*c}else if("ZXY"===euler.order){ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce-df*b,te[4]=-a*f,te[8]=de+cf*b,te[1]=cf+de*b,te[5]=a*e,te[9]=df-ce*b,te[2]=-a*d,te[6]=b,te[10]=a*c}else if("ZYX"===euler.order){ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e,te[4]=be*d-af,te[8]=ae*d+bf,te[1]=c*f,te[5]=bf*d+ae,te[9]=af*d-be,te[2]=-d,te[6]=b*c,te[10]=a*c}else if("YZX"===euler.order){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e,te[4]=bd-ac*f,te[8]=bc*f+ad,te[1]=f,te[5]=a*e,te[9]=-b*e,te[2]=-d*e,te[6]=ad*f+bc,te[10]=ac-bd*f}else if("XZY"===euler.order){ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e,te[4]=-f,te[8]=d*e,te[1]=ac*f+bd,te[5]=a*e,te[9]=ad*f-bc,te[2]=bc*f-ad,te[6]=b*e,te[10]=bd*f+ac}return te[3]=0,te[7]=0,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this},makeRotationFromQuaternion:function(q){var te=this.elements,x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return te[0]=1-(yy+zz),te[4]=xy-wz,te[8]=xz+wy,te[1]=xy+wz,te[5]=1-(xx+zz),te[9]=yz-wx,te[2]=xz-wy,te[6]=yz+wx,te[10]=1-(xx+yy),te[3]=0,te[7]=0,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this},lookAt:function(eye,target,up){void 0===x&&(x=new Vector3,y=new Vector3,z=new Vector3);var te=this.elements;return z.subVectors(eye,target).normalize(),0===z.lengthSq()&&(z.z=1),x.crossVectors(up,z).normalize(),0===x.lengthSq()&&(z.z+=1e-4,x.crossVectors(up,z).normalize()),y.crossVectors(z,x),te[0]=x.x,te[4]=y.x,te[8]=z.x,te[1]=x.y,te[5]=y.y,te[9]=z.y,te[2]=x.z,te[6]=y.z,te[10]=z.z,this},multiply:function(m,n){return void 0!==n?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(m,n)):this.multiplyMatrices(this,m)},premultiply:function(m){return this.multiplyMatrices(m,this)},multiplyMatrices:function(a,b){var ae=a.elements,be=b.elements,te=this.elements,a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12],a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13],a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14],a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15],b11=be[0],b12=be[4],b13=be[8],b14=be[12],b21=be[1],b22=be[5],b23=be[9],b24=be[13],b31=be[2],b32=be[6],b33=be[10],b34=be[14],b41=be[3],b42=be[7],b43=be[11],b44=be[15];return te[0]=a11*b11+a12*b21+a13*b31+a14*b41,te[4]=a11*b12+a12*b22+a13*b32+a14*b42,te[8]=a11*b13+a12*b23+a13*b33+a14*b43,te[12]=a11*b14+a12*b24+a13*b34+a14*b44,te[1]=a21*b11+a22*b21+a23*b31+a24*b41,te[5]=a21*b12+a22*b22+a23*b32+a24*b42,te[9]=a21*b13+a22*b23+a23*b33+a24*b43,te[13]=a21*b14+a22*b24+a23*b34+a24*b44,te[2]=a31*b11+a32*b21+a33*b31+a34*b41,te[6]=a31*b12+a32*b22+a33*b32+a34*b42,te[10]=a31*b13+a32*b23+a33*b33+a34*b43,te[14]=a31*b14+a32*b24+a33*b34+a34*b44,te[3]=a41*b11+a42*b21+a43*b31+a44*b41,te[7]=a41*b12+a42*b22+a43*b32+a44*b42,te[11]=a41*b13+a42*b23+a43*b33+a44*b43,te[15]=a41*b14+a42*b24+a43*b34+a44*b44,this},multiplyToArray:function(a,b,r){var te=this.elements;return this.multiplyMatrices(a,b),r[0]=te[0],r[1]=te[1],r[2]=te[2],r[3]=te[3],r[4]=te[4],r[5]=te[5],r[6]=te[6],r[7]=te[7],r[8]=te[8],r[9]=te[9],r[10]=te[10],r[11]=te[11],r[12]=te[12],r[13]=te[13],r[14]=te[14],r[15]=te[15],this},multiplyScalar:function(s){var te=this.elements;return te[0]*=s,te[4]*=s,te[8]*=s,te[12]*=s,te[1]*=s,te[5]*=s,te[9]*=s,te[13]*=s,te[2]*=s,te[6]*=s,te[10]*=s,te[14]*=s,te[3]*=s,te[7]*=s,te[11]*=s,te[15]*=s,this},applyToVector3Array:function(){var v1;return function(array,offset,length){void 0===v1&&(v1=new Vector3),void 0===offset&&(offset=0),void 0===length&&(length=array.length);for(var i=0,j=offset;i<length;i+=3,j+=3)v1.fromArray(array,j),v1.applyMatrix4(this),v1.toArray(array,j);return array}}(),applyToBufferAttribute:function(){var v1;return function(attribute){void 0===v1&&(v1=new Vector3);for(var i=0,l=attribute.count;i<l;i++)v1.x=attribute.getX(i),v1.y=attribute.getY(i),v1.z=attribute.getZ(i),v1.applyMatrix4(this),attribute.setXYZ(i,v1.x,v1.y,v1.z);return attribute}}(),determinant:function(){var te=this.elements,n11=te[0],n12=te[4],n13=te[8],n14=te[12],n21=te[1],n22=te[5],n23=te[9],n24=te[13],n31=te[2],n32=te[6],n33=te[10],n34=te[14];return te[3]*(+n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34)+te[7]*(+n11*n23*n34-n11*n24*n33+n14*n21*n33-n13*n21*n34+n13*n24*n31-n14*n23*n31)+te[11]*(+n11*n24*n32-n11*n22*n34-n14*n21*n32+n12*n21*n34+n14*n22*n31-n12*n24*n31)+te[15]*(-n13*n22*n31-n11*n23*n32+n11*n22*n33+n13*n21*n32-n12*n21*n33+n12*n23*n31)},transpose:function(){var tmp,te=this.elements;return tmp=te[1],te[1]=te[4],te[4]=tmp,tmp=te[2],te[2]=te[8],te[8]=tmp,tmp=te[6],te[6]=te[9],te[9]=tmp,tmp=te[3],te[3]=te[12],te[12]=tmp,tmp=te[7],te[7]=te[13],te[13]=tmp,tmp=te[11],te[11]=te[14],te[14]=tmp,this},setPosition:function(v){var te=this.elements;return te[12]=v.x,te[13]=v.y,te[14]=v.z,this},getInverse:function(m,throwOnDegenerate){var te=this.elements,me=m.elements,n11=me[0],n21=me[1],n31=me[2],n41=me[3],n12=me[4],n22=me[5],n32=me[6],n42=me[7],n13=me[8],n23=me[9],n33=me[10],n43=me[11],n14=me[12],n24=me[13],n34=me[14],n44=me[15],t11=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44,t12=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44,t13=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44,t14=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34,det=n11*t11+n21*t12+n31*t13+n41*t14;if(0==det){var msg="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(!0===throwOnDegenerate)throw new Error(msg);return console.warn(msg),this.identity()}var detInv=1/det;return te[0]=t11*detInv,te[1]=(n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44)*detInv,te[2]=(n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44)*detInv,te[3]=(n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43)*detInv,te[4]=t12*detInv,te[5]=(n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44)*detInv,te[6]=(n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44)*detInv,te[7]=(n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43)*detInv,te[8]=t13*detInv,te[9]=(n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44)*detInv,te[10]=(n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44)*detInv,te[11]=(n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43)*detInv,te[12]=t14*detInv,te[13]=(n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34)*detInv,te[14]=(n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34)*detInv,te[15]=(n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33)*detInv,this},scale:function(v){var te=this.elements,x=v.x,y=v.y,z=v.z;return te[0]*=x,te[4]*=y,te[8]*=z,te[1]*=x,te[5]*=y,te[9]*=z,te[2]*=x,te[6]*=y,te[10]*=z,te[3]*=x,te[7]*=y,te[11]*=z,this},getMaxScaleOnAxis:function(){var te=this.elements,scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2],scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6],scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];return Math.sqrt(Math.max(scaleXSq,scaleYSq,scaleZSq))},makeTranslation:function(x,y,z){return this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1),this},makeRotationX:function(theta){var c=Math.cos(theta),s=Math.sin(theta);return this.set(1,0,0,0,0,c,-s,0,0,s,c,0,0,0,0,1),this},makeRotationY:function(theta){var c=Math.cos(theta),s=Math.sin(theta);return this.set(c,0,s,0,0,1,0,0,-s,0,c,0,0,0,0,1),this},makeRotationZ:function(theta){var c=Math.cos(theta),s=Math.sin(theta);return this.set(c,-s,0,0,s,c,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(axis,angle){var c=Math.cos(angle),s=Math.sin(angle),t=1-c,x=axis.x,y=axis.y,z=axis.z,tx=t*x,ty=t*y;return this.set(tx*x+c,tx*y-s*z,tx*z+s*y,0,tx*y+s*z,ty*y+c,ty*z-s*x,0,tx*z-s*y,ty*z+s*x,t*z*z+c,0,0,0,0,1),this},makeScale:function(x,y,z){return this.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1),this},makeShear:function(x,y,z){return this.set(1,y,z,0,x,1,z,0,x,y,1,0,0,0,0,1),this},compose:function(position,quaternion,scale){return this.makeRotationFromQuaternion(quaternion),this.scale(scale),this.setPosition(position),this},decompose:function(){var vector,matrix;return function(position,quaternion,scale){void 0===vector&&(vector=new Vector3,matrix=new Matrix4);var te=this.elements,sx=vector.set(te[0],te[1],te[2]).length(),sy=vector.set(te[4],te[5],te[6]).length(),sz=vector.set(te[8],te[9],te[10]).length();this.determinant()<0&&(sx=-sx),position.x=te[12],position.y=te[13],position.z=te[14],matrix.elements.set(this.elements);var invSX=1/sx,invSY=1/sy,invSZ=1/sz;return matrix.elements[0]*=invSX,matrix.elements[1]*=invSX,matrix.elements[2]*=invSX,matrix.elements[4]*=invSY,matrix.elements[5]*=invSY,matrix.elements[6]*=invSY,matrix.elements[8]*=invSZ,matrix.elements[9]*=invSZ,matrix.elements[10]*=invSZ,quaternion.setFromRotationMatrix(matrix),scale.x=sx,scale.y=sy,scale.z=sz,this}}(),makeFrustum:function(left,right,bottom,top,near,far){var te=this.elements,x=2*near/(right-left),y=2*near/(top-bottom),a=(right+left)/(right-left),b=(top+bottom)/(top-bottom),c=-(far+near)/(far-near),d=-2*far*near/(far-near);return te[0]=x,te[4]=0,te[8]=a,te[12]=0,te[1]=0,te[5]=y,te[9]=b,te[13]=0,te[2]=0,te[6]=0,te[10]=c,te[14]=d,te[3]=0,te[7]=0,te[11]=-1,te[15]=0,this},makePerspective:function(fov,aspect,near,far){var ymax=near*Math.tan(_Math.DEG2RAD*fov*.5),ymin=-ymax,xmin=ymin*aspect,xmax=ymax*aspect;return this.makeFrustum(xmin,xmax,ymin,ymax,near,far)},makeOrthographic:function(left,right,top,bottom,near,far){var te=this.elements,w=1/(right-left),h=1/(top-bottom),p=1/(far-near),x=(right+left)*w,y=(top+bottom)*h,z=(far+near)*p;return te[0]=2*w,te[4]=0,te[8]=0,te[12]=-x,te[1]=0,te[5]=2*h,te[9]=0,te[13]=-y,te[2]=0,te[6]=0,te[10]=-2*p,te[14]=-z,te[3]=0,te[7]=0,te[11]=0,te[15]=1,this},equals:function(matrix){for(var te=this.elements,me=matrix.elements,i=0;i<16;i++)if(te[i]!==me[i])return!1;return!0},fromArray:function(array,offset){void 0===offset&&(offset=0);for(var i=0;i<16;i++)this.elements[i]=array[i+offset];return this},toArray:function(array,offset){void 0===array&&(array=[]),void 0===offset&&(offset=0);var te=this.elements;return array[offset]=te[0],array[offset+1]=te[1],array[offset+2]=te[2],array[offset+3]=te[3],array[offset+4]=te[4],array[offset+5]=te[5],array[offset+6]=te[6],array[offset+7]=te[7],array[offset+8]=te[8],array[offset+9]=te[9],array[offset+10]=te[10],array[offset+11]=te[11],array[offset+12]=te[12],array[offset+13]=te[13],array[offset+14]=te[14],array[offset+15]=te[15],array}},((CubeTexture.prototype=Object.create(Texture.prototype)).constructor=CubeTexture).prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(value){this.image=value}});var emptyTexture=new Texture,emptyCubeTexture=new CubeTexture;function UniformContainer(){this.seq=[],this.map={}}var arrayCacheF32=[],arrayCacheI32=[];function flatten(array,nBlocks,blockSize){var firstElem=array[0];if(firstElem<=0||0<firstElem)return array;var n=nBlocks*blockSize,r=arrayCacheF32[n];if(void 0===r&&(r=new Float32Array(n),arrayCacheF32[n]=r),0!==nBlocks){firstElem.toArray(r,0);for(var i=1,offset=0;i!==nBlocks;++i)offset+=blockSize,array[i].toArray(r,offset)}return r}function allocTexUnits(renderer,n){var r=arrayCacheI32[n];void 0===r&&(r=new Int32Array(n),arrayCacheI32[n]=r);for(var i=0;i!==n;++i)r[i]=renderer.allocTextureUnit();return r}function setValue1f(gl,v){gl.uniform1f(this.addr,v)}function setValue1i(gl,v){gl.uniform1i(this.addr,v)}function setValue2fv(gl,v){void 0===v.x?gl.uniform2fv(this.addr,v):gl.uniform2f(this.addr,v.x,v.y)}function setValue3fv(gl,v){void 0!==v.x?gl.uniform3f(this.addr,v.x,v.y,v.z):void 0!==v.r?gl.uniform3f(this.addr,v.r,v.g,v.b):gl.uniform3fv(this.addr,v)}function setValue4fv(gl,v){void 0===v.x?gl.uniform4fv(this.addr,v):gl.uniform4f(this.addr,v.x,v.y,v.z,v.w)}function setValue2fm(gl,v){gl.uniformMatrix2fv(this.addr,!1,v.elements||v)}function setValue3fm(gl,v){gl.uniformMatrix3fv(this.addr,!1,v.elements||v)}function setValue4fm(gl,v){gl.uniformMatrix4fv(this.addr,!1,v.elements||v)}function setValueT1(gl,v,renderer){var unit=renderer.allocTextureUnit();gl.uniform1i(this.addr,unit),renderer.setTexture2D(v||emptyTexture,unit)}function setValueT6(gl,v,renderer){var unit=renderer.allocTextureUnit();gl.uniform1i(this.addr,unit),renderer.setTextureCube(v||emptyCubeTexture,unit)}function setValue2iv(gl,v){gl.uniform2iv(this.addr,v)}function setValue3iv(gl,v){gl.uniform3iv(this.addr,v)}function setValue4iv(gl,v){gl.uniform4iv(this.addr,v)}function setValue1fv(gl,v){gl.uniform1fv(this.addr,v)}function setValue1iv(gl,v){gl.uniform1iv(this.addr,v)}function setValueV2a(gl,v){gl.uniform2fv(this.addr,flatten(v,this.size,2))}function setValueV3a(gl,v){gl.uniform3fv(this.addr,flatten(v,this.size,3))}function setValueV4a(gl,v){gl.uniform4fv(this.addr,flatten(v,this.size,4))}function setValueM2a(gl,v){gl.uniformMatrix2fv(this.addr,!1,flatten(v,this.size,4))}function setValueM3a(gl,v){gl.uniformMatrix3fv(this.addr,!1,flatten(v,this.size,9))}function setValueM4a(gl,v){gl.uniformMatrix4fv(this.addr,!1,flatten(v,this.size,16))}function setValueT1a(gl,v,renderer){var n=v.length,units=allocTexUnits(renderer,n);gl.uniform1iv(this.addr,units);for(var i=0;i!==n;++i)renderer.setTexture2D(v[i]||emptyTexture,units[i])}function setValueT6a(gl,v,renderer){var n=v.length,units=allocTexUnits(renderer,n);gl.uniform1iv(this.addr,units);for(var i=0;i!==n;++i)renderer.setTextureCube(v[i]||emptyCubeTexture,units[i])}function SingleUniform(id,activeInfo,addr){this.id=id,this.addr=addr,this.setValue=function(type){switch(type){case 5126:return setValue1f;case 35664:return setValue2fv;case 35665:return setValue3fv;case 35666:return setValue4fv;case 35674:return setValue2fm;case 35675:return setValue3fm;case 35676:return setValue4fm;case 35678:return setValueT1;case 35680:return setValueT6;case 5124:case 35670:return setValue1i;case 35667:case 35671:return setValue2iv;case 35668:case 35672:return setValue3iv;case 35669:case 35673:return setValue4iv}}(activeInfo.type)}function PureArrayUniform(id,activeInfo,addr){this.id=id,this.addr=addr,this.size=activeInfo.size,this.setValue=function(type){switch(type){case 5126:return setValue1fv;case 35664:return setValueV2a;case 35665:return setValueV3a;case 35666:return setValueV4a;case 35674:return setValueM2a;case 35675:return setValueM3a;case 35676:return setValueM4a;case 35678:return setValueT1a;case 35680:return setValueT6a;case 5124:case 35670:return setValue1iv;case 35667:case 35671:return setValue2iv;case 35668:case 35672:return setValue3iv;case 35669:case 35673:return setValue4iv}}(activeInfo.type)}function StructuredUniform(id){this.id=id,UniformContainer.call(this)}StructuredUniform.prototype.setValue=function(gl,value){for(var seq=this.seq,i=0,n=seq.length;i!==n;++i){var u=seq[i];u.setValue(gl,value[u.id])}};var RePathPart=/([\w\d_]+)(\])?(\[|\.)?/g;function addUniform(container,uniformObject){container.seq.push(uniformObject),container.map[uniformObject.id]=uniformObject}function parseUniform(activeInfo,addr,container){var path=activeInfo.name,pathLength=path.length;for(RePathPart.lastIndex=0;;){var match=RePathPart.exec(path),matchEnd=RePathPart.lastIndex,id=match[1],idIsIndex="]"===match[2],subscript=match[3];if(idIsIndex&&(id|=0),void 0===subscript||"["===subscript&&matchEnd+2===pathLength){addUniform(container,void 0===subscript?new SingleUniform(id,activeInfo,addr):new PureArrayUniform(id,activeInfo,addr));break}var next=container.map[id];void 0===next&&addUniform(container,next=new StructuredUniform(id)),container=next}}function WebGLUniforms(gl,program,renderer){UniformContainer.call(this),this.renderer=renderer;for(var n=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS),i=0;i!==n;++i){var info=gl.getActiveUniform(program,i),path=info.name;parseUniform(info,gl.getUniformLocation(program,path),this)}}WebGLUniforms.prototype.setValue=function(gl,name,value){var u=this.map[name];void 0!==u&&u.setValue(gl,value,this.renderer)},WebGLUniforms.prototype.set=function(gl,object,name){var u=this.map[name];void 0!==u&&u.setValue(gl,object[name],this.renderer)},WebGLUniforms.prototype.setOptional=function(gl,object,name){var v=object[name];void 0!==v&&this.setValue(gl,name,v)},WebGLUniforms.upload=function(gl,seq,values,renderer){for(var i=0,n=seq.length;i!==n;++i){var u=seq[i],v=values[u.id];!1!==v.needsUpdate&&u.setValue(gl,v.value,renderer)}},WebGLUniforms.seqWithValue=function(seq,values){for(var r=[],i=0,n=seq.length;i!==n;++i){var u=seq[i];u.id in values&&r.push(u)}return r};var UniformsUtils={merge:function(uniforms){for(var merged={},u=0;u<uniforms.length;u++){var tmp=this.clone(uniforms[u]);for(var p in tmp)merged[p]=tmp[p]}return merged},clone:function(uniforms_src){var uniforms_dst={};for(var u in uniforms_src)for(var p in uniforms_dst[u]={},uniforms_src[u]){var parameter_src=uniforms_src[u][p];parameter_src&&(parameter_src.isColor||parameter_src.isMatrix3||parameter_src.isMatrix4||parameter_src.isVector2||parameter_src.isVector3||parameter_src.isVector4||parameter_src.isTexture)?uniforms_dst[u][p]=parameter_src.clone():Array.isArray(parameter_src)?uniforms_dst[u][p]=parameter_src.slice():uniforms_dst[u][p]=parameter_src}return uniforms_dst}},ShaderChunk={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 ltcTextureCoords( const in GeometricContext geometry, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = (LUT_SIZE - 1.0)/LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5/LUT_SIZE;\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nvoid clipQuadToHorizon( inout vec3 L[5], out int n ) {\n\tint config = 0;\n\tif ( L[0].z > 0.0 ) config += 1;\n\tif ( L[1].z > 0.0 ) config += 2;\n\tif ( L[2].z > 0.0 ) config += 4;\n\tif ( L[3].z > 0.0 ) config += 8;\n\tn = 0;\n\tif ( config == 0 ) {\n\t} else if ( config == 1 ) {\n\t\tn = 3;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 2 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 3 ) {\n\t\tn = 4;\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t\tL[3] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 4 ) {\n\t\tn = 3;\n\t\tL[0] = -L[3].z * L[2] + L[2].z * L[3];\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t} else if ( config == 5 ) {\n\t\tn = 0;\n\t} else if ( config == 6 ) {\n\t\tn = 4;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 7 ) {\n\t\tn = 5;\n\t\tL[4] = -L[3].z * L[0] + L[0].z * L[3];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 8 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[1] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] =  L[3];\n\t} else if ( config == 9 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[2].z * L[3] + L[3].z * L[2];\n\t} else if ( config == 10 ) {\n\t\tn = 0;\n\t} else if ( config == 11 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 12 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t} else if ( config == 13 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = L[2];\n\t\tL[2] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t} else if ( config == 14 ) {\n\t\tn = 5;\n\t\tL[4] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t} else if ( config == 15 ) {\n\t\tn = 4;\n\t}\n\tif ( n == 3 )\n\t\tL[3] = L[0];\n\tif ( n == 4 )\n\t\tL[4] = L[0];\n}\nfloat integrateLtcBrdfOverRectEdge( vec3 v1, vec3 v2 ) {\n\tfloat cosTheta = dot( v1, v2 );\n\tfloat theta = acos( cosTheta );\n\tfloat res = cross( v1, v2 ).z * ( ( theta > 0.001 ) ? theta / sin( theta ) : 1.0 );\n\treturn res;\n}\nvoid initRectPoints( const in vec3 pos, const in vec3 halfWidth, const in vec3 halfHeight, out vec3 rectPoints[4] ) {\n\trectPoints[0] = pos - halfWidth - halfHeight;\n\trectPoints[1] = pos + halfWidth - halfHeight;\n\trectPoints[2] = pos + halfWidth + halfHeight;\n\trectPoints[3] = pos - halfWidth + halfHeight;\n}\nvec3 integrateLtcBrdfOverRect( const in GeometricContext geometry, const in mat3 brdfMat, const in vec3 rectPoints[4] ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tvec3 T1, T2;\n\tT1 = normalize(V - N * dot( V, N ));\n\tT2 = - cross( N, T1 );\n\tmat3 brdfWrtSurface = brdfMat * transpose( mat3( T1, T2, N ) );\n\tvec3 clippedRect[5];\n\tclippedRect[0] = brdfWrtSurface * ( rectPoints[0] - P );\n\tclippedRect[1] = brdfWrtSurface * ( rectPoints[1] - P );\n\tclippedRect[2] = brdfWrtSurface * ( rectPoints[2] - P );\n\tclippedRect[3] = brdfWrtSurface * ( rectPoints[3] - P );\n\tint n;\n\tclipQuadToHorizon(clippedRect, n);\n\tif ( n == 0 )\n\t\treturn vec3( 0, 0, 0 );\n\tclippedRect[0] = normalize( clippedRect[0] );\n\tclippedRect[1] = normalize( clippedRect[1] );\n\tclippedRect[2] = normalize( clippedRect[2] );\n\tclippedRect[3] = normalize( clippedRect[3] );\n\tclippedRect[4] = normalize( clippedRect[4] );\n\tfloat sum = 0.0;\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[0], clippedRect[1] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[1], clippedRect[2] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[2], clippedRect[3] );\n\tif (n >= 4)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[3], clippedRect[4] );\n\tif (n == 5)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[4], clippedRect[0] );\n\tsum = max( 0.0, sum );\n\tvec3 Lo_i = vec3( sum, sum, sum );\n\treturn Lo_i;\n}\nvec3 Rect_Area_Light_Specular_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight,\n\t\tconst in float roughness,\n\t\tconst in sampler2D ltcMat, const in sampler2D ltcMag ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tvec2 uv = ltcTextureCoords( geometry, roughness );\n\tvec4 brdfLtcApproxParams, t;\n\tbrdfLtcApproxParams = texture2D( ltcMat, uv );\n\tt = texture2D( ltcMat, uv );\n\tfloat brdfLtcScalar = texture2D( ltcMag, uv ).a;\n\tmat3 brdfLtcApproxMat = mat3(\n\t\tvec3(   1,   0, t.y ),\n\t\tvec3(   0, t.z,   0 ),\n\t\tvec3( t.w,   0, t.x )\n\t);\n\tvec3 specularReflectance = integrateLtcBrdfOverRect( geometry, brdfLtcApproxMat, rectPoints );\n\tspecularReflectance *= brdfLtcScalar;\n\treturn specularReflectance;\n}\nvec3 Rect_Area_Light_Diffuse_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tmat3 diffuseBrdfMat = mat3(1);\n\tvec3 diffuseReflectance = integrateLtcBrdfOverRect( geometry, diffuseBrdfMat, rectPoints );\n\treturn diffuseReflectance;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\n#if NUM_RECT_AREA_LIGHTS > 0\n    void RE_Direct_RectArea_BlinnPhong( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n        vec3 matDiffColor = material.diffuseColor;\n        vec3 matSpecColor = material.specularColor;\n        vec3 lightColor   = rectAreaLight.color;\n        float roughness = BlinnExponentToGGXRoughness( material.specularShininess );\n        vec3 spec = Rect_Area_Light_Specular_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n                roughness,\n                ltcMat, ltcMag );\n        vec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n        reflectedLight.directSpecular += lightColor * matSpecColor * spec / PI2;\n        reflectedLight.directDiffuse  += lightColor * matDiffColor * diff / PI2;\n    }\n#endif\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n    void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n        vec3 matDiffColor = material.diffuseColor;\n        vec3 matSpecColor = material.specularColor;\n        vec3 lightColor   = rectAreaLight.color;\n        float roughness = material.specularRoughness;\n        vec3 spec = Rect_Area_Light_Specular_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n                roughness,\n                ltcMat, ltcMag );\n        vec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n        reflectedLight.directSpecular += lightColor * matSpecColor * spec;\n        reflectedLight.directDiffuse  += lightColor * matDiffColor * diff;\n    }\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\t\t\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_flip:"#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",distanceRGBA_vert:"varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED  ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#include <premultiplied_alpha_fragment>\n\t#include <encodings_fragment>\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED  ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED  ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",shadow_frag:"uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"};function Color(r,g,b){return void 0===g&&void 0===b?this.set(r):this.setRGB(r,g,b)}function hue2rgb(p,q,t){return t<0&&(t+=1),1<t&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+6*(q-p)*(2/3-t):p}Color.prototype={constructor:Color,isColor:!0,r:1,g:1,b:1,set:function(value){return value&&value.isColor?this.copy(value):"number"==typeof value?this.setHex(value):"string"==typeof value&&this.setStyle(value),this},setScalar:function(scalar){return this.r=scalar,this.g=scalar,this.b=scalar,this},setHex:function(hex){return hex=Math.floor(hex),this.r=(hex>>16&255)/255,this.g=(hex>>8&255)/255,this.b=(255&hex)/255,this},setRGB:function(r,g,b){return this.r=r,this.g=g,this.b=b,this},setHSL:function(h,s,l){if(h=_Math.euclideanModulo(h,1),s=_Math.clamp(s,0,1),l=_Math.clamp(l,0,1),0===s)this.r=this.g=this.b=l;else{var p=l<=.5?l*(1+s):l+s-l*s,q=2*l-p;this.r=hue2rgb(q,p,h+1/3),this.g=hue2rgb(q,p,h),this.b=hue2rgb(q,p,h-1/3)}return this},setStyle:function(style){function handleAlpha(string){void 0!==string&&parseFloat(string)<1&&console.warn("THREE.Color: Alpha component of "+style+" will be ignored.")}var m;if(m=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(style)){var color,name=m[1],components=m[2];switch(name){case"rgb":case"rgba":if(color=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(components))return this.r=Math.min(255,parseInt(color[1],10))/255,this.g=Math.min(255,parseInt(color[2],10))/255,this.b=Math.min(255,parseInt(color[3],10))/255,handleAlpha(color[5]),this;if(color=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(components))return this.r=Math.min(100,parseInt(color[1],10))/100,this.g=Math.min(100,parseInt(color[2],10))/100,this.b=Math.min(100,parseInt(color[3],10))/100,handleAlpha(color[5]),this;break;case"hsl":case"hsla":if(color=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(components)){var h=parseFloat(color[1])/360,s=parseInt(color[2],10)/100,l=parseInt(color[3],10)/100;return handleAlpha(color[5]),this.setHSL(h,s,l)}}}else if(m=/^\#([A-Fa-f0-9]+)$/.exec(style)){var hex,size=(hex=m[1]).length;if(3===size)return this.r=parseInt(hex.charAt(0)+hex.charAt(0),16)/255,this.g=parseInt(hex.charAt(1)+hex.charAt(1),16)/255,this.b=parseInt(hex.charAt(2)+hex.charAt(2),16)/255,this;if(6===size)return this.r=parseInt(hex.charAt(0)+hex.charAt(1),16)/255,this.g=parseInt(hex.charAt(2)+hex.charAt(3),16)/255,this.b=parseInt(hex.charAt(4)+hex.charAt(5),16)/255,this}style&&0<style.length&&(void 0!==(hex=ColorKeywords[style])?this.setHex(hex):console.warn("THREE.Color: Unknown color "+style));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(color){return this.r=color.r,this.g=color.g,this.b=color.b,this},copyGammaToLinear:function(color,gammaFactor){return void 0===gammaFactor&&(gammaFactor=2),this.r=Math.pow(color.r,gammaFactor),this.g=Math.pow(color.g,gammaFactor),this.b=Math.pow(color.b,gammaFactor),this},copyLinearToGamma:function(color,gammaFactor){void 0===gammaFactor&&(gammaFactor=2);var safeInverse=0<gammaFactor?1/gammaFactor:1;return this.r=Math.pow(color.r,safeInverse),this.g=Math.pow(color.g,safeInverse),this.b=Math.pow(color.b,safeInverse),this},convertGammaToLinear:function(){var r=this.r,g=this.g,b=this.b;return this.r=r*r,this.g=g*g,this.b=b*b,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(optionalTarget){var hue,saturation,hsl=optionalTarget||{h:0,s:0,l:0},r=this.r,g=this.g,b=this.b,max=Math.max(r,g,b),min=Math.min(r,g,b),lightness=(min+max)/2;if(min===max)saturation=hue=0;else{var delta=max-min;switch(saturation=lightness<=.5?delta/(max+min):delta/(2-max-min),max){case r:hue=(g-b)/delta+(g<b?6:0);break;case g:hue=(b-r)/delta+2;break;case b:hue=(r-g)/delta+4}hue/=6}return hsl.h=hue,hsl.s=saturation,hsl.l=lightness,hsl},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(h,s,l){var hsl=this.getHSL();return hsl.h+=h,hsl.s+=s,hsl.l+=l,this.setHSL(hsl.h,hsl.s,hsl.l),this},add:function(color){return this.r+=color.r,this.g+=color.g,this.b+=color.b,this},addColors:function(color1,color2){return this.r=color1.r+color2.r,this.g=color1.g+color2.g,this.b=color1.b+color2.b,this},addScalar:function(s){return this.r+=s,this.g+=s,this.b+=s,this},sub:function(color){return this.r=Math.max(0,this.r-color.r),this.g=Math.max(0,this.g-color.g),this.b=Math.max(0,this.b-color.b),this},multiply:function(color){return this.r*=color.r,this.g*=color.g,this.b*=color.b,this},multiplyScalar:function(s){return this.r*=s,this.g*=s,this.b*=s,this},lerp:function(color,alpha){return this.r+=(color.r-this.r)*alpha,this.g+=(color.g-this.g)*alpha,this.b+=(color.b-this.b)*alpha,this},equals:function(c){return c.r===this.r&&c.g===this.g&&c.b===this.b},fromArray:function(array,offset){return void 0===offset&&(offset=0),this.r=array[offset],this.g=array[offset+1],this.b=array[offset+2],this},toArray:function(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.r,array[offset+1]=this.g,array[offset+2]=this.b,array},toJSON:function(){return this.getHex()}};var ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function DataTexture(data,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,encoding){Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding),this.image={data:data,width:width,height:height},this.magFilter=void 0!==magFilter?magFilter:NearestFilter,this.minFilter=void 0!==minFilter?minFilter:NearestFilter,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}((DataTexture.prototype=Object.create(Texture.prototype)).constructor=DataTexture).prototype.isDataTexture=!0;var UniformsLib={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new Vector4(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new Vector4(0,0,1,1)}}},ShaderLib={basic:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},points:{uniforms:UniformsUtils.merge([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new Vector3}},vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag}};function Box2(min,max){this.min=void 0!==min?min:new Vector2(1/0,1/0),this.max=void 0!==max?max:new Vector2(-1/0,-1/0)}function LensFlarePlugin(renderer,flares){var vertexBuffer,elementBuffer,shader,program,attributes,uniforms,tempTexture,occlusionTexture,gl=renderer.context,state=renderer.state;function init(){var vertices=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),faces=new Uint16Array([0,1,2,0,2,3]);vertexBuffer=gl.createBuffer(),elementBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,faces,gl.STATIC_DRAW),tempTexture=gl.createTexture(),occlusionTexture=gl.createTexture(),state.bindTexture(gl.TEXTURE_2D,tempTexture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,16,16,0,gl.RGB,gl.UNSIGNED_BYTE,null),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),state.bindTexture(gl.TEXTURE_2D,occlusionTexture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,16,16,0,gl.RGBA,gl.UNSIGNED_BYTE,null),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),shader={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},program=function(shader){var program=gl.createProgram(),fragmentShader=gl.createShader(gl.FRAGMENT_SHADER),vertexShader=gl.createShader(gl.VERTEX_SHADER),prefix="precision "+renderer.getPrecision()+" float;\n";return gl.shaderSource(fragmentShader,prefix+shader.fragmentShader),gl.shaderSource(vertexShader,prefix+shader.vertexShader),gl.compileShader(fragmentShader),gl.compileShader(vertexShader),gl.attachShader(program,fragmentShader),gl.attachShader(program,vertexShader),gl.linkProgram(program),program}(shader),attributes={vertex:gl.getAttribLocation(program,"position"),uv:gl.getAttribLocation(program,"uv")},uniforms={renderType:gl.getUniformLocation(program,"renderType"),map:gl.getUniformLocation(program,"map"),occlusionMap:gl.getUniformLocation(program,"occlusionMap"),opacity:gl.getUniformLocation(program,"opacity"),color:gl.getUniformLocation(program,"color"),scale:gl.getUniformLocation(program,"scale"),rotation:gl.getUniformLocation(program,"rotation"),screenPosition:gl.getUniformLocation(program,"screenPosition")}}this.render=function(scene,camera,viewport){if(0!==flares.length){var tempPosition=new Vector3,invAspect=viewport.w/viewport.z,halfViewportWidth=.5*viewport.z,halfViewportHeight=.5*viewport.w,size=16/viewport.w,scale=new Vector2(size*invAspect,size),screenPosition=new Vector3(1,1,0),screenPositionPixels=new Vector2(1,1),validArea=new Box2;validArea.min.set(viewport.x,viewport.y),validArea.max.set(viewport.x+(viewport.z-16),viewport.y+(viewport.w-16)),void 0===program&&init(),gl.useProgram(program),state.initAttributes(),state.enableAttribute(attributes.vertex),state.enableAttribute(attributes.uv),state.disableUnusedAttributes(),gl.uniform1i(uniforms.occlusionMap,0),gl.uniform1i(uniforms.map,1),gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer),gl.vertexAttribPointer(attributes.vertex,2,gl.FLOAT,!1,16,0),gl.vertexAttribPointer(attributes.uv,2,gl.FLOAT,!1,16,8),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer),state.disable(gl.CULL_FACE),state.setDepthWrite(!1);for(var i=0,l=flares.length;i<l;i++){size=16/viewport.w,scale.set(size*invAspect,size);var flare=flares[i];if(tempPosition.set(flare.matrixWorld.elements[12],flare.matrixWorld.elements[13],flare.matrixWorld.elements[14]),tempPosition.applyMatrix4(camera.matrixWorldInverse),tempPosition.applyProjection(camera.projectionMatrix),screenPosition.copy(tempPosition),screenPositionPixels.x=viewport.x+screenPosition.x*halfViewportWidth+halfViewportWidth-8,screenPositionPixels.y=viewport.y+screenPosition.y*halfViewportHeight+halfViewportHeight-8,!0===validArea.containsPoint(screenPositionPixels)){state.activeTexture(gl.TEXTURE0),state.bindTexture(gl.TEXTURE_2D,null),state.activeTexture(gl.TEXTURE1),state.bindTexture(gl.TEXTURE_2D,tempTexture),gl.copyTexImage2D(gl.TEXTURE_2D,0,gl.RGB,screenPositionPixels.x,screenPositionPixels.y,16,16,0),gl.uniform1i(uniforms.renderType,0),gl.uniform2f(uniforms.scale,scale.x,scale.y),gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z),state.disable(gl.BLEND),state.enable(gl.DEPTH_TEST),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0),state.activeTexture(gl.TEXTURE0),state.bindTexture(gl.TEXTURE_2D,occlusionTexture),gl.copyTexImage2D(gl.TEXTURE_2D,0,gl.RGBA,screenPositionPixels.x,screenPositionPixels.y,16,16,0),gl.uniform1i(uniforms.renderType,1),state.disable(gl.DEPTH_TEST),state.activeTexture(gl.TEXTURE1),state.bindTexture(gl.TEXTURE_2D,tempTexture),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0),flare.positionScreen.copy(screenPosition),flare.customUpdateCallback?flare.customUpdateCallback(flare):flare.updateLensFlares(),gl.uniform1i(uniforms.renderType,2),state.enable(gl.BLEND);for(var j=0,jl=flare.lensFlares.length;j<jl;j++){var sprite=flare.lensFlares[j];.001<sprite.opacity&&.001<sprite.scale&&(screenPosition.x=sprite.x,screenPosition.y=sprite.y,screenPosition.z=sprite.z,size=sprite.size*sprite.scale/viewport.w,scale.x=size*invAspect,scale.y=size,gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z),gl.uniform2f(uniforms.scale,scale.x,scale.y),gl.uniform1f(uniforms.rotation,sprite.rotation),gl.uniform1f(uniforms.opacity,sprite.opacity),gl.uniform3f(uniforms.color,sprite.color.r,sprite.color.g,sprite.color.b),state.setBlending(sprite.blending,sprite.blendEquation,sprite.blendSrc,sprite.blendDst),renderer.setTexture2D(sprite.texture,1),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0))}}}state.enable(gl.CULL_FACE),state.enable(gl.DEPTH_TEST),state.setDepthWrite(!0),renderer.resetGLState()}}}function SpritePlugin(renderer,sprites){var vertexBuffer,elementBuffer,program,attributes,uniforms,texture,gl=renderer.context,state=renderer.state,spritePosition=new Vector3,spriteRotation=new Quaternion,spriteScale=new Vector3;function init(){var vertices=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),faces=new Uint16Array([0,1,2,0,2,3]);vertexBuffer=gl.createBuffer(),elementBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,faces,gl.STATIC_DRAW),program=function(){var program=gl.createProgram(),vertexShader=gl.createShader(gl.VERTEX_SHADER),fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);return gl.shaderSource(vertexShader,["precision "+renderer.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),gl.shaderSource(fragmentShader,["precision "+renderer.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),gl.compileShader(vertexShader),gl.compileShader(fragmentShader),gl.attachShader(program,vertexShader),gl.attachShader(program,fragmentShader),gl.linkProgram(program),program}(),attributes={position:gl.getAttribLocation(program,"position"),uv:gl.getAttribLocation(program,"uv")},uniforms={uvOffset:gl.getUniformLocation(program,"uvOffset"),uvScale:gl.getUniformLocation(program,"uvScale"),rotation:gl.getUniformLocation(program,"rotation"),scale:gl.getUniformLocation(program,"scale"),color:gl.getUniformLocation(program,"color"),map:gl.getUniformLocation(program,"map"),opacity:gl.getUniformLocation(program,"opacity"),modelViewMatrix:gl.getUniformLocation(program,"modelViewMatrix"),projectionMatrix:gl.getUniformLocation(program,"projectionMatrix"),fogType:gl.getUniformLocation(program,"fogType"),fogDensity:gl.getUniformLocation(program,"fogDensity"),fogNear:gl.getUniformLocation(program,"fogNear"),fogFar:gl.getUniformLocation(program,"fogFar"),fogColor:gl.getUniformLocation(program,"fogColor"),alphaTest:gl.getUniformLocation(program,"alphaTest")};var canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");canvas.width=8,canvas.height=8;var context=canvas.getContext("2d");context.fillStyle="white",context.fillRect(0,0,8,8),(texture=new Texture(canvas)).needsUpdate=!0}function painterSortStable(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}this.render=function(scene,camera){if(0!==sprites.length){void 0===program&&init(),gl.useProgram(program),state.initAttributes(),state.enableAttribute(attributes.position),state.enableAttribute(attributes.uv),state.disableUnusedAttributes(),state.disable(gl.CULL_FACE),state.enable(gl.BLEND),gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer),gl.vertexAttribPointer(attributes.position,2,gl.FLOAT,!1,16,0),gl.vertexAttribPointer(attributes.uv,2,gl.FLOAT,!1,16,8),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer),gl.uniformMatrix4fv(uniforms.projectionMatrix,!1,camera.projectionMatrix.elements),state.activeTexture(gl.TEXTURE0),gl.uniform1i(uniforms.map,0);var oldFogType=0,sceneFogType=0,fog=scene.fog;fog?(gl.uniform3f(uniforms.fogColor,fog.color.r,fog.color.g,fog.color.b),fog.isFog?(gl.uniform1f(uniforms.fogNear,fog.near),gl.uniform1f(uniforms.fogFar,fog.far),gl.uniform1i(uniforms.fogType,1),sceneFogType=oldFogType=1):fog.isFogExp2&&(gl.uniform1f(uniforms.fogDensity,fog.density),gl.uniform1i(uniforms.fogType,2),sceneFogType=oldFogType=2)):(gl.uniform1i(uniforms.fogType,0),sceneFogType=oldFogType=0);for(var i=0,l=sprites.length;i<l;i++){(sprite=sprites[i]).modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,sprite.matrixWorld),sprite.z=-sprite.modelViewMatrix.elements[14]}sprites.sort(painterSortStable);var scale=[];for(i=0,l=sprites.length;i<l;i++){var sprite,material=(sprite=sprites[i]).material;if(!1!==material.visible){gl.uniform1f(uniforms.alphaTest,material.alphaTest),gl.uniformMatrix4fv(uniforms.modelViewMatrix,!1,sprite.modelViewMatrix.elements),sprite.matrixWorld.decompose(spritePosition,spriteRotation,spriteScale),scale[0]=spriteScale.x,scale[1]=spriteScale.y;var fogType=0;scene.fog&&material.fog&&(fogType=sceneFogType),oldFogType!==fogType&&(gl.uniform1i(uniforms.fogType,fogType),oldFogType=fogType),null!==material.map?(gl.uniform2f(uniforms.uvOffset,material.map.offset.x,material.map.offset.y),gl.uniform2f(uniforms.uvScale,material.map.repeat.x,material.map.repeat.y)):(gl.uniform2f(uniforms.uvOffset,0,0),gl.uniform2f(uniforms.uvScale,1,1)),gl.uniform1f(uniforms.opacity,material.opacity),gl.uniform3f(uniforms.color,material.color.r,material.color.g,material.color.b),gl.uniform1f(uniforms.rotation,material.rotation),gl.uniform2fv(uniforms.scale,scale),state.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst),state.setDepthTest(material.depthTest),state.setDepthWrite(material.depthWrite),material.map?renderer.setTexture2D(material.map,0):renderer.setTexture2D(texture,0),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)}}state.enable(gl.CULL_FACE),renderer.resetGLState()}}}ShaderLib.physical={uniforms:UniformsUtils.merge([ShaderLib.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},Box2.prototype={constructor:Box2,set:function(min,max){return this.min.copy(min),this.max.copy(max),this},setFromPoints:function(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++)this.expandByPoint(points[i]);return this},setFromCenterAndSize:function(){var v1=new Vector2;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);return this.min.copy(center).sub(halfSize),this.max.copy(center).add(halfSize),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(box){return this.min.copy(box.min),this.max.copy(box.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(optionalTarget){var result=optionalTarget||new Vector2;return this.isEmpty()?result.set(0,0):result.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(optionalTarget){var result=optionalTarget||new Vector2;return this.isEmpty()?result.set(0,0):result.subVectors(this.max,this.min)},expandByPoint:function(point){return this.min.min(point),this.max.max(point),this},expandByVector:function(vector){return this.min.sub(vector),this.max.add(vector),this},expandByScalar:function(scalar){return this.min.addScalar(-scalar),this.max.addScalar(scalar),this},containsPoint:function(point){return!(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y)},containsBox:function(box){return this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y},getParameter:function(point,optionalTarget){return(optionalTarget||new Vector2).set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(box){return!(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y)},clampPoint:function(point,optionalTarget){return(optionalTarget||new Vector2).copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new Vector2;return function(point){return v1.copy(point).clamp(this.min,this.max).sub(point).length()}}(),intersect:function(box){return this.min.max(box.min),this.max.min(box.max),this},union:function(box){return this.min.min(box.min),this.max.max(box.max),this},translate:function(offset){return this.min.add(offset),this.max.add(offset),this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)}};var points,closestPoint,box,p1,p2,sphere,v,segCenter,segDir,diff,q,materialId=0;function Material(){Object.defineProperty(this,"id",{value:materialId++}),this.uuid=_Math.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=NormalBlending,this.side=FrontSide,this.shading=SmoothShading,this.vertexColors=NoColors,this.opacity=1,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this._needsUpdate=!0}function ShaderMaterial(parameters){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},(this.index0AttributeName=void 0)!==parameters&&(void 0!==parameters.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(parameters))}function MeshDepthMaterial(parameters){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(parameters)}function Box3(min,max){this.min=void 0!==min?min:new Vector3(1/0,1/0,1/0),this.max=void 0!==max?max:new Vector3(-1/0,-1/0,-1/0)}function Sphere(center,radius){this.center=void 0!==center?center:new Vector3,this.radius=void 0!==radius?radius:0}function Matrix3(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function Plane(normal,constant){this.normal=void 0!==normal?normal:new Vector3(1,0,0),this.constant=void 0!==constant?constant:0}function Frustum(p0,p1,p2,p3,p4,p5){this.planes=[void 0!==p0?p0:new Plane,void 0!==p1?p1:new Plane,void 0!==p2?p2:new Plane,void 0!==p3?p3:new Plane,void 0!==p4?p4:new Plane,void 0!==p5?p5:new Plane]}function WebGLShadowMap(_renderer,_lights,_objects,capabilities){var _gl=_renderer.context,_state=_renderer.state,_frustum=new Frustum,_projScreenMatrix=new Matrix4,_lightShadows=_lights.shadows,_shadowMapSize=new Vector2,_maxShadowMapSize=new Vector2(capabilities.maxTextureSize,capabilities.maxTextureSize),_lookTarget=new Vector3,_lightPositionWorld=new Vector3,_renderList=[],_MorphingFlag=1,_SkinningFlag=2,_NumberOfMaterialVariants=1+(_MorphingFlag|_SkinningFlag),_depthMaterials=new Array(_NumberOfMaterialVariants),_distanceMaterials=new Array(_NumberOfMaterialVariants),_materialCache={},cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)],cube2DViewPorts=[new Vector4,new Vector4,new Vector4,new Vector4,new Vector4,new Vector4],depthMaterialTemplate=new MeshDepthMaterial;depthMaterialTemplate.depthPacking=RGBADepthPacking,depthMaterialTemplate.clipping=!0;for(var distanceShader=ShaderLib.distanceRGBA,distanceUniforms=UniformsUtils.clone(distanceShader.uniforms),i=0;i!==_NumberOfMaterialVariants;++i){var useMorphing=0!=(i&_MorphingFlag),useSkinning=0!=(i&_SkinningFlag),depthMaterial=depthMaterialTemplate.clone();depthMaterial.morphTargets=useMorphing,depthMaterial.skinning=useSkinning,_depthMaterials[i]=depthMaterial;var distanceMaterial=new ShaderMaterial({defines:{USE_SHADOWMAP:""},uniforms:distanceUniforms,vertexShader:distanceShader.vertexShader,fragmentShader:distanceShader.fragmentShader,morphTargets:useMorphing,skinning:useSkinning,clipping:!0});_distanceMaterials[i]=distanceMaterial}var scope=this;function getDepthMaterial(object,material,isPointLight,lightPositionWorld){var geometry=object.geometry,result=null,materialVariants=_depthMaterials,customMaterial=object.customDepthMaterial;if(isPointLight&&(materialVariants=_distanceMaterials,customMaterial=object.customDistanceMaterial),customMaterial)result=customMaterial;else{var useMorphing=!1;material.morphTargets&&(geometry&&geometry.isBufferGeometry?useMorphing=geometry.morphAttributes&&geometry.morphAttributes.position&&0<geometry.morphAttributes.position.length:geometry&&geometry.isGeometry&&(useMorphing=geometry.morphTargets&&0<geometry.morphTargets.length));var useSkinning=object.isSkinnedMesh&&material.skinning,variantIndex=0;useMorphing&&(variantIndex|=_MorphingFlag),useSkinning&&(variantIndex|=_SkinningFlag),result=materialVariants[variantIndex]}if(_renderer.localClippingEnabled&&!0===material.clipShadows&&0!==material.clippingPlanes.length){var keyA=result.uuid,keyB=material.uuid,materialsForVariant=_materialCache[keyA];void 0===materialsForVariant&&(materialsForVariant={},_materialCache[keyA]=materialsForVariant);var cachedMaterial=materialsForVariant[keyB];void 0===cachedMaterial&&(cachedMaterial=result.clone(),materialsForVariant[keyB]=cachedMaterial),result=cachedMaterial}result.visible=material.visible,result.wireframe=material.wireframe;var side=material.side;return scope.renderSingleSided&&side==DoubleSide&&(side=FrontSide),scope.renderReverseSided&&(side===FrontSide?side=BackSide:side===BackSide&&(side=FrontSide)),result.side=side,result.clipShadows=material.clipShadows,result.clippingPlanes=material.clippingPlanes,result.wireframeLinewidth=material.wireframeLinewidth,result.linewidth=material.linewidth,isPointLight&&void 0!==result.uniforms.lightPos&&result.uniforms.lightPos.value.copy(lightPositionWorld),result}function projectObject(object,camera,shadowCamera){if(!1!==object.visible){if(0!=(object.layers.mask&camera.layers.mask)&&(object.isMesh||object.isLine||object.isPoints))if(object.castShadow&&(!1===object.frustumCulled||!0===_frustum.intersectsObject(object)))!0===object.material.visible&&(object.modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse,object.matrixWorld),_renderList.push(object));for(var children=object.children,i=0,l=children.length;i<l;i++)projectObject(children[i],camera,shadowCamera)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(scene,camera){if(!1!==scope.enabled&&(!1!==scope.autoUpdate||!1!==scope.needsUpdate)&&0!==_lightShadows.length){var faceCount,isPointLight;_state.buffers.color.setClear(1,1,1,1),_state.disable(_gl.BLEND),_state.setDepthTest(!0),_state.setScissorTest(!1);for(var i=0,il=_lightShadows.length;i<il;i++){var light=_lightShadows[i],shadow=light.shadow;if(void 0!==shadow){var shadowCamera=shadow.camera;if(_shadowMapSize.copy(shadow.mapSize),_shadowMapSize.min(_maxShadowMapSize),light&&light.isPointLight){faceCount=6,isPointLight=!0;var vpWidth=_shadowMapSize.x,vpHeight=_shadowMapSize.y;cube2DViewPorts[0].set(2*vpWidth,vpHeight,vpWidth,vpHeight),cube2DViewPorts[1].set(0,vpHeight,vpWidth,vpHeight),cube2DViewPorts[2].set(3*vpWidth,vpHeight,vpWidth,vpHeight),cube2DViewPorts[3].set(vpWidth,vpHeight,vpWidth,vpHeight),cube2DViewPorts[4].set(3*vpWidth,0,vpWidth,vpHeight),cube2DViewPorts[5].set(vpWidth,0,vpWidth,vpHeight),_shadowMapSize.x*=4,_shadowMapSize.y*=2}else isPointLight=!(faceCount=1);if(null===shadow.map){var pars={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat};shadow.map=new WebGLRenderTarget(_shadowMapSize.x,_shadowMapSize.y,pars),shadowCamera.updateProjectionMatrix()}shadow.isSpotLightShadow&&shadow.update(light),shadow&&shadow.isRectAreaLightShadow&&shadow.update(light);var shadowMap=shadow.map,shadowMatrix=shadow.matrix;_lightPositionWorld.setFromMatrixPosition(light.matrixWorld),shadowCamera.position.copy(_lightPositionWorld),_renderer.setRenderTarget(shadowMap),_renderer.clear();for(var face=0;face<faceCount;face++){if(isPointLight){_lookTarget.copy(shadowCamera.position),_lookTarget.add(cubeDirections[face]),shadowCamera.up.copy(cubeUps[face]),shadowCamera.lookAt(_lookTarget);var vpDimensions=cube2DViewPorts[face];_state.viewport(vpDimensions)}else _lookTarget.setFromMatrixPosition(light.target.matrixWorld),shadowCamera.lookAt(_lookTarget);shadowCamera.updateMatrixWorld(),shadowCamera.matrixWorldInverse.getInverse(shadowCamera.matrixWorld),shadowMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),shadowMatrix.multiply(shadowCamera.projectionMatrix),shadowMatrix.multiply(shadowCamera.matrixWorldInverse),_projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix,shadowCamera.matrixWorldInverse),_frustum.setFromMatrix(_projScreenMatrix),_renderList.length=0,projectObject(scene,camera,shadowCamera);for(var j=0,jl=_renderList.length;j<jl;j++){var object=_renderList[j],geometry=_objects.update(object),material=object.material;if(material&&material.isMultiMaterial)for(var groups=geometry.groups,materials=material.materials,k=0,kl=groups.length;k<kl;k++){var group=groups[k],groupMaterial=materials[group.materialIndex];if(!0===groupMaterial.visible){var depthMaterial=getDepthMaterial(object,groupMaterial,isPointLight,_lightPositionWorld);_renderer.renderBufferDirect(shadowCamera,null,geometry,depthMaterial,object,group)}}else{depthMaterial=getDepthMaterial(object,material,isPointLight,_lightPositionWorld);_renderer.renderBufferDirect(shadowCamera,null,geometry,depthMaterial,object,null)}}}}else console.warn("THREE.WebGLShadowMap:",light,"has no shadow.")}var clearColor=_renderer.getClearColor(),clearAlpha=_renderer.getClearAlpha();_renderer.setClearColor(clearColor,clearAlpha),scope.needsUpdate=!1}}}function Ray(origin,direction){this.origin=void 0!==origin?origin:new Vector3,this.direction=void 0!==direction?direction:new Vector3}function Euler(x,y,z,order){this._x=x||0,this._y=y||0,this._z=z||0,this._order=order||Euler.DefaultOrder}function Layers(){this.mask=1}Material.prototype={constructor:Material,isMaterial:!0,get needsUpdate(){return this._needsUpdate},set needsUpdate(value){!0===value&&this.update(),this._needsUpdate=value},setValues:function(values){if(void 0!==values)for(var key in values){var newValue=values[key];if(void 0!==newValue){var currentValue=this[key];void 0!==currentValue?currentValue&&currentValue.isColor?currentValue.set(newValue):currentValue&&currentValue.isVector3&&newValue&&newValue.isVector3?currentValue.copy(newValue):this[key]="overdraw"===key?Number(newValue):newValue:console.warn("THREE."+this.type+": '"+key+"' is not a property of this material.")}else console.warn("THREE.Material: '"+key+"' parameter is undefined.")}},toJSON:function(meta){var isRoot=void 0===meta;isRoot&&(meta={textures:{},images:{}});var data={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};function extractFromCache(cache){var values=[];for(var key in cache){var data=cache[key];delete data.metadata,values.push(data)}return values}if(data.uuid=this.uuid,data.type=this.type,""!==this.name&&(data.name=this.name),this.color&&this.color.isColor&&(data.color=this.color.getHex()),void 0!==this.roughness&&(data.roughness=this.roughness),void 0!==this.metalness&&(data.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(data.emissive=this.emissive.getHex()),this.specular&&this.specular.isColor&&(data.specular=this.specular.getHex()),void 0!==this.shininess&&(data.shininess=this.shininess),void 0!==this.clearCoat&&(data.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(data.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(data.map=this.map.toJSON(meta).uuid),this.alphaMap&&this.alphaMap.isTexture&&(data.alphaMap=this.alphaMap.toJSON(meta).uuid),this.lightMap&&this.lightMap.isTexture&&(data.lightMap=this.lightMap.toJSON(meta).uuid),this.bumpMap&&this.bumpMap.isTexture&&(data.bumpMap=this.bumpMap.toJSON(meta).uuid,data.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(data.normalMap=this.normalMap.toJSON(meta).uuid,data.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(data.displacementMap=this.displacementMap.toJSON(meta).uuid,data.displacementScale=this.displacementScale,data.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(data.roughnessMap=this.roughnessMap.toJSON(meta).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(data.metalnessMap=this.metalnessMap.toJSON(meta).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(data.emissiveMap=this.emissiveMap.toJSON(meta).uuid),this.specularMap&&this.specularMap.isTexture&&(data.specularMap=this.specularMap.toJSON(meta).uuid),this.envMap&&this.envMap.isTexture&&(data.envMap=this.envMap.toJSON(meta).uuid,data.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(data.gradientMap=this.gradientMap.toJSON(meta).uuid),void 0!==this.size&&(data.size=this.size),void 0!==this.sizeAttenuation&&(data.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(data.blending=this.blending),this.shading!==SmoothShading&&(data.shading=this.shading),this.side!==FrontSide&&(data.side=this.side),this.vertexColors!==NoColors&&(data.vertexColors=this.vertexColors),this.opacity<1&&(data.opacity=this.opacity),!0===this.transparent&&(data.transparent=this.transparent),data.depthFunc=this.depthFunc,data.depthTest=this.depthTest,data.depthWrite=this.depthWrite,0<this.alphaTest&&(data.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(data.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(data.wireframe=this.wireframe),1<this.wireframeLinewidth&&(data.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(data.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(data.wireframeLinejoin=this.wireframeLinejoin),data.skinning=this.skinning,data.morphTargets=this.morphTargets,isRoot){var textures=extractFromCache(meta.textures),images=extractFromCache(meta.images);0<textures.length&&(data.textures=textures),0<images.length&&(data.images=images)}return data},clone:function(){return(new this.constructor).copy(this)},copy:function(source){this.name=source.name,this.fog=source.fog,this.lights=source.lights,this.blending=source.blending,this.side=source.side,this.shading=source.shading,this.vertexColors=source.vertexColors,this.opacity=source.opacity,this.transparent=source.transparent,this.blendSrc=source.blendSrc,this.blendDst=source.blendDst,this.blendEquation=source.blendEquation,this.blendSrcAlpha=source.blendSrcAlpha,this.blendDstAlpha=source.blendDstAlpha,this.blendEquationAlpha=source.blendEquationAlpha,this.depthFunc=source.depthFunc,this.depthTest=source.depthTest,this.depthWrite=source.depthWrite,this.colorWrite=source.colorWrite,this.precision=source.precision,this.polygonOffset=source.polygonOffset,this.polygonOffsetFactor=source.polygonOffsetFactor,this.polygonOffsetUnits=source.polygonOffsetUnits,this.alphaTest=source.alphaTest,this.premultipliedAlpha=source.premultipliedAlpha,this.overdraw=source.overdraw,this.visible=source.visible,this.clipShadows=source.clipShadows,this.clipIntersection=source.clipIntersection;var srcPlanes=source.clippingPlanes,dstPlanes=null;if(null!==srcPlanes){var n=srcPlanes.length;dstPlanes=new Array(n);for(var i=0;i!==n;++i)dstPlanes[i]=srcPlanes[i].clone()}return this.clippingPlanes=dstPlanes,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},Object.assign(Material.prototype,EventDispatcher.prototype),((ShaderMaterial.prototype=Object.create(Material.prototype)).constructor=ShaderMaterial).prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.fragmentShader=source.fragmentShader,this.vertexShader=source.vertexShader,this.uniforms=UniformsUtils.clone(source.uniforms),this.defines=source.defines,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.lights=source.lights,this.clipping=source.clipping,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this.extensions=source.extensions,this},ShaderMaterial.prototype.toJSON=function(meta){var data=Material.prototype.toJSON.call(this,meta);return data.uniforms=this.uniforms,data.vertexShader=this.vertexShader,data.fragmentShader=this.fragmentShader,data},((MeshDepthMaterial.prototype=Object.create(Material.prototype)).constructor=MeshDepthMaterial).prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.depthPacking=source.depthPacking,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.map=source.map,this.alphaMap=source.alphaMap,this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this},Box3.prototype={constructor:Box3,isBox3:!0,set:function(min,max){return this.min.copy(min),this.max.copy(max),this},setFromArray:function(array){for(var minX=1/0,minY=1/0,minZ=1/0,maxX=-1/0,maxY=-1/0,maxZ=-1/0,i=0,l=array.length;i<l;i+=3){var x=array[i],y=array[i+1],z=array[i+2];x<minX&&(minX=x),y<minY&&(minY=y),z<minZ&&(minZ=z),maxX<x&&(maxX=x),maxY<y&&(maxY=y),maxZ<z&&(maxZ=z)}this.min.set(minX,minY,minZ),this.max.set(maxX,maxY,maxZ)},setFromBufferAttribute:function(attribute){for(var minX=1/0,minY=1/0,minZ=1/0,maxX=-1/0,maxY=-1/0,maxZ=-1/0,i=0,l=attribute.count;i<l;i++){var x=attribute.getX(i),y=attribute.getY(i),z=attribute.getZ(i);x<minX&&(minX=x),y<minY&&(minY=y),z<minZ&&(minZ=z),maxX<x&&(maxX=x),maxY<y&&(maxY=y),maxZ<z&&(maxZ=z)}this.min.set(minX,minY,minZ),this.max.set(maxX,maxY,maxZ)},setFromPoints:function(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++)this.expandByPoint(points[i]);return this},setFromCenterAndSize:function(){var v1=new Vector3;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);return this.min.copy(center).sub(halfSize),this.max.copy(center).add(halfSize),this}}(),setFromObject:function(){var v1=new Vector3;return function(object){var scope=this;return object.updateMatrixWorld(!0),this.makeEmpty(),object.traverse(function(node){var i,l,geometry=node.geometry;if(void 0!==geometry)if(geometry.isGeometry){var vertices=geometry.vertices;for(i=0,l=vertices.length;i<l;i++)v1.copy(vertices[i]),v1.applyMatrix4(node.matrixWorld),scope.expandByPoint(v1)}else if(geometry.isBufferGeometry){var attribute=geometry.attributes.position;if(void 0!==attribute)for(i=0,l=attribute.count;i<l;i++)v1.fromAttribute(attribute,i).applyMatrix4(node.matrixWorld),scope.expandByPoint(v1)}}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(box){return this.min.copy(box.min),this.max.copy(box.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(optionalTarget){var result=optionalTarget||new Vector3;return this.isEmpty()?result.set(0,0,0):result.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(optionalTarget){var result=optionalTarget||new Vector3;return this.isEmpty()?result.set(0,0,0):result.subVectors(this.max,this.min)},expandByPoint:function(point){return this.min.min(point),this.max.max(point),this},expandByVector:function(vector){return this.min.sub(vector),this.max.add(vector),this},expandByScalar:function(scalar){return this.min.addScalar(-scalar),this.max.addScalar(scalar),this},containsPoint:function(point){return!(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y||point.z<this.min.z||point.z>this.max.z)},containsBox:function(box){return this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y&&this.min.z<=box.min.z&&box.max.z<=this.max.z},getParameter:function(point,optionalTarget){return(optionalTarget||new Vector3).set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y),(point.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(box){return!(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y||box.max.z<this.min.z||box.min.z>this.max.z)},intersectsSphere:function(sphere){return void 0===closestPoint&&(closestPoint=new Vector3),this.clampPoint(sphere.center,closestPoint),closestPoint.distanceToSquared(sphere.center)<=sphere.radius*sphere.radius},intersectsPlane:function(plane){var min,max;return max=0<plane.normal.x?(min=plane.normal.x*this.min.x,plane.normal.x*this.max.x):(min=plane.normal.x*this.max.x,plane.normal.x*this.min.x),0<plane.normal.y?(min+=plane.normal.y*this.min.y,max+=plane.normal.y*this.max.y):(min+=plane.normal.y*this.max.y,max+=plane.normal.y*this.min.y),0<plane.normal.z?(min+=plane.normal.z*this.min.z,max+=plane.normal.z*this.max.z):(min+=plane.normal.z*this.max.z,max+=plane.normal.z*this.min.z),min<=plane.constant&&max>=plane.constant},clampPoint:function(point,optionalTarget){return(optionalTarget||new Vector3).copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new Vector3;return function(point){return v1.copy(point).clamp(this.min,this.max).sub(point).length()}}(),getBoundingSphere:function(){var v1=new Vector3;return function(optionalTarget){var result=optionalTarget||new Sphere;return this.getCenter(result.center),result.radius=.5*this.getSize(v1).length(),result}}(),intersect:function(box){return this.min.max(box.min),this.max.min(box.max),this.isEmpty()&&this.makeEmpty(),this},union:function(box){return this.min.min(box.min),this.max.max(box.max),this},applyMatrix4:(points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],function(matrix){return this.isEmpty()||(points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(matrix),points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(matrix),points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(matrix),points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(matrix),points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(matrix),points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(matrix),points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(matrix),points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(matrix),this.setFromPoints(points)),this}),translate:function(offset){return this.min.add(offset),this.max.add(offset),this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)}},Sphere.prototype={constructor:Sphere,set:function(center,radius){return this.center.copy(center),this.radius=radius,this},setFromPoints:(box=new Box3,function(points,optionalCenter){var center=this.center;void 0!==optionalCenter?center.copy(optionalCenter):box.setFromPoints(points).getCenter(center);for(var maxRadiusSq=0,i=0,il=points.length;i<il;i++)maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(points[i]));return this.radius=Math.sqrt(maxRadiusSq),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(sphere){return this.center.copy(sphere.center),this.radius=sphere.radius,this},empty:function(){return this.radius<=0},containsPoint:function(point){return point.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(point){return point.distanceTo(this.center)-this.radius},intersectsSphere:function(sphere){var radiusSum=this.radius+sphere.radius;return sphere.center.distanceToSquared(this.center)<=radiusSum*radiusSum},intersectsBox:function(box){return box.intersectsSphere(this)},intersectsPlane:function(plane){return Math.abs(this.center.dot(plane.normal)-plane.constant)<=this.radius},clampPoint:function(point,optionalTarget){var deltaLengthSq=this.center.distanceToSquared(point),result=optionalTarget||new Vector3;return result.copy(point),deltaLengthSq>this.radius*this.radius&&(result.sub(this.center).normalize(),result.multiplyScalar(this.radius).add(this.center)),result},getBoundingBox:function(optionalTarget){var box=optionalTarget||new Box3;return box.set(this.center,this.center),box.expandByScalar(this.radius),box},applyMatrix4:function(matrix){return this.center.applyMatrix4(matrix),this.radius=this.radius*matrix.getMaxScaleOnAxis(),this},translate:function(offset){return this.center.add(offset),this},equals:function(sphere){return sphere.center.equals(this.center)&&sphere.radius===this.radius}},Matrix3.prototype={constructor:Matrix3,isMatrix3:!0,set:function(n11,n12,n13,n21,n22,n23,n31,n32,n33){var te=this.elements;return te[0]=n11,te[1]=n21,te[2]=n31,te[3]=n12,te[4]=n22,te[5]=n32,te[6]=n13,te[7]=n23,te[8]=n33,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(m){var me=m.elements;return this.set(me[0],me[3],me[6],me[1],me[4],me[7],me[2],me[5],me[8]),this},setFromMatrix4:function(m){var me=m.elements;return this.set(me[0],me[4],me[8],me[1],me[5],me[9],me[2],me[6],me[10]),this},applyToVector3Array:function(){var v1;return function(array,offset,length){void 0===v1&&(v1=new Vector3),void 0===offset&&(offset=0),void 0===length&&(length=array.length);for(var i=0,j=offset;i<length;i+=3,j+=3)v1.fromArray(array,j),v1.applyMatrix3(this),v1.toArray(array,j);return array}}(),applyToBufferAttribute:function(){var v1;return function(attribute){void 0===v1&&(v1=new Vector3);for(var i=0,l=attribute.count;i<l;i++)v1.x=attribute.getX(i),v1.y=attribute.getY(i),v1.z=attribute.getZ(i),v1.applyMatrix3(this),attribute.setXYZ(i,v1.x,v1.y,v1.z);return attribute}}(),multiplyScalar:function(s){var te=this.elements;return te[0]*=s,te[3]*=s,te[6]*=s,te[1]*=s,te[4]*=s,te[7]*=s,te[2]*=s,te[5]*=s,te[8]*=s,this},determinant:function(){var te=this.elements,a=te[0],b=te[1],c=te[2],d=te[3],e=te[4],f=te[5],g=te[6],h=te[7],i=te[8];return a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g},getInverse:function(matrix,throwOnDegenerate){matrix&&matrix.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var me=matrix.elements,te=this.elements,n11=me[0],n21=me[1],n31=me[2],n12=me[3],n22=me[4],n32=me[5],n13=me[6],n23=me[7],n33=me[8],t11=n33*n22-n32*n23,t12=n32*n13-n33*n12,t13=n23*n12-n22*n13,det=n11*t11+n21*t12+n31*t13;if(0==det){var msg="THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";if(!0===throwOnDegenerate)throw new Error(msg);return console.warn(msg),this.identity()}var detInv=1/det;return te[0]=t11*detInv,te[1]=(n31*n23-n33*n21)*detInv,te[2]=(n32*n21-n31*n22)*detInv,te[3]=t12*detInv,te[4]=(n33*n11-n31*n13)*detInv,te[5]=(n31*n12-n32*n11)*detInv,te[6]=t13*detInv,te[7]=(n21*n13-n23*n11)*detInv,te[8]=(n22*n11-n21*n12)*detInv,this},transpose:function(){var tmp,m=this.elements;return tmp=m[1],m[1]=m[3],m[3]=tmp,tmp=m[2],m[2]=m[6],m[6]=tmp,tmp=m[5],m[5]=m[7],m[7]=tmp,this},getNormalMatrix:function(matrix4){return this.setFromMatrix4(matrix4).getInverse(this).transpose()},transposeIntoArray:function(r){var m=this.elements;return r[0]=m[0],r[1]=m[3],r[2]=m[6],r[3]=m[1],r[4]=m[4],r[5]=m[7],r[6]=m[2],r[7]=m[5],r[8]=m[8],this},fromArray:function(array,offset){void 0===offset&&(offset=0);for(var i=0;i<9;i++)this.elements[i]=array[i+offset];return this},toArray:function(array,offset){void 0===array&&(array=[]),void 0===offset&&(offset=0);var te=this.elements;return array[offset]=te[0],array[offset+1]=te[1],array[offset+2]=te[2],array[offset+3]=te[3],array[offset+4]=te[4],array[offset+5]=te[5],array[offset+6]=te[6],array[offset+7]=te[7],array[offset+8]=te[8],array}},Plane.prototype={constructor:Plane,set:function(normal,constant){return this.normal.copy(normal),this.constant=constant,this},setComponents:function(x,y,z,w){return this.normal.set(x,y,z),this.constant=w,this},setFromNormalAndCoplanarPoint:function(normal,point){return this.normal.copy(normal),this.constant=-point.dot(this.normal),this},setFromCoplanarPoints:function(){var v1=new Vector3,v2=new Vector3;return function(a,b,c){var normal=v1.subVectors(c,b).cross(v2.subVectors(a,b)).normalize();return this.setFromNormalAndCoplanarPoint(normal,a),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(plane){return this.normal.copy(plane.normal),this.constant=plane.constant,this},normalize:function(){var inverseNormalLength=1/this.normal.length();return this.normal.multiplyScalar(inverseNormalLength),this.constant*=inverseNormalLength,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(point){return this.normal.dot(point)+this.constant},distanceToSphere:function(sphere){return this.distanceToPoint(sphere.center)-sphere.radius},projectPoint:function(point,optionalTarget){return this.orthoPoint(point,optionalTarget).sub(point).negate()},orthoPoint:function(point,optionalTarget){var perpendicularMagnitude=this.distanceToPoint(point);return(optionalTarget||new Vector3).copy(this.normal).multiplyScalar(perpendicularMagnitude)},intersectLine:function(){var v1=new Vector3;return function(line,optionalTarget){var result=optionalTarget||new Vector3,direction=line.delta(v1),denominator=this.normal.dot(direction);if(0===denominator)return 0===this.distanceToPoint(line.start)?result.copy(line.start):void 0;var t=-(line.start.dot(this.normal)+this.constant)/denominator;return t<0||1<t?void 0:result.copy(direction).multiplyScalar(t).add(line.start)}}(),intersectsLine:function(line){var startSign=this.distanceToPoint(line.start),endSign=this.distanceToPoint(line.end);return startSign<0&&0<endSign||endSign<0&&0<startSign},intersectsBox:function(box){return box.intersectsPlane(this)},intersectsSphere:function(sphere){return sphere.intersectsPlane(this)},coplanarPoint:function(optionalTarget){return(optionalTarget||new Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var v1=new Vector3,m1=new Matrix3;return function(matrix,optionalNormalMatrix){var referencePoint=this.coplanarPoint(v1).applyMatrix4(matrix),normalMatrix=optionalNormalMatrix||m1.getNormalMatrix(matrix),normal=this.normal.applyMatrix3(normalMatrix).normalize();return this.constant=-referencePoint.dot(normal),this}}(),translate:function(offset){return this.constant=this.constant-offset.dot(this.normal),this},equals:function(plane){return plane.normal.equals(this.normal)&&plane.constant===this.constant}},Frustum.prototype={constructor:Frustum,set:function(p0,p1,p2,p3,p4,p5){var planes=this.planes;return planes[0].copy(p0),planes[1].copy(p1),planes[2].copy(p2),planes[3].copy(p3),planes[4].copy(p4),planes[5].copy(p5),this},clone:function(){return(new this.constructor).copy(this)},copy:function(frustum){for(var planes=this.planes,i=0;i<6;i++)planes[i].copy(frustum.planes[i]);return this},setFromMatrix:function(m){var planes=this.planes,me=m.elements,me0=me[0],me1=me[1],me2=me[2],me3=me[3],me4=me[4],me5=me[5],me6=me[6],me7=me[7],me8=me[8],me9=me[9],me10=me[10],me11=me[11],me12=me[12],me13=me[13],me14=me[14],me15=me[15];return planes[0].setComponents(me3-me0,me7-me4,me11-me8,me15-me12).normalize(),planes[1].setComponents(me3+me0,me7+me4,me11+me8,me15+me12).normalize(),planes[2].setComponents(me3+me1,me7+me5,me11+me9,me15+me13).normalize(),planes[3].setComponents(me3-me1,me7-me5,me11-me9,me15-me13).normalize(),planes[4].setComponents(me3-me2,me7-me6,me11-me10,me15-me14).normalize(),planes[5].setComponents(me3+me2,me7+me6,me11+me10,me15+me14).normalize(),this},intersectsObject:(sphere=new Sphere,function(object){var geometry=object.geometry;return null===geometry.boundingSphere&&geometry.computeBoundingSphere(),sphere.copy(geometry.boundingSphere).applyMatrix4(object.matrixWorld),this.intersectsSphere(sphere)}),intersectsSprite:function(){var sphere=new Sphere;return function(sprite){return sphere.center.set(0,0,0),sphere.radius=.7071067811865476,sphere.applyMatrix4(sprite.matrixWorld),this.intersectsSphere(sphere)}}(),intersectsSphere:function(sphere){for(var planes=this.planes,center=sphere.center,negRadius=-sphere.radius,i=0;i<6;i++){if(planes[i].distanceToPoint(center)<negRadius)return!1}return!0},intersectsBox:(p1=new Vector3,p2=new Vector3,function(box){for(var planes=this.planes,i=0;i<6;i++){var plane=planes[i];p1.x=0<plane.normal.x?box.min.x:box.max.x,p2.x=0<plane.normal.x?box.max.x:box.min.x,p1.y=0<plane.normal.y?box.min.y:box.max.y,p2.y=0<plane.normal.y?box.max.y:box.min.y,p1.z=0<plane.normal.z?box.min.z:box.max.z,p2.z=0<plane.normal.z?box.max.z:box.min.z;var d1=plane.distanceToPoint(p1),d2=plane.distanceToPoint(p2);if(d1<0&&d2<0)return!1}return!0}),containsPoint:function(point){for(var planes=this.planes,i=0;i<6;i++)if(planes[i].distanceToPoint(point)<0)return!1;return!0}},Ray.prototype={constructor:Ray,set:function(origin,direction){return this.origin.copy(origin),this.direction.copy(direction),this},clone:function(){return(new this.constructor).copy(this)},copy:function(ray){return this.origin.copy(ray.origin),this.direction.copy(ray.direction),this},at:function(t,optionalTarget){return(optionalTarget||new Vector3).copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(v){return this.direction.copy(v).sub(this.origin).normalize(),this},recast:function(){var v1=new Vector3;return function(t){return this.origin.copy(this.at(t,v1)),this}}(),closestPointToPoint:function(point,optionalTarget){var result=optionalTarget||new Vector3;result.subVectors(point,this.origin);var directionDistance=result.dot(this.direction);return directionDistance<0?result.copy(this.origin):result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin)},distanceToPoint:function(point){return Math.sqrt(this.distanceSqToPoint(point))},distanceSqToPoint:function(){var v1=new Vector3;return function(point){var directionDistance=v1.subVectors(point,this.origin).dot(this.direction);return directionDistance<0?this.origin.distanceToSquared(point):(v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin),v1.distanceToSquared(point))}}(),distanceSqToSegment:(segCenter=new Vector3,segDir=new Vector3,diff=new Vector3,function(v0,v1,optionalPointOnRay,optionalPointOnSegment){segCenter.copy(v0).add(v1).multiplyScalar(.5),segDir.copy(v1).sub(v0).normalize(),diff.copy(this.origin).sub(segCenter);var s0,s1,sqrDist,extDet,segExtent=.5*v0.distanceTo(v1),a01=-this.direction.dot(segDir),b0=diff.dot(this.direction),b1=-diff.dot(segDir),c=diff.lengthSq(),det=Math.abs(1-a01*a01);if(0<det)if(s1=a01*b0-b1,extDet=segExtent*det,0<=(s0=a01*b1-b0))if(-extDet<=s1)if(s1<=extDet){var invDet=1/det;sqrDist=(s0*=invDet)*(s0+a01*(s1*=invDet)+2*b0)+s1*(a01*s0+s1+2*b1)+c}else s1=segExtent,sqrDist=-(s0=Math.max(0,-(a01*s1+b0)))*s0+s1*(s1+2*b1)+c;else s1=-segExtent,sqrDist=-(s0=Math.max(0,-(a01*s1+b0)))*s0+s1*(s1+2*b1)+c;else sqrDist=s1<=-extDet?-(s0=Math.max(0,-(-a01*segExtent+b0)))*s0+(s1=0<s0?-segExtent:Math.min(Math.max(-segExtent,-b1),segExtent))*(s1+2*b1)+c:s1<=extDet?(s0=0,(s1=Math.min(Math.max(-segExtent,-b1),segExtent))*(s1+2*b1)+c):-(s0=Math.max(0,-(a01*segExtent+b0)))*s0+(s1=0<s0?segExtent:Math.min(Math.max(-segExtent,-b1),segExtent))*(s1+2*b1)+c;else s1=0<a01?-segExtent:segExtent,sqrDist=-(s0=Math.max(0,-(a01*s1+b0)))*s0+s1*(s1+2*b1)+c;return optionalPointOnRay&&optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin),optionalPointOnSegment&&optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter),sqrDist}),intersectSphere:function(){var v1=new Vector3;return function(sphere,optionalTarget){v1.subVectors(sphere.center,this.origin);var tca=v1.dot(this.direction),d2=v1.dot(v1)-tca*tca,radius2=sphere.radius*sphere.radius;if(radius2<d2)return null;var thc=Math.sqrt(radius2-d2),t0=tca-thc,t1=tca+thc;return t0<0&&t1<0?null:t0<0?this.at(t1,optionalTarget):this.at(t0,optionalTarget)}}(),intersectsSphere:function(sphere){return this.distanceToPoint(sphere.center)<=sphere.radius},distanceToPlane:function(plane){var denominator=plane.normal.dot(this.direction);if(0===denominator)return 0===plane.distanceToPoint(this.origin)?0:null;var t=-(this.origin.dot(plane.normal)+plane.constant)/denominator;return 0<=t?t:null},intersectPlane:function(plane,optionalTarget){var t=this.distanceToPlane(plane);return null===t?null:this.at(t,optionalTarget)},intersectsPlane:function(plane){var distToPoint=plane.distanceToPoint(this.origin);return 0===distToPoint||plane.normal.dot(this.direction)*distToPoint<0},intersectBox:function(box,optionalTarget){var tmin,tmax,tymin,tymax,tzmin,tzmax,invdirx=1/this.direction.x,invdiry=1/this.direction.y,invdirz=1/this.direction.z,origin=this.origin;return tmax=0<=invdirx?(tmin=(box.min.x-origin.x)*invdirx,(box.max.x-origin.x)*invdirx):(tmin=(box.max.x-origin.x)*invdirx,(box.min.x-origin.x)*invdirx),(tymax=0<=invdiry?(tymin=(box.min.y-origin.y)*invdiry,(box.max.y-origin.y)*invdiry):(tymin=(box.max.y-origin.y)*invdiry,(box.min.y-origin.y)*invdiry))<tmin||tmax<tymin?null:((tmin<tymin||tmin!=tmin)&&(tmin=tymin),(tymax<tmax||tmax!=tmax)&&(tmax=tymax),(tzmax=0<=invdirz?(tzmin=(box.min.z-origin.z)*invdirz,(box.max.z-origin.z)*invdirz):(tzmin=(box.max.z-origin.z)*invdirz,(box.min.z-origin.z)*invdirz))<tmin||tmax<tzmin?null:((tmin<tzmin||tmin!=tmin)&&(tmin=tzmin),(tzmax<tmax||tmax!=tmax)&&(tmax=tzmax),tmax<0?null:this.at(0<=tmin?tmin:tmax,optionalTarget)))},intersectsBox:(v=new Vector3,function(box){return null!==this.intersectBox(box,v)}),intersectTriangle:function(){var diff=new Vector3,edge1=new Vector3,edge2=new Vector3,normal=new Vector3;return function(a,b,c,backfaceCulling,optionalTarget){edge1.subVectors(b,a),edge2.subVectors(c,a),normal.crossVectors(edge1,edge2);var sign,DdN=this.direction.dot(normal);if(0<DdN){if(backfaceCulling)return null;sign=1}else{if(!(DdN<0))return null;sign=-1,DdN=-DdN}diff.subVectors(this.origin,a);var DdQxE2=sign*this.direction.dot(edge2.crossVectors(diff,edge2));if(DdQxE2<0)return null;var DdE1xQ=sign*this.direction.dot(edge1.cross(diff));if(DdE1xQ<0)return null;if(DdN<DdQxE2+DdE1xQ)return null;var QdN=-sign*diff.dot(normal);return QdN<0?null:this.at(QdN/DdN,optionalTarget)}}(),applyMatrix4:function(matrix4){return this.direction.add(this.origin).applyMatrix4(matrix4),this.origin.applyMatrix4(matrix4),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(ray){return ray.origin.equals(this.origin)&&ray.direction.equals(this.direction)}},Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Euler.DefaultOrder="XYZ",Euler.prototype={constructor:Euler,isEuler:!0,get x(){return this._x},set x(value){this._x=value,this.onChangeCallback()},get y(){return this._y},set y(value){this._y=value,this.onChangeCallback()},get z(){return this._z},set z(value){this._z=value,this.onChangeCallback()},get order(){return this._order},set order(value){this._order=value,this.onChangeCallback()},set:function(x,y,z,order){return this._x=x,this._y=y,this._z=z,this._order=order||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(euler){return this._x=euler._x,this._y=euler._y,this._z=euler._z,this._order=euler._order,this.onChangeCallback(),this},setFromRotationMatrix:function(m,order,update){var clamp=_Math.clamp,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];return"XYZ"===(order=order||this._order)?(this._y=Math.asin(clamp(m13,-1,1)),Math.abs(m13)<.99999?(this._x=Math.atan2(-m23,m33),this._z=Math.atan2(-m12,m11)):(this._x=Math.atan2(m32,m22),this._z=0)):"YXZ"===order?(this._x=Math.asin(-clamp(m23,-1,1)),Math.abs(m23)<.99999?(this._y=Math.atan2(m13,m33),this._z=Math.atan2(m21,m22)):(this._y=Math.atan2(-m31,m11),this._z=0)):"ZXY"===order?(this._x=Math.asin(clamp(m32,-1,1)),Math.abs(m32)<.99999?(this._y=Math.atan2(-m31,m33),this._z=Math.atan2(-m12,m22)):(this._y=0,this._z=Math.atan2(m21,m11))):"ZYX"===order?(this._y=Math.asin(-clamp(m31,-1,1)),Math.abs(m31)<.99999?(this._x=Math.atan2(m32,m33),this._z=Math.atan2(m21,m11)):(this._x=0,this._z=Math.atan2(-m12,m22))):"YZX"===order?(this._z=Math.asin(clamp(m21,-1,1)),Math.abs(m21)<.99999?(this._x=Math.atan2(-m23,m22),this._y=Math.atan2(-m31,m11)):(this._x=0,this._y=Math.atan2(m13,m33))):"XZY"===order?(this._z=Math.asin(-clamp(m12,-1,1)),Math.abs(m12)<.99999?(this._x=Math.atan2(m32,m22),this._y=Math.atan2(m13,m11)):(this._x=Math.atan2(-m23,m33),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+order),this._order=order,!1!==update&&this.onChangeCallback(),this},setFromQuaternion:function(){var matrix;return function(q,order,update){return void 0===matrix&&(matrix=new Matrix4),matrix.makeRotationFromQuaternion(q),this.setFromRotationMatrix(matrix,order,update)}}(),setFromVector3:function(v,order){return this.set(v.x,v.y,v.z,order||this._order)},reorder:(q=new Quaternion,function(newOrder){return q.setFromEuler(this),this.setFromQuaternion(q,newOrder)}),equals:function(euler){return euler._x===this._x&&euler._y===this._y&&euler._z===this._z&&euler._order===this._order},fromArray:function(array){return this._x=array[0],this._y=array[1],this._z=array[2],void 0!==array[3]&&(this._order=array[3]),this.onChangeCallback(),this},toArray:function(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this._x,array[offset+1]=this._y,array[offset+2]=this._z,array[offset+3]=this._order,array},toVector3:function(optionalResult){return optionalResult?optionalResult.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)},onChange:function(callback){return this.onChangeCallback=callback,this},onChangeCallback:function(){}},Layers.prototype={constructor:Layers,set:function(channel){this.mask=1<<channel},enable:function(channel){this.mask|=1<<channel},toggle:function(channel){this.mask^=1<<channel},disable:function(channel){this.mask&=~(1<<channel)},test:function(layers){return 0!=(this.mask&layers.mask)}};var position,scale,m1,q1,startP,startEnd,v0,obj,object3DId=0;function Object3D(){Object.defineProperty(this,"id",{value:object3DId++}),this.uuid=_Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var position=new Vector3,rotation=new Euler,quaternion=new Quaternion,scale=new Vector3(1,1,1);rotation.onChange(function(){quaternion.setFromEuler(rotation,!1)}),quaternion.onChange(function(){rotation.setFromQuaternion(quaternion,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:position},rotation:{enumerable:!0,value:rotation},quaternion:{enumerable:!0,value:quaternion},scale:{enumerable:!0,value:scale},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={},this.onBeforeRender=function(){},this.onAfterRender=function(){}}function Line3(start,end){this.start=void 0!==start?start:new Vector3,this.end=void 0!==end?end:new Vector3}function Triangle(a,b,c){this.a=void 0!==a?a:new Vector3,this.b=void 0!==b?b:new Vector3,this.c=void 0!==c?c:new Vector3}function Face3(a,b,c,normal,color,materialIndex){this.a=a,this.b=b,this.c=c,this.normal=normal&&normal.isVector3?normal:new Vector3,this.vertexNormals=Array.isArray(normal)?normal:[],this.color=color&&color.isColor?color:new Color,this.vertexColors=Array.isArray(color)?color:[],this.materialIndex=void 0!==materialIndex?materialIndex:0}function MeshBasicMaterial(parameters){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(parameters)}function BufferAttribute(array,itemSize,normalized){if(Array.isArray(array))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=_Math.generateUUID(),this.array=array,this.itemSize=itemSize,this.count=void 0!==array?array.length/itemSize:0,this.normalized=!0===normalized,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function Int8BufferAttribute(array,itemSize){BufferAttribute.call(this,new Int8Array(array),itemSize)}function Uint8BufferAttribute(array,itemSize){BufferAttribute.call(this,new Uint8Array(array),itemSize)}function Uint8ClampedBufferAttribute(array,itemSize){BufferAttribute.call(this,new Uint8ClampedArray(array),itemSize)}function Int16BufferAttribute(array,itemSize){BufferAttribute.call(this,new Int16Array(array),itemSize)}function Uint16BufferAttribute(array,itemSize){BufferAttribute.call(this,new Uint16Array(array),itemSize)}function Int32BufferAttribute(array,itemSize){BufferAttribute.call(this,new Int32Array(array),itemSize)}function Uint32BufferAttribute(array,itemSize){BufferAttribute.call(this,new Uint32Array(array),itemSize)}function Float32BufferAttribute(array,itemSize){BufferAttribute.call(this,new Float32Array(array),itemSize)}function Float64BufferAttribute(array,itemSize){BufferAttribute.call(this,new Float64Array(array),itemSize)}function DirectGeometry(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Geometry(){Object.defineProperty(this,"id",{value:GeometryIdCount()}),this.uuid=_Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object.assign(Object3D.prototype,EventDispatcher.prototype,{isObject3D:!0,applyMatrix:function(matrix){this.matrix.multiplyMatrices(matrix,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(axis,angle){this.quaternion.setFromAxisAngle(axis,angle)},setRotationFromEuler:function(euler){this.quaternion.setFromEuler(euler,!0)},setRotationFromMatrix:function(m){this.quaternion.setFromRotationMatrix(m)},setRotationFromQuaternion:function(q){this.quaternion.copy(q)},rotateOnAxis:(q1=new Quaternion,function(axis,angle){return q1.setFromAxisAngle(axis,angle),this.quaternion.multiply(q1),this}),rotateX:function(){var v1=new Vector3(1,0,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateY:function(){var v1=new Vector3(0,1,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateZ:function(){var v1=new Vector3(0,0,1);return function(angle){return this.rotateOnAxis(v1,angle)}}(),translateOnAxis:function(){var v1=new Vector3;return function(axis,distance){return v1.copy(axis).applyQuaternion(this.quaternion),this.position.add(v1.multiplyScalar(distance)),this}}(),translateX:function(){var v1=new Vector3(1,0,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateY:function(){var v1=new Vector3(0,1,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateZ:function(){var v1=new Vector3(0,0,1);return function(distance){return this.translateOnAxis(v1,distance)}}(),localToWorld:function(vector){return vector.applyMatrix4(this.matrixWorld)},worldToLocal:(m1=new Matrix4,function(vector){return vector.applyMatrix4(m1.getInverse(this.matrixWorld))}),lookAt:function(){var m1=new Matrix4;return function(vector){m1.lookAt(vector,this.position,this.up),this.quaternion.setFromRotationMatrix(m1)}}(),add:function(object){if(1<arguments.length){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return object===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",object):object&&object.isObject3D?(null!==object.parent&&object.parent.remove(object),object.parent=this,object.dispatchEvent({type:"added"}),this.children.push(object)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",object),this},remove:function(object){if(1<arguments.length)for(var i=0;i<arguments.length;i++)this.remove(arguments[i]);var index=this.children.indexOf(object);-1!==index&&(object.parent=null,object.dispatchEvent({type:"removed"}),this.children.splice(index,1))},getObjectById:function(id){return this.getObjectByProperty("id",id)},getObjectByName:function(name){return this.getObjectByProperty("name",name)},getObjectByProperty:function(name,value){if(this[name]===value)return this;for(var i=0,l=this.children.length;i<l;i++){var object=this.children[i].getObjectByProperty(name,value);if(void 0!==object)return object}},getWorldPosition:function(optionalTarget){var result=optionalTarget||new Vector3;return this.updateMatrixWorld(!0),result.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(position=new Vector3,scale=new Vector3,function(optionalTarget){var result=optionalTarget||new Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(position,result,scale),result}),getWorldRotation:function(){var quaternion=new Quaternion;return function(optionalTarget){var result=optionalTarget||new Euler;return this.getWorldQuaternion(quaternion),result.setFromQuaternion(quaternion,this.rotation.order,!1)}}(),getWorldScale:function(){var position=new Vector3,quaternion=new Quaternion;return function(optionalTarget){var result=optionalTarget||new Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(position,quaternion,result),result}}(),getWorldDirection:function(){var quaternion=new Quaternion;return function(optionalTarget){var result=optionalTarget||new Vector3;return this.getWorldQuaternion(quaternion),result.set(0,0,1).applyQuaternion(quaternion)}}(),raycast:function(){},traverse:function(callback){callback(this);for(var children=this.children,i=0,l=children.length;i<l;i++)children[i].traverse(callback)},traverseVisible:function(callback){if(!1!==this.visible){callback(this);for(var children=this.children,i=0,l=children.length;i<l;i++)children[i].traverseVisible(callback)}},traverseAncestors:function(callback){var parent=this.parent;null!==parent&&(callback(parent),parent.traverseAncestors(callback))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(force){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==force||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),force=!(this.matrixWorldNeedsUpdate=!1));for(var children=this.children,i=0,l=children.length;i<l;i++)children[i].updateMatrixWorld(force)},toJSON:function(meta){var isRootObject=void 0===meta||""===meta,output={};isRootObject&&(meta={geometries:{},materials:{},textures:{},images:{}},output.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var object={};if(object.uuid=this.uuid,object.type=this.type,""!==this.name&&(object.name=this.name),"{}"!==JSON.stringify(this.userData)&&(object.userData=this.userData),!0===this.castShadow&&(object.castShadow=!0),!0===this.receiveShadow&&(object.receiveShadow=!0),!1===this.visible&&(object.visible=!1),object.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===meta.geometries[this.geometry.uuid]&&(meta.geometries[this.geometry.uuid]=this.geometry.toJSON(meta)),object.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===meta.materials[this.material.uuid]&&(meta.materials[this.material.uuid]=this.material.toJSON(meta)),object.material=this.material.uuid),0<this.children.length){object.children=[];for(var i=0;i<this.children.length;i++)object.children.push(this.children[i].toJSON(meta).object)}if(isRootObject){var geometries=extractFromCache(meta.geometries),materials=extractFromCache(meta.materials),textures=extractFromCache(meta.textures),images=extractFromCache(meta.images);0<geometries.length&&(output.geometries=geometries),0<materials.length&&(output.materials=materials),0<textures.length&&(output.textures=textures),0<images.length&&(output.images=images)}return output.object=object,output;function extractFromCache(cache){var values=[];for(var key in cache){var data=cache[key];delete data.metadata,values.push(data)}return values}},clone:function(recursive){return(new this.constructor).copy(this,recursive)},copy:function(source,recursive){if(void 0===recursive&&(recursive=!0),this.name=source.name,this.up.copy(source.up),this.position.copy(source.position),this.quaternion.copy(source.quaternion),this.scale.copy(source.scale),this.matrix.copy(source.matrix),this.matrixWorld.copy(source.matrixWorld),this.matrixAutoUpdate=source.matrixAutoUpdate,this.matrixWorldNeedsUpdate=source.matrixWorldNeedsUpdate,this.layers.mask=source.layers.mask,this.visible=source.visible,this.castShadow=source.castShadow,this.receiveShadow=source.receiveShadow,this.frustumCulled=source.frustumCulled,this.renderOrder=source.renderOrder,this.userData=JSON.parse(JSON.stringify(source.userData)),!0===recursive)for(var i=0;i<source.children.length;i++){var child=source.children[i];this.add(child.clone())}return this}}),Line3.prototype={constructor:Line3,set:function(start,end){return this.start.copy(start),this.end.copy(end),this},clone:function(){return(new this.constructor).copy(this)},copy:function(line){return this.start.copy(line.start),this.end.copy(line.end),this},getCenter:function(optionalTarget){return(optionalTarget||new Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(optionalTarget){return(optionalTarget||new Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,optionalTarget){var result=optionalTarget||new Vector3;return this.delta(result).multiplyScalar(t).add(this.start)},closestPointToPointParameter:(startP=new Vector3,startEnd=new Vector3,function(point,clampToLine){startP.subVectors(point,this.start),startEnd.subVectors(this.end,this.start);var startEnd2=startEnd.dot(startEnd),t=startEnd.dot(startP)/startEnd2;return clampToLine&&(t=_Math.clamp(t,0,1)),t}),closestPointToPoint:function(point,clampToLine,optionalTarget){var t=this.closestPointToPointParameter(point,clampToLine),result=optionalTarget||new Vector3;return this.delta(result).multiplyScalar(t).add(this.start)},applyMatrix4:function(matrix){return this.start.applyMatrix4(matrix),this.end.applyMatrix4(matrix),this},equals:function(line){return line.start.equals(this.start)&&line.end.equals(this.end)}},Triangle.normal=(v0=new Vector3,function(a,b,c,optionalTarget){var result=optionalTarget||new Vector3;result.subVectors(c,b),v0.subVectors(a,b),result.cross(v0);var resultLengthSq=result.lengthSq();return 0<resultLengthSq?result.multiplyScalar(1/Math.sqrt(resultLengthSq)):result.set(0,0,0)}),Triangle.barycoordFromPoint=function(){var v0=new Vector3,v1=new Vector3,v2=new Vector3;return function(point,a,b,c,optionalTarget){v0.subVectors(c,a),v1.subVectors(b,a),v2.subVectors(point,a);var dot00=v0.dot(v0),dot01=v0.dot(v1),dot02=v0.dot(v2),dot11=v1.dot(v1),dot12=v1.dot(v2),denom=dot00*dot11-dot01*dot01,result=optionalTarget||new Vector3;if(0==denom)return result.set(-2,-1,-1);var invDenom=1/denom,u=(dot11*dot02-dot01*dot12)*invDenom,v=(dot00*dot12-dot01*dot02)*invDenom;return result.set(1-u-v,v,u)}}(),Triangle.containsPoint=function(){var v1=new Vector3;return function(point,a,b,c){var result=Triangle.barycoordFromPoint(point,a,b,c,v1);return 0<=result.x&&0<=result.y&&result.x+result.y<=1}}(),Triangle.prototype={constructor:Triangle,set:function(a,b,c){return this.a.copy(a),this.b.copy(b),this.c.copy(c),this},setFromPointsAndIndices:function(points,i0,i1,i2){return this.a.copy(points[i0]),this.b.copy(points[i1]),this.c.copy(points[i2]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(triangle){return this.a.copy(triangle.a),this.b.copy(triangle.b),this.c.copy(triangle.c),this},area:function(){var v0=new Vector3,v1=new Vector3;return function(){return v0.subVectors(this.c,this.b),v1.subVectors(this.a,this.b),.5*v0.cross(v1).length()}}(),midpoint:function(optionalTarget){return(optionalTarget||new Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(optionalTarget){return Triangle.normal(this.a,this.b,this.c,optionalTarget)},plane:function(optionalTarget){return(optionalTarget||new Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(point,optionalTarget){return Triangle.barycoordFromPoint(point,this.a,this.b,this.c,optionalTarget)},containsPoint:function(point){return Triangle.containsPoint(point,this.a,this.b,this.c)},closestPointToPoint:function(){var plane,edgeList,projectedPoint,closestPoint;return function(point,optionalTarget){void 0===plane&&(plane=new Plane,edgeList=[new Line3,new Line3,new Line3],projectedPoint=new Vector3,closestPoint=new Vector3);var result=optionalTarget||new Vector3,minDistance=1/0;if(plane.setFromCoplanarPoints(this.a,this.b,this.c),plane.projectPoint(point,projectedPoint),!0===this.containsPoint(projectedPoint))result.copy(projectedPoint);else{edgeList[0].set(this.a,this.b),edgeList[1].set(this.b,this.c),edgeList[2].set(this.c,this.a);for(var i=0;i<edgeList.length;i++){edgeList[i].closestPointToPoint(projectedPoint,!0,closestPoint);var distance=projectedPoint.distanceToSquared(closestPoint);distance<minDistance&&(minDistance=distance,result.copy(closestPoint))}}return result}}(),equals:function(triangle){return triangle.a.equals(this.a)&&triangle.b.equals(this.b)&&triangle.c.equals(this.c)}},Face3.prototype={constructor:Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(source){this.a=source.a,this.b=source.b,this.c=source.c,this.normal.copy(source.normal),this.color.copy(source.color),this.materialIndex=source.materialIndex;for(var i=0,il=source.vertexNormals.length;i<il;i++)this.vertexNormals[i]=source.vertexNormals[i].clone();for(i=0,il=source.vertexColors.length;i<il;i++)this.vertexColors[i]=source.vertexColors[i].clone();return this}},((MeshBasicMaterial.prototype=Object.create(Material.prototype)).constructor=MeshBasicMaterial).prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.specularMap=source.specularMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.combine=source.combine,this.reflectivity=source.reflectivity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this},BufferAttribute.prototype={constructor:BufferAttribute,isBufferAttribute:!0,set needsUpdate(value){!0===value&&this.version++},setArray:function(array){if(Array.isArray(array))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==array?array.length/this.itemSize:0,this.array=array},setDynamic:function(value){return this.dynamic=value,this},copy:function(source){return this.array=new source.array.constructor(source.array),this.itemSize=source.itemSize,this.count=source.count,this.normalized=source.normalized,this.dynamic=source.dynamic,this},copyAt:function(index1,attribute,index2){index1*=this.itemSize,index2*=attribute.itemSize;for(var i=0,l=this.itemSize;i<l;i++)this.array[index1+i]=attribute.array[index2+i];return this},copyArray:function(array){return this.array.set(array),this},copyColorsArray:function(colors){for(var array=this.array,offset=0,i=0,l=colors.length;i<l;i++){var color=colors[i];void 0===color&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),color=new Color),array[offset++]=color.r,array[offset++]=color.g,array[offset++]=color.b}return this},copyIndicesArray:function(indices){for(var array=this.array,offset=0,i=0,l=indices.length;i<l;i++){var index=indices[i];array[offset++]=index.a,array[offset++]=index.b,array[offset++]=index.c}return this},copyVector2sArray:function(vectors){for(var array=this.array,offset=0,i=0,l=vectors.length;i<l;i++){var vector=vectors[i];void 0===vector&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),vector=new Vector2),array[offset++]=vector.x,array[offset++]=vector.y}return this},copyVector3sArray:function(vectors){for(var array=this.array,offset=0,i=0,l=vectors.length;i<l;i++){var vector=vectors[i];void 0===vector&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),vector=new Vector3),array[offset++]=vector.x,array[offset++]=vector.y,array[offset++]=vector.z}return this},copyVector4sArray:function(vectors){for(var array=this.array,offset=0,i=0,l=vectors.length;i<l;i++){var vector=vectors[i];void 0===vector&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),vector=new Vector4),array[offset++]=vector.x,array[offset++]=vector.y,array[offset++]=vector.z,array[offset++]=vector.w}return this},set:function(value,offset){return void 0===offset&&(offset=0),this.array.set(value,offset),this},getX:function(index){return this.array[index*this.itemSize]},setX:function(index,x){return this.array[index*this.itemSize]=x,this},getY:function(index){return this.array[index*this.itemSize+1]},setY:function(index,y){return this.array[index*this.itemSize+1]=y,this},getZ:function(index){return this.array[index*this.itemSize+2]},setZ:function(index,z){return this.array[index*this.itemSize+2]=z,this},getW:function(index){return this.array[index*this.itemSize+3]},setW:function(index,w){return this.array[index*this.itemSize+3]=w,this},setXY:function(index,x,y){return index*=this.itemSize,this.array[index+0]=x,this.array[index+1]=y,this},setXYZ:function(index,x,y,z){return index*=this.itemSize,this.array[index+0]=x,this.array[index+1]=y,this.array[index+2]=z,this},setXYZW:function(index,x,y,z,w){return index*=this.itemSize,this.array[index+0]=x,this.array[index+1]=y,this.array[index+2]=z,this.array[index+3]=w,this},onUpload:function(callback){return this.onUploadCallback=callback,this},clone:function(){return(new this.constructor).copy(this)}},(Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Int8BufferAttribute,(Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Uint8BufferAttribute,(Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Uint8ClampedBufferAttribute,(Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Int16BufferAttribute,(Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Uint16BufferAttribute,(Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Int32BufferAttribute,(Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Uint32BufferAttribute,(Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Float32BufferAttribute,(Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Float64BufferAttribute,Object.assign(DirectGeometry.prototype,{computeGroups:function(geometry){for(var group,groups=[],materialIndex=void 0,faces=geometry.faces,i=0;i<faces.length;i++){var face=faces[i];face.materialIndex!==materialIndex&&(materialIndex=face.materialIndex,void 0!==group&&(group.count=3*i-group.start,groups.push(group)),group={start:3*i,materialIndex:materialIndex})}void 0!==group&&(group.count=3*i-group.start,groups.push(group)),this.groups=groups},fromGeometry:function(geometry){var morphTargetsPosition,faces=geometry.faces,vertices=geometry.vertices,faceVertexUvs=geometry.faceVertexUvs,hasFaceVertexUv=faceVertexUvs[0]&&0<faceVertexUvs[0].length,hasFaceVertexUv2=faceVertexUvs[1]&&0<faceVertexUvs[1].length,morphTargets=geometry.morphTargets,morphTargetsLength=morphTargets.length;if(0<morphTargetsLength){morphTargetsPosition=[];for(var i=0;i<morphTargetsLength;i++)morphTargetsPosition[i]=[];this.morphTargets.position=morphTargetsPosition}var morphTargetsNormal,morphNormals=geometry.morphNormals,morphNormalsLength=morphNormals.length;if(0<morphNormalsLength){morphTargetsNormal=[];for(i=0;i<morphNormalsLength;i++)morphTargetsNormal[i]=[];this.morphTargets.normal=morphTargetsNormal}var skinIndices=geometry.skinIndices,skinWeights=geometry.skinWeights,hasSkinIndices=skinIndices.length===vertices.length,hasSkinWeights=skinWeights.length===vertices.length;for(i=0;i<faces.length;i++){var face=faces[i];this.vertices.push(vertices[face.a],vertices[face.b],vertices[face.c]);var vertexNormals=face.vertexNormals;if(3===vertexNormals.length)this.normals.push(vertexNormals[0],vertexNormals[1],vertexNormals[2]);else{var normal=face.normal;this.normals.push(normal,normal,normal)}var vertexUvs,vertexColors=face.vertexColors;if(3===vertexColors.length)this.colors.push(vertexColors[0],vertexColors[1],vertexColors[2]);else{var color=face.color;this.colors.push(color,color,color)}if(!0===hasFaceVertexUv)void 0!==(vertexUvs=faceVertexUvs[0][i])?this.uvs.push(vertexUvs[0],vertexUvs[1],vertexUvs[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",i),this.uvs.push(new Vector2,new Vector2,new Vector2));if(!0===hasFaceVertexUv2)void 0!==(vertexUvs=faceVertexUvs[1][i])?this.uvs2.push(vertexUvs[0],vertexUvs[1],vertexUvs[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",i),this.uvs2.push(new Vector2,new Vector2,new Vector2));for(var j=0;j<morphTargetsLength;j++){var morphTarget=morphTargets[j].vertices;morphTargetsPosition[j].push(morphTarget[face.a],morphTarget[face.b],morphTarget[face.c])}for(j=0;j<morphNormalsLength;j++){var morphNormal=morphNormals[j].vertexNormals[i];morphTargetsNormal[j].push(morphNormal.a,morphNormal.b,morphNormal.c)}hasSkinIndices&&this.skinIndices.push(skinIndices[face.a],skinIndices[face.b],skinIndices[face.c]),hasSkinWeights&&this.skinWeights.push(skinWeights[face.a],skinWeights[face.b],skinWeights[face.c])}return this.computeGroups(geometry),this.verticesNeedUpdate=geometry.verticesNeedUpdate,this.normalsNeedUpdate=geometry.normalsNeedUpdate,this.colorsNeedUpdate=geometry.colorsNeedUpdate,this.uvsNeedUpdate=geometry.uvsNeedUpdate,this.groupsNeedUpdate=geometry.groupsNeedUpdate,this}}),Object.assign(Geometry.prototype,EventDispatcher.prototype,{isGeometry:!0,applyMatrix:function(matrix){for(var normalMatrix=(new Matrix3).getNormalMatrix(matrix),i=0,il=this.vertices.length;i<il;i++){this.vertices[i].applyMatrix4(matrix)}for(i=0,il=this.faces.length;i<il;i++){var face=this.faces[i];face.normal.applyMatrix3(normalMatrix).normalize();for(var j=0,jl=face.vertexNormals.length;j<jl;j++)face.vertexNormals[j].applyMatrix3(normalMatrix).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var m1;return function(angle){return void 0===m1&&(m1=new Matrix4),m1.makeRotationX(angle),this.applyMatrix(m1),this}}(),rotateY:function(){var m1;return function(angle){return void 0===m1&&(m1=new Matrix4),m1.makeRotationY(angle),this.applyMatrix(m1),this}}(),rotateZ:function(){var m1;return function(angle){return void 0===m1&&(m1=new Matrix4),m1.makeRotationZ(angle),this.applyMatrix(m1),this}}(),translate:function(){var m1;return function(x,y,z){return void 0===m1&&(m1=new Matrix4),m1.makeTranslation(x,y,z),this.applyMatrix(m1),this}}(),scale:function(){var m1;return function(x,y,z){return void 0===m1&&(m1=new Matrix4),m1.makeScale(x,y,z),this.applyMatrix(m1),this}}(),lookAt:function(vector){void 0===obj&&(obj=new Object3D),obj.lookAt(vector),obj.updateMatrix(),this.applyMatrix(obj.matrix)},fromBufferGeometry:function(geometry){var scope=this,indices=null!==geometry.index?geometry.index.array:void 0,attributes=geometry.attributes,positions=attributes.position.array,normals=void 0!==attributes.normal?attributes.normal.array:void 0,colors=void 0!==attributes.color?attributes.color.array:void 0,uvs=void 0!==attributes.uv?attributes.uv.array:void 0,uvs2=void 0!==attributes.uv2?attributes.uv2.array:void 0;void 0!==uvs2&&(this.faceVertexUvs[1]=[]);for(var tempNormals=[],tempUVs=[],tempUVs2=[],i=0,j=0;i<positions.length;i+=3,j+=2)scope.vertices.push(new Vector3(positions[i],positions[i+1],positions[i+2])),void 0!==normals&&tempNormals.push(new Vector3(normals[i],normals[i+1],normals[i+2])),void 0!==colors&&scope.colors.push(new Color(colors[i],colors[i+1],colors[i+2])),void 0!==uvs&&tempUVs.push(new Vector2(uvs[j],uvs[j+1])),void 0!==uvs2&&tempUVs2.push(new Vector2(uvs2[j],uvs2[j+1]));function addFace(a,b,c,materialIndex){var face=new Face3(a,b,c,void 0!==normals?[tempNormals[a].clone(),tempNormals[b].clone(),tempNormals[c].clone()]:[],void 0!==colors?[scope.colors[a].clone(),scope.colors[b].clone(),scope.colors[c].clone()]:[],materialIndex);scope.faces.push(face),void 0!==uvs&&scope.faceVertexUvs[0].push([tempUVs[a].clone(),tempUVs[b].clone(),tempUVs[c].clone()]),void 0!==uvs2&&scope.faceVertexUvs[1].push([tempUVs2[a].clone(),tempUVs2[b].clone(),tempUVs2[c].clone()])}if(void 0!==indices){var groups=geometry.groups;if(0<groups.length)for(i=0;i<groups.length;i++)for(var group=groups[i],start=group.start,jl=(j=start,start+group.count);j<jl;j+=3)addFace(indices[j],indices[j+1],indices[j+2],group.materialIndex);else for(i=0;i<indices.length;i+=3)addFace(indices[i],indices[i+1],indices[i+2])}else for(i=0;i<positions.length/3;i+=3)addFace(i,i+1,i+2);return this.computeFaceNormals(),null!==geometry.boundingBox&&(this.boundingBox=geometry.boundingBox.clone()),null!==geometry.boundingSphere&&(this.boundingSphere=geometry.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var offset=this.boundingBox.getCenter().negate();return this.translate(offset.x,offset.y,offset.z),offset},normalize:function(){this.computeBoundingSphere();var center=this.boundingSphere.center,radius=this.boundingSphere.radius,s=0===radius?1:1/radius,matrix=new Matrix4;return matrix.set(s,0,0,-s*center.x,0,s,0,-s*center.y,0,0,s,-s*center.z,0,0,0,1),this.applyMatrix(matrix),this},computeFaceNormals:function(){for(var cb=new Vector3,ab=new Vector3,f=0,fl=this.faces.length;f<fl;f++){var face=this.faces[f],vA=this.vertices[face.a],vB=this.vertices[face.b],vC=this.vertices[face.c];cb.subVectors(vC,vB),ab.subVectors(vA,vB),cb.cross(ab),cb.normalize(),face.normal.copy(cb)}},computeVertexNormals:function(areaWeighted){var v,vl,f,fl,face,vertices;for(void 0===areaWeighted&&(areaWeighted=!0),vertices=new Array(this.vertices.length),v=0,vl=this.vertices.length;v<vl;v++)vertices[v]=new Vector3;if(areaWeighted){var vA,vB,vC,cb=new Vector3,ab=new Vector3;for(f=0,fl=this.faces.length;f<fl;f++)face=this.faces[f],vA=this.vertices[face.a],vB=this.vertices[face.b],vC=this.vertices[face.c],cb.subVectors(vC,vB),ab.subVectors(vA,vB),cb.cross(ab),vertices[face.a].add(cb),vertices[face.b].add(cb),vertices[face.c].add(cb)}else for(this.computeFaceNormals(),f=0,fl=this.faces.length;f<fl;f++)vertices[(face=this.faces[f]).a].add(face.normal),vertices[face.b].add(face.normal),vertices[face.c].add(face.normal);for(v=0,vl=this.vertices.length;v<vl;v++)vertices[v].normalize();for(f=0,fl=this.faces.length;f<fl;f++){var vertexNormals=(face=this.faces[f]).vertexNormals;3===vertexNormals.length?(vertexNormals[0].copy(vertices[face.a]),vertexNormals[1].copy(vertices[face.b]),vertexNormals[2].copy(vertices[face.c])):(vertexNormals[0]=vertices[face.a].clone(),vertexNormals[1]=vertices[face.b].clone(),vertexNormals[2]=vertices[face.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var f,fl,face;for(this.computeFaceNormals(),f=0,fl=this.faces.length;f<fl;f++){var vertexNormals=(face=this.faces[f]).vertexNormals;3===vertexNormals.length?(vertexNormals[0].copy(face.normal),vertexNormals[1].copy(face.normal),vertexNormals[2].copy(face.normal)):(vertexNormals[0]=face.normal.clone(),vertexNormals[1]=face.normal.clone(),vertexNormals[2]=face.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var i,il,f,fl,face;for(f=0,fl=this.faces.length;f<fl;f++)for((face=this.faces[f]).__originalFaceNormal?face.__originalFaceNormal.copy(face.normal):face.__originalFaceNormal=face.normal.clone(),face.__originalVertexNormals||(face.__originalVertexNormals=[]),i=0,il=face.vertexNormals.length;i<il;i++)face.__originalVertexNormals[i]?face.__originalVertexNormals[i].copy(face.vertexNormals[i]):face.__originalVertexNormals[i]=face.vertexNormals[i].clone();var tmpGeo=new Geometry;for(tmpGeo.faces=this.faces,i=0,il=this.morphTargets.length;i<il;i++){if(!this.morphNormals[i]){this.morphNormals[i]={},this.morphNormals[i].faceNormals=[],this.morphNormals[i].vertexNormals=[];var dstNormalsFace=this.morphNormals[i].faceNormals,dstNormalsVertex=this.morphNormals[i].vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++)faceNormal=new Vector3,vertexNormals={a:new Vector3,b:new Vector3,c:new Vector3},dstNormalsFace.push(faceNormal),dstNormalsVertex.push(vertexNormals)}var faceNormal,vertexNormals,morphNormals=this.morphNormals[i];for(tmpGeo.vertices=this.morphTargets[i].vertices,tmpGeo.computeFaceNormals(),tmpGeo.computeVertexNormals(),f=0,fl=this.faces.length;f<fl;f++)face=this.faces[f],faceNormal=morphNormals.faceNormals[f],vertexNormals=morphNormals.vertexNormals[f],faceNormal.copy(face.normal),vertexNormals.a.copy(face.vertexNormals[0]),vertexNormals.b.copy(face.vertexNormals[1]),vertexNormals.c.copy(face.vertexNormals[2])}for(f=0,fl=this.faces.length;f<fl;f++)(face=this.faces[f]).normal=face.__originalFaceNormal,face.vertexNormals=face.__originalVertexNormals},computeLineDistances:function(){for(var d=0,vertices=this.vertices,i=0,il=vertices.length;i<il;i++)0<i&&(d+=vertices[i].distanceTo(vertices[i-1])),this.lineDistances[i]=d},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(geometry,matrix,materialIndexOffset){if(!1!==(geometry&&geometry.isGeometry)){var normalMatrix,vertexOffset=this.vertices.length,vertices1=this.vertices,vertices2=geometry.vertices,faces1=this.faces,faces2=geometry.faces,uvs1=this.faceVertexUvs[0],uvs2=geometry.faceVertexUvs[0],colors1=this.colors,colors2=geometry.colors;void 0===materialIndexOffset&&(materialIndexOffset=0),void 0!==matrix&&(normalMatrix=(new Matrix3).getNormalMatrix(matrix));for(var i=0,il=vertices2.length;i<il;i++){var vertexCopy=vertices2[i].clone();void 0!==matrix&&vertexCopy.applyMatrix4(matrix),vertices1.push(vertexCopy)}for(i=0,il=colors2.length;i<il;i++)colors1.push(colors2[i].clone());for(i=0,il=faces2.length;i<il;i++){var faceCopy,normal,color,face=faces2[i],faceVertexNormals=face.vertexNormals,faceVertexColors=face.vertexColors;(faceCopy=new Face3(face.a+vertexOffset,face.b+vertexOffset,face.c+vertexOffset)).normal.copy(face.normal),void 0!==normalMatrix&&faceCopy.normal.applyMatrix3(normalMatrix).normalize();for(var j=0,jl=faceVertexNormals.length;j<jl;j++)normal=faceVertexNormals[j].clone(),void 0!==normalMatrix&&normal.applyMatrix3(normalMatrix).normalize(),faceCopy.vertexNormals.push(normal);faceCopy.color.copy(face.color);for(j=0,jl=faceVertexColors.length;j<jl;j++)color=faceVertexColors[j],faceCopy.vertexColors.push(color.clone());faceCopy.materialIndex=face.materialIndex+materialIndexOffset,faces1.push(faceCopy)}for(i=0,il=uvs2.length;i<il;i++){var uv=uvs2[i],uvCopy=[];if(void 0!==uv){for(j=0,jl=uv.length;j<jl;j++)uvCopy.push(uv[j].clone());uvs1.push(uvCopy)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",geometry)},mergeMesh:function(mesh){!1!==(mesh&&mesh.isMesh)?(mesh.matrixAutoUpdate&&mesh.updateMatrix(),this.merge(mesh.geometry,mesh.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",mesh)},mergeVertices:function(){var v,key,i,il,face,indices,j,jl,verticesMap={},unique=[],changes=[],precision=Math.pow(10,4);for(i=0,il=this.vertices.length;i<il;i++)v=this.vertices[i],void 0===verticesMap[key=Math.round(v.x*precision)+"_"+Math.round(v.y*precision)+"_"+Math.round(v.z*precision)]?(verticesMap[key]=i,unique.push(this.vertices[i]),changes[i]=unique.length-1):changes[i]=changes[verticesMap[key]];var faceIndicesToRemove=[];for(i=0,il=this.faces.length;i<il;i++){(face=this.faces[i]).a=changes[face.a],face.b=changes[face.b],face.c=changes[face.c],indices=[face.a,face.b,face.c];for(var n=0;n<3;n++)if(indices[n]===indices[(n+1)%3]){n,faceIndicesToRemove.push(i);break}}for(i=faceIndicesToRemove.length-1;0<=i;i--){var idx=faceIndicesToRemove[i];for(this.faces.splice(idx,1),j=0,jl=this.faceVertexUvs.length;j<jl;j++)this.faceVertexUvs[j].splice(idx,1)}var diff=this.vertices.length-unique.length;return this.vertices=unique,diff},sortFacesByMaterialIndex:function(){for(var faces=this.faces,length=faces.length,i=0;i<length;i++)faces[i]._id=i;faces.sort(function(a,b){return a.materialIndex-b.materialIndex});var newUvs1,newUvs2,uvs1=this.faceVertexUvs[0],uvs2=this.faceVertexUvs[1];uvs1&&uvs1.length===length&&(newUvs1=[]),uvs2&&uvs2.length===length&&(newUvs2=[]);for(i=0;i<length;i++){var id=faces[i]._id;newUvs1&&newUvs1.push(uvs1[id]),newUvs2&&newUvs2.push(uvs2[id])}newUvs1&&(this.faceVertexUvs[0]=newUvs1),newUvs2&&(this.faceVertexUvs[1]=newUvs2)},toJSON:function(){var data={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(data.uuid=this.uuid,data.type=this.type,""!==this.name&&(data.name=this.name),void 0!==this.parameters){var parameters=this.parameters;for(var key in parameters)void 0!==parameters[key]&&(data[key]=parameters[key]);return data}for(var vertices=[],i=0;i<this.vertices.length;i++){var vertex=this.vertices[i];vertices.push(vertex.x,vertex.y,vertex.z)}var faces=[],normals=[],normalsHash={},colors=[],colorsHash={},uvs=[],uvsHash={};for(i=0;i<this.faces.length;i++){var face=this.faces[i],hasFaceVertexUv=void 0!==this.faceVertexUvs[0][i],hasFaceNormal=0<face.normal.length(),hasFaceVertexNormal=0<face.vertexNormals.length,hasFaceColor=1!==face.color.r||1!==face.color.g||1!==face.color.b,hasFaceVertexColor=0<face.vertexColors.length,faceType=0;if(faceType=setBit(faceType=setBit(faceType=setBit(faceType=setBit(faceType=setBit(faceType=setBit(faceType=setBit(faceType=setBit(faceType,0,0),1,!0),2,!1),3,hasFaceVertexUv),4,hasFaceNormal),5,hasFaceVertexNormal),6,hasFaceColor),7,hasFaceVertexColor),faces.push(faceType),faces.push(face.a,face.b,face.c),faces.push(face.materialIndex),hasFaceVertexUv){var faceVertexUvs=this.faceVertexUvs[0][i];faces.push(getUvIndex(faceVertexUvs[0]),getUvIndex(faceVertexUvs[1]),getUvIndex(faceVertexUvs[2]))}if(hasFaceNormal&&faces.push(getNormalIndex(face.normal)),hasFaceVertexNormal){var vertexNormals=face.vertexNormals;faces.push(getNormalIndex(vertexNormals[0]),getNormalIndex(vertexNormals[1]),getNormalIndex(vertexNormals[2]))}if(hasFaceColor&&faces.push(getColorIndex(face.color)),hasFaceVertexColor){var vertexColors=face.vertexColors;faces.push(getColorIndex(vertexColors[0]),getColorIndex(vertexColors[1]),getColorIndex(vertexColors[2]))}}function setBit(value,position,enabled){return enabled?value|1<<position:value&~(1<<position)}function getNormalIndex(normal){var hash=normal.x.toString()+normal.y.toString()+normal.z.toString();return void 0!==normalsHash[hash]||(normalsHash[hash]=normals.length/3,normals.push(normal.x,normal.y,normal.z)),normalsHash[hash]}function getColorIndex(color){var hash=color.r.toString()+color.g.toString()+color.b.toString();return void 0!==colorsHash[hash]||(colorsHash[hash]=colors.length,colors.push(color.getHex())),colorsHash[hash]}function getUvIndex(uv){var hash=uv.x.toString()+uv.y.toString();return void 0!==uvsHash[hash]||(uvsHash[hash]=uvs.length/2,uvs.push(uv.x,uv.y)),uvsHash[hash]}return data.data={},data.data.vertices=vertices,data.data.normals=normals,0<colors.length&&(data.data.colors=colors),0<uvs.length&&(data.data.uvs=[uvs]),data.data.faces=faces,data},clone:function(){return(new Geometry).copy(this)},copy:function(source){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]],this.colors=[];for(var vertices=source.vertices,i=0,il=vertices.length;i<il;i++)this.vertices.push(vertices[i].clone());var colors=source.colors;for(i=0,il=colors.length;i<il;i++)this.colors.push(colors[i].clone());var faces=source.faces;for(i=0,il=faces.length;i<il;i++)this.faces.push(faces[i].clone());for(i=0,il=source.faceVertexUvs.length;i<il;i++){var faceVertexUvs=source.faceVertexUvs[i];void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]);for(var j=0,jl=faceVertexUvs.length;j<jl;j++){for(var uvs=faceVertexUvs[j],uvsCopy=[],k=0,kl=uvs.length;k<kl;k++){var uv=uvs[k];uvsCopy.push(uv.clone())}this.faceVertexUvs[i].push(uvsCopy)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var count=0;function GeometryIdCount(){return count++}function BufferGeometry(){Object.defineProperty(this,"id",{value:GeometryIdCount()}),this.uuid=_Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Mesh(geometry,material){Object3D.call(this),this.type="Mesh",this.geometry=void 0!==geometry?geometry:new BufferGeometry,this.material=void 0!==material?material:new MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=TrianglesDrawMode,this.updateMorphTargets()}function BoxBufferGeometry(width,height,depth,widthSegments,heightSegments,depthSegments){BufferGeometry.call(this),this.type="BoxBufferGeometry",this.parameters={width:width,height:height,depth:depth,widthSegments:widthSegments,heightSegments:heightSegments,depthSegments:depthSegments};var w,h,d,index,scope=this,vertexCount=function(w,h,d){var vertices=0;return vertices+=(w+1)*(h+1)*2,vertices+=(w+1)*(d+1)*2,vertices+=(d+1)*(h+1)*2}(widthSegments=Math.floor(widthSegments)||1,heightSegments=Math.floor(heightSegments)||1,depthSegments=Math.floor(depthSegments)||1),indexCount=(index=0,index+=(w=widthSegments)*(h=heightSegments)*2,index+=w*(d=depthSegments)*2,6*(index+=d*h*2)),indices=new(65535<indexCount?Uint32Array:Uint16Array)(indexCount),vertices=new Float32Array(3*vertexCount),normals=new Float32Array(3*vertexCount),uvs=new Float32Array(2*vertexCount),vertexBufferOffset=0,uvBufferOffset=0,indexBufferOffset=0,numberOfVertices=0,groupStart=0;function buildPlane(u,v,w,udir,vdir,width,height,depth,gridX,gridY,materialIndex){for(var segmentWidth=width/gridX,segmentHeight=height/gridY,widthHalf=width/2,heightHalf=height/2,depthHalf=depth/2,gridX1=gridX+1,gridY1=gridY+1,vertexCounter=0,groupCount=0,vector=new Vector3,iy=0;iy<gridY1;iy++)for(var y=iy*segmentHeight-heightHalf,ix=0;ix<gridX1;ix++){var x=ix*segmentWidth-widthHalf;vector[u]=x*udir,vector[v]=y*vdir,vector[w]=depthHalf,vertices[vertexBufferOffset]=vector.x,vertices[vertexBufferOffset+1]=vector.y,vertices[vertexBufferOffset+2]=vector.z,vector[u]=0,vector[v]=0,vector[w]=0<depth?1:-1,normals[vertexBufferOffset]=vector.x,normals[vertexBufferOffset+1]=vector.y,normals[vertexBufferOffset+2]=vector.z,uvs[uvBufferOffset]=ix/gridX,uvs[uvBufferOffset+1]=1-iy/gridY,vertexBufferOffset+=3,uvBufferOffset+=2,vertexCounter+=1}for(iy=0;iy<gridY;iy++)for(ix=0;ix<gridX;ix++){var a=numberOfVertices+ix+gridX1*iy,b=numberOfVertices+ix+gridX1*(iy+1),c=numberOfVertices+(ix+1)+gridX1*(iy+1),d=numberOfVertices+(ix+1)+gridX1*iy;indices[indexBufferOffset]=a,indices[indexBufferOffset+1]=b,indices[indexBufferOffset+2]=d,indices[indexBufferOffset+3]=b,indices[indexBufferOffset+4]=c,indices[indexBufferOffset+5]=d,indexBufferOffset+=6,groupCount+=6}scope.addGroup(groupStart,groupCount,materialIndex),groupStart+=groupCount,numberOfVertices+=vertexCounter}buildPlane("z","y","x",-1,-1,depth,height,width,depthSegments,heightSegments,0),buildPlane("z","y","x",1,-1,depth,height,-width,depthSegments,heightSegments,1),buildPlane("x","z","y",1,1,width,depth,height,widthSegments,depthSegments,2),buildPlane("x","z","y",1,-1,width,depth,-height,widthSegments,depthSegments,3),buildPlane("x","y","z",1,-1,width,height,depth,widthSegments,heightSegments,4),buildPlane("x","y","z",-1,-1,width,height,-depth,widthSegments,heightSegments,5),this.setIndex(new BufferAttribute(indices,1)),this.addAttribute("position",new BufferAttribute(vertices,3)),this.addAttribute("normal",new BufferAttribute(normals,3)),this.addAttribute("uv",new BufferAttribute(uvs,2))}function PlaneBufferGeometry(width,height,widthSegments,heightSegments){BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};for(var width_half=width/2,height_half=height/2,gridX=Math.floor(widthSegments)||1,gridY=Math.floor(heightSegments)||1,gridX1=gridX+1,gridY1=gridY+1,segment_width=width/gridX,segment_height=height/gridY,vertices=new Float32Array(gridX1*gridY1*3),normals=new Float32Array(gridX1*gridY1*3),uvs=new Float32Array(gridX1*gridY1*2),offset=0,offset2=0,iy=0;iy<gridY1;iy++)for(var y=iy*segment_height-height_half,ix=0;ix<gridX1;ix++){var x=ix*segment_width-width_half;vertices[offset]=x,vertices[offset+1]=-y,normals[offset+2]=1,uvs[offset2]=ix/gridX,uvs[offset2+1]=1-iy/gridY,offset+=3,offset2+=2}offset=0;var indices=new(65535<vertices.length/3?Uint32Array:Uint16Array)(gridX*gridY*6);for(iy=0;iy<gridY;iy++)for(ix=0;ix<gridX;ix++){var a=ix+gridX1*iy,b=ix+gridX1*(iy+1),c=ix+1+gridX1*(iy+1),d=ix+1+gridX1*iy;indices[offset]=a,indices[offset+1]=b,indices[offset+2]=d,indices[offset+3]=b,indices[offset+4]=c,indices[offset+5]=d,offset+=6}this.setIndex(new BufferAttribute(indices,1)),this.addAttribute("position",new BufferAttribute(vertices,3)),this.addAttribute("normal",new BufferAttribute(normals,3)),this.addAttribute("uv",new BufferAttribute(uvs,2))}function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4}function PerspectiveCamera(fov,aspect,near,far){Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==fov?fov:50,this.zoom=1,this.near=void 0!==near?near:.1,this.far=void 0!==far?far:2e3,this.focus=10,this.aspect=void 0!==aspect?aspect:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function OrthographicCamera(left,right,top,bottom,near,far){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=left,this.right=right,this.top=top,this.bottom=bottom,this.near=void 0!==near?near:.1,this.far=void 0!==far?far:2e3,this.updateProjectionMatrix()}function WebGLIndexedBufferRenderer(gl,extensions,infoRender){var mode,type,size;return{setMode:function(value){mode=value},setIndex:function(index){size=index.array instanceof Uint32Array&&extensions.get("OES_element_index_uint")?(type=gl.UNSIGNED_INT,4):index.array instanceof Uint16Array?(type=gl.UNSIGNED_SHORT,2):(type=gl.UNSIGNED_BYTE,1)},render:function(start,count){gl.drawElements(mode,count,type,start*size),infoRender.calls++,infoRender.vertices+=count,mode===gl.TRIANGLES&&(infoRender.faces+=count/3)},renderInstances:function(geometry,start,count){var extension=extensions.get("ANGLE_instanced_arrays");null!==extension?(extension.drawElementsInstancedANGLE(mode,count,type,start*size,geometry.maxInstancedCount),infoRender.calls++,infoRender.vertices+=count*geometry.maxInstancedCount,mode===gl.TRIANGLES&&(infoRender.faces+=geometry.maxInstancedCount*count/3)):console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}}function WebGLBufferRenderer(gl,extensions,infoRender){var mode;return{setMode:function(value){mode=value},render:function(start,count){gl.drawArrays(mode,start,count),infoRender.calls++,infoRender.vertices+=count,mode===gl.TRIANGLES&&(infoRender.faces+=count/3)},renderInstances:function(geometry){var extension=extensions.get("ANGLE_instanced_arrays");if(null!==extension){var position=geometry.attributes.position,count=0;count=position.isInterleavedBufferAttribute?position.data.count:position.count,extension.drawArraysInstancedANGLE(mode,0,count,geometry.maxInstancedCount),infoRender.calls++,infoRender.vertices+=count*geometry.maxInstancedCount,mode===gl.TRIANGLES&&(infoRender.faces+=geometry.maxInstancedCount*count/3)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}}function WebGLLights(){var lights={};return{get:function(light){if(void 0!==lights[light.id])return lights[light.id];var uniforms;switch(light.type){case"DirectionalLight":uniforms={direction:new Vector3,color:new Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":uniforms={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":uniforms={position:new Vector3,color:new Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"HemisphereLight":uniforms={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":uniforms={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return lights[light.id]=uniforms}}}function WebGLShader(gl,type,string){var shader=gl.createShader(type);return gl.shaderSource(shader,string),gl.compileShader(shader),!1===gl.getShaderParameter(shader,gl.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==gl.getShaderInfoLog(shader)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",type===gl.VERTEX_SHADER?"vertex":"fragment",gl.getShaderInfoLog(shader),function(string){for(var lines=string.split("\n"),i=0;i<lines.length;i++)lines[i]=i+1+": "+lines[i];return lines.join("\n")}(string)),shader}Object.assign(BufferGeometry.prototype,EventDispatcher.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(index){this.index=index},addAttribute:function(name,attribute){return!1===(attribute&&attribute.isBufferAttribute)&&!1===(attribute&&attribute.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(name,new BufferAttribute(attribute,arguments[2]))):"index"===name?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(attribute)):(this.attributes[name]=attribute,this)},getAttribute:function(name){return this.attributes[name]},removeAttribute:function(name){return delete this.attributes[name],this},addGroup:function(start,count,materialIndex){this.groups.push({start:start,count:count,materialIndex:void 0!==materialIndex?materialIndex:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(start,count){this.drawRange.start=start,this.drawRange.count=count},applyMatrix:function(matrix){var position=this.attributes.position;void 0!==position&&(matrix.applyToVector3Array(position.array),position.needsUpdate=!0);var normal=this.attributes.normal;void 0!==normal&&((new Matrix3).getNormalMatrix(matrix).applyToVector3Array(normal.array),normal.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var m1;return function(angle){return void 0===m1&&(m1=new Matrix4),m1.makeRotationX(angle),this.applyMatrix(m1),this}}(),rotateY:function(){var m1;return function(angle){return void 0===m1&&(m1=new Matrix4),m1.makeRotationY(angle),this.applyMatrix(m1),this}}(),rotateZ:function(){var m1;return function(angle){return void 0===m1&&(m1=new Matrix4),m1.makeRotationZ(angle),this.applyMatrix(m1),this}}(),translate:function(){var m1;return function(x,y,z){return void 0===m1&&(m1=new Matrix4),m1.makeTranslation(x,y,z),this.applyMatrix(m1),this}}(),scale:function(){var m1;return function(x,y,z){return void 0===m1&&(m1=new Matrix4),m1.makeScale(x,y,z),this.applyMatrix(m1),this}}(),lookAt:function(){var obj;return function(vector){void 0===obj&&(obj=new Object3D),obj.lookAt(vector),obj.updateMatrix(),this.applyMatrix(obj.matrix)}}(),center:function(){this.computeBoundingBox();var offset=this.boundingBox.getCenter().negate();return this.translate(offset.x,offset.y,offset.z),offset},setFromObject:function(object){var geometry=object.geometry;if(object.isPoints||object.isLine){var positions=new Float32BufferAttribute(3*geometry.vertices.length,3),colors=new Float32BufferAttribute(3*geometry.colors.length,3);if(this.addAttribute("position",positions.copyVector3sArray(geometry.vertices)),this.addAttribute("color",colors.copyColorsArray(geometry.colors)),geometry.lineDistances&&geometry.lineDistances.length===geometry.vertices.length){var lineDistances=new Float32BufferAttribute(geometry.lineDistances.length,1);this.addAttribute("lineDistance",lineDistances.copyArray(geometry.lineDistances))}null!==geometry.boundingSphere&&(this.boundingSphere=geometry.boundingSphere.clone()),null!==geometry.boundingBox&&(this.boundingBox=geometry.boundingBox.clone())}else object.isMesh&&geometry&&geometry.isGeometry&&this.fromGeometry(geometry);return this},updateFromObject:function(object){var attribute,geometry=object.geometry;if(object.isMesh){var direct=geometry.__directGeometry;if(!0===geometry.elementsNeedUpdate&&(direct=void 0,geometry.elementsNeedUpdate=!1),void 0===direct)return this.fromGeometry(geometry);direct.verticesNeedUpdate=geometry.verticesNeedUpdate,direct.normalsNeedUpdate=geometry.normalsNeedUpdate,direct.colorsNeedUpdate=geometry.colorsNeedUpdate,direct.uvsNeedUpdate=geometry.uvsNeedUpdate,direct.groupsNeedUpdate=geometry.groupsNeedUpdate,geometry.verticesNeedUpdate=!1,geometry.normalsNeedUpdate=!1,geometry.colorsNeedUpdate=!1,geometry.uvsNeedUpdate=!1,geometry.groupsNeedUpdate=!1,geometry=direct}return!0===geometry.verticesNeedUpdate&&(void 0!==(attribute=this.attributes.position)&&(attribute.copyVector3sArray(geometry.vertices),attribute.needsUpdate=!0),geometry.verticesNeedUpdate=!1),!0===geometry.normalsNeedUpdate&&(void 0!==(attribute=this.attributes.normal)&&(attribute.copyVector3sArray(geometry.normals),attribute.needsUpdate=!0),geometry.normalsNeedUpdate=!1),!0===geometry.colorsNeedUpdate&&(void 0!==(attribute=this.attributes.color)&&(attribute.copyColorsArray(geometry.colors),attribute.needsUpdate=!0),geometry.colorsNeedUpdate=!1),geometry.uvsNeedUpdate&&(void 0!==(attribute=this.attributes.uv)&&(attribute.copyVector2sArray(geometry.uvs),attribute.needsUpdate=!0),geometry.uvsNeedUpdate=!1),geometry.lineDistancesNeedUpdate&&(void 0!==(attribute=this.attributes.lineDistance)&&(attribute.copyArray(geometry.lineDistances),attribute.needsUpdate=!0),geometry.lineDistancesNeedUpdate=!1),geometry.groupsNeedUpdate&&(geometry.computeGroups(object.geometry),this.groups=geometry.groups,geometry.groupsNeedUpdate=!1),this},fromGeometry:function(geometry){return geometry.__directGeometry=(new DirectGeometry).fromGeometry(geometry),this.fromDirectGeometry(geometry.__directGeometry)},fromDirectGeometry:function(geometry){var positions=new Float32Array(3*geometry.vertices.length);if(this.addAttribute("position",new BufferAttribute(positions,3).copyVector3sArray(geometry.vertices)),0<geometry.normals.length){var normals=new Float32Array(3*geometry.normals.length);this.addAttribute("normal",new BufferAttribute(normals,3).copyVector3sArray(geometry.normals))}if(0<geometry.colors.length){var colors=new Float32Array(3*geometry.colors.length);this.addAttribute("color",new BufferAttribute(colors,3).copyColorsArray(geometry.colors))}if(0<geometry.uvs.length){var uvs=new Float32Array(2*geometry.uvs.length);this.addAttribute("uv",new BufferAttribute(uvs,2).copyVector2sArray(geometry.uvs))}if(0<geometry.uvs2.length){var uvs2=new Float32Array(2*geometry.uvs2.length);this.addAttribute("uv2",new BufferAttribute(uvs2,2).copyVector2sArray(geometry.uvs2))}if(0<geometry.indices.length){var indices=new(65535<geometry.vertices.length?Uint32Array:Uint16Array)(3*geometry.indices.length);this.setIndex(new BufferAttribute(indices,1).copyIndicesArray(geometry.indices))}for(var name in this.groups=geometry.groups,geometry.morphTargets){for(var array=[],morphTargets=geometry.morphTargets[name],i=0,l=morphTargets.length;i<l;i++){var morphTarget=morphTargets[i],attribute=new Float32BufferAttribute(3*morphTarget.length,3);array.push(attribute.copyVector3sArray(morphTarget))}this.morphAttributes[name]=array}if(0<geometry.skinIndices.length){var skinIndices=new Float32BufferAttribute(4*geometry.skinIndices.length,4);this.addAttribute("skinIndex",skinIndices.copyVector4sArray(geometry.skinIndices))}if(0<geometry.skinWeights.length){var skinWeights=new Float32BufferAttribute(4*geometry.skinWeights.length,4);this.addAttribute("skinWeight",skinWeights.copyVector4sArray(geometry.skinWeights))}return null!==geometry.boundingSphere&&(this.boundingSphere=geometry.boundingSphere.clone()),null!==geometry.boundingBox&&(this.boundingBox=geometry.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);var position=this.attributes.position;void 0!==position?this.boundingBox.setFromBufferAttribute(position):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var box=new Box3,vector=new Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var position=this.attributes.position;if(position){var center=this.boundingSphere.center;box.setFromBufferAttribute(position),box.getCenter(center);for(var maxRadiusSq=0,i=0,il=position.count;i<il;i++)vector.x=position.getX(i),vector.y=position.getY(i),vector.z=position.getZ(i),maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(vector));this.boundingSphere.radius=Math.sqrt(maxRadiusSq),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var index=this.index,attributes=this.attributes,groups=this.groups;if(attributes.position){var positions=attributes.position.array;if(void 0===attributes.normal)this.addAttribute("normal",new BufferAttribute(new Float32Array(positions.length),3));else for(var array=attributes.normal.array,i=0,il=array.length;i<il;i++)array[i]=0;var vA,vB,vC,normals=attributes.normal.array,pA=new Vector3,pB=new Vector3,pC=new Vector3,cb=new Vector3,ab=new Vector3;if(index){var indices=index.array;0===groups.length&&this.addGroup(0,indices.length);for(var j=0,jl=groups.length;j<jl;++j){var group=groups[j],start=group.start;for(i=start,il=start+group.count;i<il;i+=3)vA=3*indices[i+0],vB=3*indices[i+1],vC=3*indices[i+2],pA.fromArray(positions,vA),pB.fromArray(positions,vB),pC.fromArray(positions,vC),cb.subVectors(pC,pB),ab.subVectors(pA,pB),cb.cross(ab),normals[vA]+=cb.x,normals[1+vA]+=cb.y,normals[2+vA]+=cb.z,normals[vB]+=cb.x,normals[1+vB]+=cb.y,normals[2+vB]+=cb.z,normals[vC]+=cb.x,normals[1+vC]+=cb.y,normals[2+vC]+=cb.z}}else for(i=0,il=positions.length;i<il;i+=9)pA.fromArray(positions,i),pB.fromArray(positions,i+3),pC.fromArray(positions,i+6),cb.subVectors(pC,pB),ab.subVectors(pA,pB),cb.cross(ab),normals[i]=cb.x,normals[i+1]=cb.y,normals[i+2]=cb.z,normals[i+3]=cb.x,normals[i+4]=cb.y,normals[i+5]=cb.z,normals[i+6]=cb.x,normals[i+7]=cb.y,normals[i+8]=cb.z;this.normalizeNormals(),attributes.normal.needsUpdate=!0}},merge:function(geometry,offset){if(!1!==(geometry&&geometry.isBufferGeometry)){void 0===offset&&(offset=0);var attributes=this.attributes;for(var key in attributes)if(void 0!==geometry.attributes[key])for(var attributeArray1=attributes[key].array,attribute2=geometry.attributes[key],attributeArray2=attribute2.array,i=0,j=attribute2.itemSize*offset;i<attributeArray2.length;i++,j++)attributeArray1[j]=attributeArray2[i];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",geometry)},normalizeNormals:function(){for(var x,y,z,n,normals=this.attributes.normal.array,i=0,il=normals.length;i<il;i+=3)x=normals[i],y=normals[i+1],z=normals[i+2],n=1/Math.sqrt(x*x+y*y+z*z),normals[i]*=n,normals[i+1]*=n,normals[i+2]*=n},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var geometry2=new BufferGeometry,indices=this.index.array,attributes=this.attributes;for(var name in attributes){for(var attribute=attributes[name],array=attribute.array,itemSize=attribute.itemSize,array2=new array.constructor(indices.length*itemSize),index=0,index2=0,i=0,l=indices.length;i<l;i++){index=indices[i]*itemSize;for(var j=0;j<itemSize;j++)array2[index2++]=array[index++]}geometry2.addAttribute(name,new BufferAttribute(array2,itemSize))}return geometry2},toJSON:function(){var data={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(data.uuid=this.uuid,data.type=this.type,""!==this.name&&(data.name=this.name),void 0!==this.parameters){var parameters=this.parameters;for(var key in parameters)void 0!==parameters[key]&&(data[key]=parameters[key]);return data}data.data={attributes:{}};var index=this.index;if(null!==index){var array=Array.prototype.slice.call(index.array);data.data.index={type:index.array.constructor.name,array:array}}var attributes=this.attributes;for(var key in attributes){var attribute=attributes[key];array=Array.prototype.slice.call(attribute.array);data.data.attributes[key]={itemSize:attribute.itemSize,type:attribute.array.constructor.name,array:array,normalized:attribute.normalized}}var groups=this.groups;0<groups.length&&(data.data.groups=JSON.parse(JSON.stringify(groups)));var boundingSphere=this.boundingSphere;return null!==boundingSphere&&(data.data.boundingSphere={center:boundingSphere.center.toArray(),radius:boundingSphere.radius}),data},clone:function(){return(new BufferGeometry).copy(this)},copy:function(source){var index=source.index;null!==index&&this.setIndex(index.clone());var attributes=source.attributes;for(var name in attributes){var attribute=attributes[name];this.addAttribute(name,attribute.clone())}for(var groups=source.groups,i=0,l=groups.length;i<l;i++){var group=groups[i];this.addGroup(group.start,group.count,group.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),BufferGeometry.MaxIndex=65535,Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,setDrawMode:function(value){this.drawMode=value},copy:function(source){return Object3D.prototype.copy.call(this,source),this.drawMode=source.drawMode,this},updateMorphTargets:function(){var morphTargets=this.geometry.morphTargets;if(void 0!==morphTargets&&0<morphTargets.length){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var m=0,ml=morphTargets.length;m<ml;m++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[morphTargets[m].name]=m}},raycast:function(){var inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere,vA=new Vector3,vB=new Vector3,vC=new Vector3,tempA=new Vector3,tempB=new Vector3,tempC=new Vector3,uvA=new Vector2,uvB=new Vector2,uvC=new Vector2,barycoord=new Vector3,intersectionPoint=new Vector3,intersectionPointWorld=new Vector3;function uvIntersection(point,p1,p2,p3,uv1,uv2,uv3){return Triangle.barycoordFromPoint(point,p1,p2,p3,barycoord),uv1.multiplyScalar(barycoord.x),uv2.multiplyScalar(barycoord.y),uv3.multiplyScalar(barycoord.z),uv1.add(uv2).add(uv3),uv1.clone()}function checkIntersection(object,raycaster,ray,pA,pB,pC,point){var material=object.material;if(null===(material.side===BackSide?ray.intersectTriangle(pC,pB,pA,!0,point):ray.intersectTriangle(pA,pB,pC,material.side!==DoubleSide,point)))return null;intersectionPointWorld.copy(point),intersectionPointWorld.applyMatrix4(object.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPointWorld);return distance<raycaster.near||distance>raycaster.far?null:{distance:distance,point:intersectionPointWorld.clone(),object:object}}function checkBufferGeometryIntersection(object,raycaster,ray,positions,uvs,a,b,c){vA.fromArray(positions,3*a),vB.fromArray(positions,3*b),vC.fromArray(positions,3*c);var intersection=checkIntersection(object,raycaster,ray,vA,vB,vC,intersectionPoint);return intersection&&(uvs&&(uvA.fromArray(uvs,2*a),uvB.fromArray(uvs,2*b),uvC.fromArray(uvs,2*c),intersection.uv=uvIntersection(intersectionPoint,vA,vB,vC,uvA,uvB,uvC)),intersection.face=new Face3(a,b,c,Triangle.normal(vA,vB,vC)),intersection.faceIndex=a),intersection}return function(raycaster,intersects){var uvs,intersection,geometry=this.geometry,material=this.material,matrixWorld=this.matrixWorld;if(void 0!==material&&(null===geometry.boundingSphere&&geometry.computeBoundingSphere(),sphere.copy(geometry.boundingSphere),sphere.applyMatrix4(matrixWorld),!1!==raycaster.ray.intersectsSphere(sphere)&&(inverseMatrix.getInverse(matrixWorld),ray.copy(raycaster.ray).applyMatrix4(inverseMatrix),null===geometry.boundingBox||!1!==ray.intersectsBox(geometry.boundingBox))))if(geometry.isBufferGeometry){var a,b,c,index=geometry.index,attributes=geometry.attributes,positions=attributes.position.array;if(void 0!==attributes.uv&&(uvs=attributes.uv.array),null!==index)for(var indices=index.array,i=0,l=indices.length;i<l;i+=3)a=indices[i],b=indices[i+1],c=indices[i+2],(intersection=checkBufferGeometryIntersection(this,raycaster,ray,positions,uvs,a,b,c))&&(intersection.faceIndex=Math.floor(i/3),intersects.push(intersection));else for(i=0,l=positions.length;i<l;i+=9)(intersection=checkBufferGeometryIntersection(this,raycaster,ray,positions,uvs,a=i/3,b=a+1,c=a+2))&&(intersection.index=a,intersects.push(intersection))}else if(geometry.isGeometry){var fvA,fvB,fvC,isFaceMaterial=material&&material.isMultiMaterial,materials=!0===isFaceMaterial?material.materials:null,vertices=geometry.vertices,faces=geometry.faces,faceVertexUvs=geometry.faceVertexUvs[0];0<faceVertexUvs.length&&(uvs=faceVertexUvs);for(var f=0,fl=faces.length;f<fl;f++){var face=faces[f],faceMaterial=!0===isFaceMaterial?materials[face.materialIndex]:material;if(void 0!==faceMaterial){if(fvA=vertices[face.a],fvB=vertices[face.b],fvC=vertices[face.c],!0===faceMaterial.morphTargets){var morphTargets=geometry.morphTargets,morphInfluences=this.morphTargetInfluences;vA.set(0,0,0),vB.set(0,0,0),vC.set(0,0,0);for(var t=0,tl=morphTargets.length;t<tl;t++){var influence=morphInfluences[t];if(0!==influence){var targets=morphTargets[t].vertices;vA.addScaledVector(tempA.subVectors(targets[face.a],fvA),influence),vB.addScaledVector(tempB.subVectors(targets[face.b],fvB),influence),vC.addScaledVector(tempC.subVectors(targets[face.c],fvC),influence)}}vA.add(fvA),vB.add(fvB),vC.add(fvC),fvA=vA,fvB=vB,fvC=vC}if(intersection=checkIntersection(this,raycaster,ray,fvA,fvB,fvC,intersectionPoint)){if(uvs){var uvs_f=uvs[f];uvA.copy(uvs_f[0]),uvB.copy(uvs_f[1]),uvC.copy(uvs_f[2]),intersection.uv=uvIntersection(intersectionPoint,fvA,fvB,fvC,uvA,uvB,uvC)}intersection.face=face,intersection.faceIndex=f,intersects.push(intersection)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(BoxBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=BoxBufferGeometry,(PlaneBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=PlaneBufferGeometry,((Camera.prototype=Object.create(Object3D.prototype)).constructor=Camera).prototype.isCamera=!0,Camera.prototype.getWorldDirection=function(){var quaternion=new Quaternion;return function(optionalTarget){var result=optionalTarget||new Vector3;return this.getWorldQuaternion(quaternion),result.set(0,0,-1).applyQuaternion(quaternion)}}(),Camera.prototype.lookAt=function(){var m1=new Matrix4;return function(vector){m1.lookAt(this.position,vector,this.up),this.quaternion.setFromRotationMatrix(m1)}}(),Camera.prototype.clone=function(){return(new this.constructor).copy(this)},Camera.prototype.copy=function(source){return Object3D.prototype.copy.call(this,source),this.matrixWorldInverse.copy(source.matrixWorldInverse),this.projectionMatrix.copy(source.projectionMatrix),this},PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(source){return Camera.prototype.copy.call(this,source),this.fov=source.fov,this.zoom=source.zoom,this.near=source.near,this.far=source.far,this.focus=source.focus,this.aspect=source.aspect,this.view=null===source.view?null:Object.assign({},source.view),this.filmGauge=source.filmGauge,this.filmOffset=source.filmOffset,this},setFocalLength:function(focalLength){var vExtentSlope=.5*this.getFilmHeight()/focalLength;this.fov=2*_Math.RAD2DEG*Math.atan(vExtentSlope),this.updateProjectionMatrix()},getFocalLength:function(){var vExtentSlope=Math.tan(.5*_Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/vExtentSlope},getEffectiveFOV:function(){return 2*_Math.RAD2DEG*Math.atan(Math.tan(.5*_Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(fullWidth,fullHeight,x,y,width,height){this.aspect=fullWidth/fullHeight,this.view={fullWidth:fullWidth,fullHeight:fullHeight,offsetX:x,offsetY:y,width:width,height:height},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var near=this.near,top=near*Math.tan(.5*_Math.DEG2RAD*this.fov)/this.zoom,height=2*top,width=this.aspect*height,left=-.5*width,view=this.view;if(null!==view){var fullWidth=view.fullWidth,fullHeight=view.fullHeight;left+=view.offsetX*width/fullWidth,top-=view.offsetY*height/fullHeight,width*=view.width/fullWidth,height*=view.height/fullHeight}var skew=this.filmOffset;0!==skew&&(left+=near*skew/this.getFilmWidth()),this.projectionMatrix.makeFrustum(left,left+width,top-height,top,near,this.far)},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);return data.object.fov=this.fov,data.object.zoom=this.zoom,data.object.near=this.near,data.object.far=this.far,data.object.focus=this.focus,data.object.aspect=this.aspect,null!==this.view&&(data.object.view=Object.assign({},this.view)),data.object.filmGauge=this.filmGauge,data.object.filmOffset=this.filmOffset,data}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(source){return Camera.prototype.copy.call(this,source),this.left=source.left,this.right=source.right,this.top=source.top,this.bottom=source.bottom,this.near=source.near,this.far=source.far,this.zoom=source.zoom,this.view=null===source.view?null:Object.assign({},source.view),this},setViewOffset:function(fullWidth,fullHeight,x,y,width,height){this.view={fullWidth:fullWidth,fullHeight:fullHeight,offsetX:x,offsetY:y,width:width,height:height},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var dx=(this.right-this.left)/(2*this.zoom),dy=(this.top-this.bottom)/(2*this.zoom),cx=(this.right+this.left)/2,cy=(this.top+this.bottom)/2,left=cx-dx,right=cx+dx,top=cy+dy,bottom=cy-dy;if(null!==this.view){var zoomW=this.zoom/(this.view.width/this.view.fullWidth),zoomH=this.zoom/(this.view.height/this.view.fullHeight),scaleW=(this.right-this.left)/this.view.width,scaleH=(this.top-this.bottom)/this.view.height;right=(left+=scaleW*(this.view.offsetX/zoomW))+scaleW*(this.view.width/zoomW),bottom=(top-=scaleH*(this.view.offsetY/zoomH))-scaleH*(this.view.height/zoomH)}this.projectionMatrix.makeOrthographic(left,right,top,bottom,this.near,this.far)},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);return data.object.zoom=this.zoom,data.object.left=this.left,data.object.right=this.right,data.object.top=this.top,data.object.bottom=this.bottom,data.object.near=this.near,data.object.far=this.far,null!==this.view&&(data.object.view=Object.assign({},this.view)),data}});var matrixPosition,offsetMatrix,programIdCount=0;function getEncodingComponents(encoding){switch(encoding){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+encoding)}}function getTexelDecodingFunction(functionName,encoding){var components=getEncodingComponents(encoding);return"vec4 "+functionName+"( vec4 value ) { return "+components[0]+"ToLinear"+components[1]+"; }"}function filterEmptyLine(string){return""!==string}function replaceLightNums(string,parameters){return string.replace(/NUM_DIR_LIGHTS/g,parameters.numDirLights).replace(/NUM_SPOT_LIGHTS/g,parameters.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,parameters.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,parameters.numPointLights).replace(/NUM_HEMI_LIGHTS/g,parameters.numHemiLights)}function parseIncludes(string){return string.replace(/#include +<([\w\d.]+)>/g,function(match,include){var replace=ShaderChunk[include];if(void 0===replace)throw new Error("Can not resolve #include <"+include+">");return parseIncludes(replace)})}function unrollLoops(string){return string.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(match,start,end,snippet){for(var unroll="",i=parseInt(start);i<parseInt(end);i++)unroll+=snippet.replace(/\[ i \]/g,"[ "+i+" ]");return unroll})}function WebGLProgram(renderer,code,material,parameters){var gl=renderer.context,extensions=material.extensions,defines=material.defines,vertexShader=material.__webglShader.vertexShader,fragmentShader=material.__webglShader.fragmentShader,shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC";parameters.shadowMapType===PCFShadowMap?shadowMapTypeDefine="SHADOWMAP_TYPE_PCF":parameters.shadowMapType===PCFSoftShadowMap&&(shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT");var envMapTypeDefine="ENVMAP_TYPE_CUBE",envMapModeDefine="ENVMAP_MODE_REFLECTION",envMapBlendingDefine="ENVMAP_BLENDING_MULTIPLY";if(parameters.envMap){switch(material.envMap.mapping){case CubeReflectionMapping:case CubeRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_CUBE_UV";break;case EquirectangularReflectionMapping:case EquirectangularRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_EQUIREC";break;case SphericalReflectionMapping:envMapTypeDefine="ENVMAP_TYPE_SPHERE"}switch(material.envMap.mapping){case CubeRefractionMapping:case EquirectangularRefractionMapping:envMapModeDefine="ENVMAP_MODE_REFRACTION"}switch(material.combine){case MultiplyOperation:envMapBlendingDefine="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:envMapBlendingDefine="ENVMAP_BLENDING_MIX";break;case AddOperation:envMapBlendingDefine="ENVMAP_BLENDING_ADD"}}var prefixVertex,prefixFragment,gammaFactorDefine=0<renderer.gammaFactor?renderer.gammaFactor:1,customExtensions=function(extensions,parameters,rendererExtensions){return[(extensions=extensions||{}).derivatives||parameters.envMapCubeUV||parameters.bumpMap||parameters.normalMap||parameters.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(extensions.fragDepth||parameters.logarithmicDepthBuffer)&&rendererExtensions.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",extensions.drawBuffers&&rendererExtensions.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(extensions.shaderTextureLOD||parameters.envMap)&&rendererExtensions.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}(extensions,parameters,renderer.extensions),customDefines=function(defines){var chunks=[];for(var name in defines){var value=defines[name];!1!==value&&chunks.push("#define "+name+" "+value)}return chunks.join("\n")}(defines),program=gl.createProgram();prefixFragment=material.isRawShaderMaterial?(prefixVertex=[customDefines,"\n"].filter(filterEmptyLine).join("\n"),[customExtensions,customDefines,"\n"].filter(filterEmptyLine).join("\n")):(prefixVertex=["precision "+parameters.precision+" float;","precision "+parameters.precision+" int;","#define SHADER_NAME "+material.__webglShader.name,customDefines,parameters.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+gammaFactorDefine,"#define MAX_BONES "+parameters.maxBones,parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.envMap?"#define "+envMapModeDefine:"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.aoMap?"#define USE_AOMAP":"",parameters.emissiveMap?"#define USE_EMISSIVEMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.displacementMap&&parameters.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.roughnessMap?"#define USE_ROUGHNESSMAP":"",parameters.metalnessMap?"#define USE_METALNESSMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.flatShading?"#define FLAT_SHADED":"",parameters.skinning?"#define USE_SKINNING":"",parameters.useVertexTexture?"#define BONE_TEXTURE":"",parameters.morphTargets?"#define USE_MORPHTARGETS":"",parameters.morphNormals&&!1===parameters.flatShading?"#define USE_MORPHNORMALS":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+parameters.numClippingPlanes,parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.sizeAttenuation?"#define USE_SIZEATTENUATION":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",parameters.logarithmicDepthBuffer&&renderer.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),[customExtensions,"precision "+parameters.precision+" float;","precision "+parameters.precision+" int;","#define SHADER_NAME "+material.__webglShader.name,customDefines,parameters.alphaTest?"#define ALPHATEST "+parameters.alphaTest:"","#define GAMMA_FACTOR "+gammaFactorDefine,parameters.useFog&&parameters.fog?"#define USE_FOG":"",parameters.useFog&&parameters.fogExp?"#define FOG_EXP2":"",parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.envMap?"#define "+envMapTypeDefine:"",parameters.envMap?"#define "+envMapModeDefine:"",parameters.envMap?"#define "+envMapBlendingDefine:"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.aoMap?"#define USE_AOMAP":"",parameters.emissiveMap?"#define USE_EMISSIVEMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.roughnessMap?"#define USE_ROUGHNESSMAP":"",parameters.metalnessMap?"#define USE_METALNESSMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.gradientMap?"#define USE_GRADIENTMAP":"",parameters.flatShading?"#define FLAT_SHADED":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+parameters.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(parameters.numClippingPlanes-parameters.numClipIntersection),parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",parameters.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",parameters.logarithmicDepthBuffer&&renderer.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",parameters.envMap&&renderer.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",parameters.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",parameters.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",parameters.toneMapping!==NoToneMapping?function(functionName,toneMapping){var toneMappingName;switch(toneMapping){case LinearToneMapping:toneMappingName="Linear";break;case ReinhardToneMapping:toneMappingName="Reinhard";break;case Uncharted2ToneMapping:toneMappingName="Uncharted2";break;case CineonToneMapping:toneMappingName="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+toneMapping)}return"vec3 "+functionName+"( vec3 color ) { return "+toneMappingName+"ToneMapping( color ); }"}("toneMapping",parameters.toneMapping):"",parameters.outputEncoding||parameters.mapEncoding||parameters.envMapEncoding||parameters.emissiveMapEncoding?ShaderChunk.encodings_pars_fragment:"",parameters.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",parameters.mapEncoding):"",parameters.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",parameters.envMapEncoding):"",parameters.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",parameters.emissiveMapEncoding):"",parameters.outputEncoding?function(functionName,encoding){var components=getEncodingComponents(encoding);return"vec4 "+functionName+"( vec4 value ) { return LinearTo"+components[0]+components[1]+"; }"}("linearToOutputTexel",parameters.outputEncoding):"",parameters.depthPacking?"#define DEPTH_PACKING "+material.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),vertexShader=replaceLightNums(vertexShader=parseIncludes(vertexShader),parameters),fragmentShader=replaceLightNums(fragmentShader=parseIncludes(fragmentShader),parameters),material.isShaderMaterial||(vertexShader=unrollLoops(vertexShader),fragmentShader=unrollLoops(fragmentShader));var vertexGlsl=prefixVertex+vertexShader,fragmentGlsl=prefixFragment+fragmentShader,glVertexShader=WebGLShader(gl,gl.VERTEX_SHADER,vertexGlsl),glFragmentShader=WebGLShader(gl,gl.FRAGMENT_SHADER,fragmentGlsl);gl.attachShader(program,glVertexShader),gl.attachShader(program,glFragmentShader),void 0!==material.index0AttributeName?gl.bindAttribLocation(program,0,material.index0AttributeName):!0===parameters.morphTargets&&gl.bindAttribLocation(program,0,"position"),gl.linkProgram(program);var cachedUniforms,cachedAttributes,programLog=gl.getProgramInfoLog(program),vertexLog=gl.getShaderInfoLog(glVertexShader),fragmentLog=gl.getShaderInfoLog(glFragmentShader),runnable=!0,haveDiagnostics=!0;return!1===gl.getProgramParameter(program,gl.LINK_STATUS)?(runnable=!1,console.error("THREE.WebGLProgram: shader error: ",gl.getError(),"gl.VALIDATE_STATUS",gl.getProgramParameter(program,gl.VALIDATE_STATUS),"gl.getProgramInfoLog",programLog,vertexLog,fragmentLog)):""!==programLog?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",programLog):""!==vertexLog&&""!==fragmentLog||(haveDiagnostics=!1),haveDiagnostics&&(this.diagnostics={runnable:runnable,material:material,programLog:programLog,vertexShader:{log:vertexLog,prefix:prefixVertex},fragmentShader:{log:fragmentLog,prefix:prefixFragment}}),gl.deleteShader(glVertexShader),gl.deleteShader(glFragmentShader),this.getUniforms=function(){return void 0===cachedUniforms&&(cachedUniforms=new WebGLUniforms(gl,program,renderer)),cachedUniforms},this.getAttributes=function(){return void 0===cachedAttributes&&(cachedAttributes=function(gl,program){for(var attributes={},n=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES),i=0;i<n;i++){var name=gl.getActiveAttrib(program,i).name;attributes[name]=gl.getAttribLocation(program,name)}return attributes}(gl,program)),cachedAttributes},this.destroy=function(){gl.deleteProgram(program),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=programIdCount++,this.code=code,this.usedTimes=1,this.program=program,this.vertexShader=glVertexShader,this.fragmentShader=glFragmentShader,this}function WebGLPrograms(renderer,capabilities){var programs=[],shaderIDs={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},parameterNames=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking"];function getTextureEncodingFromMap(map,gammaOverrideLinear){var encoding;return map?map.isTexture?encoding=map.encoding:map.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),encoding=map.texture.encoding):encoding=LinearEncoding,encoding===LinearEncoding&&gammaOverrideLinear&&(encoding=GammaEncoding),encoding}this.getParameters=function(material,lights,fog,nClipPlanes,nClipIntersection,object){var shaderID=shaderIDs[material.type],maxBones=function(object){if(capabilities.floatVertexTextures&&object&&object.skeleton&&object.skeleton.useVertexTexture)return 1024;var nVertexUniforms=capabilities.maxVertexUniforms,maxBones=Math.floor((nVertexUniforms-20)/4);return void 0!==object&&object&&object.isSkinnedMesh&&(maxBones=Math.min(object.skeleton.bones.length,maxBones))<object.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+object.skeleton.bones.length+", this GPU supports just "+maxBones+" (try OpenGL instead of ANGLE)"),maxBones}(object),precision=renderer.getPrecision();null!==material.precision&&(precision=capabilities.getMaxPrecision(material.precision))!==material.precision&&console.warn("THREE.WebGLProgram.getParameters:",material.precision,"not supported, using",precision,"instead.");var currentRenderTarget=renderer.getCurrentRenderTarget();return{shaderID:shaderID,precision:precision,supportsVertexTextures:capabilities.vertexTextures,outputEncoding:getTextureEncodingFromMap(currentRenderTarget?currentRenderTarget.texture:null,renderer.gammaOutput),map:!!material.map,mapEncoding:getTextureEncodingFromMap(material.map,renderer.gammaInput),envMap:!!material.envMap,envMapMode:material.envMap&&material.envMap.mapping,envMapEncoding:getTextureEncodingFromMap(material.envMap,renderer.gammaInput),envMapCubeUV:!!material.envMap&&(material.envMap.mapping===CubeUVReflectionMapping||material.envMap.mapping===CubeUVRefractionMapping),lightMap:!!material.lightMap,aoMap:!!material.aoMap,emissiveMap:!!material.emissiveMap,emissiveMapEncoding:getTextureEncodingFromMap(material.emissiveMap,renderer.gammaInput),bumpMap:!!material.bumpMap,normalMap:!!material.normalMap,displacementMap:!!material.displacementMap,roughnessMap:!!material.roughnessMap,metalnessMap:!!material.metalnessMap,specularMap:!!material.specularMap,alphaMap:!!material.alphaMap,gradientMap:!!material.gradientMap,combine:material.combine,vertexColors:material.vertexColors,fog:!!fog,useFog:material.fog,fogExp:fog&&fog.isFogExp2,flatShading:material.shading===FlatShading,sizeAttenuation:material.sizeAttenuation,logarithmicDepthBuffer:capabilities.logarithmicDepthBuffer,skinning:material.skinning,maxBones:maxBones,useVertexTexture:capabilities.floatVertexTextures&&object&&object.skeleton&&object.skeleton.useVertexTexture,morphTargets:material.morphTargets,morphNormals:material.morphNormals,maxMorphTargets:renderer.maxMorphTargets,maxMorphNormals:renderer.maxMorphNormals,numDirLights:lights.directional.length,numPointLights:lights.point.length,numSpotLights:lights.spot.length,numRectAreaLights:lights.rectArea.length,numHemiLights:lights.hemi.length,numClippingPlanes:nClipPlanes,numClipIntersection:nClipIntersection,shadowMapEnabled:renderer.shadowMap.enabled&&object.receiveShadow&&0<lights.shadows.length,shadowMapType:renderer.shadowMap.type,toneMapping:renderer.toneMapping,physicallyCorrectLights:renderer.physicallyCorrectLights,premultipliedAlpha:material.premultipliedAlpha,alphaTest:material.alphaTest,doubleSided:material.side===DoubleSide,flipSided:material.side===BackSide,depthPacking:void 0!==material.depthPacking&&material.depthPacking}},this.getProgramCode=function(material,parameters){var array=[];if(parameters.shaderID?array.push(parameters.shaderID):(array.push(material.fragmentShader),array.push(material.vertexShader)),void 0!==material.defines)for(var name in material.defines)array.push(name),array.push(material.defines[name]);for(var i=0;i<parameterNames.length;i++)array.push(parameters[parameterNames[i]]);return array.join()},this.acquireProgram=function(material,parameters,code){for(var program,p=0,pl=programs.length;p<pl;p++){var programInfo=programs[p];if(programInfo.code===code){++(program=programInfo).usedTimes;break}}return void 0===program&&(program=new WebGLProgram(renderer,code,material,parameters),programs.push(program)),program},this.releaseProgram=function(program){if(0==--program.usedTimes){var i=programs.indexOf(program);programs[i]=programs[programs.length-1],programs.pop(),program.destroy()}},this.programs=programs}function WebGLGeometries(gl,properties,info){var geometries={};function onGeometryDispose(event){var geometry=event.target,buffergeometry=geometries[geometry.id];null!==buffergeometry.index&&deleteAttribute(buffergeometry.index),function(attributes){for(var name in attributes)deleteAttribute(attributes[name])}(buffergeometry.attributes),geometry.removeEventListener("dispose",onGeometryDispose),delete geometries[geometry.id];var property=properties.get(geometry);property.wireframe&&deleteAttribute(property.wireframe),properties.delete(geometry);var bufferproperty=properties.get(buffergeometry);bufferproperty.wireframe&&deleteAttribute(bufferproperty.wireframe),properties.delete(buffergeometry),info.memory.geometries--}function deleteAttribute(attribute){var buffer=function(attribute){return attribute.isInterleavedBufferAttribute?properties.get(attribute.data).__webglBuffer:properties.get(attribute).__webglBuffer}(attribute);void 0!==buffer&&(gl.deleteBuffer(buffer),function(attribute){attribute.isInterleavedBufferAttribute?properties.delete(attribute.data):properties.delete(attribute)}(attribute))}return{get:function(object){var buffergeometry,geometry=object.geometry;return void 0!==geometries[geometry.id]?geometries[geometry.id]:(geometry.addEventListener("dispose",onGeometryDispose),geometry.isBufferGeometry?buffergeometry=geometry:geometry.isGeometry&&(void 0===geometry._bufferGeometry&&(geometry._bufferGeometry=(new BufferGeometry).setFromObject(object)),buffergeometry=geometry._bufferGeometry),geometries[geometry.id]=buffergeometry,info.memory.geometries++,buffergeometry)}}}function WebGLObjects(gl,properties,info){var geometries=new WebGLGeometries(gl,properties,info);function updateAttribute(attribute,bufferType){var data=attribute.isInterleavedBufferAttribute?attribute.data:attribute,attributeProperties=properties.get(data);void 0===attributeProperties.__webglBuffer?function(attributeProperties,data,bufferType){attributeProperties.__webglBuffer=gl.createBuffer(),gl.bindBuffer(bufferType,attributeProperties.__webglBuffer);var usage=data.dynamic?gl.DYNAMIC_DRAW:gl.STATIC_DRAW;gl.bufferData(bufferType,data.array,usage);var type=gl.FLOAT,array=data.array;array instanceof Float32Array?type=gl.FLOAT:array instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):array instanceof Uint16Array?type=gl.UNSIGNED_SHORT:array instanceof Int16Array?type=gl.SHORT:array instanceof Uint32Array?type=gl.UNSIGNED_INT:array instanceof Int32Array?type=gl.INT:array instanceof Int8Array?type=gl.BYTE:array instanceof Uint8Array&&(type=gl.UNSIGNED_BYTE);attributeProperties.bytesPerElement=array.BYTES_PER_ELEMENT,attributeProperties.type=type,attributeProperties.version=data.version,data.onUploadCallback()}(attributeProperties,data,bufferType):attributeProperties.version!==data.version&&function(attributeProperties,data,bufferType){gl.bindBuffer(bufferType,attributeProperties.__webglBuffer),!1===data.dynamic?gl.bufferData(bufferType,data.array,gl.STATIC_DRAW):-1===data.updateRange.count?gl.bufferSubData(bufferType,0,data.array):0===data.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(gl.bufferSubData(bufferType,data.updateRange.offset*data.array.BYTES_PER_ELEMENT,data.array.subarray(data.updateRange.offset,data.updateRange.offset+data.updateRange.count)),data.updateRange.count=0);attributeProperties.version=data.version}(attributeProperties,data,bufferType)}return{getAttributeBuffer:function(attribute){return attribute.isInterleavedBufferAttribute?properties.get(attribute.data).__webglBuffer:properties.get(attribute).__webglBuffer},getAttributeProperties:function(attribute){return attribute.isInterleavedBufferAttribute?properties.get(attribute.data):properties.get(attribute)},getWireframeAttribute:function(geometry){var property=properties.get(geometry);if(void 0!==property.wireframe)return property.wireframe;var array,indices=[],index=geometry.index,attributes=geometry.attributes,position=attributes.position;if(null!==index)for(var i=0,l=(array=index.array).length;i<l;i+=3){var a=array[i+0],b=array[i+1],c=array[i+2];indices.push(a,b,b,c,c,a)}else for(i=0,l=(array=attributes.position.array).length/3-1;i<l;i+=3){a=i+0,b=i+1,c=i+2;indices.push(a,b,b,c,c,a)}var attribute=new BufferAttribute(new(65535<position.count?Uint32Array:Uint16Array)(indices),1);return updateAttribute(attribute,gl.ELEMENT_ARRAY_BUFFER),property.wireframe=attribute},update:function(object){var geometry=geometries.get(object);object.geometry.isGeometry&&geometry.updateFromObject(object);var index=geometry.index,attributes=geometry.attributes;for(var name in null!==index&&updateAttribute(index,gl.ELEMENT_ARRAY_BUFFER),attributes)updateAttribute(attributes[name],gl.ARRAY_BUFFER);var morphAttributes=geometry.morphAttributes;for(var name in morphAttributes)for(var array=morphAttributes[name],i=0,l=array.length;i<l;i++)updateAttribute(array[i],gl.ARRAY_BUFFER);return geometry}}}function WebGLTextures(_gl,extensions,state,properties,capabilities,paramThreeToGL,info){var _infoMemory=info.memory,_isWebGL2="undefined"!=typeof WebGL2RenderingContext&&_gl instanceof WebGL2RenderingContext;function clampToMaxSize(image,maxSize){if(image.width>maxSize||image.height>maxSize){var scale=maxSize/Math.max(image.width,image.height),canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return canvas.width=Math.floor(image.width*scale),canvas.height=Math.floor(image.height*scale),canvas.getContext("2d").drawImage(image,0,0,image.width,image.height,0,0,canvas.width,canvas.height),console.warn("THREE.WebGLRenderer: image is too big ("+image.width+"x"+image.height+"). Resized to "+canvas.width+"x"+canvas.height,image),canvas}return image}function isPowerOfTwo(image){return _Math.isPowerOfTwo(image.width)&&_Math.isPowerOfTwo(image.height)}function filterFallback(f){return f===NearestFilter||f===NearestMipMapNearestFilter||f===NearestMipMapLinearFilter?_gl.NEAREST:_gl.LINEAR}function onTextureDispose(event){var texture=event.target;texture.removeEventListener("dispose",onTextureDispose),function(texture){var textureProperties=properties.get(texture);if(texture.image&&textureProperties.__image__webglTextureCube)_gl.deleteTexture(textureProperties.__image__webglTextureCube);else{if(void 0===textureProperties.__webglInit)return;_gl.deleteTexture(textureProperties.__webglTexture)}properties.delete(texture)}(texture),_infoMemory.textures--}function onRenderTargetDispose(event){var renderTarget=event.target;renderTarget.removeEventListener("dispose",onRenderTargetDispose),function(renderTarget){var renderTargetProperties=properties.get(renderTarget),textureProperties=properties.get(renderTarget.texture);if(!renderTarget)return;void 0!==textureProperties.__webglTexture&&_gl.deleteTexture(textureProperties.__webglTexture);renderTarget.depthTexture&&renderTarget.depthTexture.dispose();if(renderTarget.isWebGLRenderTargetCube)for(var i=0;i<6;i++)_gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer[i]),renderTargetProperties.__webglDepthbuffer&&_gl.deleteRenderbuffer(renderTargetProperties.__webglDepthbuffer[i]);else _gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer),renderTargetProperties.__webglDepthbuffer&&_gl.deleteRenderbuffer(renderTargetProperties.__webglDepthbuffer);properties.delete(renderTarget.texture),properties.delete(renderTarget)}(renderTarget),_infoMemory.textures--}function setTexture2D(texture,slot){var textureProperties=properties.get(texture);if(0<texture.version&&textureProperties.__version!==texture.version){var image=texture.image;if(void 0===image)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",texture);else{if(!1!==image.complete)return void function(textureProperties,texture,slot){void 0===textureProperties.__webglInit&&(textureProperties.__webglInit=!0,texture.addEventListener("dispose",onTextureDispose),textureProperties.__webglTexture=_gl.createTexture(),_infoMemory.textures++);state.activeTexture(_gl.TEXTURE0+slot),state.bindTexture(_gl.TEXTURE_2D,textureProperties.__webglTexture),_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY),_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultiplyAlpha),_gl.pixelStorei(_gl.UNPACK_ALIGNMENT,texture.unpackAlignment);var image=clampToMaxSize(texture.image,capabilities.maxTextureSize);!function(texture){return texture.wrapS!==ClampToEdgeWrapping||texture.wrapT!==ClampToEdgeWrapping||texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter}(texture)||!1!==isPowerOfTwo(image)||(image=function(image){if(image instanceof HTMLImageElement||image instanceof HTMLCanvasElement){var canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return canvas.width=_Math.nearestPowerOfTwo(image.width),canvas.height=_Math.nearestPowerOfTwo(image.height),canvas.getContext("2d").drawImage(image,0,0,canvas.width,canvas.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+image.width+"x"+image.height+"). Resized to "+canvas.width+"x"+canvas.height,image),canvas}return image}(image));var isPowerOfTwoImage=isPowerOfTwo(image),glFormat=paramThreeToGL(texture.format),glType=paramThreeToGL(texture.type);setTextureParameters(_gl.TEXTURE_2D,texture,isPowerOfTwoImage);var mipmap,mipmaps=texture.mipmaps;if(texture.isDepthTexture){var internalFormat=_gl.DEPTH_COMPONENT;if(texture.type===FloatType){if(!_isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");internalFormat=_gl.DEPTH_COMPONENT32F}else _isWebGL2&&(internalFormat=_gl.DEPTH_COMPONENT16);texture.format===DepthFormat&&internalFormat===_gl.DEPTH_COMPONENT&&texture.type!==UnsignedShortType&&texture.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),texture.type=UnsignedShortType,glType=paramThreeToGL(texture.type)),texture.format===DepthStencilFormat&&(internalFormat=_gl.DEPTH_STENCIL,texture.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),texture.type=UnsignedInt248Type,glType=paramThreeToGL(texture.type))),state.texImage2D(_gl.TEXTURE_2D,0,internalFormat,image.width,image.height,0,glFormat,glType,null)}else if(texture.isDataTexture)if(0<mipmaps.length&&isPowerOfTwoImage){for(var i=0,il=mipmaps.length;i<il;i++)mipmap=mipmaps[i],state.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data);texture.generateMipmaps=!1}else state.texImage2D(_gl.TEXTURE_2D,0,glFormat,image.width,image.height,0,glFormat,glType,image.data);else if(texture.isCompressedTexture)for(i=0,il=mipmaps.length;i<il;i++)mipmap=mipmaps[i],texture.format!==RGBAFormat&&texture.format!==RGBFormat?-1<state.getCompressedTextureFormats().indexOf(glFormat)?state.compressedTexImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,mipmap.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):state.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data);else if(0<mipmaps.length&&isPowerOfTwoImage){for(i=0,il=mipmaps.length;i<il;i++)mipmap=mipmaps[i],state.texImage2D(_gl.TEXTURE_2D,i,glFormat,glFormat,glType,mipmap);texture.generateMipmaps=!1}else state.texImage2D(_gl.TEXTURE_2D,0,glFormat,glFormat,glType,image);texture.generateMipmaps&&isPowerOfTwoImage&&_gl.generateMipmap(_gl.TEXTURE_2D);textureProperties.__version=texture.version,texture.onUpdate&&texture.onUpdate(texture)}(textureProperties,texture,slot);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",texture)}}state.activeTexture(_gl.TEXTURE0+slot),state.bindTexture(_gl.TEXTURE_2D,textureProperties.__webglTexture)}function setTextureParameters(textureType,texture,isPowerOfTwoImage){var extension;if(isPowerOfTwoImage?(_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,paramThreeToGL(texture.wrapS)),_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,paramThreeToGL(texture.wrapT)),_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,paramThreeToGL(texture.magFilter)),_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,paramThreeToGL(texture.minFilter))):(_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE),_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE),texture.wrapS===ClampToEdgeWrapping&&texture.wrapT===ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",texture),_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,filterFallback(texture.magFilter)),_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,filterFallback(texture.minFilter)),texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",texture)),extension=extensions.get("EXT_texture_filter_anisotropic")){if(texture.type===FloatType&&null===extensions.get("OES_texture_float_linear"))return;if(texture.type===HalfFloatType&&null===extensions.get("OES_texture_half_float_linear"))return;(1<texture.anisotropy||properties.get(texture).__currentAnisotropy)&&(_gl.texParameterf(textureType,extension.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(texture.anisotropy,capabilities.getMaxAnisotropy())),properties.get(texture).__currentAnisotropy=texture.anisotropy)}}function setupFrameBufferTexture(framebuffer,renderTarget,attachment,textureTarget){var glFormat=paramThreeToGL(renderTarget.texture.format),glType=paramThreeToGL(renderTarget.texture.type);state.texImage2D(textureTarget,0,glFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null),_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,attachment,textureTarget,properties.get(renderTarget.texture).__webglTexture,0),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)}function setupRenderBufferStorage(renderbuffer,renderTarget){_gl.bindRenderbuffer(_gl.RENDERBUFFER,renderbuffer),renderTarget.depthBuffer&&!renderTarget.stencilBuffer?(_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_COMPONENT16,renderTarget.width,renderTarget.height),_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)):renderTarget.depthBuffer&&renderTarget.stencilBuffer?(_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_STENCIL,renderTarget.width,renderTarget.height),_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)):_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.RGBA4,renderTarget.width,renderTarget.height),_gl.bindRenderbuffer(_gl.RENDERBUFFER,null)}function setupDepthRenderbuffer(renderTarget){var renderTargetProperties=properties.get(renderTarget),isCube=!0===renderTarget.isWebGLRenderTargetCube;if(renderTarget.depthTexture){if(isCube)throw new Error("target.depthTexture not supported in Cube render targets");!function(framebuffer,renderTarget){if(renderTarget&&renderTarget.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported!");if(_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer),!renderTarget.depthTexture||!renderTarget.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");properties.get(renderTarget.depthTexture).__webglTexture&&renderTarget.depthTexture.image.width===renderTarget.width&&renderTarget.depthTexture.image.height===renderTarget.height||(renderTarget.depthTexture.image.width=renderTarget.width,renderTarget.depthTexture.image.height=renderTarget.height,renderTarget.depthTexture.needsUpdate=!0),setTexture2D(renderTarget.depthTexture,0);var webglDepthTexture=properties.get(renderTarget.depthTexture).__webglTexture;if(renderTarget.depthTexture.format===DepthFormat)_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.TEXTURE_2D,webglDepthTexture,0);else{if(renderTarget.depthTexture.format!==DepthStencilFormat)throw new Error("Unknown depthTexture format");_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.TEXTURE_2D,webglDepthTexture,0)}}(renderTargetProperties.__webglFramebuffer,renderTarget)}else if(isCube){renderTargetProperties.__webglDepthbuffer=[];for(var i=0;i<6;i++)_gl.bindFramebuffer(_gl.FRAMEBUFFER,renderTargetProperties.__webglFramebuffer[i]),renderTargetProperties.__webglDepthbuffer[i]=_gl.createRenderbuffer(),setupRenderBufferStorage(renderTargetProperties.__webglDepthbuffer[i],renderTarget)}else _gl.bindFramebuffer(_gl.FRAMEBUFFER,renderTargetProperties.__webglFramebuffer),renderTargetProperties.__webglDepthbuffer=_gl.createRenderbuffer(),setupRenderBufferStorage(renderTargetProperties.__webglDepthbuffer,renderTarget);_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)}this.setTexture2D=setTexture2D,this.setTextureCube=function(texture,slot){var textureProperties=properties.get(texture);if(6===texture.image.length)if(0<texture.version&&textureProperties.__version!==texture.version){textureProperties.__image__webglTextureCube||(texture.addEventListener("dispose",onTextureDispose),textureProperties.__image__webglTextureCube=_gl.createTexture(),_infoMemory.textures++),state.activeTexture(_gl.TEXTURE0+slot),state.bindTexture(_gl.TEXTURE_CUBE_MAP,textureProperties.__image__webglTextureCube),_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);for(var isCompressed=texture&&texture.isCompressedTexture,isDataTexture=texture.image[0]&&texture.image[0].isDataTexture,cubeImage=[],i=0;i<6;i++)cubeImage[i]=isCompressed||isDataTexture?isDataTexture?texture.image[i].image:texture.image[i]:clampToMaxSize(texture.image[i],capabilities.maxCubemapSize);var isPowerOfTwoImage=isPowerOfTwo(cubeImage[0]),glFormat=paramThreeToGL(texture.format),glType=paramThreeToGL(texture.type);setTextureParameters(_gl.TEXTURE_CUBE_MAP,texture,isPowerOfTwoImage);for(i=0;i<6;i++)if(isCompressed)for(var mipmap,mipmaps=cubeImage[i].mipmaps,j=0,jl=mipmaps.length;j<jl;j++)mipmap=mipmaps[j],texture.format!==RGBAFormat&&texture.format!==RGBFormat?-1<state.getCompressedTextureFormats().indexOf(glFormat)?state.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,mipmap.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data);else isDataTexture?state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,cubeImage[i].width,cubeImage[i].height,0,glFormat,glType,cubeImage[i].data):state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,glFormat,glType,cubeImage[i]);texture.generateMipmaps&&isPowerOfTwoImage&&_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP),textureProperties.__version=texture.version,texture.onUpdate&&texture.onUpdate(texture)}else state.activeTexture(_gl.TEXTURE0+slot),state.bindTexture(_gl.TEXTURE_CUBE_MAP,textureProperties.__image__webglTextureCube)},this.setTextureCubeDynamic=function(texture,slot){state.activeTexture(_gl.TEXTURE0+slot),state.bindTexture(_gl.TEXTURE_CUBE_MAP,properties.get(texture).__webglTexture)},this.setupRenderTarget=function(renderTarget){var renderTargetProperties=properties.get(renderTarget),textureProperties=properties.get(renderTarget.texture);renderTarget.addEventListener("dispose",onRenderTargetDispose),textureProperties.__webglTexture=_gl.createTexture(),_infoMemory.textures++;var isCube=!0===renderTarget.isWebGLRenderTargetCube,isTargetPowerOfTwo=isPowerOfTwo(renderTarget);if(isCube){renderTargetProperties.__webglFramebuffer=[];for(var i=0;i<6;i++)renderTargetProperties.__webglFramebuffer[i]=_gl.createFramebuffer()}else renderTargetProperties.__webglFramebuffer=_gl.createFramebuffer();if(isCube){state.bindTexture(_gl.TEXTURE_CUBE_MAP,textureProperties.__webglTexture),setTextureParameters(_gl.TEXTURE_CUBE_MAP,renderTarget.texture,isTargetPowerOfTwo);for(i=0;i<6;i++)setupFrameBufferTexture(renderTargetProperties.__webglFramebuffer[i],renderTarget,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i);renderTarget.texture.generateMipmaps&&isTargetPowerOfTwo&&_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP),state.bindTexture(_gl.TEXTURE_CUBE_MAP,null)}else state.bindTexture(_gl.TEXTURE_2D,textureProperties.__webglTexture),setTextureParameters(_gl.TEXTURE_2D,renderTarget.texture,isTargetPowerOfTwo),setupFrameBufferTexture(renderTargetProperties.__webglFramebuffer,renderTarget,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_2D),renderTarget.texture.generateMipmaps&&isTargetPowerOfTwo&&_gl.generateMipmap(_gl.TEXTURE_2D),state.bindTexture(_gl.TEXTURE_2D,null);renderTarget.depthBuffer&&setupDepthRenderbuffer(renderTarget)},this.updateRenderTargetMipmap=function(renderTarget){var texture=renderTarget.texture;if(texture.generateMipmaps&&isPowerOfTwo(renderTarget)&&texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter){var target=renderTarget&&renderTarget.isWebGLRenderTargetCube?_gl.TEXTURE_CUBE_MAP:_gl.TEXTURE_2D,webglTexture=properties.get(texture).__webglTexture;state.bindTexture(target,webglTexture),_gl.generateMipmap(target),state.bindTexture(target,null)}}}function WebGLProperties(){var properties={};return{get:function(object){var uuid=object.uuid,map=properties[uuid];return void 0===map&&(map={},properties[uuid]=map),map},delete:function(object){delete properties[object.uuid]},clear:function(){properties={}}}}function WebGLState(gl,extensions,paramThreeToGL){var colorBuffer=new function(){var locked=!1,color=new Vector4,currentColorMask=null,currentColorClear=new Vector4;return{setMask:function(colorMask){currentColorMask===colorMask||locked||(gl.colorMask(colorMask,colorMask,colorMask,colorMask),currentColorMask=colorMask)},setLocked:function(lock){locked=lock},setClear:function(r,g,b,a,premultipliedAlpha){!0===premultipliedAlpha&&(r*=a,g*=a,b*=a),color.set(r,g,b,a),!1===currentColorClear.equals(color)&&(gl.clearColor(r,g,b,a),currentColorClear.copy(color))},reset:function(){locked=!1,currentColorMask=null,currentColorClear.set(0,0,0,1)}}},depthBuffer=new function(){var locked=!1,currentDepthMask=null,currentDepthFunc=null,currentDepthClear=null;return{setTest:function(depthTest){depthTest?enable(gl.DEPTH_TEST):disable(gl.DEPTH_TEST)},setMask:function(depthMask){currentDepthMask===depthMask||locked||(gl.depthMask(depthMask),currentDepthMask=depthMask)},setFunc:function(depthFunc){if(currentDepthFunc!==depthFunc){if(depthFunc)switch(depthFunc){case NeverDepth:gl.depthFunc(gl.NEVER);break;case AlwaysDepth:gl.depthFunc(gl.ALWAYS);break;case LessDepth:gl.depthFunc(gl.LESS);break;case LessEqualDepth:gl.depthFunc(gl.LEQUAL);break;case EqualDepth:gl.depthFunc(gl.EQUAL);break;case GreaterEqualDepth:gl.depthFunc(gl.GEQUAL);break;case GreaterDepth:gl.depthFunc(gl.GREATER);break;case NotEqualDepth:gl.depthFunc(gl.NOTEQUAL);break;default:gl.depthFunc(gl.LEQUAL)}else gl.depthFunc(gl.LEQUAL);currentDepthFunc=depthFunc}},setLocked:function(lock){locked=lock},setClear:function(depth){currentDepthClear!==depth&&(gl.clearDepth(depth),currentDepthClear=depth)},reset:function(){locked=!1,currentDepthClear=currentDepthFunc=currentDepthMask=null}}},stencilBuffer=new function(){var locked=!1,currentStencilMask=null,currentStencilFunc=null,currentStencilRef=null,currentStencilFuncMask=null,currentStencilFail=null,currentStencilZFail=null,currentStencilZPass=null,currentStencilClear=null;return{setTest:function(stencilTest){stencilTest?enable(gl.STENCIL_TEST):disable(gl.STENCIL_TEST)},setMask:function(stencilMask){currentStencilMask===stencilMask||locked||(gl.stencilMask(stencilMask),currentStencilMask=stencilMask)},setFunc:function(stencilFunc,stencilRef,stencilMask){currentStencilFunc===stencilFunc&&currentStencilRef===stencilRef&&currentStencilFuncMask===stencilMask||(gl.stencilFunc(stencilFunc,stencilRef,stencilMask),currentStencilFunc=stencilFunc,currentStencilRef=stencilRef,currentStencilFuncMask=stencilMask)},setOp:function(stencilFail,stencilZFail,stencilZPass){currentStencilFail===stencilFail&&currentStencilZFail===stencilZFail&&currentStencilZPass===stencilZPass||(gl.stencilOp(stencilFail,stencilZFail,stencilZPass),currentStencilFail=stencilFail,currentStencilZFail=stencilZFail,currentStencilZPass=stencilZPass)},setLocked:function(lock){locked=lock},setClear:function(stencil){currentStencilClear!==stencil&&(gl.clearStencil(stencil),currentStencilClear=stencil)},reset:function(){locked=!1,currentStencilClear=currentStencilZPass=currentStencilZFail=currentStencilFail=currentStencilFuncMask=currentStencilRef=currentStencilFunc=currentStencilMask=null}}},maxVertexAttributes=gl.getParameter(gl.MAX_VERTEX_ATTRIBS),newAttributes=new Uint8Array(maxVertexAttributes),enabledAttributes=new Uint8Array(maxVertexAttributes),attributeDivisors=new Uint8Array(maxVertexAttributes),capabilities={},compressedTextureFormats=null,currentBlending=null,currentBlendEquation=null,currentBlendSrc=null,currentBlendDst=null,currentBlendEquationAlpha=null,currentBlendSrcAlpha=null,currentBlendDstAlpha=null,currentPremultipledAlpha=!1,currentFlipSided=null,currentCullFace=null,currentLineWidth=null,currentPolygonOffsetFactor=null,currentPolygonOffsetUnits=null,currentScissorTest=null,maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),version=parseFloat(/^WebGL\ ([0-9])/.exec(gl.getParameter(gl.VERSION))[1]),lineWidthAvailable=1<=parseFloat(version),currentTextureSlot=null,currentBoundTextures={},currentScissor=new Vector4,currentViewport=new Vector4;function createTexture(type,target,count){var data=new Uint8Array(4),texture=gl.createTexture();gl.bindTexture(type,texture),gl.texParameteri(type,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(type,gl.TEXTURE_MAG_FILTER,gl.NEAREST);for(var i=0;i<count;i++)gl.texImage2D(target+i,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,data);return texture}var emptyTextures={};function enable(id){!0!==capabilities[id]&&(gl.enable(id),capabilities[id]=!0)}function disable(id){!1!==capabilities[id]&&(gl.disable(id),capabilities[id]=!1)}function setBlending(blending,blendEquation,blendSrc,blendDst,blendEquationAlpha,blendSrcAlpha,blendDstAlpha,premultipliedAlpha){blending!==NoBlending?enable(gl.BLEND):disable(gl.BLEND),blending===currentBlending&&premultipliedAlpha===currentPremultipledAlpha||(blending===AdditiveBlending?premultipliedAlpha?(gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD),gl.blendFuncSeparate(gl.ONE,gl.ONE,gl.ONE,gl.ONE)):(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.SRC_ALPHA,gl.ONE)):blending===SubtractiveBlending?premultipliedAlpha?(gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD),gl.blendFuncSeparate(gl.ZERO,gl.ZERO,gl.ONE_MINUS_SRC_COLOR,gl.ONE_MINUS_SRC_ALPHA)):(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ZERO,gl.ONE_MINUS_SRC_COLOR)):blending===MultiplyBlending?premultipliedAlpha?(gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD),gl.blendFuncSeparate(gl.ZERO,gl.SRC_COLOR,gl.ZERO,gl.SRC_ALPHA)):(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ZERO,gl.SRC_COLOR)):premultipliedAlpha?(gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD),gl.blendFuncSeparate(gl.ONE,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA)):(gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD),gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA)),currentBlending=blending,currentPremultipledAlpha=premultipliedAlpha),blending===CustomBlending?(blendEquationAlpha=blendEquationAlpha||blendEquation,blendSrcAlpha=blendSrcAlpha||blendSrc,blendDstAlpha=blendDstAlpha||blendDst,blendEquation===currentBlendEquation&&blendEquationAlpha===currentBlendEquationAlpha||(gl.blendEquationSeparate(paramThreeToGL(blendEquation),paramThreeToGL(blendEquationAlpha)),currentBlendEquation=blendEquation,currentBlendEquationAlpha=blendEquationAlpha),blendSrc===currentBlendSrc&&blendDst===currentBlendDst&&blendSrcAlpha===currentBlendSrcAlpha&&blendDstAlpha===currentBlendDstAlpha||(gl.blendFuncSeparate(paramThreeToGL(blendSrc),paramThreeToGL(blendDst),paramThreeToGL(blendSrcAlpha),paramThreeToGL(blendDstAlpha)),currentBlendSrc=blendSrc,currentBlendDst=blendDst,currentBlendSrcAlpha=blendSrcAlpha,currentBlendDstAlpha=blendDstAlpha)):currentBlendDstAlpha=currentBlendSrcAlpha=currentBlendEquationAlpha=currentBlendDst=currentBlendSrc=currentBlendEquation=null}function setDepthFunc(depthFunc){depthBuffer.setFunc(depthFunc)}function setFlipSided(flipSided){currentFlipSided!==flipSided&&(flipSided?gl.frontFace(gl.CW):gl.frontFace(gl.CCW),currentFlipSided=flipSided)}function setCullFace(cullFace){cullFace!==CullFaceNone?(enable(gl.CULL_FACE),cullFace!==currentCullFace&&(cullFace===CullFaceBack?gl.cullFace(gl.BACK):cullFace===CullFaceFront?gl.cullFace(gl.FRONT):gl.cullFace(gl.FRONT_AND_BACK))):disable(gl.CULL_FACE),currentCullFace=cullFace}function activeTexture(webglSlot){void 0===webglSlot&&(webglSlot=gl.TEXTURE0+maxTextures-1),currentTextureSlot!==webglSlot&&(gl.activeTexture(webglSlot),currentTextureSlot=webglSlot)}return emptyTextures[gl.TEXTURE_2D]=createTexture(gl.TEXTURE_2D,gl.TEXTURE_2D,1),emptyTextures[gl.TEXTURE_CUBE_MAP]=createTexture(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_CUBE_MAP_POSITIVE_X,6),{buffers:{color:colorBuffer,depth:depthBuffer,stencil:stencilBuffer},init:function(){colorBuffer.setClear(0,0,0,1),depthBuffer.setClear(1),stencilBuffer.setClear(0),enable(gl.DEPTH_TEST),setDepthFunc(LessEqualDepth),setFlipSided(!1),setCullFace(CullFaceBack),enable(gl.CULL_FACE),enable(gl.BLEND),setBlending(NormalBlending)},initAttributes:function(){for(var i=0,l=newAttributes.length;i<l;i++)newAttributes[i]=0},enableAttribute:function(attribute){newAttributes[attribute]=1,0===enabledAttributes[attribute]&&(gl.enableVertexAttribArray(attribute),enabledAttributes[attribute]=1),0!==attributeDivisors[attribute]&&(extensions.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(attribute,0),attributeDivisors[attribute]=0)},enableAttributeAndDivisor:function(attribute,meshPerAttribute,extension){newAttributes[attribute]=1,0===enabledAttributes[attribute]&&(gl.enableVertexAttribArray(attribute),enabledAttributes[attribute]=1),attributeDivisors[attribute]!==meshPerAttribute&&(extension.vertexAttribDivisorANGLE(attribute,meshPerAttribute),attributeDivisors[attribute]=meshPerAttribute)},disableUnusedAttributes:function(){for(var i=0,l=enabledAttributes.length;i!==l;++i)enabledAttributes[i]!==newAttributes[i]&&(gl.disableVertexAttribArray(i),enabledAttributes[i]=0)},enable:enable,disable:disable,getCompressedTextureFormats:function(){if(null===compressedTextureFormats&&(compressedTextureFormats=[],extensions.get("WEBGL_compressed_texture_pvrtc")||extensions.get("WEBGL_compressed_texture_s3tc")||extensions.get("WEBGL_compressed_texture_etc1")))for(var formats=gl.getParameter(gl.COMPRESSED_TEXTURE_FORMATS),i=0;i<formats.length;i++)compressedTextureFormats.push(formats[i]);return compressedTextureFormats},setBlending:setBlending,setColorWrite:function(colorWrite){colorBuffer.setMask(colorWrite)},setDepthTest:function(depthTest){depthBuffer.setTest(depthTest)},setDepthWrite:function(depthWrite){depthBuffer.setMask(depthWrite)},setDepthFunc:setDepthFunc,setStencilTest:function(stencilTest){stencilBuffer.setTest(stencilTest)},setStencilWrite:function(stencilWrite){stencilBuffer.setMask(stencilWrite)},setStencilFunc:function(stencilFunc,stencilRef,stencilMask){stencilBuffer.setFunc(stencilFunc,stencilRef,stencilMask)},setStencilOp:function(stencilFail,stencilZFail,stencilZPass){stencilBuffer.setOp(stencilFail,stencilZFail,stencilZPass)},setFlipSided:setFlipSided,setCullFace:setCullFace,setLineWidth:function(width){width!==currentLineWidth&&(lineWidthAvailable&&gl.lineWidth(width),currentLineWidth=width)},setPolygonOffset:function(polygonOffset,factor,units){polygonOffset?(enable(gl.POLYGON_OFFSET_FILL),currentPolygonOffsetFactor===factor&&currentPolygonOffsetUnits===units||(gl.polygonOffset(factor,units),currentPolygonOffsetFactor=factor,currentPolygonOffsetUnits=units)):disable(gl.POLYGON_OFFSET_FILL)},getScissorTest:function(){return currentScissorTest},setScissorTest:function(scissorTest){(currentScissorTest=scissorTest)?enable(gl.SCISSOR_TEST):disable(gl.SCISSOR_TEST)},activeTexture:activeTexture,bindTexture:function(webglType,webglTexture){null===currentTextureSlot&&activeTexture();var boundTexture=currentBoundTextures[currentTextureSlot];void 0===boundTexture&&(boundTexture={type:void 0,texture:void 0},currentBoundTextures[currentTextureSlot]=boundTexture),boundTexture.type===webglType&&boundTexture.texture===webglTexture||(gl.bindTexture(webglType,webglTexture||emptyTextures[webglType]),boundTexture.type=webglType,boundTexture.texture=webglTexture)},compressedTexImage2D:function(){try{gl.compressedTexImage2D.apply(gl,arguments)}catch(error){console.error(error)}},texImage2D:function(){try{gl.texImage2D.apply(gl,arguments)}catch(error){console.error(error)}},scissor:function(scissor){!1===currentScissor.equals(scissor)&&(gl.scissor(scissor.x,scissor.y,scissor.z,scissor.w),currentScissor.copy(scissor))},viewport:function(viewport){!1===currentViewport.equals(viewport)&&(gl.viewport(viewport.x,viewport.y,viewport.z,viewport.w),currentViewport.copy(viewport))},reset:function(){for(var i=0;i<enabledAttributes.length;i++)1===enabledAttributes[i]&&(gl.disableVertexAttribArray(i),enabledAttributes[i]=0);capabilities={},currentBoundTextures={},currentCullFace=currentFlipSided=currentBlending=currentTextureSlot=compressedTextureFormats=null,colorBuffer.reset(),depthBuffer.reset(),stencilBuffer.reset()}}}function WebGLCapabilities(gl,extensions,parameters){var maxAnisotropy;function getMaxPrecision(precision){if("highp"===precision){if(0<gl.getShaderPrecisionFormat(gl.VERTEX_SHADER,gl.HIGH_FLOAT).precision&&0<gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT).precision)return"highp";precision="mediump"}return"mediump"===precision&&0<gl.getShaderPrecisionFormat(gl.VERTEX_SHADER,gl.MEDIUM_FLOAT).precision&&0<gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.MEDIUM_FLOAT).precision?"mediump":"lowp"}var precision=void 0!==parameters.precision?parameters.precision:"highp",maxPrecision=getMaxPrecision(precision);maxPrecision!==precision&&(console.warn("THREE.WebGLRenderer:",precision,"not supported, using",maxPrecision,"instead."),precision=maxPrecision);var logarithmicDepthBuffer=!0===parameters.logarithmicDepthBuffer&&!!extensions.get("EXT_frag_depth"),maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextures=gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE),maxCubemapSize=gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes=gl.getParameter(gl.MAX_VERTEX_ATTRIBS),maxVertexUniforms=gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings=gl.getParameter(gl.MAX_VARYING_VECTORS),maxFragmentUniforms=gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures=0<maxVertexTextures,floatFragmentTextures=!!extensions.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==maxAnisotropy)return maxAnisotropy;var extension=extensions.get("EXT_texture_filter_anisotropic");return maxAnisotropy=null!==extension?gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:getMaxPrecision,precision:precision,logarithmicDepthBuffer:logarithmicDepthBuffer,maxTextures:maxTextures,maxVertexTextures:maxVertexTextures,maxTextureSize:maxTextureSize,maxCubemapSize:maxCubemapSize,maxAttributes:maxAttributes,maxVertexUniforms:maxVertexUniforms,maxVaryings:maxVaryings,maxFragmentUniforms:maxFragmentUniforms,vertexTextures:vertexTextures,floatFragmentTextures:floatFragmentTextures,floatVertexTextures:vertexTextures&&floatFragmentTextures}}function WebGLExtensions(gl){var extensions={};return{get:function(name){if(void 0!==extensions[name])return extensions[name];var extension;switch(name){case"WEBGL_depth_texture":extension=gl.getExtension("WEBGL_depth_texture")||gl.getExtension("MOZ_WEBGL_depth_texture")||gl.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":extension=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":extension=gl.getExtension("WEBGL_compressed_texture_s3tc")||gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":extension=gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":extension=gl.getExtension("WEBGL_compressed_texture_etc1");break;default:extension=gl.getExtension(name)}return null===extension&&console.warn("THREE.WebGLRenderer: "+name+" extension not supported."),extensions[name]=extension}}}function WebGLClipping(){var scope=this,globalState=null,numGlobalPlanes=0,localClippingEnabled=!1,renderingShadows=!1,plane=new Plane,viewNormalMatrix=new Matrix3,uniform={value:null,needsUpdate:!1};function resetGlobalState(){uniform.value!==globalState&&(uniform.value=globalState,uniform.needsUpdate=0<numGlobalPlanes),scope.numPlanes=numGlobalPlanes,scope.numIntersection=0}function projectPlanes(planes,camera,dstOffset,skipTransform){var nPlanes=null!==planes?planes.length:0,dstArray=null;if(0!==nPlanes){if(dstArray=uniform.value,!0!==skipTransform||null===dstArray){var flatSize=dstOffset+4*nPlanes,viewMatrix=camera.matrixWorldInverse;viewNormalMatrix.getNormalMatrix(viewMatrix),(null===dstArray||dstArray.length<flatSize)&&(dstArray=new Float32Array(flatSize));for(var i=0,i4=dstOffset;i!==nPlanes;++i,i4+=4)plane.copy(planes[i]).applyMatrix4(viewMatrix,viewNormalMatrix),plane.normal.toArray(dstArray,i4),dstArray[i4+3]=plane.constant}uniform.value=dstArray,uniform.needsUpdate=!0}return scope.numPlanes=nPlanes,dstArray}this.uniform=uniform,this.numPlanes=0,this.numIntersection=0,this.init=function(planes,enableLocalClipping,camera){var enabled=0!==planes.length||enableLocalClipping||0!==numGlobalPlanes||localClippingEnabled;return localClippingEnabled=enableLocalClipping,globalState=projectPlanes(planes,camera,0),numGlobalPlanes=planes.length,enabled},this.beginShadows=function(){renderingShadows=!0,projectPlanes(null)},this.endShadows=function(){renderingShadows=!1,resetGlobalState()},this.setState=function(planes,clipIntersection,clipShadows,camera,cache,fromCache){if(!localClippingEnabled||null===planes||0===planes.length||renderingShadows&&!clipShadows)renderingShadows?projectPlanes(null):resetGlobalState();else{var nGlobal=renderingShadows?0:numGlobalPlanes,lGlobal=4*nGlobal,dstArray=cache.clippingState||null;uniform.value=dstArray,dstArray=projectPlanes(planes,camera,lGlobal,fromCache);for(var i=0;i!==lGlobal;++i)dstArray[i]=globalState[i];cache.clippingState=dstArray,this.numIntersection=clipIntersection?this.numPlanes:0,this.numPlanes+=nGlobal}}}function WebGLRenderer(parameters){console.log("THREE.WebGLRenderer","83");var _canvas=void 0!==(parameters=parameters||{}).canvas?parameters.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),_context=void 0!==parameters.context?parameters.context:null,_alpha=void 0!==parameters.alpha&&parameters.alpha,_depth=void 0===parameters.depth||parameters.depth,_stencil=void 0===parameters.stencil||parameters.stencil,_antialias=void 0!==parameters.antialias&&parameters.antialias,_premultipliedAlpha=void 0===parameters.premultipliedAlpha||parameters.premultipliedAlpha,_preserveDrawingBuffer=void 0!==parameters.preserveDrawingBuffer&&parameters.preserveDrawingBuffer,lights=[],opaqueObjects=[],opaqueObjectsLastIndex=-1,transparentObjects=[],transparentObjectsLastIndex=-1,morphInfluences=new Float32Array(8),sprites=[],lensFlares=[];this.domElement=_canvas,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=LinearToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var _gl,_this=this,_currentProgram=null,_currentRenderTarget=null,_currentFramebuffer=null,_currentMaterialId=-1,_currentGeometryProgram="",_currentCamera=null,_currentScissor=new Vector4,_currentScissorTest=null,_currentViewport=new Vector4,_usedTextureUnits=0,_clearColor=new Color(0),_clearAlpha=0,_width=_canvas.width,_height=_canvas.height,_pixelRatio=1,_scissor=new Vector4(0,0,_width,_height),_scissorTest=!1,_viewport=new Vector4(0,0,_width,_height),_frustum=new Frustum,_clipping=new WebGLClipping,_clippingEnabled=!1,_localClippingEnabled=!1,_sphere=new Sphere,_projScreenMatrix=new Matrix4,_vector3=new Vector3,_matrix4=new Matrix4,_matrix42=new Matrix4,_lights={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},_infoRender={calls:0,vertices:0,faces:0,points:0};this.info={render:_infoRender,memory:{geometries:0,textures:0},programs:null};try{var attributes={alpha:_alpha,depth:_depth,stencil:_stencil,antialias:_antialias,premultipliedAlpha:_premultipliedAlpha,preserveDrawingBuffer:_preserveDrawingBuffer};if(null===(_gl=_context||_canvas.getContext("webgl",attributes)||_canvas.getContext("experimental-webgl",attributes)))throw null!==_canvas.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===_gl.getShaderPrecisionFormat&&(_gl.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),_canvas.addEventListener("webglcontextlost",onContextLost,!1)}catch(error){console.error("THREE.WebGLRenderer: "+error)}var extensions=new WebGLExtensions(_gl);extensions.get("WEBGL_depth_texture"),extensions.get("OES_texture_float"),extensions.get("OES_texture_float_linear"),extensions.get("OES_texture_half_float"),extensions.get("OES_texture_half_float_linear"),extensions.get("OES_standard_derivatives"),extensions.get("ANGLE_instanced_arrays"),extensions.get("OES_element_index_uint")&&(BufferGeometry.MaxIndex=4294967296);var capabilities=new WebGLCapabilities(_gl,extensions,parameters),state=new WebGLState(_gl,extensions,paramThreeToGL),properties=new WebGLProperties,textures=new WebGLTextures(_gl,extensions,state,properties,capabilities,paramThreeToGL,this.info),objects=new WebGLObjects(_gl,properties,this.info),programCache=new WebGLPrograms(this,capabilities),lightCache=new WebGLLights;this.info.programs=programCache.programs;var bufferRenderer=new WebGLBufferRenderer(_gl,extensions,_infoRender),indexedBufferRenderer=new WebGLIndexedBufferRenderer(_gl,extensions,_infoRender),backgroundCamera=new OrthographicCamera(-1,1,1,-1,0,1),backgroundCamera2=new PerspectiveCamera,backgroundPlaneMesh=new Mesh(new PlaneBufferGeometry(2,2),new MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1})),backgroundBoxShader=ShaderLib.cube,backgroundBoxMesh=new Mesh(new BoxBufferGeometry(5,5,5),new ShaderMaterial({uniforms:backgroundBoxShader.uniforms,vertexShader:backgroundBoxShader.vertexShader,fragmentShader:backgroundBoxShader.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1}));function getTargetPixelRatio(){return null===_currentRenderTarget?_pixelRatio:1}function setDefaultGLState(){state.init(),state.scissor(_currentScissor.copy(_scissor).multiplyScalar(_pixelRatio)),state.viewport(_currentViewport.copy(_viewport).multiplyScalar(_pixelRatio)),state.buffers.color.setClear(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha,_premultipliedAlpha)}function resetGLState(){_currentCamera=_currentProgram=null,_currentGeometryProgram="",_currentMaterialId=-1,state.reset()}setDefaultGLState(),this.context=_gl,this.capabilities=capabilities,this.extensions=extensions,this.properties=properties,this.state=state;var shadowMap=new WebGLShadowMap(this,_lights,objects,capabilities);this.shadowMap=shadowMap;var warned,spritePlugin=new SpritePlugin(this,sprites),lensFlarePlugin=new LensFlarePlugin(this,lensFlares);function onContextLost(event){event.preventDefault(),resetGLState(),setDefaultGLState(),properties.clear()}function onMaterialDispose(event){var material=event.target;material.removeEventListener("dispose",onMaterialDispose),function(material){releaseMaterialProgramReference(material),properties.delete(material)}(material)}function releaseMaterialProgramReference(material){var programInfo=properties.get(material).program;(material.program=void 0)!==programInfo&&programCache.releaseProgram(programInfo)}function absNumericalSort(a,b){return Math.abs(b[0])-Math.abs(a[0])}function painterSortStable(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.program&&b.material.program&&a.material.program!==b.material.program?a.material.program.id-b.material.program.id:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function reversePainterSortStable(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function pushRenderItem(object,geometry,material,z,group){var array,index;index=material.transparent?(array=transparentObjects,++transparentObjectsLastIndex):(array=opaqueObjects,++opaqueObjectsLastIndex);var renderItem=array[index];void 0!==renderItem?(renderItem.id=object.id,renderItem.object=object,renderItem.geometry=geometry,renderItem.material=material,renderItem.z=_vector3.z,renderItem.group=group):(renderItem={id:object.id,object:object,geometry:geometry,material:material,z:_vector3.z,group:group},array.push(renderItem))}function isObjectViewable(object){var geometry=object.geometry;return null===geometry.boundingSphere&&geometry.computeBoundingSphere(),_sphere.copy(geometry.boundingSphere).applyMatrix4(object.matrixWorld),isSphereViewable(_sphere)}function isSpriteViewable(sprite){return _sphere.center.set(0,0,0),_sphere.radius=.7071067811865476,_sphere.applyMatrix4(sprite.matrixWorld),isSphereViewable(_sphere)}function isSphereViewable(sphere){if(!_frustum.intersectsSphere(sphere))return!1;var numPlanes=_clipping.numPlanes;if(0===numPlanes)return!0;var planes=_this.clippingPlanes,center=sphere.center,negRad=-sphere.radius,i=0;do{if(planes[i].distanceToPoint(center)<negRad)return!1}while(++i!==numPlanes);return!0}function renderObjects(renderList,scene,camera,overrideMaterial){for(var i=0,l=renderList.length;i<l;i++){var renderItem=renderList[i],object=renderItem.object,geometry=renderItem.geometry,material=void 0===overrideMaterial?renderItem.material:overrideMaterial,group=renderItem.group;if(object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld),object.normalMatrix.getNormalMatrix(object.modelViewMatrix),object.onBeforeRender(_this,scene,camera,geometry,material,group),object.isImmediateRenderObject){setMaterial(material);var program=setProgram(camera,scene.fog,material,object);_currentGeometryProgram="",object.render(function(object){_this.renderBufferImmediate(object,program,material)})}else _this.renderBufferDirect(camera,scene.fog,geometry,material,object,group);object.onAfterRender(_this,scene,camera,geometry,material,group)}}function setMaterial(material){material.side===DoubleSide?state.disable(_gl.CULL_FACE):state.enable(_gl.CULL_FACE),state.setFlipSided(material.side===BackSide),!0===material.transparent?state.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst,material.blendEquationAlpha,material.blendSrcAlpha,material.blendDstAlpha,material.premultipliedAlpha):state.setBlending(NoBlending),state.setDepthFunc(material.depthFunc),state.setDepthTest(material.depthTest),state.setDepthWrite(material.depthWrite),state.setColorWrite(material.colorWrite),state.setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits)}function setProgram(camera,fog,material,object){_usedTextureUnits=0;var materialProperties=properties.get(material);if(_clippingEnabled&&(_localClippingEnabled||camera!==_currentCamera)){var useCache=camera===_currentCamera&&material.id===_currentMaterialId;_clipping.setState(material.clippingPlanes,material.clipIntersection,material.clipShadows,camera,materialProperties,useCache)}!1===material.needsUpdate&&(void 0===materialProperties.program?material.needsUpdate=!0:material.fog&&materialProperties.fog!==fog?material.needsUpdate=!0:material.lights&&materialProperties.lightsHash!==_lights.hash?material.needsUpdate=!0:void 0===materialProperties.numClippingPlanes||materialProperties.numClippingPlanes===_clipping.numPlanes&&materialProperties.numIntersection===_clipping.numIntersection||(material.needsUpdate=!0)),material.needsUpdate&&(function(material,fog,object){var materialProperties=properties.get(material),parameters=programCache.getParameters(material,_lights,fog,_clipping.numPlanes,_clipping.numIntersection,object),code=programCache.getProgramCode(material,parameters),program=materialProperties.program,programChange=!0;if(void 0===program)material.addEventListener("dispose",onMaterialDispose);else if(program.code!==code)releaseMaterialProgramReference(material);else{if(void 0!==parameters.shaderID)return;programChange=!1}if(programChange){if(parameters.shaderID){var shader=ShaderLib[parameters.shaderID];materialProperties.__webglShader={name:material.type,uniforms:UniformsUtils.clone(shader.uniforms),vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader}}else materialProperties.__webglShader={name:material.type,uniforms:material.uniforms,vertexShader:material.vertexShader,fragmentShader:material.fragmentShader};material.__webglShader=materialProperties.__webglShader,program=programCache.acquireProgram(material,parameters,code),materialProperties.program=program,material.program=program}var attributes=program.getAttributes();if(material.morphTargets)for(var i=material.numSupportedMorphTargets=0;i<_this.maxMorphTargets;i++)0<=attributes["morphTarget"+i]&&material.numSupportedMorphTargets++;if(material.morphNormals)for(i=material.numSupportedMorphNormals=0;i<_this.maxMorphNormals;i++)0<=attributes["morphNormal"+i]&&material.numSupportedMorphNormals++;var uniforms=materialProperties.__webglShader.uniforms;(material.isShaderMaterial||material.isRawShaderMaterial)&&!0!==material.clipping||(materialProperties.numClippingPlanes=_clipping.numPlanes,materialProperties.numIntersection=_clipping.numIntersection,uniforms.clippingPlanes=_clipping.uniform),materialProperties.fog=fog,materialProperties.lightsHash=_lights.hash,material.lights&&(uniforms.ambientLightColor.value=_lights.ambient,uniforms.directionalLights.value=_lights.directional,uniforms.spotLights.value=_lights.spot,uniforms.rectAreaLights.value=_lights.rectArea,uniforms.pointLights.value=_lights.point,uniforms.hemisphereLights.value=_lights.hemi,uniforms.directionalShadowMap.value=_lights.directionalShadowMap,uniforms.directionalShadowMatrix.value=_lights.directionalShadowMatrix,uniforms.spotShadowMap.value=_lights.spotShadowMap,uniforms.spotShadowMatrix.value=_lights.spotShadowMatrix,uniforms.pointShadowMap.value=_lights.pointShadowMap,uniforms.pointShadowMatrix.value=_lights.pointShadowMatrix);var progUniforms=materialProperties.program.getUniforms(),uniformsList=WebGLUniforms.seqWithValue(progUniforms.seq,uniforms);materialProperties.uniformsList=uniformsList}(material,fog,object),material.needsUpdate=!1);var refreshProgram=!1,refreshMaterial=!1,refreshLights=!1,program=materialProperties.program,p_uniforms=program.getUniforms(),m_uniforms=materialProperties.__webglShader.uniforms;if(program.id!==_currentProgram&&(_gl.useProgram(program.program),_currentProgram=program.id,refreshLights=refreshMaterial=refreshProgram=!0),material.id!==_currentMaterialId&&(_currentMaterialId=material.id,refreshMaterial=!0),refreshProgram||camera!==_currentCamera){if(p_uniforms.set(_gl,camera,"projectionMatrix"),capabilities.logarithmicDepthBuffer&&p_uniforms.setValue(_gl,"logDepthBufFC",2/(Math.log(camera.far+1)/Math.LN2)),camera!==_currentCamera&&(_currentCamera=camera,refreshLights=refreshMaterial=!0),material.isShaderMaterial||material.isMeshPhongMaterial||material.isMeshStandardMaterial||material.envMap){var uCamPos=p_uniforms.map.cameraPosition;void 0!==uCamPos&&uCamPos.setValue(_gl,_vector3.setFromMatrixPosition(camera.matrixWorld))}(material.isMeshPhongMaterial||material.isMeshLambertMaterial||material.isMeshBasicMaterial||material.isMeshStandardMaterial||material.isShaderMaterial||material.skinning)&&p_uniforms.setValue(_gl,"viewMatrix",camera.matrixWorldInverse),p_uniforms.set(_gl,_this,"toneMappingExposure"),p_uniforms.set(_gl,_this,"toneMappingWhitePoint")}if(material.skinning){p_uniforms.setOptional(_gl,object,"bindMatrix"),p_uniforms.setOptional(_gl,object,"bindMatrixInverse");var skeleton=object.skeleton;skeleton&&(capabilities.floatVertexTextures&&skeleton.useVertexTexture?(p_uniforms.set(_gl,skeleton,"boneTexture"),p_uniforms.set(_gl,skeleton,"boneTextureWidth"),p_uniforms.set(_gl,skeleton,"boneTextureHeight")):p_uniforms.setOptional(_gl,skeleton,"boneMatrices"))}return refreshMaterial&&(material.lights&&function(uniforms,value){uniforms.ambientLightColor.needsUpdate=value,uniforms.directionalLights.needsUpdate=value,uniforms.pointLights.needsUpdate=value,uniforms.spotLights.needsUpdate=value,uniforms.rectAreaLights.needsUpdate=value,uniforms.hemisphereLights.needsUpdate=value}(m_uniforms,refreshLights),fog&&material.fog&&function(uniforms,fog){uniforms.fogColor.value=fog.color,fog.isFog?(uniforms.fogNear.value=fog.near,uniforms.fogFar.value=fog.far):fog.isFogExp2&&(uniforms.fogDensity.value=fog.density)}(m_uniforms,fog),(material.isMeshBasicMaterial||material.isMeshLambertMaterial||material.isMeshPhongMaterial||material.isMeshStandardMaterial||material.isMeshNormalMaterial||material.isMeshDepthMaterial)&&function(uniforms,material){uniforms.opacity.value=material.opacity,uniforms.diffuse.value=material.color,material.emissive&&uniforms.emissive.value.copy(material.emissive).multiplyScalar(material.emissiveIntensity);uniforms.map.value=material.map,uniforms.specularMap.value=material.specularMap,uniforms.alphaMap.value=material.alphaMap,material.lightMap&&(uniforms.lightMap.value=material.lightMap,uniforms.lightMapIntensity.value=material.lightMapIntensity);material.aoMap&&(uniforms.aoMap.value=material.aoMap,uniforms.aoMapIntensity.value=material.aoMapIntensity);var uvScaleMap;material.map?uvScaleMap=material.map:material.specularMap?uvScaleMap=material.specularMap:material.displacementMap?uvScaleMap=material.displacementMap:material.normalMap?uvScaleMap=material.normalMap:material.bumpMap?uvScaleMap=material.bumpMap:material.roughnessMap?uvScaleMap=material.roughnessMap:material.metalnessMap?uvScaleMap=material.metalnessMap:material.alphaMap?uvScaleMap=material.alphaMap:material.emissiveMap&&(uvScaleMap=material.emissiveMap);if(void 0!==uvScaleMap){uvScaleMap.isWebGLRenderTarget&&(uvScaleMap=uvScaleMap.texture);var offset=uvScaleMap.offset,repeat=uvScaleMap.repeat;uniforms.offsetRepeat.value.set(offset.x,offset.y,repeat.x,repeat.y)}uniforms.envMap.value=material.envMap,uniforms.flipEnvMap.value=material.envMap&&material.envMap.isCubeTexture?-1:1,uniforms.reflectivity.value=material.reflectivity,uniforms.refractionRatio.value=material.refractionRatio}(m_uniforms,material),material.isLineBasicMaterial?refreshUniformsLine(m_uniforms,material):material.isLineDashedMaterial?(refreshUniformsLine(m_uniforms,material),function(uniforms,material){uniforms.dashSize.value=material.dashSize,uniforms.totalSize.value=material.dashSize+material.gapSize,uniforms.scale.value=material.scale}(m_uniforms,material)):material.isPointsMaterial?function(uniforms,material){if(uniforms.diffuse.value=material.color,uniforms.opacity.value=material.opacity,uniforms.size.value=material.size*_pixelRatio,uniforms.scale.value=.5*_height,uniforms.map.value=material.map,null!==material.map){var offset=material.map.offset,repeat=material.map.repeat;uniforms.offsetRepeat.value.set(offset.x,offset.y,repeat.x,repeat.y)}}(m_uniforms,material):material.isMeshLambertMaterial?function(uniforms,material){material.emissiveMap&&(uniforms.emissiveMap.value=material.emissiveMap)}(m_uniforms,material):material.isMeshToonMaterial?function(uniforms,material){refreshUniformsPhong(uniforms,material),material.gradientMap&&(uniforms.gradientMap.value=material.gradientMap)}(m_uniforms,material):material.isMeshPhongMaterial?refreshUniformsPhong(m_uniforms,material):material.isMeshPhysicalMaterial?function(uniforms,material){uniforms.clearCoat.value=material.clearCoat,uniforms.clearCoatRoughness.value=material.clearCoatRoughness,refreshUniformsStandard(uniforms,material)}(m_uniforms,material):material.isMeshStandardMaterial?refreshUniformsStandard(m_uniforms,material):material.isMeshDepthMaterial?material.displacementMap&&(m_uniforms.displacementMap.value=material.displacementMap,m_uniforms.displacementScale.value=material.displacementScale,m_uniforms.displacementBias.value=material.displacementBias):material.isMeshNormalMaterial&&function(uniforms,material){material.bumpMap&&(uniforms.bumpMap.value=material.bumpMap,uniforms.bumpScale.value=material.bumpScale);material.normalMap&&(uniforms.normalMap.value=material.normalMap,uniforms.normalScale.value.copy(material.normalScale));material.displacementMap&&(uniforms.displacementMap.value=material.displacementMap,uniforms.displacementScale.value=material.displacementScale,uniforms.displacementBias.value=material.displacementBias)}(m_uniforms,material),void 0!==m_uniforms.ltcMat&&(m_uniforms.ltcMat.value=THREE.UniformsLib.LTC_MAT_TEXTURE),void 0!==m_uniforms.ltcMag&&(m_uniforms.ltcMag.value=THREE.UniformsLib.LTC_MAG_TEXTURE),WebGLUniforms.upload(_gl,materialProperties.uniformsList,m_uniforms,_this)),p_uniforms.set(_gl,object,"modelViewMatrix"),p_uniforms.set(_gl,object,"normalMatrix"),p_uniforms.setValue(_gl,"modelMatrix",object.matrixWorld),program}function refreshUniformsLine(uniforms,material){uniforms.diffuse.value=material.color,uniforms.opacity.value=material.opacity}function refreshUniformsPhong(uniforms,material){uniforms.specular.value=material.specular,uniforms.shininess.value=Math.max(material.shininess,1e-4),material.emissiveMap&&(uniforms.emissiveMap.value=material.emissiveMap),material.bumpMap&&(uniforms.bumpMap.value=material.bumpMap,uniforms.bumpScale.value=material.bumpScale),material.normalMap&&(uniforms.normalMap.value=material.normalMap,uniforms.normalScale.value.copy(material.normalScale)),material.displacementMap&&(uniforms.displacementMap.value=material.displacementMap,uniforms.displacementScale.value=material.displacementScale,uniforms.displacementBias.value=material.displacementBias)}function refreshUniformsStandard(uniforms,material){uniforms.roughness.value=material.roughness,uniforms.metalness.value=material.metalness,material.roughnessMap&&(uniforms.roughnessMap.value=material.roughnessMap),material.metalnessMap&&(uniforms.metalnessMap.value=material.metalnessMap),material.emissiveMap&&(uniforms.emissiveMap.value=material.emissiveMap),material.bumpMap&&(uniforms.bumpMap.value=material.bumpMap,uniforms.bumpScale.value=material.bumpScale),material.normalMap&&(uniforms.normalMap.value=material.normalMap,uniforms.normalScale.value.copy(material.normalScale)),material.displacementMap&&(uniforms.displacementMap.value=material.displacementMap,uniforms.displacementScale.value=material.displacementScale,uniforms.displacementBias.value=material.displacementBias),material.envMap&&(uniforms.envMapIntensity.value=material.envMapIntensity)}function paramThreeToGL(p){var extension;if(1e3===p)return _gl.REPEAT;if(p===ClampToEdgeWrapping)return _gl.CLAMP_TO_EDGE;if(1002===p)return _gl.MIRRORED_REPEAT;if(p===NearestFilter)return _gl.NEAREST;if(p===NearestMipMapNearestFilter)return _gl.NEAREST_MIPMAP_NEAREST;if(p===NearestMipMapLinearFilter)return _gl.NEAREST_MIPMAP_LINEAR;if(p===LinearFilter)return _gl.LINEAR;if(1007===p)return _gl.LINEAR_MIPMAP_NEAREST;if(p===LinearMipMapLinearFilter)return _gl.LINEAR_MIPMAP_LINEAR;if(p===UnsignedByteType)return _gl.UNSIGNED_BYTE;if(1017===p)return _gl.UNSIGNED_SHORT_4_4_4_4;if(1018===p)return _gl.UNSIGNED_SHORT_5_5_5_1;if(1019===p)return _gl.UNSIGNED_SHORT_5_6_5;if(1010===p)return _gl.BYTE;if(1011===p)return _gl.SHORT;if(p===UnsignedShortType)return _gl.UNSIGNED_SHORT;if(1013===p)return _gl.INT;if(p===UnsignedIntType)return _gl.UNSIGNED_INT;if(p===FloatType)return _gl.FLOAT;if(p===HalfFloatType&&null!==(extension=extensions.get("OES_texture_half_float")))return extension.HALF_FLOAT_OES;if(1021===p)return _gl.ALPHA;if(p===RGBFormat)return _gl.RGB;if(p===RGBAFormat)return _gl.RGBA;if(1024===p)return _gl.LUMINANCE;if(1025===p)return _gl.LUMINANCE_ALPHA;if(p===DepthFormat)return _gl.DEPTH_COMPONENT;if(p===DepthStencilFormat)return _gl.DEPTH_STENCIL;if(p===AddEquation)return _gl.FUNC_ADD;if(101===p)return _gl.FUNC_SUBTRACT;if(102===p)return _gl.FUNC_REVERSE_SUBTRACT;if(200===p)return _gl.ZERO;if(201===p)return _gl.ONE;if(202===p)return _gl.SRC_COLOR;if(203===p)return _gl.ONE_MINUS_SRC_COLOR;if(p===SrcAlphaFactor)return _gl.SRC_ALPHA;if(p===OneMinusSrcAlphaFactor)return _gl.ONE_MINUS_SRC_ALPHA;if(206===p)return _gl.DST_ALPHA;if(207===p)return _gl.ONE_MINUS_DST_ALPHA;if(208===p)return _gl.DST_COLOR;if(209===p)return _gl.ONE_MINUS_DST_COLOR;if(210===p)return _gl.SRC_ALPHA_SATURATE;if((2001===p||2002===p||2003===p||2004===p)&&null!==(extension=extensions.get("WEBGL_compressed_texture_s3tc"))){if(2001===p)return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;if(2002===p)return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(2003===p)return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(2004===p)return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((2100===p||2101===p||2102===p||2103===p)&&null!==(extension=extensions.get("WEBGL_compressed_texture_pvrtc"))){if(2100===p)return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(2101===p)return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(2102===p)return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(2103===p)return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(2151===p&&null!==(extension=extensions.get("WEBGL_compressed_texture_etc1")))return extension.COMPRESSED_RGB_ETC1_WEBGL;if((103===p||104===p)&&null!==(extension=extensions.get("EXT_blend_minmax"))){if(103===p)return extension.MIN_EXT;if(104===p)return extension.MAX_EXT}return p===UnsignedInt248Type&&null!==(extension=extensions.get("WEBGL_depth_texture"))?extension.UNSIGNED_INT_24_8_WEBGL:0}this.getContext=function(){return _gl},this.getContextAttributes=function(){return _gl.getContextAttributes()},this.forceContextLoss=function(){extensions.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){return capabilities.getMaxAnisotropy()},this.getPrecision=function(){return capabilities.precision},this.getPixelRatio=function(){return _pixelRatio},this.setPixelRatio=function(value){void 0!==value&&(_pixelRatio=value,this.setSize(_viewport.z,_viewport.w,!1))},this.getSize=function(){return{width:_width,height:_height}},this.setSize=function(width,height,updateStyle){_width=width,_height=height,_canvas.width=width*_pixelRatio,_canvas.height=height*_pixelRatio,!1!==updateStyle&&(_canvas.style.width=width+"px",_canvas.style.height=height+"px"),this.setViewport(0,0,width,height)},this.setViewport=function(x,y,width,height){state.viewport(_viewport.set(x,y,width,height))},this.setScissor=function(x,y,width,height){state.scissor(_scissor.set(x,y,width,height))},this.setScissorTest=function(boolean){state.setScissorTest(_scissorTest=boolean)},this.getClearColor=function(){return _clearColor},this.setClearColor=function(color,alpha){_clearColor.set(color),_clearAlpha=void 0!==alpha?alpha:1,state.buffers.color.setClear(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha,_premultipliedAlpha)},this.getClearAlpha=function(){return _clearAlpha},this.setClearAlpha=function(alpha){_clearAlpha=alpha,state.buffers.color.setClear(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha,_premultipliedAlpha)},this.clear=function(color,depth,stencil){var bits=0;void 0!==color&&!color||(bits|=_gl.COLOR_BUFFER_BIT),void 0!==depth&&!depth||(bits|=_gl.DEPTH_BUFFER_BIT),void 0!==stencil&&!stencil||(bits|=_gl.STENCIL_BUFFER_BIT),_gl.clear(bits)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(renderTarget,color,depth,stencil){this.setRenderTarget(renderTarget),this.clear(color,depth,stencil)},this.resetGLState=resetGLState,this.dispose=function(){transparentObjects=[],opaqueObjects=[],opaqueObjectsLastIndex=transparentObjectsLastIndex=-1,_canvas.removeEventListener("webglcontextlost",onContextLost,!1)},this.renderBufferImmediate=function(object,program,material){state.initAttributes();var buffers=properties.get(object);object.hasPositions&&!buffers.position&&(buffers.position=_gl.createBuffer()),object.hasNormals&&!buffers.normal&&(buffers.normal=_gl.createBuffer()),object.hasUvs&&!buffers.uv&&(buffers.uv=_gl.createBuffer()),object.hasColors&&!buffers.color&&(buffers.color=_gl.createBuffer());var attributes=program.getAttributes();if(object.hasPositions&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.position),_gl.bufferData(_gl.ARRAY_BUFFER,object.positionArray,_gl.DYNAMIC_DRAW),state.enableAttribute(attributes.position),_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,!1,0,0)),object.hasNormals){if(_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.normal),!material.isMeshPhongMaterial&&!material.isMeshStandardMaterial&&!material.isMeshNormalMaterial&&material.shading===FlatShading)for(var i=0,l=3*object.count;i<l;i+=9){var array=object.normalArray,nx=(array[i+0]+array[i+3]+array[i+6])/3,ny=(array[i+1]+array[i+4]+array[i+7])/3,nz=(array[i+2]+array[i+5]+array[i+8])/3;array[i+0]=nx,array[i+1]=ny,array[i+2]=nz,array[i+3]=nx,array[i+4]=ny,array[i+5]=nz,array[i+6]=nx,array[i+7]=ny,array[i+8]=nz}_gl.bufferData(_gl.ARRAY_BUFFER,object.normalArray,_gl.DYNAMIC_DRAW),state.enableAttribute(attributes.normal),_gl.vertexAttribPointer(attributes.normal,3,_gl.FLOAT,!1,0,0)}object.hasUvs&&material.map&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.uv),_gl.bufferData(_gl.ARRAY_BUFFER,object.uvArray,_gl.DYNAMIC_DRAW),state.enableAttribute(attributes.uv),_gl.vertexAttribPointer(attributes.uv,2,_gl.FLOAT,!1,0,0)),object.hasColors&&material.vertexColors!==NoColors&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.color),_gl.bufferData(_gl.ARRAY_BUFFER,object.colorArray,_gl.DYNAMIC_DRAW),state.enableAttribute(attributes.color),_gl.vertexAttribPointer(attributes.color,3,_gl.FLOAT,!1,0,0)),state.disableUnusedAttributes(),_gl.drawArrays(_gl.TRIANGLES,0,object.count),object.count=0},this.renderBufferDirect=function(camera,fog,geometry,material,object,group){setMaterial(material);var program=setProgram(camera,fog,material,object),updateBuffers=!1,geometryProgram=geometry.id+"_"+program.id+"_"+material.wireframe;geometryProgram!==_currentGeometryProgram&&(_currentGeometryProgram=geometryProgram,updateBuffers=!0);var morphTargetInfluences=object.morphTargetInfluences;if(void 0!==morphTargetInfluences){for(var activeInfluences=[],i=0,l=morphTargetInfluences.length;i<l;i++){var influence=morphTargetInfluences[i];activeInfluences.push([influence,i])}activeInfluences.sort(absNumericalSort),8<activeInfluences.length&&(activeInfluences.length=8);var morphAttributes=geometry.morphAttributes;for(i=0,l=activeInfluences.length;i<l;i++){influence=activeInfluences[i];if(morphInfluences[i]=influence[0],0!==influence[0]){var index=influence[1];!0===material.morphTargets&&morphAttributes.position&&geometry.addAttribute("morphTarget"+i,morphAttributes.position[index]),!0===material.morphNormals&&morphAttributes.normal&&geometry.addAttribute("morphNormal"+i,morphAttributes.normal[index])}else!0===material.morphTargets&&geometry.removeAttribute("morphTarget"+i),!0===material.morphNormals&&geometry.removeAttribute("morphNormal"+i)}i=activeInfluences.length;for(var il=morphInfluences.length;i<il;i++)morphInfluences[i]=0;program.getUniforms().setValue(_gl,"morphTargetInfluences",morphInfluences),updateBuffers=!0}index=geometry.index;var renderer,position=geometry.attributes.position,rangeFactor=1;!0===material.wireframe&&(index=objects.getWireframeAttribute(geometry),rangeFactor=2),null!==index?(renderer=indexedBufferRenderer).setIndex(index):renderer=bufferRenderer,updateBuffers&&(function(material,program,geometry,startIndex){var extension;if(geometry&&geometry.isInstancedBufferGeometry&&null===(extension=extensions.get("ANGLE_instanced_arrays")))return console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===startIndex&&(startIndex=0);state.initAttributes();var geometryAttributes=geometry.attributes,programAttributes=program.getAttributes(),materialDefaultAttributeValues=material.defaultAttributeValues;for(var name in programAttributes){var programAttribute=programAttributes[name];if(0<=programAttribute){var geometryAttribute=geometryAttributes[name];if(void 0!==geometryAttribute){var normalized=geometryAttribute.normalized,size=geometryAttribute.itemSize,attributeProperties=objects.getAttributeProperties(geometryAttribute),buffer=attributeProperties.__webglBuffer,type=attributeProperties.type,bytesPerElement=attributeProperties.bytesPerElement;if(geometryAttribute.isInterleavedBufferAttribute){var data=geometryAttribute.data,stride=data.stride,offset=geometryAttribute.offset;data&&data.isInstancedInterleavedBuffer?(state.enableAttributeAndDivisor(programAttribute,data.meshPerAttribute,extension),void 0===geometry.maxInstancedCount&&(geometry.maxInstancedCount=data.meshPerAttribute*data.count)):state.enableAttribute(programAttribute),_gl.bindBuffer(_gl.ARRAY_BUFFER,buffer),_gl.vertexAttribPointer(programAttribute,size,type,normalized,stride*bytesPerElement,(startIndex*stride+offset)*bytesPerElement)}else geometryAttribute.isInstancedBufferAttribute?(state.enableAttributeAndDivisor(programAttribute,geometryAttribute.meshPerAttribute,extension),void 0===geometry.maxInstancedCount&&(geometry.maxInstancedCount=geometryAttribute.meshPerAttribute*geometryAttribute.count)):state.enableAttribute(programAttribute),_gl.bindBuffer(_gl.ARRAY_BUFFER,buffer),_gl.vertexAttribPointer(programAttribute,size,type,normalized,0,startIndex*size*bytesPerElement)}else if(void 0!==materialDefaultAttributeValues){var value=materialDefaultAttributeValues[name];if(void 0!==value)switch(value.length){case 2:_gl.vertexAttrib2fv(programAttribute,value);break;case 3:_gl.vertexAttrib3fv(programAttribute,value);break;case 4:_gl.vertexAttrib4fv(programAttribute,value);break;default:_gl.vertexAttrib1fv(programAttribute,value)}}}}state.disableUnusedAttributes()}(material,program,geometry),null!==index&&_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,objects.getAttributeBuffer(index)));var dataCount=0;null!==index?dataCount=index.count:void 0!==position&&(dataCount=position.count);var rangeStart=geometry.drawRange.start*rangeFactor,rangeCount=geometry.drawRange.count*rangeFactor,groupStart=null!==group?group.start*rangeFactor:0,groupCount=null!==group?group.count*rangeFactor:1/0,drawStart=Math.max(rangeStart,groupStart),drawEnd=Math.min(dataCount,rangeStart+rangeCount,groupStart+groupCount)-1,drawCount=Math.max(0,drawEnd-drawStart+1);if(0!==drawCount){if(object.isMesh)if(!0===material.wireframe)state.setLineWidth(material.wireframeLinewidth*getTargetPixelRatio()),renderer.setMode(_gl.LINES);else switch(object.drawMode){case TrianglesDrawMode:renderer.setMode(_gl.TRIANGLES);break;case 1:renderer.setMode(_gl.TRIANGLE_STRIP);break;case 2:renderer.setMode(_gl.TRIANGLE_FAN)}else if(object.isLine){var lineWidth=material.linewidth;void 0===lineWidth&&(lineWidth=1),state.setLineWidth(lineWidth*getTargetPixelRatio()),object.isLineSegments?renderer.setMode(_gl.LINES):renderer.setMode(_gl.LINE_STRIP)}else object.isPoints&&renderer.setMode(_gl.POINTS);geometry&&geometry.isInstancedBufferGeometry?0<geometry.maxInstancedCount&&renderer.renderInstances(geometry,drawStart,drawCount):renderer.render(drawStart,drawCount)}},this.render=function(scene,camera,renderTarget,forceClear){if(void 0===camera||!0===camera.isCamera){_currentGeometryProgram="",_currentMaterialId=-1,!(_currentCamera=null)===scene.autoUpdate&&scene.updateMatrixWorld(),null===camera.parent&&camera.updateMatrixWorld(),camera.matrixWorldInverse.getInverse(camera.matrixWorld),_projScreenMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse),_frustum.setFromMatrix(_projScreenMatrix),lights.length=0,transparentObjectsLastIndex=opaqueObjectsLastIndex=-1,sprites.length=0,lensFlares.length=0,_localClippingEnabled=this.localClippingEnabled,_clippingEnabled=_clipping.init(this.clippingPlanes,_localClippingEnabled,camera),function projectObject(object,camera){if(!1===object.visible)return;var visible=0!=(object.layers.mask&camera.layers.mask);if(visible)if(object.isLight)lights.push(object);else if(object.isSprite)!1!==object.frustumCulled&&!0!==isSpriteViewable(object)||sprites.push(object);else if(object.isLensFlare)lensFlares.push(object);else if(object.isImmediateRenderObject)!0===_this.sortObjects&&(_vector3.setFromMatrixPosition(object.matrixWorld),_vector3.applyProjection(_projScreenMatrix)),pushRenderItem(object,null,object.material,_vector3.z,null);else if((object.isMesh||object.isLine||object.isPoints)&&(object.isSkinnedMesh&&object.skeleton.update(),!1===object.frustumCulled||!0===isObjectViewable(object))){var material=object.material;if(!0===material.visible){!0===_this.sortObjects&&(_vector3.setFromMatrixPosition(object.matrixWorld),_vector3.applyProjection(_projScreenMatrix));var geometry=objects.update(object);if(material.isMultiMaterial)for(var groups=geometry.groups,materials=material.materials,i=0,l=groups.length;i<l;i++){var group=groups[i],groupMaterial=materials[group.materialIndex];!0===groupMaterial.visible&&pushRenderItem(object,geometry,groupMaterial,_vector3.z,group)}else pushRenderItem(object,geometry,material,_vector3.z,null)}}var children=object.children;for(var i=0,l=children.length;i<l;i++)projectObject(children[i],camera)}(scene,camera),opaqueObjects.length=opaqueObjectsLastIndex+1,transparentObjects.length=transparentObjectsLastIndex+1,!0===_this.sortObjects&&(opaqueObjects.sort(painterSortStable),transparentObjects.sort(reversePainterSortStable)),_clippingEnabled&&_clipping.beginShadows(),function(lights){for(var lightShadowsLength=0,i=0,l=lights.length;i<l;i++){var light=lights[i];light.castShadow&&(_lights.shadows[lightShadowsLength++]=light)}_lights.shadows.length=lightShadowsLength}(lights),shadowMap.render(scene,camera),function(lights,camera){var l,ll,light,color,intensity,distance,shadowMap,r=0,g=0,b=0,viewMatrix=camera.matrixWorldInverse,directionalLength=0,pointLength=0,spotLength=0,rectAreaLength=0,hemiLength=0;for(l=0,ll=lights.length;l<ll;l++)if(light=lights[l],color=light.color,intensity=light.intensity,distance=light.distance,shadowMap=light.shadow&&light.shadow.map?light.shadow.map.texture:null,light.isAmbientLight)r+=color.r*intensity,g+=color.g*intensity,b+=color.b*intensity;else if(light.isDirectionalLight){(uniforms=lightCache.get(light)).color.copy(light.color).multiplyScalar(light.intensity),uniforms.direction.setFromMatrixPosition(light.matrixWorld),_vector3.setFromMatrixPosition(light.target.matrixWorld),uniforms.direction.sub(_vector3),uniforms.direction.transformDirection(viewMatrix),uniforms.shadow=light.castShadow,light.castShadow&&(uniforms.shadowBias=light.shadow.bias,uniforms.shadowRadius=light.shadow.radius,uniforms.shadowMapSize=light.shadow.mapSize),_lights.directionalShadowMap[directionalLength]=shadowMap,_lights.directionalShadowMatrix[directionalLength]=light.shadow.matrix,_lights.directional[directionalLength++]=uniforms}else if(light.isSpotLight){(uniforms=lightCache.get(light)).position.setFromMatrixPosition(light.matrixWorld),uniforms.position.applyMatrix4(viewMatrix),uniforms.color.copy(color).multiplyScalar(intensity),uniforms.distance=distance,uniforms.direction.setFromMatrixPosition(light.matrixWorld),_vector3.setFromMatrixPosition(light.target.matrixWorld),uniforms.direction.sub(_vector3),uniforms.direction.transformDirection(viewMatrix),uniforms.coneCos=Math.cos(light.angle),uniforms.penumbraCos=Math.cos(light.angle*(1-light.penumbra)),uniforms.decay=0===light.distance?0:light.decay,uniforms.shadow=light.castShadow,light.castShadow&&(uniforms.shadowBias=light.shadow.bias,uniforms.shadowRadius=light.shadow.radius,uniforms.shadowMapSize=light.shadow.mapSize),_lights.spotShadowMap[spotLength]=shadowMap,_lights.spotShadowMatrix[spotLength]=light.shadow.matrix,_lights.spot[spotLength++]=uniforms}else if(light.isRectAreaLight){(uniforms=lightCache.get(light)).color.copy(color).multiplyScalar(intensity/(light.width*light.height)),uniforms.position.setFromMatrixPosition(light.matrixWorld),uniforms.position.applyMatrix4(viewMatrix),_matrix42.identity(),_matrix4.copy(light.matrixWorld),_matrix4.premultiply(viewMatrix),_matrix42.extractRotation(_matrix4),uniforms.halfWidth.set(.5*light.width,0,0),uniforms.halfHeight.set(0,.5*light.height,0),uniforms.halfWidth.applyMatrix4(_matrix42),uniforms.halfHeight.applyMatrix4(_matrix42),_lights.rectArea[rectAreaLength++]=uniforms}else if(light.isPointLight){(uniforms=lightCache.get(light)).position.setFromMatrixPosition(light.matrixWorld),uniforms.position.applyMatrix4(viewMatrix),uniforms.color.copy(light.color).multiplyScalar(light.intensity),uniforms.distance=light.distance,uniforms.decay=0===light.distance?0:light.decay,uniforms.shadow=light.castShadow,light.castShadow&&(uniforms.shadowBias=light.shadow.bias,uniforms.shadowRadius=light.shadow.radius,uniforms.shadowMapSize=light.shadow.mapSize),_lights.pointShadowMap[pointLength]=shadowMap,void 0===_lights.pointShadowMatrix[pointLength]&&(_lights.pointShadowMatrix[pointLength]=new Matrix4),_vector3.setFromMatrixPosition(light.matrixWorld).negate(),_lights.pointShadowMatrix[pointLength].identity().setPosition(_vector3),_lights.point[pointLength++]=uniforms}else if(light.isHemisphereLight){var uniforms;(uniforms=lightCache.get(light)).direction.setFromMatrixPosition(light.matrixWorld),uniforms.direction.transformDirection(viewMatrix),uniforms.direction.normalize(),uniforms.skyColor.copy(light.color).multiplyScalar(intensity),uniforms.groundColor.copy(light.groundColor).multiplyScalar(intensity),_lights.hemi[hemiLength++]=uniforms}_lights.ambient[0]=r,_lights.ambient[1]=g,_lights.ambient[2]=b,_lights.directional.length=directionalLength,_lights.spot.length=spotLength,_lights.rectArea.length=rectAreaLength,_lights.point.length=pointLength,_lights.hemi.length=hemiLength,_lights.hash=directionalLength+","+pointLength+","+spotLength+","+rectAreaLength+","+hemiLength+","+_lights.shadows.length}(lights,camera),_clippingEnabled&&_clipping.endShadows(),_infoRender.calls=0,_infoRender.vertices=0,_infoRender.faces=0,void(_infoRender.points=0)===renderTarget&&(renderTarget=null),this.setRenderTarget(renderTarget);var background=scene.background;if(null===background?state.buffers.color.setClear(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha,_premultipliedAlpha):background&&background.isColor&&(state.buffers.color.setClear(background.r,background.g,background.b,1,_premultipliedAlpha),forceClear=!0),(this.autoClear||forceClear)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),background&&background.isCubeTexture?(backgroundCamera2.projectionMatrix.copy(camera.projectionMatrix),backgroundCamera2.matrixWorld.extractRotation(camera.matrixWorld),backgroundCamera2.matrixWorldInverse.getInverse(backgroundCamera2.matrixWorld),backgroundBoxMesh.material.uniforms.tCube.value=background,backgroundBoxMesh.modelViewMatrix.multiplyMatrices(backgroundCamera2.matrixWorldInverse,backgroundBoxMesh.matrixWorld),objects.update(backgroundBoxMesh),_this.renderBufferDirect(backgroundCamera2,null,backgroundBoxMesh.geometry,backgroundBoxMesh.material,backgroundBoxMesh,null)):background&&background.isTexture&&(backgroundPlaneMesh.material.map=background,objects.update(backgroundPlaneMesh),_this.renderBufferDirect(backgroundCamera,null,backgroundPlaneMesh.geometry,backgroundPlaneMesh.material,backgroundPlaneMesh,null)),scene.overrideMaterial){var overrideMaterial=scene.overrideMaterial;renderObjects(opaqueObjects,scene,camera,overrideMaterial),renderObjects(transparentObjects,scene,camera,overrideMaterial)}else state.setBlending(NoBlending),renderObjects(opaqueObjects,scene,camera),renderObjects(transparentObjects,scene,camera);spritePlugin.render(scene,camera),lensFlarePlugin.render(scene,camera,_currentViewport),renderTarget&&textures.updateRenderTargetMipmap(renderTarget),state.setDepthTest(!0),state.setDepthWrite(!0),state.setColorWrite(!0)}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFaceCulling=function(cullFace,frontFaceDirection){state.setCullFace(cullFace),state.setFlipSided(0===frontFaceDirection)},this.allocTextureUnit=function(){var textureUnit=_usedTextureUnits;return textureUnit>=capabilities.maxTextures&&console.warn("WebGLRenderer: trying to use "+textureUnit+" texture units while this GPU supports only "+capabilities.maxTextures),_usedTextureUnits+=1,textureUnit},this.setTexture2D=(warned=!1,function(texture,slot){texture&&texture.isWebGLRenderTarget&&(warned||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),warned=!0),texture=texture.texture),textures.setTexture2D(texture,slot)}),this.setTexture=function(){var warned=!1;return function(texture,slot){warned||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),warned=!0),textures.setTexture2D(texture,slot)}}(),this.setTextureCube=function(){var warned=!1;return function(texture,slot){texture&&texture.isWebGLRenderTargetCube&&(warned||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),warned=!0),texture=texture.texture),texture&&texture.isCubeTexture||Array.isArray(texture.image)&&6===texture.image.length?textures.setTextureCube(texture,slot):textures.setTextureCubeDynamic(texture,slot)}}(),this.getCurrentRenderTarget=function(){return _currentRenderTarget},this.setRenderTarget=function(renderTarget){(_currentRenderTarget=renderTarget)&&void 0===properties.get(renderTarget).__webglFramebuffer&&textures.setupRenderTarget(renderTarget);var framebuffer,isCube=renderTarget&&renderTarget.isWebGLRenderTargetCube;if(renderTarget){var renderTargetProperties=properties.get(renderTarget);framebuffer=isCube?renderTargetProperties.__webglFramebuffer[renderTarget.activeCubeFace]:renderTargetProperties.__webglFramebuffer,_currentScissor.copy(renderTarget.scissor),_currentScissorTest=renderTarget.scissorTest,_currentViewport.copy(renderTarget.viewport)}else framebuffer=null,_currentScissor.copy(_scissor).multiplyScalar(_pixelRatio),_currentScissorTest=_scissorTest,_currentViewport.copy(_viewport).multiplyScalar(_pixelRatio);if(_currentFramebuffer!==framebuffer&&(_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer),_currentFramebuffer=framebuffer),state.scissor(_currentScissor),state.setScissorTest(_currentScissorTest),state.viewport(_currentViewport),isCube){var textureProperties=properties.get(renderTarget.texture);_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+renderTarget.activeCubeFace,textureProperties.__webglTexture,renderTarget.activeMipMapLevel)}},this.readRenderTargetPixels=function(renderTarget,x,y,width,height,buffer){if(!1!==(renderTarget&&renderTarget.isWebGLRenderTarget)){var framebuffer=properties.get(renderTarget).__webglFramebuffer;if(framebuffer){var restore=!1;framebuffer!==_currentFramebuffer&&(_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer),restore=!0);try{var texture=renderTarget.texture,textureFormat=texture.format,textureType=texture.type;if(textureFormat!==RGBAFormat&&paramThreeToGL(textureFormat)!==_gl.getParameter(_gl.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(textureType===UnsignedByteType||paramThreeToGL(textureType)===_gl.getParameter(_gl.IMPLEMENTATION_COLOR_READ_TYPE)||textureType===FloatType&&(extensions.get("OES_texture_float")||extensions.get("WEBGL_color_buffer_float"))||textureType===HalfFloatType&&extensions.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");_gl.checkFramebufferStatus(_gl.FRAMEBUFFER)===_gl.FRAMEBUFFER_COMPLETE?0<=x&&x<=renderTarget.width-width&&0<=y&&y<=renderTarget.height-height&&_gl.readPixels(x,y,width,height,paramThreeToGL(textureFormat),paramThreeToGL(textureType),buffer):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{restore&&_gl.bindFramebuffer(_gl.FRAMEBUFFER,_currentFramebuffer)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")}}function FogExp2(color,density){this.name="",this.color=new Color(color),this.density=void 0!==density?density:25e-5}function Fog(color,near,far){this.name="",this.color=new Color(color),this.near=void 0!==near?near:1,this.far=void 0!==far?far:1e3}function Scene(){Object3D.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function LensFlare(texture,size,distance,blending,color){Object3D.call(this),this.lensFlares=[],this.positionScreen=new Vector3,(this.customUpdateCallback=void 0)!==texture&&this.add(texture,size,distance,blending,color)}function SpriteMaterial(parameters){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(parameters)}function Sprite(material){Object3D.call(this),this.type="Sprite",this.material=void 0!==material?material:new SpriteMaterial}function LOD(){Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Skeleton(bones,boneInverses,useVertexTexture){if(this.useVertexTexture=void 0===useVertexTexture||useVertexTexture,this.identityMatrix=new Matrix4,bones=bones||[],this.bones=bones.slice(0),this.useVertexTexture){var size=Math.sqrt(4*this.bones.length);size=_Math.nextPowerOfTwo(Math.ceil(size)),size=Math.max(size,4),this.boneTextureWidth=size,this.boneTextureHeight=size,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,RGBAFormat,FloatType)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===boneInverses)this.calculateInverses();else if(this.bones.length===boneInverses.length)this.boneInverses=boneInverses.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var b=0,bl=this.bones.length;b<bl;b++)this.boneInverses.push(new Matrix4)}}function Bone(){Object3D.call(this),this.type="Bone"}function SkinnedMesh(geometry,material,useVertexTexture){Mesh.call(this,geometry,material),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4;var bones=[];if(this.geometry&&void 0!==this.geometry.bones){for(var bone,gbone,b=0,bl=this.geometry.bones.length;b<bl;++b)gbone=this.geometry.bones[b],bone=new Bone,bones.push(bone),bone.name=gbone.name,bone.position.fromArray(gbone.pos),bone.quaternion.fromArray(gbone.rotq),void 0!==gbone.scl&&bone.scale.fromArray(gbone.scl);for(b=0,bl=this.geometry.bones.length;b<bl;++b)-1!==(gbone=this.geometry.bones[b]).parent&&null!==gbone.parent&&void 0!==bones[gbone.parent]?bones[gbone.parent].add(bones[b]):this.add(bones[b])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new Skeleton(bones,void 0,useVertexTexture),this.matrixWorld)}function LineBasicMaterial(parameters){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(parameters)}function Line(geometry,material,mode){if(1===mode)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new LineSegments(geometry,material);Object3D.call(this),this.type="Line",this.geometry=void 0!==geometry?geometry:new BufferGeometry,this.material=void 0!==material?material:new LineBasicMaterial({color:16777215*Math.random()})}function LineSegments(geometry,material){Line.call(this,geometry,material),this.type="LineSegments"}function PointsMaterial(parameters){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(parameters)}function Points(geometry,material){Object3D.call(this),this.type="Points",this.geometry=void 0!==geometry?geometry:new BufferGeometry,this.material=void 0!==material?material:new PointsMaterial({color:16777215*Math.random()})}function Group(){Object3D.call(this),this.type="Group"}function VideoTexture(video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){Texture.call(this,video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy),this.generateMipmaps=!1;var scope=this;!function update(){requestAnimationFrame(update),video.readyState>=video.HAVE_CURRENT_DATA&&(scope.needsUpdate=!0)}()}function CompressedTexture(mipmaps,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,encoding){Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding),this.image={width:width,height:height},this.mipmaps=mipmaps,this.flipY=!1,this.generateMipmaps=!1}function CanvasTexture(canvas,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){Texture.call(this,canvas,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy),this.needsUpdate=!0}function DepthTexture(width,height,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,format){if((format=void 0!==format?format:DepthFormat)!==DepthFormat&&format!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===type&&format===DepthFormat&&(type=UnsignedShortType),void 0===type&&format===DepthStencilFormat&&(type=UnsignedInt248Type),Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy),this.image={width:width,height:height},this.magFilter=void 0!==magFilter?magFilter:NearestFilter,this.minFilter=void 0!==minFilter?minFilter:NearestFilter,this.flipY=!1,this.generateMipmaps=!1}function WireframeGeometry(geometry){BufferGeometry.call(this);var edge=[0,0],hash={};function sortFunction(a,b){return a-b}var keys=["a","b","c"];if(geometry&&geometry.isGeometry){for(var vertices=geometry.vertices,faces=geometry.faces,numEdges=0,edges=new Uint32Array(6*faces.length),i=0,l=faces.length;i<l;i++)for(var face=faces[i],j=0;j<3;j++){edge[0]=face[keys[j]],edge[1]=face[keys[(j+1)%3]],edge.sort(sortFunction),void 0===hash[key=edge.toString()]&&(edges[2*numEdges]=edge[0],edges[2*numEdges+1]=edge[1],hash[key]=!0,numEdges++)}var coords=new Float32Array(2*numEdges*3);for(i=0,l=numEdges;i<l;i++)for(j=0;j<2;j++){var vertex=vertices[edges[2*i+j]];coords[(index=6*i+3*j)+0]=vertex.x,coords[index+1]=vertex.y,coords[index+2]=vertex.z}this.addAttribute("position",new BufferAttribute(coords,3))}else if(geometry&&geometry.isBufferGeometry)if(null!==geometry.index){var indices=geometry.index.array,groups=(vertices=geometry.attributes.position,geometry.groups);numEdges=0;0===groups.length&&geometry.addGroup(0,indices.length);edges=new Uint32Array(2*indices.length);for(var o=0,ol=groups.length;o<ol;++o)for(var group=groups[o],start=group.start,il=(i=start,start+group.count);i<il;i+=3)for(j=0;j<3;j++){var key;edge[0]=indices[i+j],edge[1]=indices[i+(j+1)%3],edge.sort(sortFunction),void 0===hash[key=edge.toString()]&&(edges[2*numEdges]=edge[0],edges[2*numEdges+1]=edge[1],hash[key]=!0,numEdges++)}for(coords=new Float32Array(2*numEdges*3),i=0,l=numEdges;i<l;i++)for(j=0;j<2;j++){var index=6*i+3*j,index2=edges[2*i+j];coords[index+0]=vertices.getX(index2),coords[index+1]=vertices.getY(index2),coords[index+2]=vertices.getZ(index2)}this.addAttribute("position",new BufferAttribute(coords,3))}else{var numTris=(numEdges=(vertices=geometry.attributes.position.array).length/3)/3;for(coords=new Float32Array(2*numEdges*3),i=0,l=numTris;i<l;i++)for(j=0;j<3;j++){var index1=9*i+3*j;coords[(index=18*i+6*j)+0]=vertices[index1],coords[index+1]=vertices[1+index1],coords[index+2]=vertices[2+index1];index2=9*i+(j+1)%3*3;coords[index+3]=vertices[index2],coords[index+4]=vertices[index2+1],coords[index+5]=vertices[index2+2]}this.addAttribute("position",new BufferAttribute(coords,3))}}function ParametricBufferGeometry(func,slices,stacks){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:func,slices:slices,stacks:stacks};var i,j,p,u,v,vertices=[],uvs=[],sliceCount=slices+1;for(i=0;i<=stacks;i++)for(v=i/stacks,j=0;j<=slices;j++)p=func(u=j/slices,v),vertices.push(p.x,p.y,p.z),uvs.push(u,v);var a,b,c,d,indices=[];for(i=0;i<stacks;i++)for(j=0;j<slices;j++)b=(a=i*sliceCount+j)+1,c=(i+1)*sliceCount+j+1,d=(i+1)*sliceCount+j,indices.push(a,b,d),indices.push(b,c,d);this.setIndex(new(65535<indices.length?Uint32BufferAttribute:Uint16BufferAttribute)(indices,1)),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2)),this.computeVertexNormals()}function ParametricGeometry(func,slices,stacks){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:func,slices:slices,stacks:stacks},this.fromBufferGeometry(new ParametricBufferGeometry(func,slices,stacks)),this.mergeVertices()}function PolyhedronBufferGeometry(vertices,indices,radius,detail){BufferGeometry.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:vertices,indices:indices,radius:radius,detail:detail},radius=radius||1;var vertexBuffer=[],uvBuffer=[];function subdivideFace(a,b,c,detail){var i,j,cols=Math.pow(2,detail),v=[];for(i=0;i<=cols;i++){v[i]=[];var aj=a.clone().lerp(c,i/cols),bj=b.clone().lerp(c,i/cols),rows=cols-i;for(j=0;j<=rows;j++)v[i][j]=0===j&&i===cols?aj:aj.clone().lerp(bj,j/rows)}for(i=0;i<cols;i++)for(j=0;j<2*(cols-i)-1;j++){var k=Math.floor(j/2);j%2==0?(pushVertex(v[i][k+1]),pushVertex(v[i+1][k]),pushVertex(v[i][k])):(pushVertex(v[i][k+1]),pushVertex(v[i+1][k+1]),pushVertex(v[i+1][k]))}}function pushVertex(vertex){vertexBuffer.push(vertex.x,vertex.y,vertex.z)}function getVertexByIndex(index,vertex){var stride=3*index;vertex.x=vertices[0+stride],vertex.y=vertices[1+stride],vertex.z=vertices[2+stride]}function correctUV(uv,stride,vector,azimuth){azimuth<0&&1===uv.x&&(uvBuffer[stride]=uv.x-1),0===vector.x&&0===vector.z&&(uvBuffer[stride]=azimuth/2/Math.PI+.5)}function azimuth(vector){return Math.atan2(vector.z,-vector.x)}!function(detail){for(var a=new Vector3,b=new Vector3,c=new Vector3,i=0;i<indices.length;i+=3)getVertexByIndex(indices[i+0],a),getVertexByIndex(indices[i+1],b),getVertexByIndex(indices[i+2],c),subdivideFace(a,b,c,detail)}(detail=detail||0),function(radius){for(var vertex=new Vector3,i=0;i<vertexBuffer.length;i+=3)vertex.x=vertexBuffer[i+0],vertex.y=vertexBuffer[i+1],vertex.z=vertexBuffer[i+2],vertex.normalize().multiplyScalar(radius),vertexBuffer[i+0]=vertex.x,vertexBuffer[i+1]=vertex.y,vertexBuffer[i+2]=vertex.z}(radius),function(){for(var vertex=new Vector3,i=0;i<vertexBuffer.length;i+=3){vertex.x=vertexBuffer[i+0],vertex.y=vertexBuffer[i+1],vertex.z=vertexBuffer[i+2];var u=azimuth(vertex)/2/Math.PI+.5,v=(vector=vertex,Math.atan2(-vector.y,Math.sqrt(vector.x*vector.x+vector.z*vector.z))/Math.PI+.5);uvBuffer.push(u,1-v)}var vector;(function(){for(var a=new Vector3,b=new Vector3,c=new Vector3,centroid=new Vector3,uvA=new Vector2,uvB=new Vector2,uvC=new Vector2,i=0,j=0;i<vertexBuffer.length;i+=9,j+=6){a.set(vertexBuffer[i+0],vertexBuffer[i+1],vertexBuffer[i+2]),b.set(vertexBuffer[i+3],vertexBuffer[i+4],vertexBuffer[i+5]),c.set(vertexBuffer[i+6],vertexBuffer[i+7],vertexBuffer[i+8]),uvA.set(uvBuffer[j+0],uvBuffer[j+1]),uvB.set(uvBuffer[j+2],uvBuffer[j+3]),uvC.set(uvBuffer[j+4],uvBuffer[j+5]),centroid.copy(a).add(b).add(c).divideScalar(3);var azi=azimuth(centroid);correctUV(uvA,j+0,a,azi),correctUV(uvB,j+2,b,azi),correctUV(uvC,j+4,c,azi)}})(),function(){for(var i=0;i<uvBuffer.length;i+=6){var x0=uvBuffer[i+0],x1=uvBuffer[i+2],x2=uvBuffer[i+4],max=Math.max(x0,x1,x2),min=Math.min(x0,x1,x2);.9<max&&min<.1&&(x0<.2&&(uvBuffer[i+0]+=1),x1<.2&&(uvBuffer[i+2]+=1),x2<.2&&(uvBuffer[i+4]+=1))}}()}(),this.addAttribute("position",new Float32BufferAttribute(vertexBuffer,3)),this.addAttribute("normal",new Float32BufferAttribute(vertexBuffer.slice(),3)),this.addAttribute("uv",new Float32BufferAttribute(uvBuffer,2)),this.normalizeNormals(),this.boundingSphere=new Sphere(new Vector3,radius)}function TetrahedronBufferGeometry(radius,detail){PolyhedronBufferGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],radius,detail),this.type="TetrahedronBufferGeometry",this.parameters={radius:radius,detail:detail}}function TetrahedronGeometry(radius,detail){Geometry.call(this),this.type="TetrahedronGeometry",this.parameters={radius:radius,detail:detail},this.fromBufferGeometry(new TetrahedronBufferGeometry(radius,detail)),this.mergeVertices()}function OctahedronBufferGeometry(radius,detail){PolyhedronBufferGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],radius,detail),this.type="OctahedronBufferGeometry",this.parameters={radius:radius,detail:detail}}function OctahedronGeometry(radius,detail){Geometry.call(this),this.type="OctahedronGeometry",this.parameters={radius:radius,detail:detail},this.fromBufferGeometry(new OctahedronBufferGeometry(radius,detail)),this.mergeVertices()}function IcosahedronBufferGeometry(radius,detail){var t=(1+Math.sqrt(5))/2;PolyhedronBufferGeometry.call(this,[-1,t,0,1,t,0,-1,-t,0,1,-t,0,0,-1,t,0,1,t,0,-1,-t,0,1,-t,t,0,-1,t,0,1,-t,0,-1,-t,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],radius,detail),this.type="IcosahedronBufferGeometry",this.parameters={radius:radius,detail:detail}}function IcosahedronGeometry(radius,detail){Geometry.call(this),this.type="IcosahedronGeometry",this.parameters={radius:radius,detail:detail},this.fromBufferGeometry(new IcosahedronBufferGeometry(radius,detail)),this.mergeVertices()}function DodecahedronBufferGeometry(radius,detail){var t=(1+Math.sqrt(5))/2,r=1/t;PolyhedronBufferGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-t,0,-r,t,0,r,-t,0,r,t,-r,-t,0,-r,t,0,r,-t,0,r,t,0,-t,0,-r,t,0,-r,-t,0,r,t,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],radius,detail),this.type="DodecahedronBufferGeometry",this.parameters={radius:radius,detail:detail}}function DodecahedronGeometry(radius,detail){Geometry.call(this),this.type="DodecahedronGeometry",this.parameters={radius:radius,detail:detail},this.fromBufferGeometry(new DodecahedronBufferGeometry(radius,detail)),this.mergeVertices()}function PolyhedronGeometry(vertices,indices,radius,detail){Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:vertices,indices:indices,radius:radius,detail:detail},this.fromBufferGeometry(new PolyhedronBufferGeometry(vertices,indices,radius,detail)),this.mergeVertices()}function TubeBufferGeometry(path,tubularSegments,radius,radialSegments,closed){BufferGeometry.call(this),this.type="TubeBufferGeometry",this.parameters={path:path,tubularSegments:tubularSegments,radius:radius,radialSegments:radialSegments,closed:closed},tubularSegments=tubularSegments||64,radius=radius||1,radialSegments=radialSegments||8,closed=closed||!1;var frames=path.computeFrenetFrames(tubularSegments,closed);this.tangents=frames.tangents,this.normals=frames.normals,this.binormals=frames.binormals;var i,j,vertex=new Vector3,normal=new Vector3,uv=new Vector2,vertices=[],normals=[],uvs=[],indices=[];function generateSegment(i){var P=path.getPointAt(i/tubularSegments),N=frames.normals[i],B=frames.binormals[i];for(j=0;j<=radialSegments;j++){var v=j/radialSegments*Math.PI*2,sin=Math.sin(v),cos=-Math.cos(v);normal.x=cos*N.x+sin*B.x,normal.y=cos*N.y+sin*B.y,normal.z=cos*N.z+sin*B.z,normal.normalize(),normals.push(normal.x,normal.y,normal.z),vertex.x=P.x+radius*normal.x,vertex.y=P.y+radius*normal.y,vertex.z=P.z+radius*normal.z,vertices.push(vertex.x,vertex.y,vertex.z)}}!function(){for(i=0;i<tubularSegments;i++)generateSegment(i);generateSegment(!1===closed?tubularSegments:0),function(){for(i=0;i<=tubularSegments;i++)for(j=0;j<=radialSegments;j++)uv.x=i/tubularSegments,uv.y=j/radialSegments,uvs.push(uv.x,uv.y)}(),function(){for(j=1;j<=tubularSegments;j++)for(i=1;i<=radialSegments;i++){var a=(radialSegments+1)*(j-1)+(i-1),b=(radialSegments+1)*j+(i-1),c=(radialSegments+1)*j+i,d=(radialSegments+1)*(j-1)+i;indices.push(a,b,d),indices.push(b,c,d)}}()}(),this.setIndex(new(65535<indices.length?Uint32BufferAttribute:Uint16BufferAttribute)(indices,1)),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("normal",new Float32BufferAttribute(normals,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}function TubeGeometry(path,tubularSegments,radius,radialSegments,closed,taper){Geometry.call(this),this.type="TubeGeometry",this.parameters={path:path,tubularSegments:tubularSegments,radius:radius,radialSegments:radialSegments,closed:closed},void 0!==taper&&console.warn("THREE.TubeGeometry: taper has been removed.");var bufferGeometry=new TubeBufferGeometry(path,tubularSegments,radius,radialSegments,closed);this.tangents=bufferGeometry.tangents,this.normals=bufferGeometry.normals,this.binormals=bufferGeometry.binormals,this.fromBufferGeometry(bufferGeometry),this.mergeVertices()}function TorusKnotBufferGeometry(radius,tube,tubularSegments,radialSegments,p,q){BufferGeometry.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:radius,tube:tube,tubularSegments:tubularSegments,radialSegments:radialSegments,p:p,q:q},radius=radius||100,tube=tube||40,tubularSegments=Math.floor(tubularSegments)||64,p=p||2,q=q||3;var i,j,vertexCount=((radialSegments=Math.floor(radialSegments)||8)+1)*(tubularSegments+1),indexCount=radialSegments*tubularSegments*2*3,indices=new BufferAttribute(new(65535<indexCount?Uint32Array:Uint16Array)(indexCount),1),vertices=new BufferAttribute(new Float32Array(3*vertexCount),3),normals=new BufferAttribute(new Float32Array(3*vertexCount),3),uvs=new BufferAttribute(new Float32Array(2*vertexCount),2),index=0,indexOffset=0,vertex=new Vector3,normal=new Vector3,uv=new Vector2,P1=new Vector3,P2=new Vector3,B=new Vector3,T=new Vector3,N=new Vector3;for(i=0;i<=tubularSegments;++i){var u=i/tubularSegments*p*Math.PI*2;for(calculatePositionOnCurve(u,p,q,radius,P1),calculatePositionOnCurve(.01+u,p,q,radius,P2),T.subVectors(P2,P1),N.addVectors(P2,P1),B.crossVectors(T,N),N.crossVectors(B,T),B.normalize(),N.normalize(),j=0;j<=radialSegments;++j){var v=j/radialSegments*Math.PI*2,cx=-tube*Math.cos(v),cy=tube*Math.sin(v);vertex.x=P1.x+(cx*N.x+cy*B.x),vertex.y=P1.y+(cx*N.y+cy*B.y),vertex.z=P1.z+(cx*N.z+cy*B.z),vertices.setXYZ(index,vertex.x,vertex.y,vertex.z),normal.subVectors(vertex,P1).normalize(),normals.setXYZ(index,normal.x,normal.y,normal.z),uv.x=i/tubularSegments,uv.y=j/radialSegments,uvs.setXY(index,uv.x,uv.y),index++}}for(j=1;j<=tubularSegments;j++)for(i=1;i<=radialSegments;i++){var a=(radialSegments+1)*(j-1)+(i-1),b=(radialSegments+1)*j+(i-1),c=(radialSegments+1)*j+i,d=(radialSegments+1)*(j-1)+i;indices.setX(indexOffset,a),indexOffset++,indices.setX(indexOffset,b),indexOffset++,indices.setX(indexOffset,d),indexOffset++,indices.setX(indexOffset,b),indexOffset++,indices.setX(indexOffset,c),indexOffset++,indices.setX(indexOffset,d),indexOffset++}function calculatePositionOnCurve(u,p,q,radius,position){var cu=Math.cos(u),su=Math.sin(u),quOverP=q/p*u,cs=Math.cos(quOverP);position.x=radius*(2+cs)*.5*cu,position.y=radius*(2+cs)*su*.5,position.z=radius*Math.sin(quOverP)*.5}this.setIndex(indices),this.addAttribute("position",vertices),this.addAttribute("normal",normals),this.addAttribute("uv",uvs)}function TorusKnotGeometry(radius,tube,tubularSegments,radialSegments,p,q,heightScale){Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:radius,tube:tube,tubularSegments:tubularSegments,radialSegments:radialSegments,p:p,q:q},void 0!==heightScale&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(radius,tube,tubularSegments,radialSegments,p,q)),this.mergeVertices()}function TorusBufferGeometry(radius,tube,radialSegments,tubularSegments,arc){BufferGeometry.call(this),this.type="TorusBufferGeometry",this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,arc:arc},radius=radius||100,tube=tube||40,radialSegments=Math.floor(radialSegments)||8,tubularSegments=Math.floor(tubularSegments)||6,arc=arc||2*Math.PI;var j,i,vertexCount=(radialSegments+1)*(tubularSegments+1),indexCount=radialSegments*tubularSegments*2*3,indices=new(65535<indexCount?Uint32Array:Uint16Array)(indexCount),vertices=new Float32Array(3*vertexCount),normals=new Float32Array(3*vertexCount),uvs=new Float32Array(2*vertexCount),vertexBufferOffset=0,uvBufferOffset=0,indexBufferOffset=0,center=new Vector3,vertex=new Vector3,normal=new Vector3;for(j=0;j<=radialSegments;j++)for(i=0;i<=tubularSegments;i++){var u=i/tubularSegments*arc,v=j/radialSegments*Math.PI*2;vertex.x=(radius+tube*Math.cos(v))*Math.cos(u),vertex.y=(radius+tube*Math.cos(v))*Math.sin(u),vertex.z=tube*Math.sin(v),vertices[vertexBufferOffset]=vertex.x,vertices[vertexBufferOffset+1]=vertex.y,vertices[vertexBufferOffset+2]=vertex.z,center.x=radius*Math.cos(u),center.y=radius*Math.sin(u),normal.subVectors(vertex,center).normalize(),normals[vertexBufferOffset]=normal.x,normals[vertexBufferOffset+1]=normal.y,normals[vertexBufferOffset+2]=normal.z,uvs[uvBufferOffset]=i/tubularSegments,uvs[uvBufferOffset+1]=j/radialSegments,vertexBufferOffset+=3,uvBufferOffset+=2}for(j=1;j<=radialSegments;j++)for(i=1;i<=tubularSegments;i++){var a=(tubularSegments+1)*j+i-1,b=(tubularSegments+1)*(j-1)+i-1,c=(tubularSegments+1)*(j-1)+i,d=(tubularSegments+1)*j+i;indices[indexBufferOffset]=a,indices[indexBufferOffset+1]=b,indices[indexBufferOffset+2]=d,indices[indexBufferOffset+3]=b,indices[indexBufferOffset+4]=c,indices[indexBufferOffset+5]=d,indexBufferOffset+=6}this.setIndex(new BufferAttribute(indices,1)),this.addAttribute("position",new BufferAttribute(vertices,3)),this.addAttribute("normal",new BufferAttribute(normals,3)),this.addAttribute("uv",new BufferAttribute(uvs,2))}function TorusGeometry(radius,tube,radialSegments,tubularSegments,arc){Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,arc:arc},this.fromBufferGeometry(new TorusBufferGeometry(radius,tube,radialSegments,tubularSegments,arc))}FogExp2.prototype.isFogExp2=!0,FogExp2.prototype.clone=function(){return new FogExp2(this.color.getHex(),this.density)},FogExp2.prototype.toJSON=function(meta){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Fog.prototype.isFog=!0,Fog.prototype.clone=function(){return new Fog(this.color.getHex(),this.near,this.far)},Fog.prototype.toJSON=function(meta){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},((Scene.prototype=Object.create(Object3D.prototype)).constructor=Scene).prototype.copy=function(source,recursive){return Object3D.prototype.copy.call(this,source,recursive),null!==source.background&&(this.background=source.background.clone()),null!==source.fog&&(this.fog=source.fog.clone()),null!==source.overrideMaterial&&(this.overrideMaterial=source.overrideMaterial.clone()),this.autoUpdate=source.autoUpdate,this.matrixAutoUpdate=source.matrixAutoUpdate,this},Scene.prototype.toJSON=function(meta){var data=Object3D.prototype.toJSON.call(this,meta);return null!==this.background&&(data.object.background=this.background.toJSON(meta)),null!==this.fog&&(data.object.fog=this.fog.toJSON()),data},LensFlare.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LensFlare,isLensFlare:!0,copy:function(source){Object3D.prototype.copy.call(this,source),this.positionScreen.copy(source.positionScreen),this.customUpdateCallback=source.customUpdateCallback;for(var i=0,l=source.lensFlares.length;i<l;i++)this.lensFlares.push(source.lensFlares[i]);return this},add:function(texture,size,distance,blending,color,opacity){void 0===size&&(size=-1),void 0===distance&&(distance=0),void 0===opacity&&(opacity=1),void 0===color&&(color=new Color(16777215)),void 0===blending&&(blending=NormalBlending),distance=Math.min(distance,Math.max(0,distance)),this.lensFlares.push({texture:texture,size:size,distance:distance,x:0,y:0,z:0,scale:1,rotation:0,opacity:opacity,color:color,blending:blending})},updateLensFlares:function(){var f,flare,fl=this.lensFlares.length,vecX=2*-this.positionScreen.x,vecY=2*-this.positionScreen.y;for(f=0;f<fl;f++)(flare=this.lensFlares[f]).x=this.positionScreen.x+vecX*flare.distance,flare.y=this.positionScreen.y+vecY*flare.distance,flare.wantedRotation=flare.x*Math.PI*.25,flare.rotation+=.25*(flare.wantedRotation-flare.rotation)}}),((SpriteMaterial.prototype=Object.create(Material.prototype)).constructor=SpriteMaterial).prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.rotation=source.rotation,this},Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:(matrixPosition=new Vector3,function(raycaster,intersects){matrixPosition.setFromMatrixPosition(this.matrixWorld);var distanceSq=raycaster.ray.distanceSqToPoint(matrixPosition);this.scale.x*this.scale.y/4<distanceSq||intersects.push({distance:Math.sqrt(distanceSq),point:this.position,face:null,object:this})}),clone:function(){return new this.constructor(this.material).copy(this)}}),LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,copy:function(source){Object3D.prototype.copy.call(this,source,!1);for(var levels=source.levels,i=0,l=levels.length;i<l;i++){var level=levels[i];this.addLevel(level.object.clone(),level.distance)}return this},addLevel:function(object,distance){void 0===distance&&(distance=0),distance=Math.abs(distance);for(var levels=this.levels,l=0;l<levels.length&&!(distance<levels[l].distance);l++);levels.splice(l,0,{distance:distance,object:object}),this.add(object)},getObjectForDistance:function(distance){for(var levels=this.levels,i=1,l=levels.length;i<l&&!(distance<levels[i].distance);i++);return levels[i-1].object},raycast:function(){var matrixPosition=new Vector3;return function(raycaster,intersects){matrixPosition.setFromMatrixPosition(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(matrixPosition);this.getObjectForDistance(distance).raycast(raycaster,intersects)}}(),update:function(){var v1=new Vector3,v2=new Vector3;return function(camera){var levels=this.levels;if(1<levels.length){v1.setFromMatrixPosition(camera.matrixWorld),v2.setFromMatrixPosition(this.matrixWorld);var distance=v1.distanceTo(v2);levels[0].object.visible=!0;for(var i=1,l=levels.length;i<l&&distance>=levels[i].distance;i++)levels[i-1].object.visible=!1,levels[i].object.visible=!0;for(;i<l;i++)levels[i].object.visible=!1}}}(),toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);data.object.levels=[];for(var levels=this.levels,i=0,l=levels.length;i<l;i++){var level=levels[i];data.object.levels.push({object:level.object.uuid,distance:level.distance})}return data}}),Object.assign(Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var b=0,bl=this.bones.length;b<bl;b++){var inverse=new Matrix4;this.bones[b]&&inverse.getInverse(this.bones[b].matrixWorld),this.boneInverses.push(inverse)}},pose:function(){for(var bone,b=0,bl=this.bones.length;b<bl;b++)(bone=this.bones[b])&&bone.matrixWorld.getInverse(this.boneInverses[b]);for(b=0,bl=this.bones.length;b<bl;b++)(bone=this.bones[b])&&(bone.parent&&bone.parent.isBone?(bone.matrix.getInverse(bone.parent.matrixWorld),bone.matrix.multiply(bone.matrixWorld)):bone.matrix.copy(bone.matrixWorld),bone.matrix.decompose(bone.position,bone.quaternion,bone.scale))},update:(offsetMatrix=new Matrix4,function(){for(var b=0,bl=this.bones.length;b<bl;b++){var matrix=this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix;offsetMatrix.multiplyMatrices(matrix,this.boneInverses[b]),offsetMatrix.toArray(this.boneMatrices,16*b)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}),clone:function(){return new Skeleton(this.bones,this.boneInverses,this.useVertexTexture)}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0}),SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,bind:function(skeleton,bindMatrix){this.skeleton=skeleton,void 0===bindMatrix&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),bindMatrix=this.matrixWorld),this.bindMatrix.copy(bindMatrix),this.bindMatrixInverse.getInverse(bindMatrix)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&this.geometry.isGeometry)for(var i=0;i<this.geometry.skinWeights.length;i++){var sw=this.geometry.skinWeights[i];(scale=1/sw.lengthManhattan())!==1/0?sw.multiplyScalar(scale):sw.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var vec=new Vector4,skinWeight=this.geometry.attributes.skinWeight;for(i=0;i<skinWeight.count;i++){var scale;vec.x=skinWeight.getX(i),vec.y=skinWeight.getY(i),vec.z=skinWeight.getZ(i),vec.w=skinWeight.getW(i),(scale=1/vec.lengthManhattan())!==1/0?vec.multiplyScalar(scale):vec.set(1,0,0,0),skinWeight.setXYZW(i,vec.x,vec.y,vec.z,vec.w)}}},updateMatrixWorld:function(force){Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture).copy(this)}}),((LineBasicMaterial.prototype=Object.create(Material.prototype)).constructor=LineBasicMaterial).prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.linewidth=source.linewidth,this.linecap=source.linecap,this.linejoin=source.linejoin,this},Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,raycast:function(){var inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere;return function(raycaster,intersects){var precision=raycaster.linePrecision,precisionSq=precision*precision,geometry=this.geometry,matrixWorld=this.matrixWorld;if(null===geometry.boundingSphere&&geometry.computeBoundingSphere(),sphere.copy(geometry.boundingSphere),sphere.applyMatrix4(matrixWorld),!1!==raycaster.ray.intersectsSphere(sphere)){inverseMatrix.getInverse(matrixWorld),ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);var vStart=new Vector3,vEnd=new Vector3,interSegment=new Vector3,interRay=new Vector3,step=this&&this.isLineSegments?2:1;if(geometry.isBufferGeometry){var index=geometry.index,positions=geometry.attributes.position.array;if(null!==index)for(var indices=index.array,i=0,l=indices.length-1;i<l;i+=step){var a=indices[i],b=indices[i+1];if(vStart.fromArray(positions,3*a),vEnd.fromArray(positions,3*b),!(precisionSq<ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment)))interRay.applyMatrix4(this.matrixWorld),(distance=raycaster.ray.origin.distanceTo(interRay))<raycaster.near||distance>raycaster.far||intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}else for(i=0,l=positions.length/3-1;i<l;i+=step){if(vStart.fromArray(positions,3*i),vEnd.fromArray(positions,3*i+3),!(precisionSq<ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment)))interRay.applyMatrix4(this.matrixWorld),(distance=raycaster.ray.origin.distanceTo(interRay))<raycaster.near||distance>raycaster.far||intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else if(geometry.isGeometry){var vertices=geometry.vertices,nbVertices=vertices.length;for(i=0;i<nbVertices-1;i+=step){var distance;if(!(precisionSq<ray.distanceSqToSegment(vertices[i],vertices[i+1],interRay,interSegment)))interRay.applyMatrix4(this.matrixWorld),(distance=raycaster.ray.origin.distanceTo(interRay))<raycaster.near||distance>raycaster.far||intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0}),((PointsMaterial.prototype=Object.create(Material.prototype)).constructor=PointsMaterial).prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.size=source.size,this.sizeAttenuation=source.sizeAttenuation,this},Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,raycast:function(){var inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere;return function(raycaster,intersects){var object=this,geometry=this.geometry,matrixWorld=this.matrixWorld,threshold=raycaster.params.Points.threshold;if(null===geometry.boundingSphere&&geometry.computeBoundingSphere(),sphere.copy(geometry.boundingSphere),sphere.applyMatrix4(matrixWorld),!1!==raycaster.ray.intersectsSphere(sphere)){inverseMatrix.getInverse(matrixWorld),ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);var localThreshold=threshold/((this.scale.x+this.scale.y+this.scale.z)/3),localThresholdSq=localThreshold*localThreshold,position=new Vector3;if(geometry.isBufferGeometry){var index=geometry.index,positions=geometry.attributes.position.array;if(null!==index)for(var indices=index.array,i=0,il=indices.length;i<il;i++){var a=indices[i];position.fromArray(positions,3*a),testPoint(position,a)}else{i=0;for(var l=positions.length/3;i<l;i++)position.fromArray(positions,3*i),testPoint(position,i)}}else{var vertices=geometry.vertices;for(i=0,l=vertices.length;i<l;i++)testPoint(vertices[i],i)}}function testPoint(point,index){var rayPointDistanceSq=ray.distanceSqToPoint(point);if(rayPointDistanceSq<localThresholdSq){var intersectPoint=ray.closestPointToPoint(point);intersectPoint.applyMatrix4(matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectPoint);if(distance<raycaster.near||distance>raycaster.far)return;intersects.push({distance:distance,distanceToRay:Math.sqrt(rayPointDistanceSq),point:intersectPoint.clone(),index:index,face:null,object:object})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group}),(VideoTexture.prototype=Object.create(Texture.prototype)).constructor=VideoTexture,((CompressedTexture.prototype=Object.create(Texture.prototype)).constructor=CompressedTexture).prototype.isCompressedTexture=!0,(CanvasTexture.prototype=Object.create(Texture.prototype)).constructor=CanvasTexture,((DepthTexture.prototype=Object.create(Texture.prototype)).constructor=DepthTexture).prototype.isDepthTexture=!0,(WireframeGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=WireframeGeometry,(ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=ParametricBufferGeometry,(ParametricGeometry.prototype=Object.create(Geometry.prototype)).constructor=ParametricGeometry,(PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=PolyhedronBufferGeometry,(TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype)).constructor=TetrahedronBufferGeometry,(TetrahedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=TetrahedronGeometry,(OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype)).constructor=OctahedronBufferGeometry,(OctahedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=OctahedronGeometry,(IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype)).constructor=IcosahedronBufferGeometry,(IcosahedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=IcosahedronGeometry,(DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype)).constructor=DodecahedronBufferGeometry,(DodecahedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=DodecahedronGeometry,(PolyhedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=PolyhedronGeometry,(TubeBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=TubeBufferGeometry,(TubeGeometry.prototype=Object.create(Geometry.prototype)).constructor=TubeGeometry,(TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=TorusKnotBufferGeometry,(TorusKnotGeometry.prototype=Object.create(Geometry.prototype)).constructor=TorusKnotGeometry,(TorusBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=TorusBufferGeometry,(TorusGeometry.prototype=Object.create(Geometry.prototype)).constructor=TorusGeometry;var ShapeUtils={area:function(contour){for(var n=contour.length,a=0,p=n-1,q=0;q<n;p=q++)a+=contour[p].x*contour[q].y-contour[q].x*contour[p].y;return.5*a},triangulate:function(contour,indices){var n=contour.length;if(n<3)return null;var u,v,w,result=[],verts=[],vertIndices=[];if(0<ShapeUtils.area(contour))for(v=0;v<n;v++)verts[v]=v;else for(v=0;v<n;v++)verts[v]=n-1-v;var nv=n,count=2*nv;for(v=nv-1;2<nv;){if(count--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),indices?vertIndices:result;if(nv<=(u=v)&&(u=0),nv<=(v=u+1)&&(v=0),nv<=(w=v+1)&&(w=0),snip(contour,u,v,w,nv,verts)){var a,b,c,s,t;for(a=verts[u],b=verts[v],c=verts[w],result.push([contour[a],contour[b],contour[c]]),vertIndices.push([verts[u],verts[v],verts[w]]),t=(s=v)+1;t<nv;s++,t++)verts[s]=verts[t];count=2*--nv}}return indices?vertIndices:result},triangulateShape:function(contour,holes){function removeDupEndPts(points){var l=points.length;2<l&&points[l-1].equals(points[0])&&points.pop()}function point_in_segment_2D_colin(inSegPt1,inSegPt2,inOtherPt){return inSegPt1.x!==inSegPt2.x?inSegPt1.x<inSegPt2.x?inSegPt1.x<=inOtherPt.x&&inOtherPt.x<=inSegPt2.x:inSegPt2.x<=inOtherPt.x&&inOtherPt.x<=inSegPt1.x:inSegPt1.y<inSegPt2.y?inSegPt1.y<=inOtherPt.y&&inOtherPt.y<=inSegPt2.y:inSegPt2.y<=inOtherPt.y&&inOtherPt.y<=inSegPt1.y}function intersect_segments_2D(inSeg1Pt1,inSeg1Pt2,inSeg2Pt1,inSeg2Pt2,inExcludeAdjacentSegs){var seg1dx=inSeg1Pt2.x-inSeg1Pt1.x,seg1dy=inSeg1Pt2.y-inSeg1Pt1.y,seg2dx=inSeg2Pt2.x-inSeg2Pt1.x,seg2dy=inSeg2Pt2.y-inSeg2Pt1.y,seg1seg2dx=inSeg1Pt1.x-inSeg2Pt1.x,seg1seg2dy=inSeg1Pt1.y-inSeg2Pt1.y,limit=seg1dy*seg2dx-seg1dx*seg2dy,perpSeg1=seg1dy*seg1seg2dx-seg1dx*seg1seg2dy;if(Math.abs(limit)>Number.EPSILON){var perpSeg2;if(0<limit){if(perpSeg1<0||limit<perpSeg1)return[];if((perpSeg2=seg2dy*seg1seg2dx-seg2dx*seg1seg2dy)<0||limit<perpSeg2)return[]}else{if(0<perpSeg1||perpSeg1<limit)return[];if(0<(perpSeg2=seg2dy*seg1seg2dx-seg2dx*seg1seg2dy)||perpSeg2<limit)return[]}if(0===perpSeg2)return!inExcludeAdjacentSegs||0!=perpSeg1&&perpSeg1!=limit?[inSeg1Pt1]:[];if(perpSeg2===limit)return!inExcludeAdjacentSegs||0!=perpSeg1&&perpSeg1!=limit?[inSeg1Pt2]:[];if(0==perpSeg1)return[inSeg2Pt1];if(perpSeg1==limit)return[inSeg2Pt2];var factorSeg1=perpSeg2/limit;return[{x:inSeg1Pt1.x+factorSeg1*seg1dx,y:inSeg1Pt1.y+factorSeg1*seg1dy}]}if(0!=perpSeg1||seg2dy*seg1seg2dx!=seg2dx*seg1seg2dy)return[];var seg1min,seg1max,seg1minVal,seg1maxVal,seg2min,seg2max,seg2minVal,seg2maxVal,seg1Pt=0==seg1dx&&0==seg1dy,seg2Pt=0==seg2dx&&0==seg2dy;return seg1Pt&&seg2Pt?inSeg1Pt1.x!==inSeg2Pt1.x||inSeg1Pt1.y!==inSeg2Pt1.y?[]:[inSeg1Pt1]:seg1Pt?point_in_segment_2D_colin(inSeg2Pt1,inSeg2Pt2,inSeg1Pt1)?[inSeg1Pt1]:[]:seg2Pt?point_in_segment_2D_colin(inSeg1Pt1,inSeg1Pt2,inSeg2Pt1)?[inSeg2Pt1]:[]:(seg2maxVal=0!=seg1dx?(seg1maxVal=inSeg1Pt1.x<inSeg1Pt2.x?(seg1minVal=(seg1min=inSeg1Pt1).x,(seg1max=inSeg1Pt2).x):(seg1minVal=(seg1min=inSeg1Pt2).x,(seg1max=inSeg1Pt1).x),inSeg2Pt1.x<inSeg2Pt2.x?(seg2minVal=(seg2min=inSeg2Pt1).x,(seg2max=inSeg2Pt2).x):(seg2minVal=(seg2min=inSeg2Pt2).x,(seg2max=inSeg2Pt1).x)):(seg1maxVal=inSeg1Pt1.y<inSeg1Pt2.y?(seg1minVal=(seg1min=inSeg1Pt1).y,(seg1max=inSeg1Pt2).y):(seg1minVal=(seg1min=inSeg1Pt2).y,(seg1max=inSeg1Pt1).y),inSeg2Pt1.y<inSeg2Pt2.y?(seg2minVal=(seg2min=inSeg2Pt1).y,(seg2max=inSeg2Pt2).y):(seg2minVal=(seg2min=inSeg2Pt2).y,(seg2max=inSeg2Pt1).y)),seg1minVal<=seg2minVal?seg1maxVal<seg2minVal?[]:seg1maxVal===seg2minVal?inExcludeAdjacentSegs?[]:[seg2min]:seg1maxVal<=seg2maxVal?[seg2min,seg1max]:[seg2min,seg2max]:seg2maxVal<seg1minVal?[]:seg1minVal===seg2maxVal?inExcludeAdjacentSegs?[]:[seg1min]:seg1maxVal<=seg2maxVal?[seg1min,seg1max]:[seg1min,seg2max])}function isPointInsideAngle(inVertex,inLegFromPt,inLegToPt,inOtherPt){var legFromPtX=inLegFromPt.x-inVertex.x,legFromPtY=inLegFromPt.y-inVertex.y,legToPtX=inLegToPt.x-inVertex.x,legToPtY=inLegToPt.y-inVertex.y,otherPtX=inOtherPt.x-inVertex.x,otherPtY=inOtherPt.y-inVertex.y,from2toAngle=legFromPtX*legToPtY-legFromPtY*legToPtX,from2otherAngle=legFromPtX*otherPtY-legFromPtY*otherPtX;if(Math.abs(from2toAngle)>Number.EPSILON){var other2toAngle=otherPtX*legToPtY-otherPtY*legToPtX;return 0<from2toAngle?0<=from2otherAngle&&0<=other2toAngle:0<=from2otherAngle||0<=other2toAngle}return 0<from2otherAngle}removeDupEndPts(contour),holes.forEach(removeDupEndPts);for(var i,il,f,face,key,index,allPointsMap={},allpoints=contour.concat(),h=0,hl=holes.length;h<hl;h++)Array.prototype.push.apply(allpoints,holes[h]);for(i=0,il=allpoints.length;i<il;i++)void 0!==allPointsMap[key=allpoints[i].x+":"+allpoints[i].y]&&console.warn("THREE.ShapeUtils: Duplicate point",key,i),allPointsMap[key]=i;var shapeWithoutHoles=function(contour,holes){var hole,shape=contour.concat();function isCutLineInsideAngles(inShapeIdx,inHoleIdx){var lastShapeIdx=shape.length-1,prevShapeIdx=inShapeIdx-1;prevShapeIdx<0&&(prevShapeIdx=lastShapeIdx);var nextShapeIdx=inShapeIdx+1;lastShapeIdx<nextShapeIdx&&(nextShapeIdx=0);var insideAngle=isPointInsideAngle(shape[inShapeIdx],shape[prevShapeIdx],shape[nextShapeIdx],hole[inHoleIdx]);if(!insideAngle)return!1;var lastHoleIdx=hole.length-1,prevHoleIdx=inHoleIdx-1;prevHoleIdx<0&&(prevHoleIdx=lastHoleIdx);var nextHoleIdx=inHoleIdx+1;return lastHoleIdx<nextHoleIdx&&(nextHoleIdx=0),!!(insideAngle=isPointInsideAngle(hole[inHoleIdx],hole[prevHoleIdx],hole[nextHoleIdx],shape[inShapeIdx]))}function intersectsShapeEdge(inShapePt,inHolePt){var sIdx,nextIdx;for(sIdx=0;sIdx<shape.length;sIdx++)if(nextIdx=sIdx+1,nextIdx%=shape.length,0<intersect_segments_2D(inShapePt,inHolePt,shape[sIdx],shape[nextIdx],!0).length)return!0;return!1}var indepHoles=[];function intersectsHoleEdge(inShapePt,inHolePt){var ihIdx,chkHole,hIdx,nextIdx;for(ihIdx=0;ihIdx<indepHoles.length;ihIdx++)for(chkHole=holes[indepHoles[ihIdx]],hIdx=0;hIdx<chkHole.length;hIdx++)if(nextIdx=hIdx+1,nextIdx%=chkHole.length,0<intersect_segments_2D(inShapePt,inHolePt,chkHole[hIdx],chkHole[nextIdx],!0).length)return!0;return!1}for(var holeIndex,shapeIndex,shapePt,holePt,holeIdx,cutKey,tmpShape1,tmpShape2,tmpHole1,tmpHole2,failedCuts=[],h=0,hl=holes.length;h<hl;h++)indepHoles.push(h);for(var minShapeIndex=0,counter=2*indepHoles.length;0<indepHoles.length;){if(--counter<0){console.log("Infinite Loop! Holes left:"+indepHoles.length+", Probably Hole outside Shape!");break}for(shapeIndex=minShapeIndex;shapeIndex<shape.length;shapeIndex++){shapePt=shape[shapeIndex],holeIndex=-1;for(h=0;h<indepHoles.length;h++)if(holeIdx=indepHoles[h],void 0===failedCuts[cutKey=shapePt.x+":"+shapePt.y+":"+holeIdx]){hole=holes[holeIdx];for(var h2=0;h2<hole.length;h2++)if(holePt=hole[h2],isCutLineInsideAngles(shapeIndex,h2)&&!intersectsShapeEdge(shapePt,holePt)&&!intersectsHoleEdge(shapePt,holePt)){holeIndex=h2,indepHoles.splice(h,1),tmpShape1=shape.slice(0,shapeIndex+1),tmpShape2=shape.slice(shapeIndex),tmpHole1=hole.slice(holeIndex),tmpHole2=hole.slice(0,holeIndex+1),shape=tmpShape1.concat(tmpHole1).concat(tmpHole2).concat(tmpShape2),minShapeIndex=shapeIndex;break}if(0<=holeIndex)break;failedCuts[cutKey]=!0}if(0<=holeIndex)break}}return shape}(contour,holes),triangles=ShapeUtils.triangulate(shapeWithoutHoles,!1);for(i=0,il=triangles.length;i<il;i++)for(face=triangles[i],f=0;f<3;f++)void 0!==(index=allPointsMap[key=face[f].x+":"+face[f].y])&&(face[f]=index);return triangles.concat()},isClockWise:function(pts){return ShapeUtils.area(pts)<0},b2:function(t,p0,p1,p2){return function(t,p){var k=1-t;return k*k*p}(t,p0)+function(t,p){return 2*(1-t)*t*p}(t,p1)+function(t,p){return t*t*p}(t,p2)},b3:function(t,p0,p1,p2,p3){return function(t,p){var k=1-t;return k*k*k*p}(t,p0)+function(t,p){var k=1-t;return 3*k*k*t*p}(t,p1)+function(t,p){return 3*(1-t)*t*t*p}(t,p2)+function(t,p){return t*t*t*p}(t,p3)}};function snip(contour,u,v,w,n,verts){var p,ax,ay,bx,by,cx,cy,px,py,aX,aY,bX,bY,cX,cY,cCROSSap,bCROSScp;if(ax=contour[verts[u]].x,ay=contour[verts[u]].y,bx=contour[verts[v]].x,by=contour[verts[v]].y,cx=contour[verts[w]].x,(bx-ax)*((cy=contour[verts[w]].y)-ay)-(by-ay)*(cx-ax)<=0)return!1;for(aX=cx-bx,aY=cy-by,bX=ax-cx,bY=ay-cy,cX=bx-ax,cY=by-ay,p=0;p<n;p++)if(px=contour[verts[p]].x,py=contour[verts[p]].y,!(px===ax&&py===ay||px===bx&&py===by||px===cx&&py===cy)&&(cCROSSap=cX*(py-ay)-cY*(px-ax),bCROSScp=bX*(py-cy)-bY*(px-cx),aX*(py-by)-aY*(px-bx)>=-Number.EPSILON&&bCROSScp>=-Number.EPSILON&&cCROSSap>=-Number.EPSILON))return!1;return!0}function ExtrudeGeometry(shapes,options){void 0!==shapes?(Geometry.call(this),this.type="ExtrudeGeometry",shapes=Array.isArray(shapes)?shapes:[shapes],this.addShapeList(shapes,options),this.computeFaceNormals()):shapes=[]}function TextGeometry(text,parameters){var font=(parameters=parameters||{}).font;if(!1===(font&&font.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Geometry;var shapes=font.generateShapes(text,parameters.size,parameters.curveSegments);parameters.amount=void 0!==parameters.height?parameters.height:50,void 0===parameters.bevelThickness&&(parameters.bevelThickness=10),void 0===parameters.bevelSize&&(parameters.bevelSize=8),void 0===parameters.bevelEnabled&&(parameters.bevelEnabled=!1),ExtrudeGeometry.call(this,shapes,parameters),this.type="TextGeometry"}function SphereBufferGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:radius,widthSegments:widthSegments,heightSegments:heightSegments,phiStart:phiStart,phiLength:phiLength,thetaStart:thetaStart,thetaLength:thetaLength},radius=radius||50,widthSegments=Math.max(3,Math.floor(widthSegments)||8),heightSegments=Math.max(2,Math.floor(heightSegments)||6),phiStart=void 0!==phiStart?phiStart:0,phiLength=void 0!==phiLength?phiLength:2*Math.PI;for(var thetaEnd=(thetaStart=void 0!==thetaStart?thetaStart:0)+(thetaLength=void 0!==thetaLength?thetaLength:Math.PI),vertexCount=(widthSegments+1)*(heightSegments+1),positions=new BufferAttribute(new Float32Array(3*vertexCount),3),normals=new BufferAttribute(new Float32Array(3*vertexCount),3),uvs=new BufferAttribute(new Float32Array(2*vertexCount),2),index=0,vertices=[],normal=new Vector3,y=0;y<=heightSegments;y++){for(var verticesRow=[],v=y/heightSegments,x=0;x<=widthSegments;x++){var u=x/widthSegments,px=-radius*Math.cos(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength),py=radius*Math.cos(thetaStart+v*thetaLength),pz=radius*Math.sin(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);normal.set(px,py,pz).normalize(),positions.setXYZ(index,px,py,pz),normals.setXYZ(index,normal.x,normal.y,normal.z),uvs.setXY(index,u,1-v),verticesRow.push(index),index++}vertices.push(verticesRow)}var indices=[];for(y=0;y<heightSegments;y++)for(x=0;x<widthSegments;x++){var v1=vertices[y][x+1],v2=vertices[y][x],v3=vertices[y+1][x],v4=vertices[y+1][x+1];(0!==y||0<thetaStart)&&indices.push(v1,v2,v4),(y!==heightSegments-1||thetaEnd<Math.PI)&&indices.push(v2,v3,v4)}this.setIndex(new(65535<positions.count?Uint32BufferAttribute:Uint16BufferAttribute)(indices,1)),this.addAttribute("position",positions),this.addAttribute("normal",normals),this.addAttribute("uv",uvs),this.boundingSphere=new Sphere(new Vector3,radius)}function SphereGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:radius,widthSegments:widthSegments,heightSegments:heightSegments,phiStart:phiStart,phiLength:phiLength,thetaStart:thetaStart,thetaLength:thetaLength},this.fromBufferGeometry(new SphereBufferGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength))}function RingBufferGeometry(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength){BufferGeometry.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:innerRadius,outerRadius:outerRadius,thetaSegments:thetaSegments,phiSegments:phiSegments,thetaStart:thetaStart,thetaLength:thetaLength},innerRadius=innerRadius||20,outerRadius=outerRadius||50,thetaStart=void 0!==thetaStart?thetaStart:0,thetaLength=void 0!==thetaLength?thetaLength:2*Math.PI;var segment,j,i,vertexCount=((thetaSegments=void 0!==thetaSegments?Math.max(3,thetaSegments):8)+1)*((phiSegments=void 0!==phiSegments?Math.max(1,phiSegments):1)+1),indexCount=thetaSegments*phiSegments*2*3,indices=new BufferAttribute(new(65535<indexCount?Uint32Array:Uint16Array)(indexCount),1),vertices=new BufferAttribute(new Float32Array(3*vertexCount),3),normals=new BufferAttribute(new Float32Array(3*vertexCount),3),uvs=new BufferAttribute(new Float32Array(2*vertexCount),2),index=0,indexOffset=0,radius=innerRadius,radiusStep=(outerRadius-innerRadius)/phiSegments,vertex=new Vector3,uv=new Vector2;for(j=0;j<=phiSegments;j++){for(i=0;i<=thetaSegments;i++)segment=thetaStart+i/thetaSegments*thetaLength,vertex.x=radius*Math.cos(segment),vertex.y=radius*Math.sin(segment),vertices.setXYZ(index,vertex.x,vertex.y,vertex.z),normals.setXYZ(index,0,0,1),uv.x=(vertex.x/outerRadius+1)/2,uv.y=(vertex.y/outerRadius+1)/2,uvs.setXY(index,uv.x,uv.y),index++;radius+=radiusStep}for(j=0;j<phiSegments;j++){var thetaSegmentLevel=j*(thetaSegments+1);for(i=0;i<thetaSegments;i++){var a=segment=i+thetaSegmentLevel,b=segment+thetaSegments+1,c=segment+thetaSegments+2,d=segment+1;indices.setX(indexOffset,a),indexOffset++,indices.setX(indexOffset,b),indexOffset++,indices.setX(indexOffset,c),indexOffset++,indices.setX(indexOffset,a),indexOffset++,indices.setX(indexOffset,c),indexOffset++,indices.setX(indexOffset,d),indexOffset++}}this.setIndex(indices),this.addAttribute("position",vertices),this.addAttribute("normal",normals),this.addAttribute("uv",uvs)}function RingGeometry(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength){Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:innerRadius,outerRadius:outerRadius,thetaSegments:thetaSegments,phiSegments:phiSegments,thetaStart:thetaStart,thetaLength:thetaLength},this.fromBufferGeometry(new RingBufferGeometry(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength))}function PlaneGeometry(width,height,widthSegments,heightSegments){Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments},this.fromBufferGeometry(new PlaneBufferGeometry(width,height,widthSegments,heightSegments))}function LatheBufferGeometry(points,segments,phiStart,phiLength){BufferGeometry.call(this),this.type="LatheBufferGeometry",this.parameters={points:points,segments:segments,phiStart:phiStart,phiLength:phiLength},segments=Math.floor(segments)||12,phiStart=phiStart||0,phiLength=phiLength||2*Math.PI,phiLength=_Math.clamp(phiLength,0,2*Math.PI);var base,i,j,vertexCount=(segments+1)*points.length,indexCount=segments*points.length*2*3,indices=new BufferAttribute(new(65535<indexCount?Uint32Array:Uint16Array)(indexCount),1),vertices=new BufferAttribute(new Float32Array(3*vertexCount),3),uvs=new BufferAttribute(new Float32Array(2*vertexCount),2),index=0,indexOffset=0,inverseSegments=1/segments,vertex=new Vector3,uv=new Vector2;for(i=0;i<=segments;i++){var phi=phiStart+i*inverseSegments*phiLength,sin=Math.sin(phi),cos=Math.cos(phi);for(j=0;j<=points.length-1;j++)vertex.x=points[j].x*sin,vertex.y=points[j].y,vertex.z=points[j].x*cos,vertices.setXYZ(index,vertex.x,vertex.y,vertex.z),uv.x=i/segments,uv.y=j/(points.length-1),uvs.setXY(index,uv.x,uv.y),index++}for(i=0;i<segments;i++)for(j=0;j<points.length-1;j++){var a=base=j+i*points.length,b=base+points.length,c=base+points.length+1,d=base+1;indices.setX(indexOffset,a),indexOffset++,indices.setX(indexOffset,b),indexOffset++,indices.setX(indexOffset,d),indexOffset++,indices.setX(indexOffset,b),indexOffset++,indices.setX(indexOffset,c),indexOffset++,indices.setX(indexOffset,d),indexOffset++}if(this.setIndex(indices),this.addAttribute("position",vertices),this.addAttribute("uv",uvs),this.computeVertexNormals(),phiLength===2*Math.PI){var normals=this.attributes.normal.array,n1=new Vector3,n2=new Vector3,n=new Vector3;for(base=segments*points.length*3,j=i=0;i<points.length;i++,j+=3)n1.x=normals[j+0],n1.y=normals[j+1],n1.z=normals[j+2],n2.x=normals[base+j+0],n2.y=normals[base+j+1],n2.z=normals[base+j+2],n.addVectors(n1,n2).normalize(),normals[j+0]=normals[base+j+0]=n.x,normals[j+1]=normals[base+j+1]=n.y,normals[j+2]=normals[base+j+2]=n.z}}function LatheGeometry(points,segments,phiStart,phiLength){Geometry.call(this),this.type="LatheGeometry",this.parameters={points:points,segments:segments,phiStart:phiStart,phiLength:phiLength},this.fromBufferGeometry(new LatheBufferGeometry(points,segments,phiStart,phiLength)),this.mergeVertices()}function ShapeBufferGeometry(shapes,curveSegments){BufferGeometry.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:shapes,curveSegments:curveSegments},curveSegments=curveSegments||12;var vertices=[],normals=[],uvs=[],indices=[],groupStart=0,groupCount=0;if(!1===Array.isArray(shapes))addShape(shapes);else for(var i=0;i<shapes.length;i++)addShape(shapes[i]),this.addGroup(groupStart,groupCount,i),groupStart+=groupCount,groupCount=0;function addShape(shape){var i,l,shapeHole,indexOffset=vertices.length/3,points=shape.extractPoints(curveSegments),shapeVertices=points.shape,shapeHoles=points.holes;if(!1===ShapeUtils.isClockWise(shapeVertices))for(shapeVertices=shapeVertices.reverse(),i=0,l=shapeHoles.length;i<l;i++)shapeHole=shapeHoles[i],!0===ShapeUtils.isClockWise(shapeHole)&&(shapeHoles[i]=shapeHole.reverse());var faces=ShapeUtils.triangulateShape(shapeVertices,shapeHoles);for(i=0,l=shapeHoles.length;i<l;i++)shapeHole=shapeHoles[i],shapeVertices=shapeVertices.concat(shapeHole);for(i=0,l=shapeVertices.length;i<l;i++){var vertex=shapeVertices[i];vertices.push(vertex.x,vertex.y,0),normals.push(0,0,1),uvs.push(vertex.x,vertex.y)}for(i=0,l=faces.length;i<l;i++){var face=faces[i],a=face[0]+indexOffset,b=face[1]+indexOffset,c=face[2]+indexOffset;indices.push(a,b,c),groupCount+=3}}this.setIndex(new(65535<indices.length?Uint32BufferAttribute:Uint16BufferAttribute)(indices,1)),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("normal",new Float32BufferAttribute(normals,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}function ShapeGeometry(shapes,curveSegments){Geometry.call(this),this.type="ShapeGeometry","object"==typeof curveSegments&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),curveSegments=curveSegments.curveSegments),this.parameters={shapes:shapes,curveSegments:curveSegments},this.fromBufferGeometry(new ShapeBufferGeometry(shapes,curveSegments)),this.mergeVertices()}function EdgesGeometry(geometry,thresholdAngle){BufferGeometry.call(this),thresholdAngle=void 0!==thresholdAngle?thresholdAngle:1;var thresholdDot=Math.cos(_Math.DEG2RAD*thresholdAngle),edge=[0,0],hash={};function sortFunction(a,b){return a-b}var geometry2,keys=["a","b","c"];geometry.isBufferGeometry?(geometry2=new Geometry).fromBufferGeometry(geometry):geometry2=geometry.clone(),geometry2.mergeVertices(),geometry2.computeFaceNormals();for(var vertices=geometry2.vertices,faces=geometry2.faces,i=0,l=faces.length;i<l;i++)for(var face=faces[i],j=0;j<3;j++){edge[0]=face[keys[j]],edge[1]=face[keys[(j+1)%3]],edge.sort(sortFunction),void 0===hash[key=edge.toString()]?hash[key]={vert1:edge[0],vert2:edge[1],face1:i,face2:void 0}:hash[key].face2=i}var coords=[];for(var key in hash){var h=hash[key];if(void 0===h.face2||faces[h.face1].normal.dot(faces[h.face2].normal)<=thresholdDot){var vertex=vertices[h.vert1];coords.push(vertex.x),coords.push(vertex.y),coords.push(vertex.z),vertex=vertices[h.vert2],coords.push(vertex.x),coords.push(vertex.y),coords.push(vertex.z)}}this.addAttribute("position",new Float32BufferAttribute(coords,3))}function CylinderBufferGeometry(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:radiusTop,radiusBottom:radiusBottom,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength};var scope=this;radiusTop=void 0!==radiusTop?radiusTop:20,radiusBottom=void 0!==radiusBottom?radiusBottom:20,height=void 0!==height?height:100,radialSegments=Math.floor(radialSegments)||8,heightSegments=Math.floor(heightSegments)||1,openEnded=void 0!==openEnded&&openEnded,thetaStart=void 0!==thetaStart?thetaStart:0,thetaLength=void 0!==thetaLength?thetaLength:2*Math.PI;var nbCap=0;!1===openEnded&&(0<radiusTop&&nbCap++,0<radiusBottom&&nbCap++);var vertexCount=function(){var count=(radialSegments+1)*(heightSegments+1);!1===openEnded&&(count+=(radialSegments+1)*nbCap+radialSegments*nbCap);return count}(),indexCount=function(){var count=radialSegments*heightSegments*2*3;!1===openEnded&&(count+=radialSegments*nbCap*3);return count}(),indices=new BufferAttribute(new(65535<indexCount?Uint32Array:Uint16Array)(indexCount),1),vertices=new BufferAttribute(new Float32Array(3*vertexCount),3),normals=new BufferAttribute(new Float32Array(3*vertexCount),3),uvs=new BufferAttribute(new Float32Array(2*vertexCount),2),index=0,indexOffset=0,indexArray=[],halfHeight=height/2,groupStart=0;function generateCap(top){var x,centerIndexStart,centerIndexEnd,uv=new Vector2,vertex=new Vector3,groupCount=0,radius=!0===top?radiusTop:radiusBottom,sign=!0===top?1:-1;for(centerIndexStart=index,x=1;x<=radialSegments;x++)vertices.setXYZ(index,0,halfHeight*sign,0),normals.setXYZ(index,0,sign,0),uv.x=.5,uv.y=.5,uvs.setXY(index,uv.x,uv.y),index++;for(centerIndexEnd=index,x=0;x<=radialSegments;x++){var theta=x/radialSegments*thetaLength+thetaStart,cosTheta=Math.cos(theta),sinTheta=Math.sin(theta);vertex.x=radius*sinTheta,vertex.y=halfHeight*sign,vertex.z=radius*cosTheta,vertices.setXYZ(index,vertex.x,vertex.y,vertex.z),normals.setXYZ(index,0,sign,0),uv.x=.5*cosTheta+.5,uv.y=.5*sinTheta*sign+.5,uvs.setXY(index,uv.x,uv.y),index++}for(x=0;x<radialSegments;x++){var c=centerIndexStart+x,i=centerIndexEnd+x;!0===top?(indices.setX(indexOffset,i),indexOffset++,indices.setX(indexOffset,i+1)):(indices.setX(indexOffset,i+1),indexOffset++,indices.setX(indexOffset,i)),indexOffset++,indices.setX(indexOffset,c),indexOffset++,groupCount+=3}scope.addGroup(groupStart,groupCount,!0===top?1:2),groupStart+=groupCount}!function(){var x,y,normal=new Vector3,vertex=new Vector3,groupCount=0,slope=(radiusBottom-radiusTop)/height;for(y=0;y<=heightSegments;y++){var indexRow=[],v=y/heightSegments,radius=v*(radiusBottom-radiusTop)+radiusTop;for(x=0;x<=radialSegments;x++){var u=x/radialSegments,theta=u*thetaLength+thetaStart,sinTheta=Math.sin(theta),cosTheta=Math.cos(theta);vertex.x=radius*sinTheta,vertex.y=-v*height+halfHeight,vertex.z=radius*cosTheta,vertices.setXYZ(index,vertex.x,vertex.y,vertex.z),normal.set(sinTheta,slope,cosTheta).normalize(),normals.setXYZ(index,normal.x,normal.y,normal.z),uvs.setXY(index,u,1-v),indexRow.push(index),index++}indexArray.push(indexRow)}for(x=0;x<radialSegments;x++)for(y=0;y<heightSegments;y++){var i1=indexArray[y][x],i2=indexArray[y+1][x],i3=indexArray[y+1][x+1],i4=indexArray[y][x+1];indices.setX(indexOffset,i1),indexOffset++,indices.setX(indexOffset,i2),indexOffset++,indices.setX(indexOffset,i4),indexOffset++,indices.setX(indexOffset,i2),indexOffset++,indices.setX(indexOffset,i3),indexOffset++,indices.setX(indexOffset,i4),indexOffset++,groupCount+=6}scope.addGroup(groupStart,groupCount,0),groupStart+=groupCount}(),!1===openEnded&&(0<radiusTop&&generateCap(!0),0<radiusBottom&&generateCap(!1)),this.setIndex(indices),this.addAttribute("position",vertices),this.addAttribute("normal",normals),this.addAttribute("uv",uvs)}function CylinderGeometry(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:radiusTop,radiusBottom:radiusBottom,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength},this.fromBufferGeometry(new CylinderBufferGeometry(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength)),this.mergeVertices()}function ConeGeometry(radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){CylinderGeometry.call(this,0,radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength),this.type="ConeGeometry",this.parameters={radius:radius,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength}}function ConeBufferGeometry(radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){CylinderBufferGeometry.call(this,0,radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength),this.type="ConeBufferGeometry",this.parameters={radius:radius,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength}}function CircleBufferGeometry(radius,segments,thetaStart,thetaLength){BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:radius,segments:segments,thetaStart:thetaStart,thetaLength:thetaLength},radius=radius||50,segments=void 0!==segments?Math.max(3,segments):8,thetaStart=void 0!==thetaStart?thetaStart:0,thetaLength=void 0!==thetaLength?thetaLength:2*Math.PI;var vertices=segments+2,positions=new Float32Array(3*vertices),normals=new Float32Array(3*vertices),uvs=new Float32Array(2*vertices);normals[2]=1,uvs[0]=.5,uvs[1]=.5;for(var s=0,i=3,ii=2;s<=segments;s++,i+=3,ii+=2){var segment=thetaStart+s/segments*thetaLength;positions[i]=radius*Math.cos(segment),positions[i+1]=radius*Math.sin(segment),normals[i+2]=1,uvs[ii]=(positions[i]/radius+1)/2,uvs[ii+1]=(positions[i+1]/radius+1)/2}var indices=[];for(i=1;i<=segments;i++)indices.push(i,i+1,0);this.setIndex(new BufferAttribute(new Uint16Array(indices),1)),this.addAttribute("position",new BufferAttribute(positions,3)),this.addAttribute("normal",new BufferAttribute(normals,3)),this.addAttribute("uv",new BufferAttribute(uvs,2)),this.boundingSphere=new Sphere(new Vector3,radius)}function CircleGeometry(radius,segments,thetaStart,thetaLength){Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:radius,segments:segments,thetaStart:thetaStart,thetaLength:thetaLength},this.fromBufferGeometry(new CircleBufferGeometry(radius,segments,thetaStart,thetaLength))}function BoxGeometry(width,height,depth,widthSegments,heightSegments,depthSegments){Geometry.call(this),this.type="BoxGeometry",this.parameters={width:width,height:height,depth:depth,widthSegments:widthSegments,heightSegments:heightSegments,depthSegments:depthSegments},this.fromBufferGeometry(new BoxBufferGeometry(width,height,depth,widthSegments,heightSegments,depthSegments)),this.mergeVertices()}((ExtrudeGeometry.prototype=Object.create(Geometry.prototype)).constructor=ExtrudeGeometry).prototype.addShapeList=function(shapes,options){for(var sl=shapes.length,s=0;s<sl;s++){var shape=shapes[s];this.addShape(shape,options)}},ExtrudeGeometry.prototype.addShape=function(shape,options){var extrudePts,splineTube,binormal,normal,position2,ahole,h,hl,amount=void 0!==options.amount?options.amount:100,bevelThickness=void 0!==options.bevelThickness?options.bevelThickness:6,bevelSize=void 0!==options.bevelSize?options.bevelSize:bevelThickness-2,bevelSegments=void 0!==options.bevelSegments?options.bevelSegments:3,bevelEnabled=void 0===options.bevelEnabled||options.bevelEnabled,curveSegments=void 0!==options.curveSegments?options.curveSegments:12,steps=void 0!==options.steps?options.steps:1,extrudePath=options.extrudePath,extrudeByPath=!1,uvgen=void 0!==options.UVGenerator?options.UVGenerator:ExtrudeGeometry.WorldUVGenerator;extrudePath&&(extrudePts=extrudePath.getSpacedPoints(steps),bevelEnabled=!(extrudeByPath=!0),splineTube=void 0!==options.frames?options.frames:extrudePath.computeFrenetFrames(steps,!1),binormal=new Vector3,normal=new Vector3,position2=new Vector3),bevelEnabled||(bevelSize=bevelThickness=bevelSegments=0);var scope=this,shapesOffset=this.vertices.length,shapePoints=shape.extractPoints(curveSegments),vertices=shapePoints.shape,holes=shapePoints.holes,reverse=!ShapeUtils.isClockWise(vertices);if(reverse){for(vertices=vertices.reverse(),h=0,hl=holes.length;h<hl;h++)ahole=holes[h],ShapeUtils.isClockWise(ahole)&&(holes[h]=ahole.reverse());reverse=!1}var faces=ShapeUtils.triangulateShape(vertices,holes),contour=vertices;for(h=0,hl=holes.length;h<hl;h++)ahole=holes[h],vertices=vertices.concat(ahole);function scalePt2(pt,vec,size){return vec||console.error("THREE.ExtrudeGeometry: vec does not exist"),vec.clone().multiplyScalar(size).add(pt)}var b,bs,t,z,vert,face,vlen=vertices.length,flen=faces.length;function getBevelVec(inPt,inPrev,inNext){var v_trans_x,v_trans_y,shrink_by=1,v_prev_x=inPt.x-inPrev.x,v_prev_y=inPt.y-inPrev.y,v_next_x=inNext.x-inPt.x,v_next_y=inNext.y-inPt.y,v_prev_lensq=v_prev_x*v_prev_x+v_prev_y*v_prev_y,collinear0=v_prev_x*v_next_y-v_prev_y*v_next_x;if(Math.abs(collinear0)>Number.EPSILON){var v_prev_len=Math.sqrt(v_prev_lensq),v_next_len=Math.sqrt(v_next_x*v_next_x+v_next_y*v_next_y),ptPrevShift_x=inPrev.x-v_prev_y/v_prev_len,ptPrevShift_y=inPrev.y+v_prev_x/v_prev_len,sf=((inNext.x-v_next_y/v_next_len-ptPrevShift_x)*v_next_y-(inNext.y+v_next_x/v_next_len-ptPrevShift_y)*v_next_x)/(v_prev_x*v_next_y-v_prev_y*v_next_x),v_trans_lensq=(v_trans_x=ptPrevShift_x+v_prev_x*sf-inPt.x)*v_trans_x+(v_trans_y=ptPrevShift_y+v_prev_y*sf-inPt.y)*v_trans_y;if(v_trans_lensq<=2)return new Vector2(v_trans_x,v_trans_y);shrink_by=Math.sqrt(v_trans_lensq/2)}else{var direction_eq=!1;v_prev_x>Number.EPSILON?v_next_x>Number.EPSILON&&(direction_eq=!0):v_prev_x<-Number.EPSILON?v_next_x<-Number.EPSILON&&(direction_eq=!0):Math.sign(v_prev_y)===Math.sign(v_next_y)&&(direction_eq=!0),shrink_by=direction_eq?(v_trans_x=-v_prev_y,v_trans_y=v_prev_x,Math.sqrt(v_prev_lensq)):(v_trans_x=v_prev_x,v_trans_y=v_prev_y,Math.sqrt(v_prev_lensq/2))}return new Vector2(v_trans_x/shrink_by,v_trans_y/shrink_by)}for(var contourMovements=[],i=0,il=contour.length,j=il-1,k=i+1;i<il;i++,j++,k++)j===il&&(j=0),k===il&&(k=0),contourMovements[i]=getBevelVec(contour[i],contour[j],contour[k]);var oneHoleMovements,s,holesMovements=[],verticesMovements=contourMovements.concat();for(h=0,hl=holes.length;h<hl;h++){for(ahole=holes[h],oneHoleMovements=[],i=0,j=(il=ahole.length)-1,k=i+1;i<il;i++,j++,k++)j===il&&(j=0),k===il&&(k=0),oneHoleMovements[i]=getBevelVec(ahole[i],ahole[j],ahole[k]);holesMovements.push(oneHoleMovements),verticesMovements=verticesMovements.concat(oneHoleMovements)}for(b=0;b<bevelSegments;b++){for(t=b/bevelSegments,z=bevelThickness*Math.cos(t*Math.PI/2),bs=bevelSize*Math.sin(t*Math.PI/2),i=0,il=contour.length;i<il;i++)v((vert=scalePt2(contour[i],contourMovements[i],bs)).x,vert.y,-z);for(h=0,hl=holes.length;h<hl;h++)for(ahole=holes[h],oneHoleMovements=holesMovements[h],i=0,il=ahole.length;i<il;i++)v((vert=scalePt2(ahole[i],oneHoleMovements[i],bs)).x,vert.y,-z)}for(bs=bevelSize,i=0;i<vlen;i++)vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i],extrudeByPath?(normal.copy(splineTube.normals[0]).multiplyScalar(vert.x),binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y),position2.copy(extrudePts[0]).add(normal).add(binormal),v(position2.x,position2.y,position2.z)):v(vert.x,vert.y,0);for(s=1;s<=steps;s++)for(i=0;i<vlen;i++)vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i],extrudeByPath?(normal.copy(splineTube.normals[s]).multiplyScalar(vert.x),binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y),position2.copy(extrudePts[s]).add(normal).add(binormal),v(position2.x,position2.y,position2.z)):v(vert.x,vert.y,amount/steps*s);for(b=bevelSegments-1;0<=b;b--){for(t=b/bevelSegments,z=bevelThickness*Math.cos(t*Math.PI/2),bs=bevelSize*Math.sin(t*Math.PI/2),i=0,il=contour.length;i<il;i++)v((vert=scalePt2(contour[i],contourMovements[i],bs)).x,vert.y,amount+z);for(h=0,hl=holes.length;h<hl;h++)for(ahole=holes[h],oneHoleMovements=holesMovements[h],i=0,il=ahole.length;i<il;i++)vert=scalePt2(ahole[i],oneHoleMovements[i],bs),extrudeByPath?v(vert.x,vert.y+extrudePts[steps-1].y,extrudePts[steps-1].x+z):v(vert.x,vert.y,amount+z)}function sidewalls(contour,layeroffset){var j,k;for(i=contour.length;0<=--i;){(k=(j=i)-1)<0&&(k=contour.length-1);var s=0,sl=steps+2*bevelSegments;for(s=0;s<sl;s++){var slen1=vlen*s,slen2=vlen*(s+1);f4(layeroffset+j+slen1,layeroffset+k+slen1,layeroffset+k+slen2,layeroffset+j+slen2,contour,s,sl,j,k)}}}function v(x,y,z){scope.vertices.push(new Vector3(x,y,z))}function f3(a,b,c){a+=shapesOffset,b+=shapesOffset,c+=shapesOffset,scope.faces.push(new Face3(a,b,c,null,null,0));var uvs=uvgen.generateTopUV(scope,a,b,c);scope.faceVertexUvs[0].push(uvs)}function f4(a,b,c,d){a+=shapesOffset,b+=shapesOffset,c+=shapesOffset,d+=shapesOffset,scope.faces.push(new Face3(a,b,d,null,null,1)),scope.faces.push(new Face3(b,c,d,null,null,1));var uvs=uvgen.generateSideWallUV(scope,a,b,c,d);scope.faceVertexUvs[0].push([uvs[0],uvs[1],uvs[3]]),scope.faceVertexUvs[0].push([uvs[1],uvs[2],uvs[3]])}!function(){if(bevelEnabled){var layer=0,offset=vlen*layer;for(i=0;i<flen;i++)f3((face=faces[i])[2]+offset,face[1]+offset,face[0]+offset);for(offset=vlen*(layer=steps+2*bevelSegments),i=0;i<flen;i++)f3((face=faces[i])[0]+offset,face[1]+offset,face[2]+offset)}else{for(i=0;i<flen;i++)f3((face=faces[i])[2],face[1],face[0]);for(i=0;i<flen;i++)f3((face=faces[i])[0]+vlen*steps,face[1]+vlen*steps,face[2]+vlen*steps)}}(),function(){var layeroffset=0;for(sidewalls(contour,layeroffset),layeroffset+=contour.length,h=0,hl=holes.length;h<hl;h++)sidewalls(ahole=holes[h],layeroffset),layeroffset+=ahole.length}()},ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(geometry,indexA,indexB,indexC){var vertices=geometry.vertices,a=vertices[indexA],b=vertices[indexB],c=vertices[indexC];return[new Vector2(a.x,a.y),new Vector2(b.x,b.y),new Vector2(c.x,c.y)]},generateSideWallUV:function(geometry,indexA,indexB,indexC,indexD){var vertices=geometry.vertices,a=vertices[indexA],b=vertices[indexB],c=vertices[indexC],d=vertices[indexD];return Math.abs(a.y-b.y)<.01?[new Vector2(a.x,1-a.z),new Vector2(b.x,1-b.z),new Vector2(c.x,1-c.z),new Vector2(d.x,1-d.z)]:[new Vector2(a.y,1-a.z),new Vector2(b.y,1-b.z),new Vector2(c.y,1-c.z),new Vector2(d.y,1-d.z)]}},(TextGeometry.prototype=Object.create(ExtrudeGeometry.prototype)).constructor=TextGeometry,(SphereBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=SphereBufferGeometry,(SphereGeometry.prototype=Object.create(Geometry.prototype)).constructor=SphereGeometry,(RingBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=RingBufferGeometry,(RingGeometry.prototype=Object.create(Geometry.prototype)).constructor=RingGeometry,(PlaneGeometry.prototype=Object.create(Geometry.prototype)).constructor=PlaneGeometry,(LatheBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=LatheBufferGeometry,(LatheGeometry.prototype=Object.create(Geometry.prototype)).constructor=LatheGeometry,(ShapeBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=ShapeBufferGeometry,(ShapeGeometry.prototype=Object.create(Geometry.prototype)).constructor=ShapeGeometry,(EdgesGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=EdgesGeometry,(CylinderBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=CylinderBufferGeometry,(CylinderGeometry.prototype=Object.create(Geometry.prototype)).constructor=CylinderGeometry,(ConeGeometry.prototype=Object.create(CylinderGeometry.prototype)).constructor=ConeGeometry,(ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype)).constructor=ConeBufferGeometry,(CircleBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=CircleBufferGeometry,(CircleGeometry.prototype=Object.create(Geometry.prototype)).constructor=CircleGeometry,(BoxGeometry.prototype=Object.create(Geometry.prototype)).constructor=BoxGeometry;var Geometries=Object.freeze({WireframeGeometry:WireframeGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,SphereBufferGeometry:SphereBufferGeometry,SphereGeometry:SphereGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneBufferGeometry:PlaneBufferGeometry,PlaneGeometry:PlaneGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,CircleBufferGeometry:CircleBufferGeometry,CircleGeometry:CircleGeometry,BoxBufferGeometry:BoxBufferGeometry,BoxGeometry:BoxGeometry});function ShadowMaterial(){ShaderMaterial.call(this,{uniforms:UniformsUtils.merge([UniformsLib.lights,{opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}),this.lights=!0,this.transparent=!0,Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(value){this.uniforms.opacity.value=value}}})}function RawShaderMaterial(parameters){ShaderMaterial.call(this,parameters),this.type="RawShaderMaterial"}function MultiMaterial(materials){this.uuid=_Math.generateUUID(),this.type="MultiMaterial",this.materials=Array.isArray(materials)?materials:[],this.visible=!0}function MeshStandardMaterial(parameters){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(parameters)}function MeshPhysicalMaterial(parameters){MeshStandardMaterial.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(parameters)}function MeshPhongMaterial(parameters){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(parameters)}function MeshToonMaterial(parameters){MeshPhongMaterial.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(parameters)}function MeshNormalMaterial(parameters){Material.call(this,parameters),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(parameters)}function MeshLambertMaterial(parameters){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(parameters)}function LineDashedMaterial(parameters){Material.call(this),this.type="LineDashedMaterial",this.color=new Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.lights=!1,this.setValues(parameters)}((ShadowMaterial.prototype=Object.create(ShaderMaterial.prototype)).constructor=ShadowMaterial).prototype.isShadowMaterial=!0,RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype),MultiMaterial.prototype={constructor:MultiMaterial,isMultiMaterial:(RawShaderMaterial.prototype.constructor=RawShaderMaterial).prototype.isRawShaderMaterial=!0,toJSON:function(meta){for(var output={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},materials=this.materials,i=0,l=materials.length;i<l;i++){var material=materials[i].toJSON(meta);delete material.metadata,output.materials.push(material)}return output.visible=this.visible,output},clone:function(){for(var material=new this.constructor,i=0;i<this.materials.length;i++)material.materials.push(this.materials[i].clone());return material.visible=this.visible,material}},((MeshStandardMaterial.prototype=Object.create(Material.prototype)).constructor=MeshStandardMaterial).prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.defines={STANDARD:""},this.color.copy(source.color),this.roughness=source.roughness,this.metalness=source.metalness,this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.roughnessMap=source.roughnessMap,this.metalnessMap=source.metalnessMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.envMapIntensity=source.envMapIntensity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},((MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype)).constructor=MeshPhysicalMaterial).prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(source){return MeshStandardMaterial.prototype.copy.call(this,source),this.defines={PHYSICAL:""},this.reflectivity=source.reflectivity,this.clearCoat=source.clearCoat,this.clearCoatRoughness=source.clearCoatRoughness,this},((MeshPhongMaterial.prototype=Object.create(Material.prototype)).constructor=MeshPhongMaterial).prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.specular.copy(source.specular),this.shininess=source.shininess,this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.specularMap=source.specularMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.combine=source.combine,this.reflectivity=source.reflectivity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},((MeshToonMaterial.prototype=Object.create(MeshPhongMaterial.prototype)).constructor=MeshToonMaterial).prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(source){return MeshPhongMaterial.prototype.copy.call(this,source),this.gradientMap=source.gradientMap,this},((MeshNormalMaterial.prototype=Object.create(Material.prototype)).constructor=MeshNormalMaterial).prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},((MeshLambertMaterial.prototype=Object.create(Material.prototype)).constructor=MeshLambertMaterial).prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.specularMap=source.specularMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.combine=source.combine,this.reflectivity=source.reflectivity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},((LineDashedMaterial.prototype=Object.create(Material.prototype)).constructor=LineDashedMaterial).prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.linewidth=source.linewidth,this.scale=source.scale,this.dashSize=source.dashSize,this.gapSize=source.gapSize,this};var Materials=Object.freeze({ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MultiMaterial:MultiMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshBasicMaterial:MeshBasicMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material}),Cache={enabled:!1,files:{},add:function(key,file){!1!==this.enabled&&(this.files[key]=file)},get:function(key){if(!1!==this.enabled)return this.files[key]},remove:function(key){delete this.files[key]},clear:function(){this.files={}}};function LoadingManager(onLoad,onProgress,onError){var scope=this,isLoading=!1,itemsLoaded=0,itemsTotal=0;this.onStart=void 0,this.onLoad=onLoad,this.onProgress=onProgress,this.onError=onError,this.itemStart=function(url){itemsTotal++,!1===isLoading&&void 0!==scope.onStart&&scope.onStart(url,itemsLoaded,itemsTotal),isLoading=!0},this.itemEnd=function(url){itemsLoaded++,void 0!==scope.onProgress&&scope.onProgress(url,itemsLoaded,itemsTotal),itemsLoaded===itemsTotal&&(isLoading=!1,void 0!==scope.onLoad&&scope.onLoad())},this.itemError=function(url){void 0!==scope.onError&&scope.onError(url)}}var DefaultLoadingManager=new LoadingManager;function FileLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}function CompressedTextureLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager,this._parser=null}Object.assign(FileLoader.prototype,{load:function(url,onLoad,onProgress,onError){void 0===url&&(url=""),void 0!==this.path&&(url=this.path+url);var scope=this,cached=Cache.get(url);if(void 0!==cached)return scope.manager.itemStart(url),setTimeout(function(){onLoad&&onLoad(cached),scope.manager.itemEnd(url)},0),cached;var dataUriRegexResult=url.match(/^data:(.*?)(;base64)?,(.*)$/);if(dataUriRegexResult){var mimeType=dataUriRegexResult[1],isBase64=!!dataUriRegexResult[2],data=dataUriRegexResult[3];data=window.decodeURIComponent(data),isBase64&&(data=window.atob(data));try{var response,responseType=(this.responseType||"").toLowerCase();switch(responseType){case"arraybuffer":case"blob":response=new ArrayBuffer(data.length);for(var view=new Uint8Array(response),i=0;i<data.length;i++)view[i]=data.charCodeAt(i);"blob"===responseType&&(response=new Blob([response],{type:mimeType}));break;case"document":var parser=new DOMParser;response=parser.parseFromString(data,mimeType);break;case"json":response=JSON.parse(data);break;default:response=data}window.setTimeout(function(){onLoad&&onLoad(response),scope.manager.itemEnd(url)},0)}catch(error){window.setTimeout(function(){onError&&onError(error),scope.manager.itemError(url)},0)}}else{var request=new XMLHttpRequest;request.open("GET",url,!0),request.addEventListener("load",function(event){var response=event.target.response;Cache.add(url,response),200===this.status?(onLoad&&onLoad(response),scope.manager.itemEnd(url)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),onLoad&&onLoad(response),scope.manager.itemEnd(url)):(onError&&onError(event),scope.manager.itemError(url))},!1),void 0!==onProgress&&request.addEventListener("progress",function(event){onProgress(event)},!1),request.addEventListener("error",function(event){onError&&onError(event),scope.manager.itemError(url)},!1),void 0!==this.responseType&&(request.responseType=this.responseType),void 0!==this.withCredentials&&(request.withCredentials=this.withCredentials),request.overrideMimeType&&request.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),request.send(null)}return scope.manager.itemStart(url),request},setPath:function(value){return this.path=value,this},setResponseType:function(value){return this.responseType=value,this},setWithCredentials:function(value){return this.withCredentials=value,this},setMimeType:function(value){return this.mimeType=value,this}}),Object.assign(CompressedTextureLoader.prototype,{load:function(url,onLoad,onProgress,onError){var scope=this,images=[],texture=new CompressedTexture;texture.image=images;var loader=new FileLoader(this.manager);function loadTexture(i){loader.load(url[i],function(buffer){var texDatas=scope._parser(buffer,!0);images[i]={width:texDatas.width,height:texDatas.height,format:texDatas.format,mipmaps:texDatas.mipmaps},6===(loaded+=1)&&(1===texDatas.mipmapCount&&(texture.minFilter=LinearFilter),texture.format=texDatas.format,texture.needsUpdate=!0,onLoad&&onLoad(texture))},onProgress,onError)}if(loader.setPath(this.path),loader.setResponseType("arraybuffer"),Array.isArray(url))for(var loaded=0,i=0,il=url.length;i<il;++i)loadTexture(i);else loader.load(url,function(buffer){var texDatas=scope._parser(buffer,!0);if(texDatas.isCubemap)for(var faces=texDatas.mipmaps.length/texDatas.mipmapCount,f=0;f<faces;f++){images[f]={mipmaps:[]};for(var i=0;i<texDatas.mipmapCount;i++)images[f].mipmaps.push(texDatas.mipmaps[f*texDatas.mipmapCount+i]),images[f].format=texDatas.format,images[f].width=texDatas.width,images[f].height=texDatas.height}else texture.image.width=texDatas.width,texture.image.height=texDatas.height,texture.mipmaps=texDatas.mipmaps;1===texDatas.mipmapCount&&(texture.minFilter=LinearFilter),texture.format=texDatas.format,texture.needsUpdate=!0,onLoad&&onLoad(texture)},onProgress,onError);return texture},setPath:function(value){return this.path=value,this}});var DataTextureLoader=BinaryTextureLoader;function BinaryTextureLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager,this._parser=null}function ImageLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}function CubeTextureLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}function TextureLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}function Light(color,intensity){Object3D.call(this),this.type="Light",this.color=new Color(color),this.intensity=void 0!==intensity?intensity:1,this.receiveShadow=void 0}function HemisphereLight(skyColor,groundColor,intensity){Light.call(this,skyColor,intensity),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(groundColor)}function LightShadow(camera){this.camera=camera,this.bias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.matrix=new Matrix4}function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}function SpotLight(color,intensity,distance,angle,penumbra,decay){Light.call(this,color,intensity),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(power){this.intensity=power/Math.PI}}),this.distance=void 0!==distance?distance:0,this.angle=void 0!==angle?angle:Math.PI/3,this.penumbra=void 0!==penumbra?penumbra:0,this.decay=void 0!==decay?decay:1,this.shadow=new SpotLightShadow}function PointLight(color,intensity,distance,decay){Light.call(this,color,intensity),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(power){this.intensity=power/(4*Math.PI)}}),this.distance=void 0!==distance?distance:0,this.decay=void 0!==decay?decay:1,this.shadow=new LightShadow(new PerspectiveCamera(90,1,.5,500))}function DirectionalLightShadow(light){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}function DirectionalLight(color,intensity){Light.call(this,color,intensity),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}function AmbientLight(color,intensity){Light.call(this,color,intensity),this.type="AmbientLight",this.castShadow=void 0}Object.assign(BinaryTextureLoader.prototype,{load:function(url,onLoad,onProgress,onError){var scope=this,texture=new DataTexture,loader=new FileLoader(this.manager);return loader.setResponseType("arraybuffer"),loader.load(url,function(buffer){var texData=scope._parser(buffer);texData&&(void 0!==texData.image?texture.image=texData.image:void 0!==texData.data&&(texture.image.width=texData.width,texture.image.height=texData.height,texture.image.data=texData.data),texture.wrapS=void 0!==texData.wrapS?texData.wrapS:ClampToEdgeWrapping,texture.wrapT=void 0!==texData.wrapT?texData.wrapT:ClampToEdgeWrapping,texture.magFilter=void 0!==texData.magFilter?texData.magFilter:LinearFilter,texture.minFilter=void 0!==texData.minFilter?texData.minFilter:LinearMipMapLinearFilter,texture.anisotropy=void 0!==texData.anisotropy?texData.anisotropy:1,void 0!==texData.format&&(texture.format=texData.format),void 0!==texData.type&&(texture.type=texData.type),void 0!==texData.mipmaps&&(texture.mipmaps=texData.mipmaps),1===texData.mipmapCount&&(texture.minFilter=LinearFilter),texture.needsUpdate=!0,onLoad&&onLoad(texture,texData))},onProgress,onError),texture}}),Object.assign(ImageLoader.prototype,{load:function(url,onLoad,onProgress,onError){var scope=this,image=document.createElementNS("http://www.w3.org/1999/xhtml","img");if(image.onload=function(){image.onload=null,URL.revokeObjectURL(image.src),onLoad&&onLoad(image),scope.manager.itemEnd(url)},image.onerror=onError,0===url.indexOf("data:"))image.src=url;else if(void 0!==this.crossOrigin)image.crossOrigin=this.crossOrigin,image.src=url;else{var loader=new FileLoader;loader.setPath(this.path),loader.setResponseType("blob"),loader.setWithCredentials(this.withCredentials),loader.load(url,function(blob){image.src=URL.createObjectURL(blob)},onProgress,onError)}return scope.manager.itemStart(url),image},setCrossOrigin:function(value){return this.crossOrigin=value,this},setWithCredentials:function(value){return this.withCredentials=value,this},setPath:function(value){return this.path=value,this}}),Object.assign(CubeTextureLoader.prototype,{load:function(urls,onLoad,onProgress,onError){var texture=new CubeTexture,loader=new ImageLoader(this.manager);loader.setCrossOrigin(this.crossOrigin),loader.setPath(this.path);var loaded=0;function loadTexture(i){loader.load(urls[i],function(image){texture.images[i]=image,6===++loaded&&(texture.needsUpdate=!0,onLoad&&onLoad(texture))},void 0,onError)}for(var i=0;i<urls.length;++i)loadTexture(i);return texture},setCrossOrigin:function(value){return this.crossOrigin=value,this},setPath:function(value){return this.path=value,this}}),Object.assign(TextureLoader.prototype,{load:function(url,onLoad,onProgress,onError){var texture=new Texture,loader=new ImageLoader(this.manager);return loader.setCrossOrigin(this.crossOrigin),loader.setWithCredentials(this.withCredentials),loader.setPath(this.path),loader.load(url,function(image){var isJPEG=0<url.search(/\.(jpg|jpeg)$/)||0===url.search(/^data\:image\/jpeg/);texture.format=isJPEG?RGBFormat:RGBAFormat,texture.image=image,texture.needsUpdate=!0,void 0!==onLoad&&onLoad(texture)},onProgress,onError),texture},setCrossOrigin:function(value){return this.crossOrigin=value,this},setWithCredentials:function(value){return this.withCredentials=value,this},setPath:function(value){return this.path=value,this}}),Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(source){return Object3D.prototype.copy.call(this,source),this.color.copy(source.color),this.intensity=source.intensity,this},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);return data.object.color=this.color.getHex(),data.object.intensity=this.intensity,void 0!==this.groundColor&&(data.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(data.object.distance=this.distance),void 0!==this.angle&&(data.object.angle=this.angle),void 0!==this.decay&&(data.object.decay=this.decay),void 0!==this.penumbra&&(data.object.penumbra=this.penumbra),void 0!==this.shadow&&(data.object.shadow=this.shadow.toJSON()),data}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.groundColor.copy(source.groundColor),this}}),Object.assign(LightShadow.prototype,{copy:function(source){return this.camera=source.camera.clone(),this.bias=source.bias,this.radius=source.radius,this.mapSize.copy(source.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var object={};return 0!==this.bias&&(object.bias=this.bias),1!==this.radius&&(object.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(object.mapSize=this.mapSize.toArray()),object.camera=this.camera.toJSON(!1).object,delete object.camera.matrix,object}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,update:function(light){var fov=2*_Math.RAD2DEG*light.angle,aspect=this.mapSize.width/this.mapSize.height,far=light.distance||500,camera=this.camera;fov===camera.fov&&aspect===camera.aspect&&far===camera.far||(camera.fov=fov,camera.aspect=aspect,camera.far=far,camera.updateProjectionMatrix())}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.distance=source.distance,this.angle=source.angle,this.penumbra=source.penumbra,this.decay=source.decay,this.target=source.target.clone(),this.shadow=source.shadow.clone(),this}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.distance=source.distance,this.decay=source.decay,this.shadow=source.shadow.clone(),this}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.target=source.target.clone(),this.shadow=source.shadow.clone(),this}}),AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0});var KeyframeTrackPrototype,color,textureLoader,materialLoader,AnimationUtils={arraySlice:function(array,from,to){return AnimationUtils.isTypedArray(array)?new array.constructor(array.subarray(from,to)):array.slice(from,to)},convertArray:function(array,type,forceClone){return!array||!forceClone&&array.constructor===type?array:"number"==typeof type.BYTES_PER_ELEMENT?new type(array):Array.prototype.slice.call(array)},isTypedArray:function(object){return ArrayBuffer.isView(object)&&!(object instanceof DataView)},getKeyframeOrder:function(times){for(var n=times.length,result=new Array(n),i=0;i!==n;++i)result[i]=i;return result.sort(function(i,j){return times[i]-times[j]}),result},sortedArray:function(values,stride,order){for(var nValues=values.length,result=new values.constructor(nValues),i=0,dstOffset=0;dstOffset!==nValues;++i)for(var srcOffset=order[i]*stride,j=0;j!==stride;++j)result[dstOffset++]=values[srcOffset+j];return result},flattenJSON:function(jsonKeys,times,values,valuePropertyName){for(var i=1,key=jsonKeys[0];void 0!==key&&void 0===key[valuePropertyName];)key=jsonKeys[i++];if(void 0!==key){var value=key[valuePropertyName];if(void 0!==value)if(Array.isArray(value))for(;void 0!==(value=key[valuePropertyName])&&(times.push(key.time),values.push.apply(values,value)),void 0!==(key=jsonKeys[i++]););else if(void 0!==value.toArray)for(;void 0!==(value=key[valuePropertyName])&&(times.push(key.time),value.toArray(values,values.length)),void 0!==(key=jsonKeys[i++]););else for(;void 0!==(value=key[valuePropertyName])&&(times.push(key.time),values.push(value)),void 0!==(key=jsonKeys[i++]););}}};function Interpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){this.parameterPositions=parameterPositions,this._cachedIndex=0,this.resultBuffer=void 0!==resultBuffer?resultBuffer:new sampleValues.constructor(sampleSize),this.sampleValues=sampleValues,this.valueSize=sampleSize}function CubicInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function LinearInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer)}function DiscreteInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer)}function KeyframeTrackConstructor(name,times,values,interpolation){if(void 0===name)throw new Error("track name is undefined");if(void 0===times||0===times.length)throw new Error("no keyframes in track named "+name);this.name=name,this.times=AnimationUtils.convertArray(times,this.TimeBufferType),this.values=AnimationUtils.convertArray(values,this.ValueBufferType),this.setInterpolation(interpolation||this.DefaultInterpolation),this.validate(),this.optimize()}function VectorKeyframeTrack(name,times,values,interpolation){KeyframeTrackConstructor.call(this,name,times,values,interpolation)}function QuaternionLinearInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer)}function QuaternionKeyframeTrack(name,times,values,interpolation){KeyframeTrackConstructor.call(this,name,times,values,interpolation)}function NumberKeyframeTrack(name,times,values,interpolation){KeyframeTrackConstructor.call(this,name,times,values,interpolation)}function StringKeyframeTrack(name,times,values,interpolation){KeyframeTrackConstructor.call(this,name,times,values,interpolation)}function BooleanKeyframeTrack(name,times,values){KeyframeTrackConstructor.call(this,name,times,values)}function ColorKeyframeTrack(name,times,values,interpolation){KeyframeTrackConstructor.call(this,name,times,values,interpolation)}function KeyframeTrack(name,times,values,interpolation){KeyframeTrackConstructor.apply(this,arguments)}function AnimationClip(name,duration,tracks){this.name=name,this.tracks=tracks,this.duration=void 0!==duration?duration:-1,this.uuid=_Math.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function MaterialLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager,this.textures={}}function BufferGeometryLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}function Loader(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function JSONLoader(manager){"boolean"==typeof manager&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),manager=void 0),this.manager=void 0!==manager?manager:DefaultLoadingManager,this.withCredentials=!1}function ObjectLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager,this.texturePath=""}function Curve(){}function LineCurve(v1,v2){this.v1=v1,this.v2=v2}function CurvePath(){this.curves=[],this.autoClose=!1}function EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){this.aX=aX,this.aY=aY,this.xRadius=xRadius,this.yRadius=yRadius,this.aStartAngle=aStartAngle,this.aEndAngle=aEndAngle,this.aClockwise=aClockwise,this.aRotation=aRotation||0}Interpolant.prototype={constructor:Interpolant,evaluate:function(t){var pp=this.parameterPositions,i1=this._cachedIndex,t1=pp[i1],t0=pp[i1-1];validate_interval:{seek:{var right;linear_scan:{forward_scan:if(!(t<t1)){for(var giveUpAt=i1+2;;){if(void 0===t1){if(t<t0)break forward_scan;return i1=pp.length,this._cachedIndex=i1,this.afterEnd_(i1-1,t,t0)}if(i1===giveUpAt)break;if(t0=t1,t<(t1=pp[++i1]))break seek}right=pp.length;break linear_scan}if(t0<=t)break validate_interval;var t1global=pp[1];t<t1global&&(i1=2,t0=t1global);for(giveUpAt=i1-2;;){if(void 0===t0)return this._cachedIndex=0,this.beforeStart_(0,t,t1);if(i1===giveUpAt)break;if(t1=t0,(t0=pp[--i1-1])<=t)break seek}right=i1,i1=0}for(;i1<right;){var mid=i1+right>>>1;t<pp[mid]?right=mid:i1=1+mid}if(t1=pp[i1],void 0===(t0=pp[i1-1]))return this._cachedIndex=0,this.beforeStart_(0,t,t1);if(void 0===t1)return i1=pp.length,this._cachedIndex=i1,this.afterEnd_(i1-1,t0,t)}this._cachedIndex=i1,this.intervalChanged_(i1,t0,t1)}return this.interpolate_(i1,t0,t,t1)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(index){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,offset=index*stride,i=0;i!==stride;++i)result[i]=values[offset+i];return result},interpolate_:function(i1,t0,t,t1){throw new Error("call to abstract method")},intervalChanged_:function(i1,t0,t1){}},Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(i1,t0,t1){var pp=this.parameterPositions,iPrev=i1-2,iNext=i1+1,tPrev=pp[iPrev],tNext=pp[iNext];if(void 0===tPrev)switch(this.getSettings_().endingStart){case 2401:iPrev=i1,tPrev=2*t0-t1;break;case 2402:tPrev=t0+pp[iPrev=pp.length-2]-pp[iPrev+1];break;default:iPrev=i1,tPrev=t1}if(void 0===tNext)switch(this.getSettings_().endingEnd){case 2401:iNext=i1,tNext=2*t1-t0;break;case 2402:tNext=t1+pp[iNext=1]-pp[0];break;default:iNext=i1-1,tNext=t0}var halfDt=.5*(t1-t0),stride=this.valueSize;this._weightPrev=halfDt/(t0-tPrev),this._weightNext=halfDt/(tNext-t1),this._offsetPrev=iPrev*stride,this._offsetNext=iNext*stride},interpolate_:function(i1,t0,t,t1){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,o1=i1*stride,o0=o1-stride,oP=this._offsetPrev,oN=this._offsetNext,wP=this._weightPrev,wN=this._weightNext,p=(t-t0)/(t1-t0),pp=p*p,ppp=pp*p,sP=-wP*ppp+2*wP*pp-wP*p,s0=(1+wP)*ppp+(-1.5-2*wP)*pp+(-.5+wP)*p+1,s1=(-1-wN)*ppp+(1.5+wN)*pp+.5*p,sN=wN*ppp-wN*pp,i=0;i!==stride;++i)result[i]=sP*values[oP+i]+s0*values[o0+i]+s1*values[o1+i]+sN*values[oN+i];return result}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(i1,t0,t,t1){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,offset1=i1*stride,offset0=offset1-stride,weight1=(t-t0)/(t1-t0),weight0=1-weight1,i=0;i!==stride;++i)result[i]=values[offset0+i]*weight0+values[offset1+i]*weight1;return result}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(i1,t0,t,t1){return this.copySampleValue_(i1-1)}}),KeyframeTrackPrototype={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(result){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),result)},InterpolantFactoryMethodLinear:function(result){return new LinearInterpolant(this.times,this.values,this.getValueSize(),result)},InterpolantFactoryMethodSmooth:function(result){return new CubicInterpolant(this.times,this.values,this.getValueSize(),result)},setInterpolation:function(interpolation){var factoryMethod;switch(interpolation){case 2300:factoryMethod=this.InterpolantFactoryMethodDiscrete;break;case 2301:factoryMethod=this.InterpolantFactoryMethodLinear;break;case 2302:factoryMethod=this.InterpolantFactoryMethodSmooth}if(void 0!==factoryMethod)this.createInterpolant=factoryMethod;else{var message="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(interpolation===this.DefaultInterpolation)throw new Error(message);this.setInterpolation(this.DefaultInterpolation)}console.warn(message)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(timeOffset){if(0!==timeOffset)for(var times=this.times,i=0,n=times.length;i!==n;++i)times[i]+=timeOffset;return this},scale:function(timeScale){if(1!==timeScale)for(var times=this.times,i=0,n=times.length;i!==n;++i)times[i]*=timeScale;return this},trim:function(startTime,endTime){for(var times=this.times,nKeys=times.length,from=0,to=nKeys-1;from!==nKeys&&times[from]<startTime;)++from;for(;-1!==to&&times[to]>endTime;)--to;if(++to,0!==from||to!==nKeys){to<=from&&(from=(to=Math.max(to,1))-1);var stride=this.getValueSize();this.times=AnimationUtils.arraySlice(times,from,to),this.values=AnimationUtils.arraySlice(this.values,from*stride,to*stride)}return this},validate:function(){var valid=!0,valueSize=this.getValueSize();valueSize-Math.floor(valueSize)!=0&&(console.error("invalid value size in track",this),valid=!1);var times=this.times,values=this.values,nKeys=times.length;0===nKeys&&(console.error("track is empty",this),valid=!1);for(var prevTime=null,i=0;i!==nKeys;i++){var currTime=times[i];if("number"==typeof currTime&&isNaN(currTime)){console.error("time is not a valid number",this,i,currTime),valid=!1;break}if(null!==prevTime&&currTime<prevTime){console.error("out of order keys",this,i,currTime,prevTime),valid=!1;break}prevTime=currTime}if(void 0!==values&&AnimationUtils.isTypedArray(values)){i=0;for(var n=values.length;i!==n;++i){var value=values[i];if(isNaN(value)){console.error("value is not a valid number",this,i,value),valid=!1;break}}}return valid},optimize:function(){for(var times=this.times,values=this.values,stride=this.getValueSize(),smoothInterpolation=2302===this.getInterpolation(),writeIndex=1,lastIndex=times.length-1,i=1;i<lastIndex;++i){var keep=!1,time=times[i];if(time!==times[i+1]&&(1!==i||time!==time[0]))if(smoothInterpolation)keep=!0;else for(var offset=i*stride,offsetP=offset-stride,offsetN=offset+stride,j=0;j!==stride;++j){var value=values[offset+j];if(value!==values[offsetP+j]||value!==values[offsetN+j]){keep=!0;break}}if(keep){if(i!==writeIndex){times[writeIndex]=times[i];var readOffset=i*stride,writeOffset=writeIndex*stride;for(j=0;j!==stride;++j)values[writeOffset+j]=values[readOffset+j]}++writeIndex}}if(0<lastIndex){times[writeIndex]=times[lastIndex];for(readOffset=lastIndex*stride,writeOffset=writeIndex*stride,j=0;j!==stride;++j)values[writeOffset+j]=values[readOffset+j];++writeIndex}return writeIndex!==times.length&&(this.times=AnimationUtils.arraySlice(times,0,writeIndex),this.values=AnimationUtils.arraySlice(values,0,writeIndex*stride)),this}},VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrackPrototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(i1,t0,t,t1){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,offset=i1*stride,alpha=(t-t0)/(t1-t0),end=offset+stride;offset!==end;offset+=4)Quaternion.slerpFlat(result,0,values,offset-stride,values,offset,alpha);return result}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrackPrototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(result){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),result)},InterpolantFactoryMethodSmooth:void 0}),NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrackPrototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"}),StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrackPrototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrackPrototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrackPrototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),(KeyframeTrack.prototype=KeyframeTrackPrototype).constructor=KeyframeTrack,Object.assign(KeyframeTrack,{parse:function(json){if(void 0===json.type)throw new Error("track type undefined, can not parse");var trackType=KeyframeTrack._getTrackTypeForValueTypeName(json.type);if(void 0===json.times){var times=[],values=[];AnimationUtils.flattenJSON(json.keys,times,values,"value"),json.times=times,json.values=values}return void 0!==trackType.parse?trackType.parse(json):new trackType(json.name,json.times,json.values,json.interpolation)},toJSON:function(track){var json,trackType=track.constructor;if(void 0!==trackType.toJSON)json=trackType.toJSON(track);else{json={name:track.name,times:AnimationUtils.convertArray(track.times,Array),values:AnimationUtils.convertArray(track.values,Array)};var interpolation=track.getInterpolation();interpolation!==track.DefaultInterpolation&&(json.interpolation=interpolation)}return json.type=track.ValueTypeName,json},_getTrackTypeForValueTypeName:function(typeName){switch(typeName.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("Unsupported typeName: "+typeName)}}),AnimationClip.prototype={constructor:AnimationClip,resetDuration:function(){for(var duration=0,i=0,n=this.tracks.length;i!==n;++i){var track=this.tracks[i];duration=Math.max(duration,track.times[track.times.length-1])}this.duration=duration},trim:function(){for(var i=0;i<this.tracks.length;i++)this.tracks[i].trim(0,this.duration);return this},optimize:function(){for(var i=0;i<this.tracks.length;i++)this.tracks[i].optimize();return this}},Object.assign(AnimationClip,{parse:function(json){for(var tracks=[],jsonTracks=json.tracks,frameTime=1/(json.fps||1),i=0,n=jsonTracks.length;i!==n;++i)tracks.push(KeyframeTrack.parse(jsonTracks[i]).scale(frameTime));return new AnimationClip(json.name,json.duration,tracks)},toJSON:function(clip){for(var tracks=[],clipTracks=clip.tracks,json={name:clip.name,duration:clip.duration,tracks:tracks},i=0,n=clipTracks.length;i!==n;++i)tracks.push(KeyframeTrack.toJSON(clipTracks[i]));return json},CreateFromMorphTargetSequence:function(name,morphTargetSequence,fps,noLoop){for(var numMorphTargets=morphTargetSequence.length,tracks=[],i=0;i<numMorphTargets;i++){var times=[],values=[];times.push((i+numMorphTargets-1)%numMorphTargets,i,(i+1)%numMorphTargets),values.push(0,1,0);var order=AnimationUtils.getKeyframeOrder(times);times=AnimationUtils.sortedArray(times,1,order),values=AnimationUtils.sortedArray(values,1,order),noLoop||0!==times[0]||(times.push(numMorphTargets),values.push(values[0])),tracks.push(new NumberKeyframeTrack(".morphTargetInfluences["+morphTargetSequence[i].name+"]",times,values).scale(1/fps))}return new AnimationClip(name,-1,tracks)},findByName:function(objectOrClipArray,name){var clipArray=objectOrClipArray;if(!Array.isArray(objectOrClipArray)){var o=objectOrClipArray;clipArray=o.geometry&&o.geometry.animations||o.animations}for(var i=0;i<clipArray.length;i++)if(clipArray[i].name===name)return clipArray[i];return null},CreateClipsFromMorphTargetSequences:function(morphTargets,fps,noLoop){for(var animationToMorphTargets={},pattern=/^([\w-]*?)([\d]+)$/,i=0,il=morphTargets.length;i<il;i++){var morphTarget=morphTargets[i],parts=morphTarget.name.match(pattern);if(parts&&1<parts.length){var animationMorphTargets=animationToMorphTargets[name=parts[1]];animationMorphTargets||(animationToMorphTargets[name]=animationMorphTargets=[]),animationMorphTargets.push(morphTarget)}}var clips=[];for(var name in animationToMorphTargets)clips.push(AnimationClip.CreateFromMorphTargetSequence(name,animationToMorphTargets[name],fps,noLoop));return clips},parseAnimation:function(animation,bones){if(!animation)return console.error("  no animation in JSONLoader data"),null;for(var addNonemptyTrack=function(trackType,trackName,animationKeys,propertyName,destTracks){if(0!==animationKeys.length){var times=[],values=[];AnimationUtils.flattenJSON(animationKeys,times,values,propertyName),0!==times.length&&destTracks.push(new trackType(trackName,times,values))}},tracks=[],clipName=animation.name||"default",duration=animation.length||-1,fps=animation.fps||30,hierarchyTracks=animation.hierarchy||[],h=0;h<hierarchyTracks.length;h++){var animationKeys=hierarchyTracks[h].keys;if(animationKeys&&0!==animationKeys.length)if(animationKeys[0].morphTargets){for(var morphTargetNames={},k=0;k<animationKeys.length;k++)if(animationKeys[k].morphTargets)for(var m=0;m<animationKeys[k].morphTargets.length;m++)morphTargetNames[animationKeys[k].morphTargets[m]]=-1;for(var morphTargetName in morphTargetNames){var times=[],values=[];for(m=0;m!==animationKeys[k].morphTargets.length;++m){var animationKey=animationKeys[k];times.push(animationKey.time),values.push(animationKey.morphTarget===morphTargetName?1:0)}tracks.push(new NumberKeyframeTrack(".morphTargetInfluence["+morphTargetName+"]",times,values))}duration=morphTargetNames.length*(fps||1)}else{var boneName=".bones["+bones[h].name+"]";addNonemptyTrack(VectorKeyframeTrack,boneName+".position",animationKeys,"pos",tracks),addNonemptyTrack(QuaternionKeyframeTrack,boneName+".quaternion",animationKeys,"rot",tracks),addNonemptyTrack(VectorKeyframeTrack,boneName+".scale",animationKeys,"scl",tracks)}}return 0===tracks.length?null:new AnimationClip(clipName,duration,tracks)}}),Object.assign(MaterialLoader.prototype,{load:function(url,onLoad,onProgress,onError){var scope=this;new FileLoader(scope.manager).load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},setTextures:function(value){this.textures=value},parse:function(json){var textures=this.textures;function getTexture(name){return void 0===textures[name]&&console.warn("THREE.MaterialLoader: Undefined texture",name),textures[name]}var material=new Materials[json.type];if(void 0!==json.uuid&&(material.uuid=json.uuid),void 0!==json.name&&(material.name=json.name),void 0!==json.color&&material.color.setHex(json.color),void 0!==json.roughness&&(material.roughness=json.roughness),void 0!==json.metalness&&(material.metalness=json.metalness),void 0!==json.emissive&&material.emissive.setHex(json.emissive),void 0!==json.specular&&material.specular.setHex(json.specular),void 0!==json.shininess&&(material.shininess=json.shininess),void 0!==json.clearCoat&&(material.clearCoat=json.clearCoat),void 0!==json.clearCoatRoughness&&(material.clearCoatRoughness=json.clearCoatRoughness),void 0!==json.uniforms&&(material.uniforms=json.uniforms),void 0!==json.vertexShader&&(material.vertexShader=json.vertexShader),void 0!==json.fragmentShader&&(material.fragmentShader=json.fragmentShader),void 0!==json.vertexColors&&(material.vertexColors=json.vertexColors),void 0!==json.fog&&(material.fog=json.fog),void 0!==json.shading&&(material.shading=json.shading),void 0!==json.blending&&(material.blending=json.blending),void 0!==json.side&&(material.side=json.side),void 0!==json.opacity&&(material.opacity=json.opacity),void 0!==json.transparent&&(material.transparent=json.transparent),void 0!==json.alphaTest&&(material.alphaTest=json.alphaTest),void 0!==json.depthTest&&(material.depthTest=json.depthTest),void 0!==json.depthWrite&&(material.depthWrite=json.depthWrite),void 0!==json.colorWrite&&(material.colorWrite=json.colorWrite),void 0!==json.wireframe&&(material.wireframe=json.wireframe),void 0!==json.wireframeLinewidth&&(material.wireframeLinewidth=json.wireframeLinewidth),void 0!==json.wireframeLinecap&&(material.wireframeLinecap=json.wireframeLinecap),void 0!==json.wireframeLinejoin&&(material.wireframeLinejoin=json.wireframeLinejoin),void 0!==json.skinning&&(material.skinning=json.skinning),void 0!==json.morphTargets&&(material.morphTargets=json.morphTargets),void 0!==json.size&&(material.size=json.size),void 0!==json.sizeAttenuation&&(material.sizeAttenuation=json.sizeAttenuation),void 0!==json.map&&(material.map=getTexture(json.map)),void 0!==json.alphaMap&&(material.alphaMap=getTexture(json.alphaMap),material.transparent=!0),void 0!==json.bumpMap&&(material.bumpMap=getTexture(json.bumpMap)),void 0!==json.bumpScale&&(material.bumpScale=json.bumpScale),void 0!==json.normalMap&&(material.normalMap=getTexture(json.normalMap)),void 0!==json.normalScale){var normalScale=json.normalScale;!1===Array.isArray(normalScale)&&(normalScale=[normalScale,normalScale]),material.normalScale=(new Vector2).fromArray(normalScale)}if(void 0!==json.displacementMap&&(material.displacementMap=getTexture(json.displacementMap)),void 0!==json.displacementScale&&(material.displacementScale=json.displacementScale),void 0!==json.displacementBias&&(material.displacementBias=json.displacementBias),void 0!==json.roughnessMap&&(material.roughnessMap=getTexture(json.roughnessMap)),void 0!==json.metalnessMap&&(material.metalnessMap=getTexture(json.metalnessMap)),void 0!==json.emissiveMap&&(material.emissiveMap=getTexture(json.emissiveMap)),void 0!==json.emissiveIntensity&&(material.emissiveIntensity=json.emissiveIntensity),void 0!==json.specularMap&&(material.specularMap=getTexture(json.specularMap)),void 0!==json.envMap&&(material.envMap=getTexture(json.envMap)),void 0!==json.reflectivity&&(material.reflectivity=json.reflectivity),void 0!==json.lightMap&&(material.lightMap=getTexture(json.lightMap)),void 0!==json.lightMapIntensity&&(material.lightMapIntensity=json.lightMapIntensity),void 0!==json.aoMap&&(material.aoMap=getTexture(json.aoMap)),void 0!==json.aoMapIntensity&&(material.aoMapIntensity=json.aoMapIntensity),void 0!==json.gradientMap&&(material.gradientMap=getTexture(json.gradientMap)),void 0!==json.materials)for(var i=0,l=json.materials.length;i<l;i++)material.materials.push(this.parse(json.materials[i]));return material}}),Object.assign(BufferGeometryLoader.prototype,{load:function(url,onLoad,onProgress,onError){var scope=this;new FileLoader(scope.manager).load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},parse:function(json){var geometry=new BufferGeometry,index=json.data.index,TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};if(void 0!==index){var typedArray=new TYPED_ARRAYS[index.type](index.array);geometry.setIndex(new BufferAttribute(typedArray,1))}var attributes=json.data.attributes;for(var key in attributes){var attribute=attributes[key];typedArray=new TYPED_ARRAYS[attribute.type](attribute.array);geometry.addAttribute(key,new BufferAttribute(typedArray,attribute.itemSize,attribute.normalized))}var groups=json.data.groups||json.data.drawcalls||json.data.offsets;if(void 0!==groups)for(var i=0,n=groups.length;i!==n;++i){var group=groups[i];geometry.addGroup(group.start,group.count,group.materialIndex)}var boundingSphere=json.data.boundingSphere;if(void 0!==boundingSphere){var center=new Vector3;void 0!==boundingSphere.center&&center.fromArray(boundingSphere.center),geometry.boundingSphere=new Sphere(center,boundingSphere.radius)}return geometry}}),Loader.prototype={constructor:Loader,crossOrigin:void 0,extractUrlBase:function(url){var parts=url.split("/");return 1===parts.length?"./":(parts.pop(),parts.join("/")+"/")},initMaterials:function(materials,texturePath,crossOrigin){for(var array=[],i=0;i<materials.length;++i)array[i]=this.createMaterial(materials[i],texturePath,crossOrigin);return array},createMaterial:function(m,texturePath,crossOrigin){void 0===color&&(color=new Color),void 0===textureLoader&&(textureLoader=new TextureLoader),void 0===materialLoader&&(materialLoader=new MaterialLoader);var textures={};function loadTexture(path,repeat,offset,wrap,anisotropy){var texture,fullPath=texturePath+path,loader=Loader.Handlers.get(fullPath);texture=null!==loader?loader.load(fullPath):(textureLoader.setCrossOrigin(crossOrigin),textureLoader.load(fullPath)),void 0!==repeat&&(texture.repeat.fromArray(repeat),1!==repeat[0]&&(texture.wrapS=1e3),1!==repeat[1]&&(texture.wrapT=1e3)),void 0!==offset&&texture.offset.fromArray(offset),void 0!==wrap&&("repeat"===wrap[0]&&(texture.wrapS=1e3),"mirror"===wrap[0]&&(texture.wrapS=1002),"repeat"===wrap[1]&&(texture.wrapT=1e3),"mirror"===wrap[1]&&(texture.wrapT=1002)),void 0!==anisotropy&&(texture.anisotropy=anisotropy);var uuid=_Math.generateUUID();return textures[uuid]=texture,uuid}var json={uuid:_Math.generateUUID(),type:"MeshLambertMaterial"};for(var name in m){var value=m[name];switch(name){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":json.name=value;break;case"blending":json.blending=BlendingMode[value];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",name,"is no longer supported.");break;case"colorDiffuse":json.color=color.fromArray(value).getHex();break;case"colorSpecular":json.specular=color.fromArray(value).getHex();break;case"colorEmissive":json.emissive=color.fromArray(value).getHex();break;case"specularCoef":json.shininess=value;break;case"shading":"basic"===value.toLowerCase()&&(json.type="MeshBasicMaterial"),"phong"===value.toLowerCase()&&(json.type="MeshPhongMaterial"),"standard"===value.toLowerCase()&&(json.type="MeshStandardMaterial");break;case"mapDiffuse":json.map=loadTexture(value,m.mapDiffuseRepeat,m.mapDiffuseOffset,m.mapDiffuseWrap,m.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":json.emissiveMap=loadTexture(value,m.mapEmissiveRepeat,m.mapEmissiveOffset,m.mapEmissiveWrap,m.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":json.lightMap=loadTexture(value,m.mapLightRepeat,m.mapLightOffset,m.mapLightWrap,m.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":json.aoMap=loadTexture(value,m.mapAORepeat,m.mapAOOffset,m.mapAOWrap,m.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":json.bumpMap=loadTexture(value,m.mapBumpRepeat,m.mapBumpOffset,m.mapBumpWrap,m.mapBumpAnisotropy);break;case"mapBumpScale":json.bumpScale=value;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":json.normalMap=loadTexture(value,m.mapNormalRepeat,m.mapNormalOffset,m.mapNormalWrap,m.mapNormalAnisotropy);break;case"mapNormalFactor":json.normalScale=[value,value];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":json.specularMap=loadTexture(value,m.mapSpecularRepeat,m.mapSpecularOffset,m.mapSpecularWrap,m.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":json.metalnessMap=loadTexture(value,m.mapMetalnessRepeat,m.mapMetalnessOffset,m.mapMetalnessWrap,m.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":json.roughnessMap=loadTexture(value,m.mapRoughnessRepeat,m.mapRoughnessOffset,m.mapRoughnessWrap,m.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":json.alphaMap=loadTexture(value,m.mapAlphaRepeat,m.mapAlphaOffset,m.mapAlphaWrap,m.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":json.side=BackSide;break;case"doubleSided":json.side=DoubleSide;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),json.opacity=value;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":json[name]=value;break;case"vertexColors":!0===value&&(json.vertexColors=2),"face"===value&&(json.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",name,value)}}return"MeshBasicMaterial"===json.type&&delete json.emissive,"MeshPhongMaterial"!==json.type&&delete json.specular,json.opacity<1&&(json.transparent=!0),materialLoader.setTextures(textures),materialLoader.parse(json)}},Loader.Handlers={handlers:[],add:function(regex,loader){this.handlers.push(regex,loader)},get:function(file){for(var handlers=this.handlers,i=0,l=handlers.length;i<l;i+=2){var regex=handlers[i],loader=handlers[i+1];if(regex.test(file))return loader}return null}},Object.assign(JSONLoader.prototype,{load:function(url,onLoad,onProgress,onError){var scope=this,texturePath=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:Loader.prototype.extractUrlBase(url),loader=new FileLoader(this.manager);loader.setWithCredentials(this.withCredentials),loader.load(url,function(text){var json=JSON.parse(text),metadata=json.metadata;if(void 0!==metadata){var type=metadata.type;if(void 0!==type){if("object"===type.toLowerCase())return void console.error("THREE.JSONLoader: "+url+" should be loaded with THREE.ObjectLoader instead.");if("scene"===type.toLowerCase())return void console.error("THREE.JSONLoader: "+url+" should be loaded with THREE.SceneLoader instead.")}}var object=scope.parse(json,texturePath);onLoad(object.geometry,object.materials)},onProgress,onError)},setTexturePath:function(value){this.texturePath=value},parse:function(json,texturePath){var geometry=new Geometry,scale=void 0!==json.scale?1/json.scale:1;if(function(scale){function isBitSet(value,position){return value&1<<position}var i,j,fi,offset,zLength,colorIndex,normalIndex,uvIndex,materialIndex,type,isQuad,hasMaterial,hasFaceVertexUv,hasFaceNormal,hasFaceVertexNormal,hasFaceColor,hasFaceVertexColor,vertex,face,faceA,faceB,hex,normal,uvLayer,uv,u,v,faces=json.faces,vertices=json.vertices,normals=json.normals,colors=json.colors,nUvLayers=0;if(void 0!==json.uvs){for(i=0;i<json.uvs.length;i++)json.uvs[i].length&&nUvLayers++;for(i=0;i<nUvLayers;i++)geometry.faceVertexUvs[i]=[]}offset=0,zLength=vertices.length;for(;offset<zLength;)(vertex=new Vector3).x=vertices[offset++]*scale,vertex.y=vertices[offset++]*scale,vertex.z=vertices[offset++]*scale,geometry.vertices.push(vertex);offset=0,zLength=faces.length;for(;offset<zLength;)if(type=faces[offset++],isQuad=isBitSet(type,0),hasMaterial=isBitSet(type,1),hasFaceVertexUv=isBitSet(type,3),hasFaceNormal=isBitSet(type,4),hasFaceVertexNormal=isBitSet(type,5),hasFaceColor=isBitSet(type,6),hasFaceVertexColor=isBitSet(type,7),isQuad){if((faceA=new Face3).a=faces[offset],faceA.b=faces[offset+1],faceA.c=faces[offset+3],(faceB=new Face3).a=faces[offset+1],faceB.b=faces[offset+2],faceB.c=faces[offset+3],offset+=4,hasMaterial&&(materialIndex=faces[offset++],faceA.materialIndex=materialIndex,faceB.materialIndex=materialIndex),fi=geometry.faces.length,hasFaceVertexUv)for(i=0;i<nUvLayers;i++)for(uvLayer=json.uvs[i],geometry.faceVertexUvs[i][fi]=[],geometry.faceVertexUvs[i][fi+1]=[],j=0;j<4;j++)uvIndex=faces[offset++],u=uvLayer[2*uvIndex],v=uvLayer[2*uvIndex+1],uv=new Vector2(u,v),2!==j&&geometry.faceVertexUvs[i][fi].push(uv),0!==j&&geometry.faceVertexUvs[i][fi+1].push(uv);if(hasFaceNormal&&(normalIndex=3*faces[offset++],faceA.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]),faceB.normal.copy(faceA.normal)),hasFaceVertexNormal)for(i=0;i<4;i++)normalIndex=3*faces[offset++],normal=new Vector3(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]),2!==i&&faceA.vertexNormals.push(normal),0!==i&&faceB.vertexNormals.push(normal);if(hasFaceColor&&(colorIndex=faces[offset++],hex=colors[colorIndex],faceA.color.setHex(hex),faceB.color.setHex(hex)),hasFaceVertexColor)for(i=0;i<4;i++)colorIndex=faces[offset++],hex=colors[colorIndex],2!==i&&faceA.vertexColors.push(new Color(hex)),0!==i&&faceB.vertexColors.push(new Color(hex));geometry.faces.push(faceA),geometry.faces.push(faceB)}else{if((face=new Face3).a=faces[offset++],face.b=faces[offset++],face.c=faces[offset++],hasMaterial&&(materialIndex=faces[offset++],face.materialIndex=materialIndex),fi=geometry.faces.length,hasFaceVertexUv)for(i=0;i<nUvLayers;i++)for(uvLayer=json.uvs[i],geometry.faceVertexUvs[i][fi]=[],j=0;j<3;j++)uvIndex=faces[offset++],u=uvLayer[2*uvIndex],v=uvLayer[2*uvIndex+1],uv=new Vector2(u,v),geometry.faceVertexUvs[i][fi].push(uv);if(hasFaceNormal&&(normalIndex=3*faces[offset++],face.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex])),hasFaceVertexNormal)for(i=0;i<3;i++)normalIndex=3*faces[offset++],normal=new Vector3(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]),face.vertexNormals.push(normal);if(hasFaceColor&&(colorIndex=faces[offset++],face.color.setHex(colors[colorIndex])),hasFaceVertexColor)for(i=0;i<3;i++)colorIndex=faces[offset++],face.vertexColors.push(new Color(colors[colorIndex]));geometry.faces.push(face)}}(scale),function(){var influencesPerVertex=void 0!==json.influencesPerVertex?json.influencesPerVertex:2;if(json.skinWeights)for(var i=0,l=json.skinWeights.length;i<l;i+=influencesPerVertex){var x=json.skinWeights[i],y=1<influencesPerVertex?json.skinWeights[i+1]:0,z=2<influencesPerVertex?json.skinWeights[i+2]:0,w=3<influencesPerVertex?json.skinWeights[i+3]:0;geometry.skinWeights.push(new Vector4(x,y,z,w))}if(json.skinIndices)for(i=0,l=json.skinIndices.length;i<l;i+=influencesPerVertex){var a=json.skinIndices[i],b=1<influencesPerVertex?json.skinIndices[i+1]:0,c=2<influencesPerVertex?json.skinIndices[i+2]:0,d=3<influencesPerVertex?json.skinIndices[i+3]:0;geometry.skinIndices.push(new Vector4(a,b,c,d))}geometry.bones=json.bones,geometry.bones&&0<geometry.bones.length&&(geometry.skinWeights.length!==geometry.skinIndices.length||geometry.skinIndices.length!==geometry.vertices.length)&&console.warn("When skinning, number of vertices ("+geometry.vertices.length+"), skinIndices ("+geometry.skinIndices.length+"), and skinWeights ("+geometry.skinWeights.length+") should match.")}(),function(scale){if(void 0!==json.morphTargets)for(var i=0,l=json.morphTargets.length;i<l;i++){geometry.morphTargets[i]={},geometry.morphTargets[i].name=json.morphTargets[i].name,geometry.morphTargets[i].vertices=[];for(var dstVertices=geometry.morphTargets[i].vertices,srcVertices=json.morphTargets[i].vertices,v=0,vl=srcVertices.length;v<vl;v+=3){var vertex=new Vector3;vertex.x=srcVertices[v]*scale,vertex.y=srcVertices[v+1]*scale,vertex.z=srcVertices[v+2]*scale,dstVertices.push(vertex)}}if(void 0!==json.morphColors&&0<json.morphColors.length){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var faces=geometry.faces,morphColors=json.morphColors[0].colors;for(i=0,l=faces.length;i<l;i++)faces[i].color.fromArray(morphColors,3*i)}}(scale),function(){var outputAnimations=[],animations=[];void 0!==json.animation&&animations.push(json.animation);void 0!==json.animations&&(json.animations.length?animations=animations.concat(json.animations):animations.push(json.animations));for(var i=0;i<animations.length;i++){var clip=AnimationClip.parseAnimation(animations[i],geometry.bones);clip&&outputAnimations.push(clip)}if(geometry.morphTargets){var morphAnimationClips=AnimationClip.CreateClipsFromMorphTargetSequences(geometry.morphTargets,10);outputAnimations=outputAnimations.concat(morphAnimationClips)}0<outputAnimations.length&&(geometry.animations=outputAnimations)}(),geometry.computeFaceNormals(),geometry.computeBoundingSphere(),void 0===json.materials||0===json.materials.length)return{geometry:geometry};var materials=Loader.prototype.initMaterials(json.materials,texturePath,this.crossOrigin);return{geometry:geometry,materials:materials}}}),Object.assign(ObjectLoader.prototype,{load:function(url,onLoad,onProgress,onError){""===this.texturePath&&(this.texturePath=url.substring(0,url.lastIndexOf("/")+1));var scope=this;new FileLoader(scope.manager).load(url,function(text){var json=null;try{json=JSON.parse(text)}catch(error){return void console.error("THREE:ObjectLoader: Can't parse "+url+".",error.message)}var metadata=json.metadata;void 0!==metadata&&void 0!==metadata.type&&"geometry"!==metadata.type.toLowerCase()?scope.parse(json,onLoad):console.error("THREE.ObjectLoader: Can't load "+url+". Use THREE.JSONLoader instead.")},onProgress,onError)},setTexturePath:function(value){this.texturePath=value},setCrossOrigin:function(value){this.crossOrigin=value},parse:function(json,onLoad){var geometries=this.parseGeometries(json.geometries),images=this.parseImages(json.images,function(){void 0!==onLoad&&onLoad(object)}),textures=this.parseTextures(json.textures,images),materials=this.parseMaterials(json.materials,textures),object=this.parseObject(json.object,geometries,materials);return json.animations&&(object.animations=this.parseAnimations(json.animations)),void 0!==json.images&&0!==json.images.length||void 0!==onLoad&&onLoad(object),object},parseGeometries:function(json){var geometries={};if(void 0!==json)for(var geometryLoader=new JSONLoader,bufferGeometryLoader=new BufferGeometryLoader,i=0,l=json.length;i<l;i++){var geometry,data=json[i];switch(data.type){case"PlaneGeometry":case"PlaneBufferGeometry":geometry=new Geometries[data.type](data.width,data.height,data.widthSegments,data.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":geometry=new Geometries[data.type](data.width,data.height,data.depth,data.widthSegments,data.heightSegments,data.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":geometry=new Geometries[data.type](data.radius,data.segments,data.thetaStart,data.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":geometry=new Geometries[data.type](data.radiusTop,data.radiusBottom,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":geometry=new Geometries[data.type](data.radius,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":geometry=new Geometries[data.type](data.radius,data.widthSegments,data.heightSegments,data.phiStart,data.phiLength,data.thetaStart,data.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":geometry=new Geometries[data.type](data.radius,data.detail);break;case"RingGeometry":case"RingBufferGeometry":geometry=new Geometries[data.type](data.innerRadius,data.outerRadius,data.thetaSegments,data.phiSegments,data.thetaStart,data.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":geometry=new Geometries[data.type](data.radius,data.tube,data.radialSegments,data.tubularSegments,data.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":geometry=new Geometries[data.type](data.radius,data.tube,data.tubularSegments,data.radialSegments,data.p,data.q);break;case"LatheGeometry":case"LatheBufferGeometry":geometry=new Geometries[data.type](data.points,data.segments,data.phiStart,data.phiLength);break;case"BufferGeometry":geometry=bufferGeometryLoader.parse(data);break;case"Geometry":geometry=geometryLoader.parse(data.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+data.type+'"');continue}geometry.uuid=data.uuid,void 0!==data.name&&(geometry.name=data.name),geometries[data.uuid]=geometry}return geometries},parseMaterials:function(json,textures){var materials={};if(void 0!==json){var loader=new MaterialLoader;loader.setTextures(textures);for(var i=0,l=json.length;i<l;i++){var material=loader.parse(json[i]);materials[material.uuid]=material}}return materials},parseAnimations:function(json){for(var animations=[],i=0;i<json.length;i++){var clip=AnimationClip.parse(json[i]);animations.push(clip)}return animations},parseImages:function(json,onLoad){var scope=this,images={};function loadImage(url){return scope.manager.itemStart(url),loader.load(url,function(){scope.manager.itemEnd(url)},void 0,function(){scope.manager.itemError(url)})}if(void 0!==json&&0<json.length){var loader=new ImageLoader(new LoadingManager(onLoad));loader.setCrossOrigin(this.crossOrigin);for(var i=0,l=json.length;i<l;i++){var image=json[i],path=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(image.url)?image.url:scope.texturePath+image.url;images[image.uuid]=loadImage(path)}}return images},parseTextures:function(json,images){function parseConstant(value,type){return"number"==typeof value?value:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",value),type[value])}var textures={};if(void 0!==json)for(var i=0,l=json.length;i<l;i++){var data=json[i];void 0===data.image&&console.warn('THREE.ObjectLoader: No "image" specified for',data.uuid),void 0===images[data.image]&&console.warn("THREE.ObjectLoader: Undefined image",data.image);var texture=new Texture(images[data.image]);texture.needsUpdate=!0,texture.uuid=data.uuid,void 0!==data.name&&(texture.name=data.name),void 0!==data.mapping&&(texture.mapping=parseConstant(data.mapping,TextureMapping)),void 0!==data.offset&&texture.offset.fromArray(data.offset),void 0!==data.repeat&&texture.repeat.fromArray(data.repeat),void 0!==data.wrap&&(texture.wrapS=parseConstant(data.wrap[0],TextureWrapping),texture.wrapT=parseConstant(data.wrap[1],TextureWrapping)),void 0!==data.minFilter&&(texture.minFilter=parseConstant(data.minFilter,TextureFilter)),void 0!==data.magFilter&&(texture.magFilter=parseConstant(data.magFilter,TextureFilter)),void 0!==data.anisotropy&&(texture.anisotropy=data.anisotropy),void 0!==data.flipY&&(texture.flipY=data.flipY),textures[data.uuid]=texture}return textures},parseObject:function(){var matrix=new Matrix4;return function(data,geometries,materials){var object;function getGeometry(name){return void 0===geometries[name]&&console.warn("THREE.ObjectLoader: Undefined geometry",name),geometries[name]}function getMaterial(name){if(void 0!==name)return void 0===materials[name]&&console.warn("THREE.ObjectLoader: Undefined material",name),materials[name]}switch(data.type){case"Scene":object=new Scene,void 0!==data.background&&Number.isInteger(data.background)&&(object.background=new Color(data.background)),void 0!==data.fog&&("Fog"===data.fog.type?object.fog=new Fog(data.fog.color,data.fog.near,data.fog.far):"FogExp2"===data.fog.type&&(object.fog=new FogExp2(data.fog.color,data.fog.density)));break;case"PerspectiveCamera":object=new PerspectiveCamera(data.fov,data.aspect,data.near,data.far),void 0!==data.focus&&(object.focus=data.focus),void 0!==data.zoom&&(object.zoom=data.zoom),void 0!==data.filmGauge&&(object.filmGauge=data.filmGauge),void 0!==data.filmOffset&&(object.filmOffset=data.filmOffset),void 0!==data.view&&(object.view=Object.assign({},data.view));break;case"OrthographicCamera":object=new OrthographicCamera(data.left,data.right,data.top,data.bottom,data.near,data.far);break;case"AmbientLight":object=new AmbientLight(data.color,data.intensity);break;case"DirectionalLight":object=new DirectionalLight(data.color,data.intensity);break;case"PointLight":object=new PointLight(data.color,data.intensity,data.distance,data.decay);break;case"SpotLight":object=new SpotLight(data.color,data.intensity,data.distance,data.angle,data.penumbra,data.decay);break;case"HemisphereLight":object=new HemisphereLight(data.color,data.groundColor,data.intensity);break;case"Mesh":var geometry=getGeometry(data.geometry),material=getMaterial(data.material);object=geometry.bones&&0<geometry.bones.length?new SkinnedMesh(geometry,material):new Mesh(geometry,material);break;case"LOD":object=new LOD;break;case"Line":object=new Line(getGeometry(data.geometry),getMaterial(data.material),data.mode);break;case"LineSegments":object=new LineSegments(getGeometry(data.geometry),getMaterial(data.material));break;case"PointCloud":case"Points":object=new Points(getGeometry(data.geometry),getMaterial(data.material));break;case"Sprite":object=new Sprite(getMaterial(data.material));break;case"Group":object=new Group;break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh type. Instantiates Object3D instead.");default:object=new Object3D}if(object.uuid=data.uuid,void 0!==data.name&&(object.name=data.name),void 0!==data.matrix?(matrix.fromArray(data.matrix),matrix.decompose(object.position,object.quaternion,object.scale)):(void 0!==data.position&&object.position.fromArray(data.position),void 0!==data.rotation&&object.rotation.fromArray(data.rotation),void 0!==data.quaternion&&object.quaternion.fromArray(data.quaternion),void 0!==data.scale&&object.scale.fromArray(data.scale)),void 0!==data.castShadow&&(object.castShadow=data.castShadow),void 0!==data.receiveShadow&&(object.receiveShadow=data.receiveShadow),data.shadow&&(void 0!==data.shadow.bias&&(object.shadow.bias=data.shadow.bias),void 0!==data.shadow.radius&&(object.shadow.radius=data.shadow.radius),void 0!==data.shadow.mapSize&&object.shadow.mapSize.fromArray(data.shadow.mapSize),void 0!==data.shadow.camera&&(object.shadow.camera=this.parseObject(data.shadow.camera))),void 0!==data.visible&&(object.visible=data.visible),void 0!==data.userData&&(object.userData=data.userData),void 0!==data.children)for(var child in data.children)object.add(this.parseObject(data.children[child],geometries,materials));if("LOD"===data.type)for(var levels=data.levels,l=0;l<levels.length;l++){var level=levels[l];void 0!==(child=object.getObjectByProperty("uuid",level.object))&&object.addLevel(child,level.distance)}return object}}()}),Curve.prototype={constructor:Curve,getPoint:function(t){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},getPointAt:function(u){var t=this.getUtoTmapping(u);return this.getPoint(t)},getPoints:function(divisions){divisions||(divisions=5);for(var points=[],d=0;d<=divisions;d++)points.push(this.getPoint(d/divisions));return points},getSpacedPoints:function(divisions){divisions||(divisions=5);for(var points=[],d=0;d<=divisions;d++)points.push(this.getPointAt(d/divisions));return points},getLength:function(){var lengths=this.getLengths();return lengths[lengths.length-1]},getLengths:function(divisions){if(divisions||(divisions=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===divisions+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var current,p,cache=[],last=this.getPoint(0),sum=0;for(cache.push(0),p=1;p<=divisions;p++)sum+=(current=this.getPoint(p/divisions)).distanceTo(last),cache.push(sum),last=current;return this.cacheArcLengths=cache},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(u,distance){var targetArcLength,arcLengths=this.getLengths(),i=0,il=arcLengths.length;targetArcLength=distance||u*arcLengths[il-1];for(var comparison,low=0,high=il-1;low<=high;)if((comparison=arcLengths[i=Math.floor(low+(high-low)/2)]-targetArcLength)<0)low=i+1;else{if(!(0<comparison)){high=i;break}high=i-1}if(arcLengths[i=high]===targetArcLength)return i/(il-1);var lengthBefore=arcLengths[i];return(i+(targetArcLength-lengthBefore)/(arcLengths[i+1]-lengthBefore))/(il-1)},getTangent:function(t){var t1=t-1e-4,t2=t+1e-4;t1<0&&(t1=0),1<t2&&(t2=1);var pt1=this.getPoint(t1);return this.getPoint(t2).clone().sub(pt1).normalize()},getTangentAt:function(u){var t=this.getUtoTmapping(u);return this.getTangent(t)},computeFrenetFrames:function(segments,closed){var i,u,theta,normal=new Vector3,tangents=[],normals=[],binormals=[],vec=new Vector3,mat=new Matrix4;for(i=0;i<=segments;i++)u=i/segments,tangents[i]=this.getTangentAt(u),tangents[i].normalize();normals[0]=new Vector3,binormals[0]=new Vector3;var min=Number.MAX_VALUE,tx=Math.abs(tangents[0].x),ty=Math.abs(tangents[0].y),tz=Math.abs(tangents[0].z);for(tx<=min&&(min=tx,normal.set(1,0,0)),ty<=min&&(min=ty,normal.set(0,1,0)),tz<=min&&normal.set(0,0,1),vec.crossVectors(tangents[0],normal).normalize(),normals[0].crossVectors(tangents[0],vec),binormals[0].crossVectors(tangents[0],normals[0]),i=1;i<=segments;i++)normals[i]=normals[i-1].clone(),binormals[i]=binormals[i-1].clone(),vec.crossVectors(tangents[i-1],tangents[i]),vec.length()>Number.EPSILON&&(vec.normalize(),theta=Math.acos(_Math.clamp(tangents[i-1].dot(tangents[i]),-1,1)),normals[i].applyMatrix4(mat.makeRotationAxis(vec,theta))),binormals[i].crossVectors(tangents[i],normals[i]);if(!0===closed)for(theta=Math.acos(_Math.clamp(normals[0].dot(normals[segments]),-1,1)),theta/=segments,0<tangents[0].dot(vec.crossVectors(normals[0],normals[segments]))&&(theta=-theta),i=1;i<=segments;i++)normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i],theta*i)),binormals[i].crossVectors(tangents[i],normals[i]);return{tangents:tangents,normals:normals,binormals:binormals}}},Curve.create=function(constructor,getPointFunc){return constructor.prototype=Object.create(Curve.prototype),(constructor.prototype.constructor=constructor).prototype.getPoint=getPointFunc,constructor},((LineCurve.prototype=Object.create(Curve.prototype)).constructor=LineCurve).prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(t){if(1===t)return this.v2.clone();var point=this.v2.clone().sub(this.v1);return point.multiplyScalar(t).add(this.v1),point},LineCurve.prototype.getPointAt=function(u){return this.getPoint(u)},LineCurve.prototype.getTangent=function(t){return this.v2.clone().sub(this.v1).normalize()},CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(curve){this.curves.push(curve)},closePath:function(){var startPoint=this.curves[0].getPoint(0),endPoint=this.curves[this.curves.length-1].getPoint(1);startPoint.equals(endPoint)||this.curves.push(new LineCurve(endPoint,startPoint))},getPoint:function(t){for(var d=t*this.getLength(),curveLengths=this.getCurveLengths(),i=0;i<curveLengths.length;){if(curveLengths[i]>=d){var diff=curveLengths[i]-d,curve=this.curves[i],segmentLength=curve.getLength(),u=0===segmentLength?0:1-diff/segmentLength;return curve.getPointAt(u)}i++}return null},getLength:function(){var lens=this.getCurveLengths();return lens[lens.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var lengths=[],sums=0,i=0,l=this.curves.length;i<l;i++)sums+=this.curves[i].getLength(),lengths.push(sums);return this.cacheLengths=lengths},getSpacedPoints:function(divisions){divisions||(divisions=40);for(var points=[],i=0;i<=divisions;i++)points.push(this.getPoint(i/divisions));return this.autoClose&&points.push(points[0]),points},getPoints:function(divisions){divisions=divisions||12;for(var last,points=[],i=0,curves=this.curves;i<curves.length;i++)for(var curve=curves[i],resolution=curve&&curve.isEllipseCurve?2*divisions:curve&&curve.isLineCurve?1:curve&&curve.isSplineCurve?divisions*curve.points.length:divisions,pts=curve.getPoints(resolution),j=0;j<pts.length;j++){var point=pts[j];last&&last.equals(point)||(points.push(point),last=point)}return this.autoClose&&1<points.length&&!points[points.length-1].equals(points[0])&&points.push(points[0]),points},createPointsGeometry:function(divisions){var pts=this.getPoints(divisions);return this.createGeometry(pts)},createSpacedPointsGeometry:function(divisions){var pts=this.getSpacedPoints(divisions);return this.createGeometry(pts)},createGeometry:function(points){for(var geometry=new Geometry,i=0,l=points.length;i<l;i++){var point=points[i];geometry.vertices.push(new Vector3(point.x,point.y,point.z||0))}return geometry}}),((EllipseCurve.prototype=Object.create(Curve.prototype)).constructor=EllipseCurve).prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(t){for(var twoPi=2*Math.PI,deltaAngle=this.aEndAngle-this.aStartAngle,samePoints=Math.abs(deltaAngle)<Number.EPSILON;deltaAngle<0;)deltaAngle+=twoPi;for(;twoPi<deltaAngle;)deltaAngle-=twoPi;deltaAngle<Number.EPSILON&&(deltaAngle=samePoints?0:twoPi),!0!==this.aClockwise||samePoints||(deltaAngle===twoPi?deltaAngle=-twoPi:deltaAngle-=twoPi);var angle=this.aStartAngle+t*deltaAngle,x=this.aX+this.xRadius*Math.cos(angle),y=this.aY+this.yRadius*Math.sin(angle);if(0!==this.aRotation){var cos=Math.cos(this.aRotation),sin=Math.sin(this.aRotation),tx=x-this.aX,ty=y-this.aY;x=tx*cos-ty*sin+this.aX,y=tx*sin+ty*cos+this.aY}return new Vector2(x,y)};var CurveUtils={tangentQuadraticBezier:function(t,p0,p1,p2){return 2*(1-t)*(p1-p0)+2*t*(p2-p1)},tangentCubicBezier:function(t,p0,p1,p2,p3){return-3*p0*(1-t)*(1-t)+3*p1*(1-t)*(1-t)-6*t*p1*(1-t)+6*t*p2*(1-t)-3*t*t*p2+3*t*t*p3},tangentSpline:function(t,p0,p1,p2,p3){return 6*t*t-6*t+(3*t*t-4*t+1)+(-6*t*t+6*t)+(3*t*t-2*t)},interpolate:function(p0,p1,p2,p3,t){var v0=.5*(p2-p0),v1=.5*(p3-p1),t2=t*t;return(2*p1-2*p2+v0+v1)*(t*t2)+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}};function SplineCurve(points){this.points=void 0===points?[]:points}function CubicBezierCurve(v0,v1,v2,v3){this.v0=v0,this.v1=v1,this.v2=v2,this.v3=v3}function QuadraticBezierCurve(v0,v1,v2){this.v0=v0,this.v1=v1,this.v2=v2}((SplineCurve.prototype=Object.create(Curve.prototype)).constructor=SplineCurve).prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(t){var points=this.points,point=(points.length-1)*t,intPoint=Math.floor(point),weight=point-intPoint,point0=points[0===intPoint?intPoint:intPoint-1],point1=points[intPoint],point2=points[intPoint>points.length-2?points.length-1:intPoint+1],point3=points[intPoint>points.length-3?points.length-1:intPoint+2],interpolate=CurveUtils.interpolate;return new Vector2(interpolate(point0.x,point1.x,point2.x,point3.x,weight),interpolate(point0.y,point1.y,point2.y,point3.y,weight))},((CubicBezierCurve.prototype=Object.create(Curve.prototype)).constructor=CubicBezierCurve).prototype.getPoint=function(t){var b3=ShapeUtils.b3;return new Vector2(b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y))},CubicBezierCurve.prototype.getTangent=function(t){var tangentCubicBezier=CurveUtils.tangentCubicBezier;return new Vector2(tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()},((QuadraticBezierCurve.prototype=Object.create(Curve.prototype)).constructor=QuadraticBezierCurve).prototype.getPoint=function(t){var b2=ShapeUtils.b2;return new Vector2(b2(t,this.v0.x,this.v1.x,this.v2.x),b2(t,this.v0.y,this.v1.y,this.v2.y))},QuadraticBezierCurve.prototype.getTangent=function(t){var tangentQuadraticBezier=CurveUtils.tangentQuadraticBezier;return new Vector2(tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x),tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y)).normalize()};var context,PathPrototype=Object.assign(Object.create(CurvePath.prototype),{fromPoints:function(vectors){this.moveTo(vectors[0].x,vectors[0].y);for(var i=1,l=vectors.length;i<l;i++)this.lineTo(vectors[i].x,vectors[i].y)},moveTo:function(x,y){this.currentPoint.set(x,y)},lineTo:function(x,y){var curve=new LineCurve(this.currentPoint.clone(),new Vector2(x,y));this.curves.push(curve),this.currentPoint.set(x,y)},quadraticCurveTo:function(aCPx,aCPy,aX,aY){var curve=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(aCPx,aCPy),new Vector2(aX,aY));this.curves.push(curve),this.currentPoint.set(aX,aY)},bezierCurveTo:function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var curve=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(aCP1x,aCP1y),new Vector2(aCP2x,aCP2y),new Vector2(aX,aY));this.curves.push(curve),this.currentPoint.set(aX,aY)},splineThru:function(pts){var curve=new SplineCurve([this.currentPoint.clone()].concat(pts));this.curves.push(curve),this.currentPoint.copy(pts[pts.length-1])},arc:function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){var x0=this.currentPoint.x,y0=this.currentPoint.y;this.absarc(aX+x0,aY+y0,aRadius,aStartAngle,aEndAngle,aClockwise)},absarc:function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){this.absellipse(aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise)},ellipse:function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){var x0=this.currentPoint.x,y0=this.currentPoint.y;this.absellipse(aX+x0,aY+y0,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation)},absellipse:function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){var curve=new EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation);if(0<this.curves.length){var firstPoint=curve.getPoint(0);firstPoint.equals(this.currentPoint)||this.lineTo(firstPoint.x,firstPoint.y)}this.curves.push(curve);var lastPoint=curve.getPoint(1);this.currentPoint.copy(lastPoint)}});function Shape(){Path.apply(this,arguments),this.holes=[]}function Path(points){CurvePath.call(this),this.currentPoint=new Vector2,points&&this.fromPoints(points)}function ShapePath(){this.subPaths=[],this.currentPath=null}function Font(data){this.data=data}function FontLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}Shape.prototype=Object.assign(Object.create(PathPrototype),{constructor:Shape,getPointsHoles:function(divisions){for(var holesPts=[],i=0,l=this.holes.length;i<l;i++)holesPts[i]=this.holes[i].getPoints(divisions);return holesPts},extractAllPoints:function(divisions){return{shape:this.getPoints(divisions),holes:this.getPointsHoles(divisions)}},extractPoints:function(divisions){return this.extractAllPoints(divisions)}}),(Path.prototype=PathPrototype).constructor=Path,ShapePath.prototype={moveTo:function(x,y){this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(x,y)},lineTo:function(x,y){this.currentPath.lineTo(x,y)},quadraticCurveTo:function(aCPx,aCPy,aX,aY){this.currentPath.quadraticCurveTo(aCPx,aCPy,aX,aY)},bezierCurveTo:function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){this.currentPath.bezierCurveTo(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY)},splineThru:function(pts){this.currentPath.splineThru(pts)},toShapes:function(isCCW,noHoles){function toShapesNoHoles(inSubpaths){for(var shapes=[],i=0,l=inSubpaths.length;i<l;i++){var tmpPath=inSubpaths[i],tmpShape=new Shape;tmpShape.curves=tmpPath.curves,shapes.push(tmpShape)}return shapes}function isPointInsidePolygon(inPt,inPolygon){for(var polyLen=inPolygon.length,inside=!1,p=polyLen-1,q=0;q<polyLen;p=q++){var edgeLowPt=inPolygon[p],edgeHighPt=inPolygon[q],edgeDx=edgeHighPt.x-edgeLowPt.x,edgeDy=edgeHighPt.y-edgeLowPt.y;if(Math.abs(edgeDy)>Number.EPSILON){if(edgeDy<0&&(edgeLowPt=inPolygon[q],edgeDx=-edgeDx,edgeHighPt=inPolygon[p],edgeDy=-edgeDy),inPt.y<edgeLowPt.y||inPt.y>edgeHighPt.y)continue;if(inPt.y===edgeLowPt.y){if(inPt.x===edgeLowPt.x)return!0}else{var perpEdge=edgeDy*(inPt.x-edgeLowPt.x)-edgeDx*(inPt.y-edgeLowPt.y);if(0==perpEdge)return!0;if(perpEdge<0)continue;inside=!inside}}else{if(inPt.y!==edgeLowPt.y)continue;if(edgeHighPt.x<=inPt.x&&inPt.x<=edgeLowPt.x||edgeLowPt.x<=inPt.x&&inPt.x<=edgeHighPt.x)return!0}}return inside}var isClockWise=ShapeUtils.isClockWise,subPaths=this.subPaths;if(0===subPaths.length)return[];if(!0===noHoles)return toShapesNoHoles(subPaths);var solid,tmpPath,tmpShape,shapes=[];if(1===subPaths.length)return tmpPath=subPaths[0],(tmpShape=new Shape).curves=tmpPath.curves,shapes.push(tmpShape),shapes;var holesFirst=!isClockWise(subPaths[0].getPoints());holesFirst=isCCW?!holesFirst:holesFirst;var tmpPoints,tmpHoles,betterShapeHoles=[],newShapes=[],newShapeHoles=[],mainIdx=0;newShapes[mainIdx]=void 0,newShapeHoles[mainIdx]=[];for(var i=0,l=subPaths.length;i<l;i++)solid=isClockWise(tmpPoints=(tmpPath=subPaths[i]).getPoints()),(solid=isCCW?!solid:solid)?(!holesFirst&&newShapes[mainIdx]&&mainIdx++,newShapes[mainIdx]={s:new Shape,p:tmpPoints},newShapes[mainIdx].s.curves=tmpPath.curves,holesFirst&&mainIdx++,newShapeHoles[mainIdx]=[]):newShapeHoles[mainIdx].push({h:tmpPath,p:tmpPoints[0]});if(!newShapes[0])return toShapesNoHoles(subPaths);if(1<newShapes.length){for(var ambiguous=!1,toChange=[],sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++)betterShapeHoles[sIdx]=[];for(sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++)for(var sho=newShapeHoles[sIdx],hIdx=0;hIdx<sho.length;hIdx++){for(var ho=sho[hIdx],hole_unassigned=!0,s2Idx=0;s2Idx<newShapes.length;s2Idx++)isPointInsidePolygon(ho.p,newShapes[s2Idx].p)&&(sIdx!==s2Idx&&toChange.push({froms:sIdx,tos:s2Idx,hole:hIdx}),hole_unassigned?(hole_unassigned=!1,betterShapeHoles[s2Idx].push(ho)):ambiguous=!0);hole_unassigned&&betterShapeHoles[sIdx].push(ho)}0<toChange.length&&(ambiguous||(newShapeHoles=betterShapeHoles))}i=0;for(var il=newShapes.length;i<il;i++){tmpShape=newShapes[i].s,shapes.push(tmpShape);for(var j=0,jl=(tmpHoles=newShapeHoles[i]).length;j<jl;j++)tmpShape.holes.push(tmpHoles[j].h)}return shapes}},Object.assign(Font.prototype,{isFont:!0,generateShapes:function(text,size,divisions){function createPath(c,scale,offset){var glyph=data.glyphs[c]||data.glyphs["?"];if(glyph){var x,y,cpx,cpy,cpx0,cpy0,cpx1,cpy1,cpx2,cpy2,laste,path=new ShapePath,pts=[],b2=ShapeUtils.b2,b3=ShapeUtils.b3;if(glyph.o)for(var outline=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(" ")),i=0,l=outline.length;i<l;){switch(outline[i++]){case"m":x=outline[i++]*scale+offset,y=outline[i++]*scale,path.moveTo(x,y);break;case"l":x=outline[i++]*scale+offset,y=outline[i++]*scale,path.lineTo(x,y);break;case"q":if(cpx=outline[i++]*scale+offset,cpy=outline[i++]*scale,cpx1=outline[i++]*scale+offset,cpy1=outline[i++]*scale,path.quadraticCurveTo(cpx1,cpy1,cpx,cpy),laste=pts[pts.length-1]){cpx0=laste.x,cpy0=laste.y;for(var i2=1;i2<=divisions;i2++){b2(t=i2/divisions,cpx0,cpx1,cpx),b2(t,cpy0,cpy1,cpy)}}break;case"b":if(cpx=outline[i++]*scale+offset,cpy=outline[i++]*scale,cpx1=outline[i++]*scale+offset,cpy1=outline[i++]*scale,cpx2=outline[i++]*scale+offset,cpy2=outline[i++]*scale,path.bezierCurveTo(cpx1,cpy1,cpx2,cpy2,cpx,cpy),laste=pts[pts.length-1]){cpx0=laste.x,cpy0=laste.y;for(i2=1;i2<=divisions;i2++){var t;b3(t=i2/divisions,cpx0,cpx1,cpx2,cpx),b3(t,cpy0,cpy1,cpy2,cpy)}}}}return{offset:glyph.ha*scale,path:path}}}void 0===size&&(size=100),void 0===divisions&&(divisions=4);for(var data=this.data,paths=function(text){for(var chars=String(text).split(""),scale=size/data.resolution,offset=0,paths=[],i=0;i<chars.length;i++){var ret=createPath(chars[i],scale,offset);offset+=ret.offset,paths.push(ret.path)}return paths}(text),shapes=[],p=0,pl=paths.length;p<pl;p++)Array.prototype.push.apply(shapes,paths[p].toShapes());return shapes}}),Object.assign(FontLoader.prototype,{load:function(url,onLoad,onProgress,onError){var scope=this;new FileLoader(this.manager).load(url,function(text){var json;try{json=JSON.parse(text)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),json=JSON.parse(text.substring(65,text.length-2))}var font=scope.parse(json);onLoad&&onLoad(font)},onProgress,onError)},parse:function(json){return new Font(json)}});var instance,focus,fov,aspect,near,far,zoom,eyeRight,eyeLeft,vector,vector2,AudioContext={getContext:function(){return void 0===context&&(context=new(window.AudioContext||window.webkitAudioContext)),context},setContext:function(value){context=value}};function AudioLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}function RectAreaLight(color,intensity,width,height){Light.call(this,color,intensity),this.type="RectAreaLight",this.position.set(0,1,0),this.updateMatrix(),this.width=void 0!==width?width:10,this.height=void 0!==height?height:10}function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function CubeCamera(near,far,cubeResolution){Object3D.call(this),this.type="CubeCamera";var cameraPX=new PerspectiveCamera(90,1,near,far);cameraPX.up.set(0,-1,0),cameraPX.lookAt(new Vector3(1,0,0)),this.add(cameraPX);var cameraNX=new PerspectiveCamera(90,1,near,far);cameraNX.up.set(0,-1,0),cameraNX.lookAt(new Vector3(-1,0,0)),this.add(cameraNX);var cameraPY=new PerspectiveCamera(90,1,near,far);cameraPY.up.set(0,0,1),cameraPY.lookAt(new Vector3(0,1,0)),this.add(cameraPY);var cameraNY=new PerspectiveCamera(90,1,near,far);cameraNY.up.set(0,0,-1),cameraNY.lookAt(new Vector3(0,-1,0)),this.add(cameraNY);var cameraPZ=new PerspectiveCamera(90,1,near,far);cameraPZ.up.set(0,-1,0),cameraPZ.lookAt(new Vector3(0,0,1)),this.add(cameraPZ);var cameraNZ=new PerspectiveCamera(90,1,near,far);cameraNZ.up.set(0,-1,0),cameraNZ.lookAt(new Vector3(0,0,-1)),this.add(cameraNZ);var options={format:RGBFormat,magFilter:LinearFilter,minFilter:LinearFilter};this.renderTarget=new WebGLRenderTargetCube(cubeResolution,cubeResolution,options),this.updateCubeMap=function(renderer,scene){null===this.parent&&this.updateMatrixWorld();var renderTarget=this.renderTarget,generateMipmaps=renderTarget.texture.generateMipmaps;renderTarget.texture.generateMipmaps=!1,renderTarget.activeCubeFace=0,renderer.render(scene,cameraPX,renderTarget),renderTarget.activeCubeFace=1,renderer.render(scene,cameraNX,renderTarget),renderTarget.activeCubeFace=2,renderer.render(scene,cameraPY,renderTarget),renderTarget.activeCubeFace=3,renderer.render(scene,cameraNY,renderTarget),renderTarget.activeCubeFace=4,renderer.render(scene,cameraPZ,renderTarget),renderTarget.texture.generateMipmaps=generateMipmaps,renderTarget.activeCubeFace=5,renderer.render(scene,cameraNZ,renderTarget),renderer.setRenderTarget(null)}}function AudioListener(){Object3D.call(this),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Audio(listener){Object3D.call(this),this.type="Audio",this.context=listener.context,this.gain=this.context.createGain(),this.gain.connect(listener.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function PositionalAudio(listener){Audio.call(this,listener),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function AudioAnalyser(audio,fftSize){this.analyser=audio.context.createAnalyser(),this.analyser.fftSize=void 0!==fftSize?fftSize:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),audio.getOutput().connect(this.analyser)}function PropertyMixer(binding,typeName,valueSize){this.binding=binding,this.valueSize=valueSize;var mixFunction,bufferType=Float64Array;switch(typeName){case"quaternion":mixFunction=this._slerp;break;case"string":case"bool":bufferType=Array,mixFunction=this._select;break;default:mixFunction=this._lerp}this.buffer=new bufferType(4*valueSize),this._mixBufferRegion=mixFunction,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function PropertyBinding(rootNode,path,parsedPath){this.path=path,this.parsedPath=parsedPath||PropertyBinding.parseTrackName(path),this.node=PropertyBinding.findNode(rootNode,this.parsedPath.nodeName)||rootNode,this.rootNode=rootNode}function AnimationObjectGroup(var_args){this.uuid=_Math.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var indices={};this._indicesByUUID=indices;for(var i=0,n=arguments.length;i!==n;++i)indices[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var scope=this;this.stats={objects:{get total(){return scope._objects.length},get inUse(){return this.total-scope.nCachedObjects_}},get bindingsPerObject(){return scope._bindings.length}}}function AnimationAction(mixer,clip,localRoot){this._mixer=mixer,this._clip=clip,this._localRoot=localRoot||null;for(var tracks=clip.tracks,nTracks=tracks.length,interpolants=new Array(nTracks),interpolantSettings={endingStart:2400,endingEnd:2400},i=0;i!==nTracks;++i){var interpolant=tracks[i].createInterpolant(null);(interpolants[i]=interpolant).settings=interpolantSettings}this._interpolantSettings=interpolantSettings,this._interpolants=interpolants,this._propertyBindings=new Array(nTracks),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function AnimationMixer(root){this._root=root,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Uniform(value){"string"==typeof value&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),value=arguments[1]),this.value=value}function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function InterleavedBufferAttribute(interleavedBuffer,itemSize,offset,normalized){this.uuid=_Math.generateUUID(),this.data=interleavedBuffer,this.itemSize=itemSize,this.offset=offset,this.normalized=!0===normalized}function InterleavedBuffer(array,stride){this.uuid=_Math.generateUUID(),this.array=array,this.stride=stride,this.count=void 0!==array?array.length/stride:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function InstancedInterleavedBuffer(array,stride,meshPerAttribute){InterleavedBuffer.call(this,array,stride),this.meshPerAttribute=meshPerAttribute||1}function InstancedBufferAttribute(array,itemSize,meshPerAttribute){BufferAttribute.call(this,array,itemSize),this.meshPerAttribute=meshPerAttribute||1}function Raycaster(origin,direction,near,far){this.ray=new Ray(origin,direction),this.near=near||0,this.far=far||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(a,b){return a.distance-b.distance}function intersectObject(object,raycaster,intersects,recursive){if(!1!==object.visible&&(object.raycast(raycaster,intersects),!0===recursive))for(var children=object.children,i=0,l=children.length;i<l;i++)intersectObject(children[i],raycaster,intersects,!0)}function Clock(autoStart){this.autoStart=void 0===autoStart||autoStart,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Spherical(radius,phi,theta){return this.radius=void 0!==radius?radius:1,this.phi=void 0!==phi?phi:0,this.theta=void 0!==theta?theta:0,this}function Cylindrical(radius,theta,y){return this.radius=void 0!==radius?radius:1,this.theta=void 0!==theta?theta:0,this.y=void 0!==y?y:0,this}function MorphBlendMesh(geometry,material){Mesh.call(this,geometry,material),this.animationsMap={},this.animationsList=[];var numFrames=this.geometry.morphTargets.length,endFrame=numFrames-1,fps=numFrames/1;this.createAnimation("__default",0,endFrame,fps),this.setAnimationWeight("__default",1)}function ImmediateRenderObject(material){Object3D.call(this),this.material=material,this.render=function(renderCallback){}}function VertexNormalsHelper(object,size,hex,linewidth){this.object=object,this.size=void 0!==size?size:1;var color=void 0!==hex?hex:16711680,width=void 0!==linewidth?linewidth:1,nNormals=0,objGeometry=this.object.geometry;objGeometry&&objGeometry.isGeometry?nNormals=3*objGeometry.faces.length:objGeometry&&objGeometry.isBufferGeometry&&(nNormals=objGeometry.attributes.normal.count);var geometry=new BufferGeometry,positions=new Float32BufferAttribute(2*nNormals*3,3);geometry.addAttribute("position",positions),LineSegments.call(this,geometry,new LineBasicMaterial({color:color,linewidth:width})),this.matrixAutoUpdate=!1,this.update()}function SpotLightHelper(light){Object3D.call(this),this.light=light,this.light.updateMatrixWorld(),this.matrix=light.matrixWorld,this.matrixAutoUpdate=!1;for(var geometry=new BufferGeometry,positions=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,j=1;i<32;i++,j++){var p1=i/32*Math.PI*2,p2=j/32*Math.PI*2;positions.push(Math.cos(p1),Math.sin(p1),1,Math.cos(p2),Math.sin(p2),1)}geometry.addAttribute("position",new Float32BufferAttribute(positions,3));var material=new LineBasicMaterial({fog:!1});this.cone=new LineSegments(geometry,material),this.add(this.cone),this.update()}function SkeletonHelper(object){this.bones=this.getBoneList(object);for(var geometry=new BufferGeometry,vertices=[],colors=[],color1=new Color(0,0,1),color2=new Color(0,1,0),i=0;i<this.bones.length;i++){var bone=this.bones[i];bone.parent&&bone.parent.isBone&&(vertices.push(0,0,0),vertices.push(0,0,0),colors.push(color1.r,color1.g,color1.b),colors.push(color2.r,color2.g,color2.b))}geometry.addAttribute("position",new Float32BufferAttribute(vertices,3)),geometry.addAttribute("color",new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});LineSegments.call(this,geometry,material),this.root=object,this.matrix=object.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function PointLightHelper(light,sphereSize){this.light=light,this.light.updateMatrixWorld();var geometry=new SphereBufferGeometry(sphereSize,4,2),material=new MeshBasicMaterial({wireframe:!0,fog:!1});material.color.copy(this.light.color).multiplyScalar(this.light.intensity),Mesh.call(this,geometry,material),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1}function RectAreaLightHelper(light){Object3D.call(this),this.light=light,this.light.updateMatrixWorld();var materialFront=new MeshBasicMaterial({color:light.color,fog:!1}),materialBack=new MeshBasicMaterial({color:light.color,fog:!1,wireframe:!0}),geometry=new BufferGeometry;geometry.addAttribute("position",new BufferAttribute(new Float32Array(18),3)),this.add(new Mesh(geometry,materialFront)),this.add(new Mesh(geometry,materialBack)),this.update()}function HemisphereLightHelper(light,size){Object3D.call(this),this.light=light,this.light.updateMatrixWorld(),this.matrix=light.matrixWorld,this.matrixAutoUpdate=!1;var geometry=new OctahedronBufferGeometry(size);geometry.rotateY(.5*Math.PI);var material=new MeshBasicMaterial({vertexColors:2,wireframe:!0}),position=geometry.getAttribute("position"),colors=new Float32Array(3*position.count);geometry.addAttribute("color",new BufferAttribute(colors,3)),this.add(new Mesh(geometry,material)),this.update()}function GridHelper(size,divisions,color1,color2){size=size||10,divisions=divisions||10,color1=new Color(void 0!==color1?color1:4473924),color2=new Color(void 0!==color2?color2:8947848);for(var center=divisions/2,step=2*size/divisions,vertices=[],colors=[],i=0,j=0,k=-size;i<=divisions;i++,k+=step){vertices.push(-size,0,k,size,0,k),vertices.push(k,0,-size,k,0,size);var color=i===center?color1:color2;color.toArray(colors,j),j+=3,color.toArray(colors,j),j+=3,color.toArray(colors,j),j+=3,color.toArray(colors,j),j+=3}var geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute(vertices,3)),geometry.addAttribute("color",new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial({vertexColors:2});LineSegments.call(this,geometry,material)}function PolarGridHelper(radius,radials,circles,divisions,color1,color2){radius=radius||10,radials=radials||16,circles=circles||8,divisions=divisions||64,color1=new Color(void 0!==color1?color1:4473924),color2=new Color(void 0!==color2?color2:8947848);var x,z,v,i,j,r,color,vertices=[],colors=[];for(i=0;i<=radials;i++)v=i/radials*(2*Math.PI),x=Math.sin(v)*radius,z=Math.cos(v)*radius,vertices.push(0,0,0),vertices.push(x,0,z),color=1&i?color1:color2,colors.push(color.r,color.g,color.b),colors.push(color.r,color.g,color.b);for(i=0;i<=circles;i++)for(color=1&i?color1:color2,r=radius-radius/circles*i,j=0;j<divisions;j++)v=j/divisions*(2*Math.PI),x=Math.sin(v)*r,z=Math.cos(v)*r,vertices.push(x,0,z),colors.push(color.r,color.g,color.b),v=(j+1)/divisions*(2*Math.PI),x=Math.sin(v)*r,z=Math.cos(v)*r,vertices.push(x,0,z),colors.push(color.r,color.g,color.b);var geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute(vertices,3)),geometry.addAttribute("color",new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial({vertexColors:2});LineSegments.call(this,geometry,material)}function FaceNormalsHelper(object,size,hex,linewidth){this.object=object,this.size=void 0!==size?size:1;var color=void 0!==hex?hex:16776960,width=void 0!==linewidth?linewidth:1,nNormals=0,objGeometry=this.object.geometry;objGeometry&&objGeometry.isGeometry?nNormals=objGeometry.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var geometry=new BufferGeometry,positions=new Float32BufferAttribute(2*nNormals*3,3);geometry.addAttribute("position",positions),LineSegments.call(this,geometry,new LineBasicMaterial({color:color,linewidth:width})),this.matrixAutoUpdate=!1,this.update()}function DirectionalLightHelper(light,size){Object3D.call(this),this.light=light,this.light.updateMatrixWorld(),this.matrix=light.matrixWorld,this.matrixAutoUpdate=!1,void 0===size&&(size=1);var geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute([-size,size,0,size,size,0,size,-size,0,-size,-size,0,-size,size,0],3));var material=new LineBasicMaterial({fog:!1});this.add(new Line(geometry,material)),(geometry=new BufferGeometry).addAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.add(new Line(geometry,material)),this.update()}function CameraHelper(camera){var geometry=new BufferGeometry,material=new LineBasicMaterial({color:16777215,vertexColors:1}),vertices=[],colors=[],pointMap={},colorFrustum=new Color(16755200),colorCone=new Color(16711680),colorUp=new Color(43775),colorTarget=new Color(16777215),colorCross=new Color(3355443);function addLine(a,b,color){addPoint(a,color),addPoint(b,color)}function addPoint(id,color){vertices.push(0,0,0),colors.push(color.r,color.g,color.b),void 0===pointMap[id]&&(pointMap[id]=[]),pointMap[id].push(vertices.length/3-1)}addLine("n1","n2",colorFrustum),addLine("n2","n4",colorFrustum),addLine("n4","n3",colorFrustum),addLine("n3","n1",colorFrustum),addLine("f1","f2",colorFrustum),addLine("f2","f4",colorFrustum),addLine("f4","f3",colorFrustum),addLine("f3","f1",colorFrustum),addLine("n1","f1",colorFrustum),addLine("n2","f2",colorFrustum),addLine("n3","f3",colorFrustum),addLine("n4","f4",colorFrustum),addLine("p","n1",colorCone),addLine("p","n2",colorCone),addLine("p","n3",colorCone),addLine("p","n4",colorCone),addLine("u1","u2",colorUp),addLine("u2","u3",colorUp),addLine("u3","u1",colorUp),addLine("c","t",colorTarget),addLine("p","c",colorCross),addLine("cn1","cn2",colorCross),addLine("cn3","cn4",colorCross),addLine("cf1","cf2",colorCross),addLine("cf3","cf4",colorCross),geometry.addAttribute("position",new Float32BufferAttribute(vertices,3)),geometry.addAttribute("color",new Float32BufferAttribute(colors,3)),LineSegments.call(this,geometry,material),this.camera=camera,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=camera.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=pointMap,this.update()}function BoxHelper(object,color){void 0===color&&(color=16776960);var indices=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),positions=new Float32Array(24),geometry=new BufferGeometry;geometry.setIndex(new BufferAttribute(indices,1)),geometry.addAttribute("position",new BufferAttribute(positions,3)),LineSegments.call(this,geometry,new LineBasicMaterial({color:color})),void 0!==object&&this.update(object)}Object.assign(AudioLoader.prototype,{load:function(url,onLoad,onProgress,onError){var loader=new FileLoader(this.manager);loader.setResponseType("arraybuffer"),loader.load(url,function(buffer){AudioContext.getContext().decodeAudioData(buffer,function(audioBuffer){onLoad(audioBuffer)})},onProgress,onError)}}),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.width=source.width,this.height=source.height,this}}),Object.assign(StereoCamera.prototype,{update:(eyeRight=new Matrix4,eyeLeft=new Matrix4,function(camera){if(instance!==this||focus!==camera.focus||fov!==camera.fov||aspect!==camera.aspect*this.aspect||near!==camera.near||far!==camera.far||zoom!==camera.zoom){instance=this,focus=camera.focus,fov=camera.fov,aspect=camera.aspect*this.aspect,near=camera.near,far=camera.far,zoom=camera.zoom;var xmin,xmax,projectionMatrix=camera.projectionMatrix.clone(),eyeSep=this.eyeSep/2,eyeSepOnProjection=eyeSep*near/focus,ymax=near*Math.tan(_Math.DEG2RAD*fov*.5)/zoom;eyeLeft.elements[12]=-eyeSep,eyeRight.elements[12]=eyeSep,xmin=-ymax*aspect+eyeSepOnProjection,xmax=ymax*aspect+eyeSepOnProjection,projectionMatrix.elements[0]=2*near/(xmax-xmin),projectionMatrix.elements[8]=(xmax+xmin)/(xmax-xmin),this.cameraL.projectionMatrix.copy(projectionMatrix),xmin=-ymax*aspect-eyeSepOnProjection,xmax=ymax*aspect-eyeSepOnProjection,projectionMatrix.elements[0]=2*near/(xmax-xmin),projectionMatrix.elements[8]=(xmax+xmin)/(xmax-xmin),this.cameraR.projectionMatrix.copy(projectionMatrix)}this.cameraL.matrixWorld.copy(camera.matrixWorld).multiply(eyeLeft),this.cameraR.matrixWorld.copy(camera.matrixWorld).multiply(eyeRight)})}),(CubeCamera.prototype=Object.create(Object3D.prototype)).constructor=CubeCamera,AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(value){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=value,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(value){this.gain.gain.value=value},updateMatrixWorld:function(){var position=new Vector3,quaternion=new Quaternion,scale=new Vector3,orientation=new Vector3;return function(force){Object3D.prototype.updateMatrixWorld.call(this,force);var listener=this.context.listener,up=this.up;this.matrixWorld.decompose(position,quaternion,scale),orientation.set(0,0,-1).applyQuaternion(quaternion),listener.positionX?(listener.positionX.setValueAtTime(position.x,this.context.currentTime),listener.positionY.setValueAtTime(position.y,this.context.currentTime),listener.positionZ.setValueAtTime(position.z,this.context.currentTime),listener.forwardX.setValueAtTime(orientation.x,this.context.currentTime),listener.forwardY.setValueAtTime(orientation.y,this.context.currentTime),listener.forwardZ.setValueAtTime(orientation.z,this.context.currentTime),listener.upX.setValueAtTime(up.x,this.context.currentTime),listener.upY.setValueAtTime(up.y,this.context.currentTime),listener.upZ.setValueAtTime(up.z,this.context.currentTime)):(listener.setPosition(position.x,position.y,position.z),listener.setOrientation(orientation.x,orientation.y,orientation.z,up.x,up.y,up.z))}}()}),Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function(){return this.gain},setNodeSource:function(audioNode){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=audioNode,this.connect(),this},setBuffer:function(audioBuffer){return this.buffer=audioBuffer,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var source=this.context.createBufferSource();return source.buffer=this.buffer,source.loop=this.loop,source.onended=this.onEnded.bind(this),source.playbackRate.setValueAtTime(this.playbackRate,this.startTime),source.start(0,this.startTime),this.isPlaying=!0,this.source=source,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var i=1,l=this.filters.length;i<l;i++)this.filters[i-1].connect(this.filters[i]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var i=1,l=this.filters.length;i<l;i++)this.filters[i-1].disconnect(this.filters[i]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(value){return value||(value=[]),!0===this.isPlaying?(this.disconnect(),this.filters=value,this.connect()):this.filters=value,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(filter){return this.setFilters(filter?[filter]:[])},setPlaybackRate:function(value){if(!1!==this.hasPlaybackControl)return this.playbackRate=value,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(value){if(!1!==this.hasPlaybackControl)return this.loop=value,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(value){return this.gain.gain.value=value,this}}),PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(value){this.panner.refDistance=value},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(value){this.panner.rolloffFactor=value},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(value){this.panner.distanceModel=value},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(value){this.panner.maxDistance=value},updateMatrixWorld:function(){var position=new Vector3;return function(force){Object3D.prototype.updateMatrixWorld.call(this,force),position.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(position.x,position.y,position.z)}}()}),Object.assign(AudioAnalyser.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var value=0,data=this.getFrequencyData(),i=0;i<data.length;i++)value+=data[i];return value/data.length}}),PropertyMixer.prototype={constructor:PropertyMixer,accumulate:function(accuIndex,weight){var buffer=this.buffer,stride=this.valueSize,offset=accuIndex*stride+stride,currentWeight=this.cumulativeWeight;if(0===currentWeight){for(var i=0;i!==stride;++i)buffer[offset+i]=buffer[i];currentWeight=weight}else{var mix=weight/(currentWeight+=weight);this._mixBufferRegion(buffer,offset,0,mix,stride)}this.cumulativeWeight=currentWeight},apply:function(accuIndex){var stride=this.valueSize,buffer=this.buffer,offset=accuIndex*stride+stride,weight=this.cumulativeWeight,binding=this.binding;if(this.cumulativeWeight=0,weight<1){var originalValueOffset=3*stride;this._mixBufferRegion(buffer,offset,originalValueOffset,1-weight,stride)}for(var i=stride,e=stride+stride;i!==e;++i)if(buffer[i]!==buffer[i+stride]){binding.setValue(buffer,offset);break}},saveOriginalState:function(){var binding=this.binding,buffer=this.buffer,stride=this.valueSize,originalValueOffset=3*stride;binding.getValue(buffer,originalValueOffset);for(var i=stride,e=originalValueOffset;i!==e;++i)buffer[i]=buffer[originalValueOffset+i%stride];this.cumulativeWeight=0},restoreOriginalState:function(){var originalValueOffset=3*this.valueSize;this.binding.setValue(this.buffer,originalValueOffset)},_select:function(buffer,dstOffset,srcOffset,t,stride){if(.5<=t)for(var i=0;i!==stride;++i)buffer[dstOffset+i]=buffer[srcOffset+i]},_slerp:function(buffer,dstOffset,srcOffset,t,stride){Quaternion.slerpFlat(buffer,dstOffset,buffer,dstOffset,buffer,srcOffset,t)},_lerp:function(buffer,dstOffset,srcOffset,t,stride){for(var s=1-t,i=0;i!==stride;++i){var j=dstOffset+i;buffer[j]=buffer[j]*s+buffer[srcOffset+i]*t}}},PropertyBinding.prototype={constructor:PropertyBinding,getValue:function(targetArray,offset){this.bind(),this.getValue(targetArray,offset)},setValue:function(sourceArray,offset){this.bind(),this.setValue(sourceArray,offset)},bind:function(){var targetObject=this.node,parsedPath=this.parsedPath,objectName=parsedPath.objectName,propertyName=parsedPath.propertyName,propertyIndex=parsedPath.propertyIndex;if(targetObject||(targetObject=PropertyBinding.findNode(this.rootNode,parsedPath.nodeName)||this.rootNode,this.node=targetObject),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,targetObject){if(objectName){var objectIndex=parsedPath.objectIndex;switch(objectName){case"materials":if(!targetObject.material)return void console.error("  can not bind to material as node does not have a material",this);if(!targetObject.material.materials)return void console.error("  can not bind to material.materials as node.material does not have a materials array",this);targetObject=targetObject.material.materials;break;case"bones":if(!targetObject.skeleton)return void console.error("  can not bind to bones as node does not have a skeleton",this);targetObject=targetObject.skeleton.bones;for(var i=0;i<targetObject.length;i++)if(targetObject[i].name===objectIndex){objectIndex=i;break}break;default:if(void 0===targetObject[objectName])return void console.error("  can not bind to objectName of node, undefined",this);targetObject=targetObject[objectName]}if(void 0!==objectIndex){if(void 0===targetObject[objectIndex])return void console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,targetObject);targetObject=targetObject[objectIndex]}}var nodeProperty=targetObject[propertyName];if(void 0!==nodeProperty){var versioning=this.Versioning.None;void 0!==targetObject.needsUpdate?(versioning=this.Versioning.NeedsUpdate,this.targetObject=targetObject):void 0!==targetObject.matrixWorldNeedsUpdate&&(versioning=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=targetObject);var bindingType=this.BindingType.Direct;if(void 0!==propertyIndex){if("morphTargetInfluences"===propertyName){if(!targetObject.geometry)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);if(!targetObject.geometry.morphTargets)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);for(i=0;i<this.node.geometry.morphTargets.length;i++)if(targetObject.geometry.morphTargets[i].name===propertyIndex){propertyIndex=i;break}}bindingType=this.BindingType.ArrayElement,this.resolvedProperty=nodeProperty,this.propertyIndex=propertyIndex}else void 0!==nodeProperty.fromArray&&void 0!==nodeProperty.toArray?(bindingType=this.BindingType.HasFromToArray,this.resolvedProperty=nodeProperty):void 0!==nodeProperty.length?(bindingType=this.BindingType.EntireArray,this.resolvedProperty=nodeProperty):this.propertyName=propertyName;this.getValue=this.GetterByBindingType[bindingType],this.setValue=this.SetterByBindingTypeAndVersioning[bindingType][versioning]}else{var nodeName=parsedPath.nodeName;console.error("  trying to update property for track: "+nodeName+"."+propertyName+" but it wasn't found.",targetObject)}}else console.error("  trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}},Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(buffer,offset){buffer[offset]=this.node[this.propertyName]},function(buffer,offset){for(var source=this.resolvedProperty,i=0,n=source.length;i!==n;++i)buffer[offset++]=source[i]},function(buffer,offset){buffer[offset]=this.resolvedProperty[this.propertyIndex]},function(buffer,offset){this.resolvedProperty.toArray(buffer,offset)}],SetterByBindingTypeAndVersioning:[[function(buffer,offset){this.node[this.propertyName]=buffer[offset]},function(buffer,offset){this.node[this.propertyName]=buffer[offset],this.targetObject.needsUpdate=!0},function(buffer,offset){this.node[this.propertyName]=buffer[offset],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(buffer,offset){for(var dest=this.resolvedProperty,i=0,n=dest.length;i!==n;++i)dest[i]=buffer[offset++]},function(buffer,offset){for(var dest=this.resolvedProperty,i=0,n=dest.length;i!==n;++i)dest[i]=buffer[offset++];this.targetObject.needsUpdate=!0},function(buffer,offset){for(var dest=this.resolvedProperty,i=0,n=dest.length;i!==n;++i)dest[i]=buffer[offset++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(buffer,offset){this.resolvedProperty[this.propertyIndex]=buffer[offset]},function(buffer,offset){this.resolvedProperty[this.propertyIndex]=buffer[offset],this.targetObject.needsUpdate=!0},function(buffer,offset){this.resolvedProperty[this.propertyIndex]=buffer[offset],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(buffer,offset){this.resolvedProperty.fromArray(buffer,offset)},function(buffer,offset){this.resolvedProperty.fromArray(buffer,offset),this.targetObject.needsUpdate=!0},function(buffer,offset){this.resolvedProperty.fromArray(buffer,offset),this.targetObject.matrixWorldNeedsUpdate=!0}]]}),(PropertyBinding.Composite=function(targetGroup,path,optionalParsedPath){var parsedPath=optionalParsedPath||PropertyBinding.parseTrackName(path);this._targetGroup=targetGroup,this._bindings=targetGroup.subscribe_(path,parsedPath)}).prototype={constructor:PropertyBinding.Composite,getValue:function(array,offset){this.bind();var firstValidIndex=this._targetGroup.nCachedObjects_,binding=this._bindings[firstValidIndex];void 0!==binding&&binding.getValue(array,offset)},setValue:function(array,offset){for(var bindings=this._bindings,i=this._targetGroup.nCachedObjects_,n=bindings.length;i!==n;++i)bindings[i].setValue(array,offset)},bind:function(){for(var bindings=this._bindings,i=this._targetGroup.nCachedObjects_,n=bindings.length;i!==n;++i)bindings[i].bind()},unbind:function(){for(var bindings=this._bindings,i=this._targetGroup.nCachedObjects_,n=bindings.length;i!==n;++i)bindings[i].unbind()}},PropertyBinding.create=function(root,path,parsedPath){return root&&root.isAnimationObjectGroup?new PropertyBinding.Composite(root,path,parsedPath):new PropertyBinding(root,path,parsedPath)},PropertyBinding.parseTrackName=function(trackName){var matches=/^((?:[\w-]+[\/:])*)([\w-]+)?(?:\.([\w-]+)(?:\[(.+)\])?)?\.([\w-]+)(?:\[(.+)\])?$/.exec(trackName);if(!matches)throw new Error("cannot parse trackName at all: "+trackName);var results={nodeName:matches[2],objectName:matches[3],objectIndex:matches[4],propertyName:matches[5],propertyIndex:matches[6]};if(null===results.propertyName||0===results.propertyName.length)throw new Error("can not parse propertyName from trackName: "+trackName);return results},PropertyBinding.findNode=function(root,nodeName){if(!nodeName||""===nodeName||"root"===nodeName||"."===nodeName||-1===nodeName||nodeName===root.name||nodeName===root.uuid)return root;if(root.skeleton){var bone=function(skeleton){for(var i=0;i<skeleton.bones.length;i++){var bone=skeleton.bones[i];if(bone.name===nodeName)return bone}return null}(root.skeleton);if(bone)return bone}if(root.children){var searchNodeSubtree=function(children){for(var i=0;i<children.length;i++){var childNode=children[i];if(childNode.name===nodeName||childNode.uuid===nodeName)return childNode;var result=searchNodeSubtree(childNode.children);if(result)return result}return null},subTreeNode=searchNodeSubtree(root.children);if(subTreeNode)return subTreeNode}return null},AnimationObjectGroup.prototype={constructor:AnimationObjectGroup,isAnimationObjectGroup:!0,add:function(var_args){for(var objects=this._objects,nObjects=objects.length,nCachedObjects=this.nCachedObjects_,indicesByUUID=this._indicesByUUID,paths=this._paths,parsedPaths=this._parsedPaths,bindings=this._bindings,nBindings=bindings.length,i=0,n=arguments.length;i!==n;++i){var object=arguments[i],uuid=object.uuid,index=indicesByUUID[uuid],knownObject=void 0;if(void 0===index){index=nObjects++,indicesByUUID[uuid]=index,objects.push(object);for(var j=0,m=nBindings;j!==m;++j)bindings[j].push(new PropertyBinding(object,paths[j],parsedPaths[j]))}else if(index<nCachedObjects){knownObject=objects[index];var firstActiveIndex=--nCachedObjects,lastCachedObject=objects[firstActiveIndex];objects[indicesByUUID[lastCachedObject.uuid]=index]=lastCachedObject,objects[indicesByUUID[uuid]=firstActiveIndex]=object;for(j=0,m=nBindings;j!==m;++j){var bindingsForPath=bindings[j],lastCached=bindingsForPath[firstActiveIndex],binding=bindingsForPath[index];bindingsForPath[index]=lastCached,void 0===binding&&(binding=new PropertyBinding(object,paths[j],parsedPaths[j])),bindingsForPath[firstActiveIndex]=binding}}else objects[index]!==knownObject&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=nCachedObjects},remove:function(var_args){for(var objects=this._objects,nCachedObjects=this.nCachedObjects_,indicesByUUID=this._indicesByUUID,bindings=this._bindings,nBindings=bindings.length,i=0,n=arguments.length;i!==n;++i){var object=arguments[i],uuid=object.uuid,index=indicesByUUID[uuid];if(void 0!==index&&nCachedObjects<=index){var lastCachedIndex=nCachedObjects++,firstActiveObject=objects[lastCachedIndex];objects[indicesByUUID[firstActiveObject.uuid]=index]=firstActiveObject,objects[indicesByUUID[uuid]=lastCachedIndex]=object;for(var j=0,m=nBindings;j!==m;++j){var bindingsForPath=bindings[j],firstActive=bindingsForPath[lastCachedIndex],binding=bindingsForPath[index];bindingsForPath[index]=firstActive,bindingsForPath[lastCachedIndex]=binding}}}this.nCachedObjects_=nCachedObjects},uncache:function(var_args){for(var objects=this._objects,nObjects=objects.length,nCachedObjects=this.nCachedObjects_,indicesByUUID=this._indicesByUUID,bindings=this._bindings,nBindings=bindings.length,i=0,n=arguments.length;i!==n;++i){var uuid=arguments[i].uuid,index=indicesByUUID[uuid];if(void 0!==index)if(delete indicesByUUID[uuid],index<nCachedObjects){var firstActiveIndex=--nCachedObjects,lastCachedObject=objects[firstActiveIndex],lastObject=objects[lastIndex=--nObjects];objects[indicesByUUID[lastCachedObject.uuid]=index]=lastCachedObject,objects[indicesByUUID[lastObject.uuid]=firstActiveIndex]=lastObject,objects.pop();for(var j=0,m=nBindings;j!==m;++j){var lastCached=(bindingsForPath=bindings[j])[firstActiveIndex],last=bindingsForPath[lastIndex];bindingsForPath[index]=lastCached,bindingsForPath[firstActiveIndex]=last,bindingsForPath.pop()}}else{var lastIndex;objects[indicesByUUID[(lastObject=objects[lastIndex=--nObjects]).uuid]=index]=lastObject,objects.pop();for(j=0,m=nBindings;j!==m;++j){var bindingsForPath;(bindingsForPath=bindings[j])[index]=bindingsForPath[lastIndex],bindingsForPath.pop()}}}this.nCachedObjects_=nCachedObjects},subscribe_:function(path,parsedPath){var indicesByPath=this._bindingsIndicesByPath,index=indicesByPath[path],bindings=this._bindings;if(void 0!==index)return bindings[index];var paths=this._paths,parsedPaths=this._parsedPaths,objects=this._objects,nObjects=objects.length,nCachedObjects=this.nCachedObjects_,bindingsForPath=new Array(nObjects);index=bindings.length,indicesByPath[path]=index,paths.push(path),parsedPaths.push(parsedPath),bindings.push(bindingsForPath);for(var i=nCachedObjects,n=objects.length;i!==n;++i){var object=objects[i];bindingsForPath[i]=new PropertyBinding(object,path,parsedPath)}return bindingsForPath},unsubscribe_:function(path){var indicesByPath=this._bindingsIndicesByPath,index=indicesByPath[path];if(void 0!==index){var paths=this._paths,parsedPaths=this._parsedPaths,bindings=this._bindings,lastBindingsIndex=bindings.length-1,lastBindings=bindings[lastBindingsIndex];bindings[indicesByPath[path[lastBindingsIndex]]=index]=lastBindings,bindings.pop(),parsedPaths[index]=parsedPaths[lastBindingsIndex],parsedPaths.pop(),paths[index]=paths[lastBindingsIndex],paths.pop()}}},AnimationAction.prototype={constructor:AnimationAction,play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(time){return this._startTime=time,this},setLoop:function(mode,repetitions){return this.loop=mode,this.repetitions=repetitions,this},setEffectiveWeight:function(weight){return this.weight=weight,this._effectiveWeight=this.enabled?weight:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(duration){return this._scheduleFading(duration,0,1)},fadeOut:function(duration){return this._scheduleFading(duration,1,0)},crossFadeFrom:function(fadeOutAction,duration,warp){if(fadeOutAction.fadeOut(duration),this.fadeIn(duration),warp){var fadeInDuration=this._clip.duration,fadeOutDuration=fadeOutAction._clip.duration,startEndRatio=fadeOutDuration/fadeInDuration,endStartRatio=fadeInDuration/fadeOutDuration;fadeOutAction.warp(1,startEndRatio,duration),this.warp(endStartRatio,1,duration)}return this},crossFadeTo:function(fadeInAction,duration,warp){return fadeInAction.crossFadeFrom(this,duration,warp)},stopFading:function(){var weightInterpolant=this._weightInterpolant;return null!==weightInterpolant&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(weightInterpolant)),this},setEffectiveTimeScale:function(timeScale){return this.timeScale=timeScale,this._effectiveTimeScale=this.paused?0:timeScale,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(duration){return this.timeScale=this._clip.duration/duration,this.stopWarping()},syncWith:function(action){return this.time=action.time,this.timeScale=action.timeScale,this.stopWarping()},halt:function(duration){return this.warp(this._effectiveTimeScale,0,duration)},warp:function(startTimeScale,endTimeScale,duration){var mixer=this._mixer,now=mixer.time,interpolant=this._timeScaleInterpolant,timeScale=this.timeScale;null===interpolant&&(interpolant=mixer._lendControlInterpolant(),this._timeScaleInterpolant=interpolant);var times=interpolant.parameterPositions,values=interpolant.sampleValues;return times[0]=now,times[1]=now+duration,values[0]=startTimeScale/timeScale,values[1]=endTimeScale/timeScale,this},stopWarping:function(){var timeScaleInterpolant=this._timeScaleInterpolant;return null!==timeScaleInterpolant&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(timeScaleInterpolant)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(time,deltaTime,timeDirection,accuIndex){var startTime=this._startTime;if(null!==startTime){var timeRunning=(time-startTime)*timeDirection;if(timeRunning<0||0===timeDirection)return;this._startTime=null,deltaTime=timeDirection*timeRunning}deltaTime*=this._updateTimeScale(time);var clipTime=this._updateTime(deltaTime),weight=this._updateWeight(time);if(0<weight)for(var interpolants=this._interpolants,propertyMixers=this._propertyBindings,j=0,m=interpolants.length;j!==m;++j)interpolants[j].evaluate(clipTime),propertyMixers[j].accumulate(accuIndex,weight)},_updateWeight:function(time){var weight=0;if(this.enabled){weight=this.weight;var interpolant=this._weightInterpolant;if(null!==interpolant){var interpolantValue=interpolant.evaluate(time)[0];weight*=interpolantValue,time>interpolant.parameterPositions[1]&&(this.stopFading(),0===interpolantValue&&(this.enabled=!1))}}return this._effectiveWeight=weight},_updateTimeScale:function(time){var timeScale=0;if(!this.paused){timeScale=this.timeScale;var interpolant=this._timeScaleInterpolant;if(null!==interpolant)timeScale*=interpolant.evaluate(time)[0],time>interpolant.parameterPositions[1]&&(this.stopWarping(),0===timeScale?this.paused=!0:this.timeScale=timeScale)}return this._effectiveTimeScale=timeScale},_updateTime:function(deltaTime){var time=this.time+deltaTime;if(0===deltaTime)return time;var duration=this._clip.duration,loop=this.loop,loopCount=this._loopCount;if(2200===loop){-1===loopCount&&(this._loopCount=0,this._setEndings(!0,!0,!1));handle_stop:{if(duration<=time)time=duration;else{if(!(time<0))break handle_stop;time=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:deltaTime<0?-1:1})}}else{var pingPong=2202===loop;if(-1===loopCount&&(0<=deltaTime?(loopCount=0,this._setEndings(!0,0===this.repetitions,pingPong)):this._setEndings(0===this.repetitions,!0,pingPong)),duration<=time||time<0){var loopDelta=Math.floor(time/duration);time-=duration*loopDelta,loopCount+=Math.abs(loopDelta);var pending=this.repetitions-loopCount;if(pending<0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,time=0<deltaTime?duration:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<deltaTime?1:-1});else{if(0==pending){var atStart=deltaTime<0;this._setEndings(atStart,!atStart,pingPong)}else this._setEndings(!1,!1,pingPong);this._loopCount=loopCount,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:loopDelta})}}if(pingPong&&1==(1&loopCount))return duration-(this.time=time)}return this.time=time},_setEndings:function(atStart,atEnd,pingPong){var settings=this._interpolantSettings;pingPong?(settings.endingStart=2401,settings.endingEnd=2401):(settings.endingStart=atStart?this.zeroSlopeAtStart?2401:2400:2402,settings.endingEnd=atEnd?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(duration,weightNow,weightThen){var mixer=this._mixer,now=mixer.time,interpolant=this._weightInterpolant;null===interpolant&&(interpolant=mixer._lendControlInterpolant(),this._weightInterpolant=interpolant);var times=interpolant.parameterPositions,values=interpolant.sampleValues;return times[0]=now,values[0]=weightNow,times[1]=now+duration,values[1]=weightThen,this}},Object.assign(AnimationMixer.prototype,EventDispatcher.prototype,{clipAction:function(clip,optionalRoot){var root=optionalRoot||this._root,rootUuid=root.uuid,clipObject="string"==typeof clip?AnimationClip.findByName(root,clip):clip,clipUuid=null!==clipObject?clipObject.uuid:clip,actionsForClip=this._actionsByClip[clipUuid],prototypeAction=null;if(void 0!==actionsForClip){var existingAction=actionsForClip.actionByRoot[rootUuid];if(void 0!==existingAction)return existingAction;prototypeAction=actionsForClip.knownActions[0],null===clipObject&&(clipObject=prototypeAction._clip)}if(null===clipObject)return null;var newAction=new AnimationAction(this,clipObject,optionalRoot);return this._bindAction(newAction,prototypeAction),this._addInactiveAction(newAction,clipUuid,rootUuid),newAction},existingAction:function(clip,optionalRoot){var root=optionalRoot||this._root,rootUuid=root.uuid,clipObject="string"==typeof clip?AnimationClip.findByName(root,clip):clip,clipUuid=clipObject?clipObject.uuid:clip,actionsForClip=this._actionsByClip[clipUuid];return void 0!==actionsForClip&&actionsForClip.actionByRoot[rootUuid]||null},stopAllAction:function(){var actions=this._actions,nActions=this._nActiveActions,bindings=this._bindings,nBindings=this._nActiveBindings;this._nActiveActions=0;for(var i=this._nActiveBindings=0;i!==nActions;++i)actions[i].reset();for(i=0;i!==nBindings;++i)bindings[i].useCount=0;return this},update:function(deltaTime){deltaTime*=this.timeScale;for(var actions=this._actions,nActions=this._nActiveActions,time=this.time+=deltaTime,timeDirection=Math.sign(deltaTime),accuIndex=this._accuIndex^=1,i=0;i!==nActions;++i){var action=actions[i];action.enabled&&action._update(time,deltaTime,timeDirection,accuIndex)}var bindings=this._bindings,nBindings=this._nActiveBindings;for(i=0;i!==nBindings;++i)bindings[i].apply(accuIndex);return this},getRoot:function(){return this._root},uncacheClip:function(clip){var actions=this._actions,clipUuid=clip.uuid,actionsByClip=this._actionsByClip,actionsForClip=actionsByClip[clipUuid];if(void 0!==actionsForClip){for(var actionsToRemove=actionsForClip.knownActions,i=0,n=actionsToRemove.length;i!==n;++i){var action=actionsToRemove[i];this._deactivateAction(action);var cacheIndex=action._cacheIndex,lastInactiveAction=actions[actions.length-1];action._cacheIndex=null,action._byClipCacheIndex=null,actions[lastInactiveAction._cacheIndex=cacheIndex]=lastInactiveAction,actions.pop(),this._removeInactiveBindingsForAction(action)}delete actionsByClip[clipUuid]}},uncacheRoot:function(root){var rootUuid=root.uuid,actionsByClip=this._actionsByClip;for(var clipUuid in actionsByClip){var action=actionsByClip[clipUuid].actionByRoot[rootUuid];void 0!==action&&(this._deactivateAction(action),this._removeInactiveAction(action))}var bindingByName=this._bindingsByRootAndName[rootUuid];if(void 0!==bindingByName)for(var trackName in bindingByName){var binding=bindingByName[trackName];binding.restoreOriginalState(),this._removeInactiveBinding(binding)}},uncacheAction:function(clip,optionalRoot){var action=this.existingAction(clip,optionalRoot);null!==action&&(this._deactivateAction(action),this._removeInactiveAction(action))}}),Object.assign(AnimationMixer.prototype,{_bindAction:function(action,prototypeAction){var root=action._localRoot||this._root,tracks=action._clip.tracks,nTracks=tracks.length,bindings=action._propertyBindings,interpolants=action._interpolants,rootUuid=root.uuid,bindingsByRoot=this._bindingsByRootAndName,bindingsByName=bindingsByRoot[rootUuid];void 0===bindingsByName&&(bindingsByName={},bindingsByRoot[rootUuid]=bindingsByName);for(var i=0;i!==nTracks;++i){var track=tracks[i],trackName=track.name,binding=bindingsByName[trackName];if(void 0!==binding)bindings[i]=binding;else{if(void 0!==(binding=bindings[i])){null===binding._cacheIndex&&(++binding.referenceCount,this._addInactiveBinding(binding,rootUuid,trackName));continue}var path=prototypeAction&&prototypeAction._propertyBindings[i].binding.parsedPath;++(binding=new PropertyMixer(PropertyBinding.create(root,trackName,path),track.ValueTypeName,track.getValueSize())).referenceCount,this._addInactiveBinding(binding,rootUuid,trackName),bindings[i]=binding}interpolants[i].resultBuffer=binding.buffer}},_activateAction:function(action){if(!this._isActiveAction(action)){if(null===action._cacheIndex){var rootUuid=(action._localRoot||this._root).uuid,clipUuid=action._clip.uuid,actionsForClip=this._actionsByClip[clipUuid];this._bindAction(action,actionsForClip&&actionsForClip.knownActions[0]),this._addInactiveAction(action,clipUuid,rootUuid)}for(var bindings=action._propertyBindings,i=0,n=bindings.length;i!==n;++i){var binding=bindings[i];0==binding.useCount++&&(this._lendBinding(binding),binding.saveOriginalState())}this._lendAction(action)}},_deactivateAction:function(action){if(this._isActiveAction(action)){for(var bindings=action._propertyBindings,i=0,n=bindings.length;i!==n;++i){var binding=bindings[i];0==--binding.useCount&&(binding.restoreOriginalState(),this._takeBackBinding(binding))}this._takeBackAction(action)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var scope=this;this.stats={actions:{get total(){return scope._actions.length},get inUse(){return scope._nActiveActions}},bindings:{get total(){return scope._bindings.length},get inUse(){return scope._nActiveBindings}},controlInterpolants:{get total(){return scope._controlInterpolants.length},get inUse(){return scope._nActiveControlInterpolants}}}},_isActiveAction:function(action){var index=action._cacheIndex;return null!==index&&index<this._nActiveActions},_addInactiveAction:function(action,clipUuid,rootUuid){var actions=this._actions,actionsByClip=this._actionsByClip,actionsForClip=actionsByClip[clipUuid];if(void 0===actionsForClip)actionsForClip={knownActions:[action],actionByRoot:{}},action._byClipCacheIndex=0,actionsByClip[clipUuid]=actionsForClip;else{var knownActions=actionsForClip.knownActions;action._byClipCacheIndex=knownActions.length,knownActions.push(action)}action._cacheIndex=actions.length,actions.push(action),actionsForClip.actionByRoot[rootUuid]=action},_removeInactiveAction:function(action){var actions=this._actions,lastInactiveAction=actions[actions.length-1],cacheIndex=action._cacheIndex;actions[lastInactiveAction._cacheIndex=cacheIndex]=lastInactiveAction,actions.pop(),action._cacheIndex=null;var clipUuid=action._clip.uuid,actionsByClip=this._actionsByClip,actionsForClip=actionsByClip[clipUuid],knownActionsForClip=actionsForClip.knownActions,lastKnownAction=knownActionsForClip[knownActionsForClip.length-1],byClipCacheIndex=action._byClipCacheIndex;knownActionsForClip[lastKnownAction._byClipCacheIndex=byClipCacheIndex]=lastKnownAction,knownActionsForClip.pop(),action._byClipCacheIndex=null,delete actionsForClip.actionByRoot[(actions._localRoot||this._root).uuid],0===knownActionsForClip.length&&delete actionsByClip[clipUuid],this._removeInactiveBindingsForAction(action)},_removeInactiveBindingsForAction:function(action){for(var bindings=action._propertyBindings,i=0,n=bindings.length;i!==n;++i){var binding=bindings[i];0==--binding.referenceCount&&this._removeInactiveBinding(binding)}},_lendAction:function(action){var actions=this._actions,prevIndex=action._cacheIndex,lastActiveIndex=this._nActiveActions++,firstInactiveAction=actions[lastActiveIndex];actions[action._cacheIndex=lastActiveIndex]=action,actions[firstInactiveAction._cacheIndex=prevIndex]=firstInactiveAction},_takeBackAction:function(action){var actions=this._actions,prevIndex=action._cacheIndex,firstInactiveIndex=--this._nActiveActions,lastActiveAction=actions[firstInactiveIndex];actions[action._cacheIndex=firstInactiveIndex]=action,actions[lastActiveAction._cacheIndex=prevIndex]=lastActiveAction},_addInactiveBinding:function(binding,rootUuid,trackName){var bindingsByRoot=this._bindingsByRootAndName,bindingByName=bindingsByRoot[rootUuid],bindings=this._bindings;void 0===bindingByName&&(bindingByName={},bindingsByRoot[rootUuid]=bindingByName),(bindingByName[trackName]=binding)._cacheIndex=bindings.length,bindings.push(binding)},_removeInactiveBinding:function(binding){var bindings=this._bindings,propBinding=binding.binding,rootUuid=propBinding.rootNode.uuid,trackName=propBinding.path,bindingsByRoot=this._bindingsByRootAndName,bindingByName=bindingsByRoot[rootUuid],lastInactiveBinding=bindings[bindings.length-1],cacheIndex=binding._cacheIndex;bindings[lastInactiveBinding._cacheIndex=cacheIndex]=lastInactiveBinding,bindings.pop(),delete bindingByName[trackName];remove_empty_map:{for(var _ in bindingByName)break remove_empty_map;delete bindingsByRoot[rootUuid]}},_lendBinding:function(binding){var bindings=this._bindings,prevIndex=binding._cacheIndex,lastActiveIndex=this._nActiveBindings++,firstInactiveBinding=bindings[lastActiveIndex];bindings[binding._cacheIndex=lastActiveIndex]=binding,bindings[firstInactiveBinding._cacheIndex=prevIndex]=firstInactiveBinding},_takeBackBinding:function(binding){var bindings=this._bindings,prevIndex=binding._cacheIndex,firstInactiveIndex=--this._nActiveBindings,lastActiveBinding=bindings[firstInactiveIndex];bindings[binding._cacheIndex=firstInactiveIndex]=binding,bindings[lastActiveBinding._cacheIndex=prevIndex]=lastActiveBinding},_lendControlInterpolant:function(){var interpolants=this._controlInterpolants,lastActiveIndex=this._nActiveControlInterpolants++,interpolant=interpolants[lastActiveIndex];return void 0===interpolant&&(interpolants[(interpolant=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=lastActiveIndex]=interpolant),interpolant},_takeBackControlInterpolant:function(interpolant){var interpolants=this._controlInterpolants,prevIndex=interpolant.__cacheIndex,firstInactiveIndex=--this._nActiveControlInterpolants,lastActiveInterpolant=interpolants[firstInactiveIndex];interpolants[interpolant.__cacheIndex=firstInactiveIndex]=interpolant,interpolants[lastActiveInterpolant.__cacheIndex=prevIndex]=lastActiveInterpolant},_controlInterpolantsResultBuffer:new Float32Array(1)}),Uniform.prototype.clone=function(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())},((InstancedBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=InstancedBufferGeometry).prototype.isInstancedBufferGeometry=!0,InstancedBufferGeometry.prototype.addGroup=function(start,count,materialIndex){this.groups.push({start:start,count:count,materialIndex:materialIndex})},InstancedBufferGeometry.prototype.copy=function(source){var index=source.index;null!==index&&this.setIndex(index.clone());var attributes=source.attributes;for(var name in attributes){var attribute=attributes[name];this.addAttribute(name,attribute.clone())}for(var groups=source.groups,i=0,l=groups.length;i<l;i++){var group=groups[i];this.addGroup(group.start,group.count,group.materialIndex)}return this},InterleavedBufferAttribute.prototype={constructor:InterleavedBufferAttribute,isInterleavedBufferAttribute:!0,get count(){return this.data.count},get array(){return this.data.array},setX:function(index,x){return this.data.array[index*this.data.stride+this.offset]=x,this},setY:function(index,y){return this.data.array[index*this.data.stride+this.offset+1]=y,this},setZ:function(index,z){return this.data.array[index*this.data.stride+this.offset+2]=z,this},setW:function(index,w){return this.data.array[index*this.data.stride+this.offset+3]=w,this},getX:function(index){return this.data.array[index*this.data.stride+this.offset]},getY:function(index){return this.data.array[index*this.data.stride+this.offset+1]},getZ:function(index){return this.data.array[index*this.data.stride+this.offset+2]},getW:function(index){return this.data.array[index*this.data.stride+this.offset+3]},setXY:function(index,x,y){return index=index*this.data.stride+this.offset,this.data.array[index+0]=x,this.data.array[index+1]=y,this},setXYZ:function(index,x,y,z){return index=index*this.data.stride+this.offset,this.data.array[index+0]=x,this.data.array[index+1]=y,this.data.array[index+2]=z,this},setXYZW:function(index,x,y,z,w){return index=index*this.data.stride+this.offset,this.data.array[index+0]=x,this.data.array[index+1]=y,this.data.array[index+2]=z,this.data.array[index+3]=w,this}},InterleavedBuffer.prototype={constructor:InterleavedBuffer,isInterleavedBuffer:!0,set needsUpdate(value){!0===value&&this.version++},setArray:function(array){if(Array.isArray(array))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==array?array.length/this.stride:0,this.array=array},setDynamic:function(value){return this.dynamic=value,this},copy:function(source){return this.array=new source.array.constructor(source.array),this.count=source.count,this.stride=source.stride,this.dynamic=source.dynamic,this},copyAt:function(index1,attribute,index2){index1*=this.stride,index2*=attribute.stride;for(var i=0,l=this.stride;i<l;i++)this.array[index1+i]=attribute.array[index2+i];return this},set:function(value,offset){return void 0===offset&&(offset=0),this.array.set(value,offset),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(callback){return this.onUploadCallback=callback,this}},((InstancedInterleavedBuffer.prototype=Object.create(InterleavedBuffer.prototype)).constructor=InstancedInterleavedBuffer).prototype.isInstancedInterleavedBuffer=!0,InstancedInterleavedBuffer.prototype.copy=function(source){return InterleavedBuffer.prototype.copy.call(this,source),this.meshPerAttribute=source.meshPerAttribute,this},((InstancedBufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=InstancedBufferAttribute).prototype.isInstancedBufferAttribute=!0,InstancedBufferAttribute.prototype.copy=function(source){return BufferAttribute.prototype.copy.call(this,source),this.meshPerAttribute=source.meshPerAttribute,this},Raycaster.prototype={constructor:Raycaster,linePrecision:1,set:function(origin,direction){this.ray.set(origin,direction)},setFromCamera:function(coords,camera){camera&&camera.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(camera.matrixWorld),this.ray.direction.set(coords.x,coords.y,.5).unproject(camera).sub(this.ray.origin).normalize()):camera&&camera.isOrthographicCamera?(this.ray.origin.set(coords.x,coords.y,(camera.near+camera.far)/(camera.near-camera.far)).unproject(camera),this.ray.direction.set(0,0,-1).transformDirection(camera.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(object,recursive){var intersects=[];return intersectObject(object,this,intersects,recursive),intersects.sort(ascSort),intersects},intersectObjects:function(objects,recursive){var intersects=[];if(!1===Array.isArray(objects))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),intersects;for(var i=0,l=objects.length;i<l;i++)intersectObject(objects[i],this,intersects,recursive);return intersects.sort(ascSort),intersects}},Clock.prototype={constructor:Clock,start:function(){this.startTime=(performance||Date).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var diff=0;if(this.autoStart&&!this.running&&this.start(),this.running){var newTime=(performance||Date).now();diff=(newTime-this.oldTime)/1e3,this.oldTime=newTime,this.elapsedTime+=diff}return diff}},Spherical.prototype={constructor:Spherical,set:function(radius,phi,theta){return this.radius=radius,this.phi=phi,this.theta=theta,this},clone:function(){return(new this.constructor).copy(this)},copy:function(other){return this.radius=other.radius,this.phi=other.phi,this.theta=other.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(vec3){return this.radius=vec3.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(vec3.x,vec3.z),this.phi=Math.acos(_Math.clamp(vec3.y/this.radius,-1,1))),this}},Cylindrical.prototype={constructor:Cylindrical,set:function(radius,theta,y){return this.radius=radius,this.theta=theta,this.y=y,this},clone:function(){return(new this.constructor).copy(this)},copy:function(other){return this.radius=other.radius,this.theta=other.theta,this.y=other.y,this},setFromVector3:function(vec3){return this.radius=Math.sqrt(vec3.x*vec3.x+vec3.z*vec3.z),this.theta=Math.atan2(vec3.x,vec3.z),this.y=vec3.y,this}},((MorphBlendMesh.prototype=Object.create(Mesh.prototype)).constructor=MorphBlendMesh).prototype.createAnimation=function(name,start,end,fps){var animation={start:start,end:end,length:end-start+1,fps:fps,duration:(end-start)/fps,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[name]=animation,this.animationsList.push(animation)},MorphBlendMesh.prototype.autoCreateAnimations=function(fps){for(var firstAnimation,pattern=/([a-z]+)_?(\d+)/i,frameRanges={},geometry=this.geometry,i=0,il=geometry.morphTargets.length;i<il;i++){var chunks=geometry.morphTargets[i].name.match(pattern);if(chunks&&1<chunks.length)frameRanges[name=chunks[1]]||(frameRanges[name]={start:1/0,end:-1/0}),i<(range=frameRanges[name]).start&&(range.start=i),i>range.end&&(range.end=i),firstAnimation||(firstAnimation=name)}for(var name in frameRanges){var range=frameRanges[name];this.createAnimation(name,range.start,range.end,fps)}this.firstAnimation=firstAnimation},MorphBlendMesh.prototype.setAnimationDirectionForward=function(name){var animation=this.animationsMap[name];animation&&(animation.direction=1,animation.directionBackwards=!1)},MorphBlendMesh.prototype.setAnimationDirectionBackward=function(name){var animation=this.animationsMap[name];animation&&(animation.direction=-1,animation.directionBackwards=!0)},MorphBlendMesh.prototype.setAnimationFPS=function(name,fps){var animation=this.animationsMap[name];animation&&(animation.fps=fps,animation.duration=(animation.end-animation.start)/animation.fps)},MorphBlendMesh.prototype.setAnimationDuration=function(name,duration){var animation=this.animationsMap[name];animation&&(animation.duration=duration,animation.fps=(animation.end-animation.start)/animation.duration)},MorphBlendMesh.prototype.setAnimationWeight=function(name,weight){var animation=this.animationsMap[name];animation&&(animation.weight=weight)},MorphBlendMesh.prototype.setAnimationTime=function(name,time){var animation=this.animationsMap[name];animation&&(animation.time=time)},MorphBlendMesh.prototype.getAnimationTime=function(name){var time=0,animation=this.animationsMap[name];return animation&&(time=animation.time),time},MorphBlendMesh.prototype.getAnimationDuration=function(name){var duration=-1,animation=this.animationsMap[name];return animation&&(duration=animation.duration),duration},MorphBlendMesh.prototype.playAnimation=function(name){var animation=this.animationsMap[name];animation?(animation.time=0,animation.active=!0):console.warn("THREE.MorphBlendMesh: animation["+name+"] undefined in .playAnimation()")},MorphBlendMesh.prototype.stopAnimation=function(name){var animation=this.animationsMap[name];animation&&(animation.active=!1)},MorphBlendMesh.prototype.update=function(delta){for(var i=0,il=this.animationsList.length;i<il;i++){var animation=this.animationsList[i];if(animation.active){var frameTime=animation.duration/animation.length;animation.time+=animation.direction*delta,animation.mirroredLoop?(animation.time>animation.duration||animation.time<0)&&(animation.direction*=-1,animation.time>animation.duration&&(animation.time=animation.duration,animation.directionBackwards=!0),animation.time<0&&(animation.time=0,animation.directionBackwards=!1)):(animation.time=animation.time%animation.duration,animation.time<0&&(animation.time+=animation.duration));var keyframe=animation.start+_Math.clamp(Math.floor(animation.time/frameTime),0,animation.length-1),weight=animation.weight;keyframe!==animation.currentFrame&&(this.morphTargetInfluences[animation.lastFrame]=0,this.morphTargetInfluences[animation.currentFrame]=1*weight,this.morphTargetInfluences[keyframe]=0,animation.lastFrame=animation.currentFrame,animation.currentFrame=keyframe);var mix=animation.time%frameTime/frameTime;animation.directionBackwards&&(mix=1-mix),animation.currentFrame!==animation.lastFrame?(this.morphTargetInfluences[animation.currentFrame]=mix*weight,this.morphTargetInfluences[animation.lastFrame]=(1-mix)*weight):this.morphTargetInfluences[animation.currentFrame]=weight}}},((ImmediateRenderObject.prototype=Object.create(Object3D.prototype)).constructor=ImmediateRenderObject).prototype.isImmediateRenderObject=!0,((VertexNormalsHelper.prototype=Object.create(LineSegments.prototype)).constructor=VertexNormalsHelper).prototype.update=function(){var v1=new Vector3,v2=new Vector3,normalMatrix=new Matrix3;return function(){var keys=["a","b","c"];this.object.updateMatrixWorld(!0),normalMatrix.getNormalMatrix(this.object.matrixWorld);var matrixWorld=this.object.matrixWorld,position=this.geometry.attributes.position,objGeometry=this.object.geometry;if(objGeometry&&objGeometry.isGeometry)for(var vertices=objGeometry.vertices,faces=objGeometry.faces,idx=0,i=0,l=faces.length;i<l;i++)for(var face=faces[i],j=0,jl=face.vertexNormals.length;j<jl;j++){var vertex=vertices[face[keys[j]]],normal=face.vertexNormals[j];v1.copy(vertex).applyMatrix4(matrixWorld),v2.copy(normal).applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1),position.setXYZ(idx,v1.x,v1.y,v1.z),idx+=1,position.setXYZ(idx,v2.x,v2.y,v2.z),idx+=1}else if(objGeometry&&objGeometry.isBufferGeometry){var objPos=objGeometry.attributes.position,objNorm=objGeometry.attributes.normal;for(idx=0,j=0,jl=objPos.count;j<jl;j++)v1.set(objPos.getX(j),objPos.getY(j),objPos.getZ(j)).applyMatrix4(matrixWorld),v2.set(objNorm.getX(j),objNorm.getY(j),objNorm.getZ(j)),v2.applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1),position.setXYZ(idx,v1.x,v1.y,v1.z),idx+=1,position.setXYZ(idx,v2.x,v2.y,v2.z),idx+=1}return position.needsUpdate=!0,this}}(),((SpotLightHelper.prototype=Object.create(Object3D.prototype)).constructor=SpotLightHelper).prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},SpotLightHelper.prototype.update=(vector=new Vector3,vector2=new Vector3,function(){var coneLength=this.light.distance?this.light.distance:1e3,coneWidth=coneLength*Math.tan(this.light.angle);this.cone.scale.set(coneWidth,coneWidth,coneLength),vector.setFromMatrixPosition(this.light.matrixWorld),vector2.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(vector2.sub(vector)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}),((SkeletonHelper.prototype=Object.create(LineSegments.prototype)).constructor=SkeletonHelper).prototype.getBoneList=function(object){var boneList=[];object&&object.isBone&&boneList.push(object);for(var i=0;i<object.children.length;i++)boneList.push.apply(boneList,this.getBoneList(object.children[i]));return boneList},SkeletonHelper.prototype.update=function(){var vector=new Vector3,boneMatrix=new Matrix4,matrixWorldInv=new Matrix4;return function(){var geometry=this.geometry,position=geometry.getAttribute("position");matrixWorldInv.getInverse(this.root.matrixWorld);for(var i=0,j=0;i<this.bones.length;i++){var bone=this.bones[i];bone.parent&&bone.parent.isBone&&(boneMatrix.multiplyMatrices(matrixWorldInv,bone.matrixWorld),vector.setFromMatrixPosition(boneMatrix),position.setXYZ(j,vector.x,vector.y,vector.z),boneMatrix.multiplyMatrices(matrixWorldInv,bone.parent.matrixWorld),vector.setFromMatrixPosition(boneMatrix),position.setXYZ(j+1,vector.x,vector.y,vector.z),j+=2)}geometry.getAttribute("position").needsUpdate=!0}}(),((PointLightHelper.prototype=Object.create(Mesh.prototype)).constructor=PointLightHelper).prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},((RectAreaLightHelper.prototype=Object.create(Object3D.prototype)).constructor=RectAreaLightHelper).prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose(),this.children[1].geometry.dispose(),this.children[1].material.dispose()},RectAreaLightHelper.prototype.update=function(){var vector1=new Vector3,vector2=new Vector3;return function(){var mesh1=this.children[0],mesh2=this.children[1];if(this.light.target){vector1.setFromMatrixPosition(this.light.matrixWorld),vector2.setFromMatrixPosition(this.light.target.matrixWorld);var lookVec=vector2.clone().sub(vector1);mesh1.lookAt(lookVec),mesh2.lookAt(lookVec)}mesh1.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),mesh2.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var hx=.5*this.light.width,hy=.5*this.light.height,position=mesh1.geometry.getAttribute("position"),array=position.array;array[0]=hx,array[1]=-hy,array[2]=0,array[3]=hx,array[4]=hy,array[5]=0,array[6]=-hx,array[7]=hy,array[8]=0,array[9]=-hx,array[10]=hy,array[11]=0,array[12]=-hx,array[13]=-hy,array[14]=0,array[15]=hx,array[16]=-hy,array[17]=0,position.needsUpdate=!0}}(),((HemisphereLightHelper.prototype=Object.create(Object3D.prototype)).constructor=HemisphereLightHelper).prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},HemisphereLightHelper.prototype.update=function(){var vector=new Vector3,color1=new Color,color2=new Color;return function(){var mesh=this.children[0],colors=mesh.geometry.getAttribute("color");color1.copy(this.light.color).multiplyScalar(this.light.intensity),color2.copy(this.light.groundColor).multiplyScalar(this.light.intensity);for(var i=0,l=colors.count;i<l;i++){var color=i<l/2?color1:color2;colors.setXYZ(i,color.r,color.g,color.b)}mesh.lookAt(vector.setFromMatrixPosition(this.light.matrixWorld).negate()),colors.needsUpdate=!0}}(),(GridHelper.prototype=Object.create(LineSegments.prototype)).constructor=GridHelper,(PolarGridHelper.prototype=Object.create(LineSegments.prototype)).constructor=PolarGridHelper,((FaceNormalsHelper.prototype=Object.create(LineSegments.prototype)).constructor=FaceNormalsHelper).prototype.update=function(){var v1=new Vector3,v2=new Vector3,normalMatrix=new Matrix3;return function(){this.object.updateMatrixWorld(!0),normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var matrixWorld=this.object.matrixWorld,position=this.geometry.attributes.position,objGeometry=this.object.geometry,vertices=objGeometry.vertices,faces=objGeometry.faces,idx=0,i=0,l=faces.length;i<l;i++){var face=faces[i],normal=face.normal;v1.copy(vertices[face.a]).add(vertices[face.b]).add(vertices[face.c]).divideScalar(3).applyMatrix4(matrixWorld),v2.copy(normal).applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1),position.setXYZ(idx,v1.x,v1.y,v1.z),idx+=1,position.setXYZ(idx,v2.x,v2.y,v2.z),idx+=1}return position.needsUpdate=!0,this}}(),((DirectionalLightHelper.prototype=Object.create(Object3D.prototype)).constructor=DirectionalLightHelper).prototype.dispose=function(){var lightPlane=this.children[0],targetLine=this.children[1];lightPlane.geometry.dispose(),lightPlane.material.dispose(),targetLine.geometry.dispose(),targetLine.material.dispose()},DirectionalLightHelper.prototype.update=function(){var v1=new Vector3,v2=new Vector3,v3=new Vector3;return function(){v1.setFromMatrixPosition(this.light.matrixWorld),v2.setFromMatrixPosition(this.light.target.matrixWorld),v3.subVectors(v2,v1);var lightPlane=this.children[0],targetLine=this.children[1];lightPlane.lookAt(v3),lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),targetLine.lookAt(v3),targetLine.scale.z=v3.length()}}(),((CameraHelper.prototype=Object.create(LineSegments.prototype)).constructor=CameraHelper).prototype.update=function(){var geometry,pointMap,vector=new Vector3,camera=new Camera;function setPoint(point,x,y,z){vector.set(x,y,z).unproject(camera);var points=pointMap[point];if(void 0!==points)for(var position=geometry.getAttribute("position"),i=0,l=points.length;i<l;i++)position.setXYZ(points[i],vector.x,vector.y,vector.z)}return function(){geometry=this.geometry,pointMap=this.pointMap;camera.projectionMatrix.copy(this.camera.projectionMatrix),setPoint("c",0,0,-1),setPoint("t",0,0,1),setPoint("n1",-1,-1,-1),setPoint("n2",1,-1,-1),setPoint("n3",-1,1,-1),setPoint("n4",1,1,-1),setPoint("f1",-1,-1,1),setPoint("f2",1,-1,1),setPoint("f3",-1,1,1),setPoint("f4",1,1,1),setPoint("u1",.7,1.1,-1),setPoint("u2",-.7,1.1,-1),setPoint("u3",0,2,-1),setPoint("cf1",-1,0,1),setPoint("cf2",1,0,1),setPoint("cf3",0,-1,1),setPoint("cf4",0,1,1),setPoint("cn1",-1,0,-1),setPoint("cn2",1,0,-1),setPoint("cn3",0,-1,-1),setPoint("cn4",0,1,-1),geometry.getAttribute("position").needsUpdate=!0}}(),((BoxHelper.prototype=Object.create(LineSegments.prototype)).constructor=BoxHelper).prototype.update=function(){var box=new Box3;return function(object){if(object&&object.isBox3?box.copy(object):box.setFromObject(object),!box.isEmpty()){var min=box.min,max=box.max,position=this.geometry.attributes.position,array=position.array;array[0]=max.x,array[1]=max.y,array[2]=max.z,array[3]=min.x,array[4]=max.y,array[5]=max.z,array[6]=min.x,array[7]=min.y,array[8]=max.z,array[9]=max.x,array[10]=min.y,array[11]=max.z,array[12]=max.x,array[13]=max.y,array[14]=min.z,array[15]=min.x,array[16]=max.y,array[17]=min.z,array[18]=min.x,array[19]=min.y,array[20]=min.z,array[21]=max.x,array[22]=min.y,array[23]=min.z,position.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}();var lineGeometry=new BufferGeometry;lineGeometry.addAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3));var radians,axis,coneGeometry=new CylinderBufferGeometry(0,.5,1,5,1);function ArrowHelper(dir,origin,length,color,headLength,headWidth){Object3D.call(this),void 0===color&&(color=16776960),void 0===length&&(length=1),void 0===headLength&&(headLength=.2*length),void 0===headWidth&&(headWidth=.2*headLength),this.position.copy(origin),this.line=new Line(lineGeometry,new LineBasicMaterial({color:color})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(coneGeometry,new MeshBasicMaterial({color:color})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(dir),this.setLength(length,headLength,headWidth)}function AxisHelper(size){var vertices=[0,0,0,size=size||1,0,0,0,0,0,0,size,0,0,0,0,0,0,size],geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute(vertices,3)),geometry.addAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var material=new LineBasicMaterial({vertexColors:2});LineSegments.call(this,geometry,material)}coneGeometry.translate(0,-.5,0),((ArrowHelper.prototype=Object.create(Object3D.prototype)).constructor=ArrowHelper).prototype.setDirection=(axis=new Vector3,function(dir){.99999<dir.y?this.quaternion.set(0,0,0,1):dir.y<-.99999?this.quaternion.set(1,0,0,0):(axis.set(dir.z,0,-dir.x).normalize(),radians=Math.acos(dir.y),this.quaternion.setFromAxisAngle(axis,radians))}),ArrowHelper.prototype.setLength=function(length,headLength,headWidth){void 0===headLength&&(headLength=.2*length),void 0===headWidth&&(headWidth=.2*headLength),this.line.scale.set(1,Math.max(0,length-headLength),1),this.line.updateMatrix(),this.cone.scale.set(headWidth,headLength,headWidth),this.cone.position.y=length,this.cone.updateMatrix()},ArrowHelper.prototype.setColor=function(color){this.line.material.color.copy(color),this.cone.material.color.copy(color)},(AxisHelper.prototype=Object.create(LineSegments.prototype)).constructor=AxisHelper;var tmp,px,py,pz,CatmullRomCurve3=(tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly,CubicPoly.prototype.init=function(x0,x1,t0,t1){this.c0=x0,this.c1=t0,this.c2=-3*x0+3*x1-2*t0-t1,this.c3=2*x0-2*x1+t0+t1},CubicPoly.prototype.initNonuniformCatmullRom=function(x0,x1,x2,x3,dt0,dt1,dt2){var t1=(x1-x0)/dt0-(x2-x0)/(dt0+dt1)+(x2-x1)/dt1,t2=(x2-x1)/dt1-(x3-x1)/(dt1+dt2)+(x3-x2)/dt2;t1*=dt1,t2*=dt1,this.init(x1,x2,t1,t2)},CubicPoly.prototype.initCatmullRom=function(x0,x1,x2,x3,tension){this.init(x1,x2,tension*(x2-x0),tension*(x3-x1))},CubicPoly.prototype.calc=function(t){var t2=t*t,t3=t2*t;return this.c0+this.c1*t+this.c2*t2+this.c3*t3},Curve.create(function(p){this.points=p||[],this.closed=!1},function(t){var point,intPoint,weight,l,p0,p1,p2,p3,points=this.points;if((l=points.length)<2&&console.log("duh, you need at least 2 points"),weight=(point=(l-(this.closed?0:1))*t)-(intPoint=Math.floor(point)),this.closed?intPoint+=0<intPoint?0:(Math.floor(Math.abs(intPoint)/points.length)+1)*points.length:0===weight&&intPoint===l-1&&(intPoint=l-2,weight=1),p0=this.closed||0<intPoint?points[(intPoint-1)%l]:(tmp.subVectors(points[0],points[1]).add(points[0]),tmp),p1=points[intPoint%l],p2=points[(intPoint+1)%l],p3=this.closed||intPoint+2<l?points[(intPoint+2)%l]:(tmp.subVectors(points[l-1],points[l-2]).add(points[l-1]),tmp),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var pow="chordal"===this.type?.5:.25,dt0=Math.pow(p0.distanceToSquared(p1),pow),dt1=Math.pow(p1.distanceToSquared(p2),pow),dt2=Math.pow(p2.distanceToSquared(p3),pow);dt1<1e-4&&(dt1=1),dt0<1e-4&&(dt0=dt1),dt2<1e-4&&(dt2=dt1),px.initNonuniformCatmullRom(p0.x,p1.x,p2.x,p3.x,dt0,dt1,dt2),py.initNonuniformCatmullRom(p0.y,p1.y,p2.y,p3.y,dt0,dt1,dt2),pz.initNonuniformCatmullRom(p0.z,p1.z,p2.z,p3.z,dt0,dt1,dt2)}else if("catmullrom"===this.type){var tension=void 0!==this.tension?this.tension:.5;px.initCatmullRom(p0.x,p1.x,p2.x,p3.x,tension),py.initCatmullRom(p0.y,p1.y,p2.y,p3.y,tension),pz.initCatmullRom(p0.z,p1.z,p2.z,p3.z,tension)}return new Vector3(px.calc(weight),py.calc(weight),pz.calc(weight))}));function CubicPoly(){}var SplineCurve3=Curve.create(function(points){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"),this.points=void 0===points?[]:points},function(t){var points=this.points,point=(points.length-1)*t,intPoint=Math.floor(point),weight=point-intPoint,point0=points[0==intPoint?intPoint:intPoint-1],point1=points[intPoint],point2=points[intPoint>points.length-2?points.length-1:intPoint+1],point3=points[intPoint>points.length-3?points.length-1:intPoint+2],interpolate=CurveUtils.interpolate;return new Vector3(interpolate(point0.x,point1.x,point2.x,point3.x,weight),interpolate(point0.y,point1.y,point2.y,point3.y,weight),interpolate(point0.z,point1.z,point2.z,point3.z,weight))}),CubicBezierCurve3=Curve.create(function(v0,v1,v2,v3){this.v0=v0,this.v1=v1,this.v2=v2,this.v3=v3},function(t){var b3=ShapeUtils.b3;return new Vector3(b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),QuadraticBezierCurve3=Curve.create(function(v0,v1,v2){this.v0=v0,this.v1=v1,this.v2=v2},function(t){var b2=ShapeUtils.b2;return new Vector3(b2(t,this.v0.x,this.v1.x,this.v2.x),b2(t,this.v0.y,this.v1.y,this.v2.y),b2(t,this.v0.z,this.v1.z,this.v2.z))}),LineCurve3=Curve.create(function(v1,v2){this.v1=v1,this.v2=v2},function(t){if(1===t)return this.v2.clone();var vector=new Vector3;return vector.subVectors(this.v2,this.v1),vector.multiplyScalar(t),vector.add(this.v1),vector});function ArcCurve(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){EllipseCurve.call(this,aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise)}(ArcCurve.prototype=Object.create(EllipseCurve.prototype)).constructor=ArcCurve;var SceneUtils={createMultiMaterialObject:function(geometry,materials){for(var group=new Group,i=0,l=materials.length;i<l;i++)group.add(new Mesh(geometry,materials[i]));return group},detach:function(child,parent,scene){child.applyMatrix(parent.matrixWorld),parent.remove(child),scene.add(child)},attach:function(child,scene,parent){var matrixWorldInverse=new Matrix4;matrixWorldInverse.getInverse(parent.matrixWorld),child.applyMatrix(matrixWorldInverse),scene.remove(child),parent.add(child)}};function ClosedSplineCurve3(points){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,points),this.type="catmullrom",this.closed=!0}ClosedSplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Object.assign(Box2.prototype,{center:function(optionalTarget){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(optionalTarget)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(box){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(box)},size:function(optionalTarget){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(optionalTarget)}}),Object.assign(Box3.prototype,{center:function(optionalTarget){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(optionalTarget)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(box){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(box)},isIntersectionSphere:function(sphere){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(sphere)},size:function(optionalTarget){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(optionalTarget)}}),Line3.prototype.center=function(optionalTarget){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(optionalTarget)},_Math.random16=function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(array,offset){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(array,offset)},multiplyVector3:function(vector){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),vector.applyMatrix3(this)},multiplyVector3Array:function(a){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(a)},applyToBuffer:function(buffer,offset,length){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(buffer)}}),Object.assign(Matrix4.prototype,{extractPosition:function(m){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(m)},flattenToArrayOffset:function(array,offset){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(array,offset)},getPosition:function(){var v1;return function(){return void 0===v1&&(v1=new Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),v1.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(q){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(q)},multiplyVector3:function(vector){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),vector.applyProjection(this)},multiplyVector4:function(vector){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),vector.applyMatrix4(this)},multiplyVector3Array:function(a){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(a)},rotateAxis:function(v){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),v.transformDirection(this)},crossVector:function(vector){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),vector.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(buffer,offset,length){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(buffer)}}),Plane.prototype.isIntersectionLine=function(line){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(line)},Quaternion.prototype.multiplyVector3=function(vector){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),vector.applyQuaternion(this)},Object.assign(Ray.prototype,{isIntersectionBox:function(box){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(box)},isIntersectionPlane:function(plane){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(plane)},isIntersectionSphere:function(sphere){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(sphere)}}),Object.assign(Shape.prototype,{extrude:function(options){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,options)},makeGeometry:function(options){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,options)}}),Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(m){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(m)},getScaleFromMatrix:function(m){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(m)},getColumnFromMatrix:function(index,matrix){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(matrix,index)}}),Geometry.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},Object.assign(Object3D.prototype,{getChildByName:function(name){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(name)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(distance,axis){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(axis,distance)}}),Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(value){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=value}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),PerspectiveCamera.prototype.setLens=function(focalLength,filmGauge){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==filmGauge&&(this.filmGauge=filmGauge),this.setFocalLength(focalLength)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(value){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=value}},shadowCameraLeft:{set:function(value){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=value}},shadowCameraRight:{set:function(value){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=value}},shadowCameraTop:{set:function(value){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=value}},shadowCameraBottom:{set:function(value){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=value}},shadowCameraNear:{set:function(value){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=value}},shadowCameraFar:{set:function(value){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=value}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(value){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=value}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(value){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=value}},shadowMapHeight:{set:function(value){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=value}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}}),Object.assign(BufferGeometry.prototype,{addIndex:function(index){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(index)},addDrawCall:function(start,count,indexOffset){void 0!==indexOffset&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(start,count)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Uniform.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new Color}}}),Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(value){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=value}}}),EventDispatcher.prototype=Object.assign(Object.create({constructor:EventDispatcher,apply:function(target){console.warn("THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in."),Object.assign(target,this)}}),EventDispatcher.prototype),Object.assign(WebGLRenderer.prototype,{supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(boolean){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(boolean)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}),Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(value){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=value}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(value){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=value}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(value){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=value}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){return this.renderReverseSided?CullFaceFront:CullFaceBack},set:function(cullFace){var value=cullFace!==CullFaceBack;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+value+"."),this.renderReverseSided=value}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(value){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=value}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(value){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=value}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(value){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=value}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(value){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=value}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(value){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=value}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(value){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=value}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(value){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=value}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(value){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=value}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(value){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=value}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(value){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=value}}}),Audio.prototype.load=function(file){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var scope=this;return(new AudioLoader).load(file,function(buffer){scope.setBuffer(buffer)}),this},AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};var GeometryUtils={merge:function(geometry1,geometry2,materialIndexOffset){var matrix;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),geometry2.isMesh&&(geometry2.matrixAutoUpdate&&geometry2.updateMatrix(),matrix=geometry2.matrix,geometry2=geometry2.geometry),geometry1.merge(geometry2,matrix,materialIndexOffset)},center:function(geometry){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),geometry.center()}},ImageUtils={crossOrigin:void 0,loadTexture:function(url,mapping,onLoad,onError){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var loader=new TextureLoader;loader.setCrossOrigin(this.crossOrigin);var texture=loader.load(url,onLoad,void 0,onError);return mapping&&(texture.mapping=mapping),texture},loadTextureCube:function(urls,mapping,onLoad,onError){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var loader=new CubeTextureLoader;loader.setCrossOrigin(this.crossOrigin);var texture=loader.load(urls,onLoad,void 0,onError);return mapping&&(texture.mapping=mapping),texture},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};exports.WebGLRenderTargetCube=WebGLRenderTargetCube,exports.WebGLRenderTarget=WebGLRenderTarget,exports.WebGLRenderer=WebGLRenderer,exports.ShaderLib=ShaderLib,exports.UniformsLib=UniformsLib,exports.UniformsUtils=UniformsUtils,exports.ShaderChunk=ShaderChunk,exports.FogExp2=FogExp2,exports.Fog=Fog,exports.Scene=Scene,exports.LensFlare=LensFlare,exports.Sprite=Sprite,exports.LOD=LOD,exports.SkinnedMesh=SkinnedMesh,exports.Skeleton=Skeleton,exports.Bone=Bone,exports.Mesh=Mesh,exports.LineSegments=LineSegments,exports.Line=Line,exports.Points=Points,exports.Group=Group,exports.VideoTexture=VideoTexture,exports.DataTexture=DataTexture,exports.CompressedTexture=CompressedTexture,exports.CubeTexture=CubeTexture,exports.CanvasTexture=CanvasTexture,exports.DepthTexture=DepthTexture,exports.Texture=Texture,exports.CompressedTextureLoader=CompressedTextureLoader,exports.BinaryTextureLoader=BinaryTextureLoader,exports.DataTextureLoader=DataTextureLoader,exports.CubeTextureLoader=CubeTextureLoader,exports.TextureLoader=TextureLoader,exports.ObjectLoader=ObjectLoader,exports.MaterialLoader=MaterialLoader,exports.BufferGeometryLoader=BufferGeometryLoader,exports.DefaultLoadingManager=DefaultLoadingManager,exports.LoadingManager=LoadingManager,exports.JSONLoader=JSONLoader,exports.ImageLoader=ImageLoader,exports.FontLoader=FontLoader,exports.FileLoader=FileLoader,exports.Loader=Loader,exports.Cache=Cache,exports.AudioLoader=AudioLoader,exports.SpotLightShadow=SpotLightShadow,exports.SpotLight=SpotLight,exports.PointLight=PointLight,exports.RectAreaLight=RectAreaLight,exports.HemisphereLight=HemisphereLight,exports.DirectionalLightShadow=DirectionalLightShadow,exports.DirectionalLight=DirectionalLight,exports.AmbientLight=AmbientLight,exports.LightShadow=LightShadow,exports.Light=Light,exports.StereoCamera=StereoCamera,exports.PerspectiveCamera=PerspectiveCamera,exports.OrthographicCamera=OrthographicCamera,exports.CubeCamera=CubeCamera,exports.Camera=Camera,exports.AudioListener=AudioListener,exports.PositionalAudio=PositionalAudio,exports.AudioContext=AudioContext,exports.AudioAnalyser=AudioAnalyser,exports.Audio=Audio,exports.VectorKeyframeTrack=VectorKeyframeTrack,exports.StringKeyframeTrack=StringKeyframeTrack,exports.QuaternionKeyframeTrack=QuaternionKeyframeTrack,exports.NumberKeyframeTrack=NumberKeyframeTrack,exports.ColorKeyframeTrack=ColorKeyframeTrack,exports.BooleanKeyframeTrack=BooleanKeyframeTrack,exports.PropertyMixer=PropertyMixer,exports.PropertyBinding=PropertyBinding,exports.KeyframeTrack=KeyframeTrack,exports.AnimationUtils=AnimationUtils,exports.AnimationObjectGroup=AnimationObjectGroup,exports.AnimationMixer=AnimationMixer,exports.AnimationClip=AnimationClip,exports.Uniform=Uniform,exports.InstancedBufferGeometry=InstancedBufferGeometry,exports.BufferGeometry=BufferGeometry,exports.GeometryIdCount=GeometryIdCount,exports.Geometry=Geometry,exports.InterleavedBufferAttribute=InterleavedBufferAttribute,exports.InstancedInterleavedBuffer=InstancedInterleavedBuffer,exports.InterleavedBuffer=InterleavedBuffer,exports.InstancedBufferAttribute=InstancedBufferAttribute,exports.Face3=Face3,exports.Object3D=Object3D,exports.Raycaster=Raycaster,exports.Layers=Layers,exports.EventDispatcher=EventDispatcher,exports.Clock=Clock,exports.QuaternionLinearInterpolant=QuaternionLinearInterpolant,exports.LinearInterpolant=LinearInterpolant,exports.DiscreteInterpolant=DiscreteInterpolant,exports.CubicInterpolant=CubicInterpolant,exports.Interpolant=Interpolant,exports.Triangle=Triangle,exports.Spline=function(points){this.points=points;var point,intPoint,weight,w2,w3,pa,pb,pc,pd,c=[],v3={x:0,y:0,z:0};function interpolate(p0,p1,p2,p3,t,t2,t3){var v0=.5*(p2-p0),v1=.5*(p3-p1);return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1}this.initFromArray=function(a){this.points=[];for(var i=0;i<a.length;i++)this.points[i]={x:a[i][0],y:a[i][1],z:a[i][2]}},this.getPoint=function(k){return point=(this.points.length-1)*k,intPoint=Math.floor(point),weight=point-intPoint,c[0]=0===intPoint?intPoint:intPoint-1,c[1]=intPoint,c[2]=intPoint>this.points.length-2?this.points.length-1:intPoint+1,c[3]=intPoint>this.points.length-3?this.points.length-1:intPoint+2,pa=this.points[c[0]],pb=this.points[c[1]],pc=this.points[c[2]],pd=this.points[c[3]],w3=weight*(w2=weight*weight),v3.x=interpolate(pa.x,pb.x,pc.x,pd.x,weight,w2,w3),v3.y=interpolate(pa.y,pb.y,pc.y,pd.y,weight,w2,w3),v3.z=interpolate(pa.z,pb.z,pc.z,pd.z,weight,w2,w3),v3},this.getControlPointsArray=function(){var i,p,l=this.points.length,coords=[];for(i=0;i<l;i++)p=this.points[i],coords[i]=[p.x,p.y,p.z];return coords},this.getLength=function(nSubDivisions){var i,index,nSamples,position,point=0,intPoint=0,oldIntPoint=0,oldPosition=new Vector3,tmpVec=new Vector3,chunkLengths=[],totalLength=0;for(chunkLengths[0]=0,nSubDivisions||(nSubDivisions=100),nSamples=this.points.length*nSubDivisions,oldPosition.copy(this.points[0]),i=1;i<nSamples;i++)index=i/nSamples,position=this.getPoint(index),tmpVec.copy(position),totalLength+=tmpVec.distanceTo(oldPosition),oldPosition.copy(position),point=(this.points.length-1)*index,(intPoint=Math.floor(point))!==oldIntPoint&&(chunkLengths[intPoint]=totalLength,oldIntPoint=intPoint);return chunkLengths[chunkLengths.length]=totalLength,{chunks:chunkLengths,total:totalLength}},this.reparametrizeByArcLength=function(samplingCoef){var i,j,index,indexCurrent,indexNext,realDistance,sampling,position,newpoints=[],tmpVec=new Vector3,sl=this.getLength();for(newpoints.push(tmpVec.copy(this.points[0]).clone()),i=1;i<this.points.length;i++){for(realDistance=sl.chunks[i]-sl.chunks[i-1],sampling=Math.ceil(samplingCoef*realDistance/sl.total),indexCurrent=(i-1)/(this.points.length-1),indexNext=i/(this.points.length-1),j=1;j<sampling-1;j++)index=indexCurrent+j*(1/sampling)*(indexNext-indexCurrent),position=this.getPoint(index),newpoints.push(tmpVec.copy(position).clone());newpoints.push(tmpVec.copy(this.points[i]).clone())}this.points=newpoints}},exports.Math=_Math,exports.Spherical=Spherical,exports.Cylindrical=Cylindrical,exports.Plane=Plane,exports.Frustum=Frustum,exports.Sphere=Sphere,exports.Ray=Ray,exports.Matrix4=Matrix4,exports.Matrix3=Matrix3,exports.Box3=Box3,exports.Box2=Box2,exports.Line3=Line3,exports.Euler=Euler,exports.Vector4=Vector4,exports.Vector3=Vector3,exports.Vector2=Vector2,exports.Quaternion=Quaternion,exports.Color=Color,exports.MorphBlendMesh=MorphBlendMesh,exports.ImmediateRenderObject=ImmediateRenderObject,exports.VertexNormalsHelper=VertexNormalsHelper,exports.SpotLightHelper=SpotLightHelper,exports.SkeletonHelper=SkeletonHelper,exports.PointLightHelper=PointLightHelper,exports.RectAreaLightHelper=RectAreaLightHelper,exports.HemisphereLightHelper=HemisphereLightHelper,exports.GridHelper=GridHelper,exports.PolarGridHelper=PolarGridHelper,exports.FaceNormalsHelper=FaceNormalsHelper,exports.DirectionalLightHelper=DirectionalLightHelper,exports.CameraHelper=CameraHelper,exports.BoxHelper=BoxHelper,exports.ArrowHelper=ArrowHelper,exports.AxisHelper=AxisHelper,exports.CatmullRomCurve3=CatmullRomCurve3,exports.SplineCurve3=SplineCurve3,exports.CubicBezierCurve3=CubicBezierCurve3,exports.QuadraticBezierCurve3=QuadraticBezierCurve3,exports.LineCurve3=LineCurve3,exports.ArcCurve=ArcCurve,exports.EllipseCurve=EllipseCurve,exports.SplineCurve=SplineCurve,exports.CubicBezierCurve=CubicBezierCurve,exports.QuadraticBezierCurve=QuadraticBezierCurve,exports.LineCurve=LineCurve,exports.Shape=Shape,exports.ShapePath=ShapePath,exports.Path=Path,exports.Font=Font,exports.CurvePath=CurvePath,exports.Curve=Curve,exports.ShapeUtils=ShapeUtils,exports.SceneUtils=SceneUtils,exports.CurveUtils=CurveUtils,exports.WireframeGeometry=WireframeGeometry,exports.ParametricGeometry=ParametricGeometry,exports.ParametricBufferGeometry=ParametricBufferGeometry,exports.TetrahedronGeometry=TetrahedronGeometry,exports.TetrahedronBufferGeometry=TetrahedronBufferGeometry,exports.OctahedronGeometry=OctahedronGeometry,exports.OctahedronBufferGeometry=OctahedronBufferGeometry,exports.IcosahedronGeometry=IcosahedronGeometry,exports.IcosahedronBufferGeometry=IcosahedronBufferGeometry,exports.DodecahedronGeometry=DodecahedronGeometry,exports.DodecahedronBufferGeometry=DodecahedronBufferGeometry,exports.PolyhedronGeometry=PolyhedronGeometry,exports.PolyhedronBufferGeometry=PolyhedronBufferGeometry,exports.TubeGeometry=TubeGeometry,exports.TubeBufferGeometry=TubeBufferGeometry,exports.TorusKnotGeometry=TorusKnotGeometry,exports.TorusKnotBufferGeometry=TorusKnotBufferGeometry,exports.TorusGeometry=TorusGeometry,exports.TorusBufferGeometry=TorusBufferGeometry,exports.TextGeometry=TextGeometry,exports.SphereBufferGeometry=SphereBufferGeometry,exports.SphereGeometry=SphereGeometry,exports.RingGeometry=RingGeometry,exports.RingBufferGeometry=RingBufferGeometry,exports.PlaneBufferGeometry=PlaneBufferGeometry,exports.PlaneGeometry=PlaneGeometry,exports.LatheGeometry=LatheGeometry,exports.LatheBufferGeometry=LatheBufferGeometry,exports.ShapeGeometry=ShapeGeometry,exports.ShapeBufferGeometry=ShapeBufferGeometry,exports.ExtrudeGeometry=ExtrudeGeometry,exports.EdgesGeometry=EdgesGeometry,exports.ConeGeometry=ConeGeometry,exports.ConeBufferGeometry=ConeBufferGeometry,exports.CylinderGeometry=CylinderGeometry,exports.CylinderBufferGeometry=CylinderBufferGeometry,exports.CircleBufferGeometry=CircleBufferGeometry,exports.CircleGeometry=CircleGeometry,exports.BoxBufferGeometry=BoxBufferGeometry,exports.BoxGeometry=BoxGeometry,exports.ShadowMaterial=ShadowMaterial,exports.SpriteMaterial=SpriteMaterial,exports.RawShaderMaterial=RawShaderMaterial,exports.ShaderMaterial=ShaderMaterial,exports.PointsMaterial=PointsMaterial,exports.MultiMaterial=MultiMaterial,exports.MeshPhysicalMaterial=MeshPhysicalMaterial,exports.MeshStandardMaterial=MeshStandardMaterial,exports.MeshPhongMaterial=MeshPhongMaterial,exports.MeshToonMaterial=MeshToonMaterial,exports.MeshNormalMaterial=MeshNormalMaterial,exports.MeshLambertMaterial=MeshLambertMaterial,exports.MeshDepthMaterial=MeshDepthMaterial,exports.MeshBasicMaterial=MeshBasicMaterial,exports.LineDashedMaterial=LineDashedMaterial,exports.LineBasicMaterial=LineBasicMaterial,exports.Material=Material,exports.Float64BufferAttribute=Float64BufferAttribute,exports.Float32BufferAttribute=Float32BufferAttribute,exports.Uint32BufferAttribute=Uint32BufferAttribute,exports.Int32BufferAttribute=Int32BufferAttribute,exports.Uint16BufferAttribute=Uint16BufferAttribute,exports.Int16BufferAttribute=Int16BufferAttribute,exports.Uint8ClampedBufferAttribute=Uint8ClampedBufferAttribute,exports.Uint8BufferAttribute=Uint8BufferAttribute,exports.Int8BufferAttribute=Int8BufferAttribute,exports.BufferAttribute=BufferAttribute,exports.REVISION="83",exports.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},exports.CullFaceNone=CullFaceNone,exports.CullFaceBack=CullFaceBack,exports.CullFaceFront=CullFaceFront,exports.CullFaceFrontBack=3,exports.FrontFaceDirectionCW=0,exports.FrontFaceDirectionCCW=1,exports.BasicShadowMap=0,exports.PCFShadowMap=PCFShadowMap,exports.PCFSoftShadowMap=PCFSoftShadowMap,exports.FrontSide=FrontSide,exports.BackSide=BackSide,exports.DoubleSide=DoubleSide,exports.FlatShading=FlatShading,exports.SmoothShading=SmoothShading,exports.NoColors=NoColors,exports.FaceColors=1,exports.VertexColors=2,exports.NoBlending=NoBlending,exports.NormalBlending=NormalBlending,exports.AdditiveBlending=AdditiveBlending,exports.SubtractiveBlending=SubtractiveBlending,exports.MultiplyBlending=MultiplyBlending,exports.CustomBlending=CustomBlending,exports.BlendingMode=BlendingMode,exports.AddEquation=AddEquation,exports.SubtractEquation=101,exports.ReverseSubtractEquation=102,exports.MinEquation=103,exports.MaxEquation=104,exports.ZeroFactor=200,exports.OneFactor=201,exports.SrcColorFactor=202,exports.OneMinusSrcColorFactor=203,exports.SrcAlphaFactor=SrcAlphaFactor,exports.OneMinusSrcAlphaFactor=OneMinusSrcAlphaFactor,exports.DstAlphaFactor=206,exports.OneMinusDstAlphaFactor=207,exports.DstColorFactor=208,exports.OneMinusDstColorFactor=209,exports.SrcAlphaSaturateFactor=210,exports.NeverDepth=NeverDepth,exports.AlwaysDepth=AlwaysDepth,exports.LessDepth=LessDepth,exports.LessEqualDepth=LessEqualDepth,exports.EqualDepth=EqualDepth,exports.GreaterEqualDepth=GreaterEqualDepth,exports.GreaterDepth=GreaterDepth,exports.NotEqualDepth=NotEqualDepth,exports.MultiplyOperation=MultiplyOperation,exports.MixOperation=MixOperation,exports.AddOperation=AddOperation,exports.NoToneMapping=NoToneMapping,exports.LinearToneMapping=LinearToneMapping,exports.ReinhardToneMapping=ReinhardToneMapping,exports.Uncharted2ToneMapping=Uncharted2ToneMapping,exports.CineonToneMapping=CineonToneMapping,exports.UVMapping=300,exports.CubeReflectionMapping=CubeReflectionMapping,exports.CubeRefractionMapping=CubeRefractionMapping,exports.EquirectangularReflectionMapping=EquirectangularReflectionMapping,exports.EquirectangularRefractionMapping=EquirectangularRefractionMapping,exports.SphericalReflectionMapping=SphericalReflectionMapping,exports.CubeUVReflectionMapping=CubeUVReflectionMapping,exports.CubeUVRefractionMapping=CubeUVRefractionMapping,exports.TextureMapping=TextureMapping,exports.RepeatWrapping=1e3,exports.ClampToEdgeWrapping=ClampToEdgeWrapping,exports.MirroredRepeatWrapping=1002,exports.TextureWrapping=TextureWrapping,exports.NearestFilter=NearestFilter,exports.NearestMipMapNearestFilter=NearestMipMapNearestFilter,exports.NearestMipMapLinearFilter=NearestMipMapLinearFilter,exports.LinearFilter=LinearFilter,exports.LinearMipMapNearestFilter=1007,exports.LinearMipMapLinearFilter=LinearMipMapLinearFilter,exports.TextureFilter=TextureFilter,exports.UnsignedByteType=UnsignedByteType,exports.ByteType=1010,exports.ShortType=1011,exports.UnsignedShortType=UnsignedShortType,exports.IntType=1013,exports.UnsignedIntType=UnsignedIntType,exports.FloatType=FloatType,exports.HalfFloatType=HalfFloatType,exports.UnsignedShort4444Type=1017,exports.UnsignedShort5551Type=1018,exports.UnsignedShort565Type=1019,exports.UnsignedInt248Type=UnsignedInt248Type,exports.AlphaFormat=1021,exports.RGBFormat=RGBFormat,exports.RGBAFormat=RGBAFormat,exports.LuminanceFormat=1024,exports.LuminanceAlphaFormat=1025,exports.RGBEFormat=RGBEFormat,exports.DepthFormat=DepthFormat,exports.DepthStencilFormat=DepthStencilFormat,exports.RGB_S3TC_DXT1_Format=2001,exports.RGBA_S3TC_DXT1_Format=2002,exports.RGBA_S3TC_DXT3_Format=2003,exports.RGBA_S3TC_DXT5_Format=2004,exports.RGB_PVRTC_4BPPV1_Format=2100,exports.RGB_PVRTC_2BPPV1_Format=2101,exports.RGBA_PVRTC_4BPPV1_Format=2102,exports.RGBA_PVRTC_2BPPV1_Format=2103,exports.RGB_ETC1_Format=2151,exports.LoopOnce=2200,exports.LoopRepeat=2201,exports.LoopPingPong=2202,exports.InterpolateDiscrete=2300,exports.InterpolateLinear=2301,exports.InterpolateSmooth=2302,exports.ZeroCurvatureEnding=2400,exports.ZeroSlopeEnding=2401,exports.WrapAroundEnding=2402,exports.TrianglesDrawMode=TrianglesDrawMode,exports.TriangleStripDrawMode=1,exports.TriangleFanDrawMode=2,exports.LinearEncoding=LinearEncoding,exports.sRGBEncoding=sRGBEncoding,exports.GammaEncoding=GammaEncoding,exports.RGBEEncoding=RGBEEncoding,exports.LogLuvEncoding=3003,exports.RGBM7Encoding=RGBM7Encoding,exports.RGBM16Encoding=RGBM16Encoding,exports.RGBDEncoding=RGBDEncoding,exports.BasicDepthPacking=BasicDepthPacking,exports.RGBADepthPacking=RGBADepthPacking,exports.CubeGeometry=BoxGeometry,exports.Face4=function(a,b,c,d,normal,color,materialIndex){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Face3(a,b,c,normal,color,materialIndex)},exports.LineStrip=0,exports.LinePieces=1,exports.MeshFaceMaterial=function(materials){return console.warn("THREE.MeshFaceMaterial has been renamed to THREE.MultiMaterial."),new MultiMaterial(materials)},exports.PointCloud=function(geometry,material){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(geometry,material)},exports.Particle=function(material){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(material)},exports.ParticleSystem=function(geometry,material){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(geometry,material)},exports.PointCloudMaterial=function(parameters){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(parameters)},exports.ParticleBasicMaterial=function(parameters){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(parameters)},exports.ParticleSystemMaterial=function(parameters){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(parameters)},exports.Vertex=function(x,y,z){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3(x,y,z)},exports.DynamicBufferAttribute=function(array,itemSize){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new BufferAttribute(array,itemSize).setDynamic(!0)},exports.Int8Attribute=function(array,itemSize){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(array,itemSize)},exports.Uint8Attribute=function(array,itemSize){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(array,itemSize)},exports.Uint8ClampedAttribute=function(array,itemSize){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(array,itemSize)},exports.Int16Attribute=function(array,itemSize){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(array,itemSize)},exports.Uint16Attribute=function(array,itemSize){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(array,itemSize)},exports.Int32Attribute=function(array,itemSize){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(array,itemSize)},exports.Uint32Attribute=function(array,itemSize){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(array,itemSize)},exports.Float32Attribute=function(array,itemSize){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(array,itemSize)},exports.Float64Attribute=function(array,itemSize){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(array,itemSize)},exports.ClosedSplineCurve3=ClosedSplineCurve3,exports.BoundingBoxHelper=function(object,color){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(object,color)},exports.EdgesHelper=function(object,hex){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(object.geometry),new LineBasicMaterial({color:void 0!==hex?hex:16777215}))},exports.WireframeHelper=function(object,hex){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(object.geometry),new LineBasicMaterial({color:void 0!==hex?hex:16777215}))},exports.XHRLoader=function(manager){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(manager)},exports.GeometryUtils=GeometryUtils,exports.ImageUtils=ImageUtils,exports.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(vector,camera){console.warn("THREE.Projector: .projectVector() is now vector.project()."),vector.project(camera)},this.unprojectVector=function(vector,camera){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),vector.unproject(camera)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},exports.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},Object.defineProperty(exports,"__esModule",{value:!0})},"object"==typeof exports&&void 0!==module?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory(global.THREE=global.THREE||{})},{}],3:[function(require,module,exports){var global,factory;global=this,factory=function(exports){"use strict";function EventDispatcher(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(value){return"number"==typeof value&&isFinite(value)&&Math.floor(value)===value}),void 0===Math.sign&&(Math.sign=function(x){return x<0?-1:0<x?1:+x}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(target){if(null==target)throw new TypeError("Cannot convert undefined or null to object");for(var output=Object(target),index=1;index<arguments.length;index++){var source=arguments[index];if(null!=source)for(var nextKey in source)Object.prototype.hasOwnProperty.call(source,nextKey)&&(output[nextKey]=source[nextKey])}return output}),Object.assign(EventDispatcher.prototype,{addEventListener:function(type,listener){void 0===this._listeners&&(this._listeners={});var listeners=this._listeners;void 0===listeners[type]&&(listeners[type]=[]),-1===listeners[type].indexOf(listener)&&listeners[type].push(listener)},hasEventListener:function(type,listener){if(void 0===this._listeners)return!1;var listeners=this._listeners;return void 0!==listeners[type]&&-1!==listeners[type].indexOf(listener)},removeEventListener:function(type,listener){if(void 0!==this._listeners){var listenerArray=this._listeners[type];if(void 0!==listenerArray){var index=listenerArray.indexOf(listener);-1!==index&&listenerArray.splice(index,1)}}},dispatchEvent:function(event){if(void 0!==this._listeners){var listenerArray=this._listeners[event.type];if(void 0!==listenerArray){event.target=this;for(var array=listenerArray.slice(0),i=0,l=array.length;i<l;i++)array[i].call(this,event)}}}});var v1,quaternion,_canvas,CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,PCFShadowMap=1,PCFSoftShadowMap=2,FrontSide=0,BackSide=1,DoubleSide=2,NoColors=0,VertexColors=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,Uncharted2ToneMapping=3,CineonToneMapping=4,ACESFilmicToneMapping=5,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,SphericalReflectionMapping=305,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipMapNearestFilter=1004,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipMapNearestFilter=1007,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedShort565Type=1019,UnsignedInt248Type=1020,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,RGBEFormat=RGBAFormat,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,TrianglesDrawMode=0,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,_Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var lut=[],i=0;i<256;i++)lut[i]=(i<16?"0":"")+i.toString(16);return function(){var d0=4294967295*Math.random()|0,d1=4294967295*Math.random()|0,d2=4294967295*Math.random()|0,d3=4294967295*Math.random()|0;return(lut[255&d0]+lut[d0>>8&255]+lut[d0>>16&255]+lut[d0>>24&255]+"-"+lut[255&d1]+lut[d1>>8&255]+"-"+lut[d1>>16&15|64]+lut[d1>>24&255]+"-"+lut[63&d2|128]+lut[d2>>8&255]+"-"+lut[d2>>16&255]+lut[d2>>24&255]+lut[255&d3]+lut[d3>>8&255]+lut[d3>>16&255]+lut[d3>>24&255]).toUpperCase()}}(),clamp:function(value,min,max){return Math.max(min,Math.min(max,value))},euclideanModulo:function(n,m){return(n%m+m)%m},mapLinear:function(x,a1,a2,b1,b2){return b1+(x-a1)*(b2-b1)/(a2-a1)},lerp:function(x,y,t){return(1-t)*x+t*y},smoothstep:function(x,min,max){return x<=min?0:max<=x?1:(x=(x-min)/(max-min))*x*(3-2*x)},smootherstep:function(x,min,max){return x<=min?0:max<=x?1:(x=(x-min)/(max-min))*x*x*(x*(6*x-15)+10)},randInt:function(low,high){return low+Math.floor(Math.random()*(high-low+1))},randFloat:function(low,high){return low+Math.random()*(high-low)},randFloatSpread:function(range){return range*(.5-Math.random())},degToRad:function(degrees){return degrees*_Math.DEG2RAD},radToDeg:function(radians){return radians*_Math.RAD2DEG},isPowerOfTwo:function(value){return 0==(value&value-1)&&0!==value},ceilPowerOfTwo:function(value){return Math.pow(2,Math.ceil(Math.log(value)/Math.LN2))},floorPowerOfTwo:function(value){return Math.pow(2,Math.floor(Math.log(value)/Math.LN2))}};function Vector2(x,y){this.x=x||0,this.y=y||0}function Quaternion(x,y,z,w){this._x=x||0,this._y=y||0,this._z=z||0,this._w=void 0!==w?w:1}function Vector3(x,y,z){this.x=x||0,this.y=y||0,this.z=z||0}function Matrix3(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Vector2.prototype,{width:{get:function(){return this.x},set:function(value){this.x=value}},height:{get:function(){return this.y},set:function(value){this.y=value}}}),Object.assign(Vector2.prototype,{isVector2:!0,set:function(x,y){return this.x=x,this.y=y,this},setScalar:function(scalar){return this.x=scalar,this.y=scalar,this},setX:function(x){return this.x=x,this},setY:function(y){return this.y=y,this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;default:throw new Error("index is out of range: "+index)}return this},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+index)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(v){return this.x=v.x,this.y=v.y,this},add:function(v,w){return void 0!==w?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(v,w)):(this.x+=v.x,this.y+=v.y,this)},addScalar:function(s){return this.x+=s,this.y+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScaledVector:function(v,s){return this.x+=v.x*s,this.y+=v.y*s,this},sub:function(v,w){return void 0!==w?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(v,w)):(this.x-=v.x,this.y-=v.y,this)},subScalar:function(s){return this.x-=s,this.y-=s,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiply:function(v){return this.x*=v.x,this.y*=v.y,this},multiplyScalar:function(scalar){return this.x*=scalar,this.y*=scalar,this},divide:function(v){return this.x/=v.x,this.y/=v.y,this},divideScalar:function(scalar){return this.multiplyScalar(1/scalar)},applyMatrix3:function(m){var x=this.x,y=this.y,e=m.elements;return this.x=e[0]*x+e[3]*y+e[6],this.y=e[1]*x+e[4]*y+e[7],this},min:function(v){return this.x=Math.min(this.x,v.x),this.y=Math.min(this.y,v.y),this},max:function(v){return this.x=Math.max(this.x,v.x),this.y=Math.max(this.y,v.y),this},clamp:function(min,max){return this.x=Math.max(min.x,Math.min(max.x,this.x)),this.y=Math.max(min.y,Math.min(max.y,this.y)),this},clampScalar:function(minVal,maxVal){return this.x=Math.max(minVal,Math.min(maxVal,this.x)),this.y=Math.max(minVal,Math.min(maxVal,this.y)),this},clampLength:function(min,max){var length=this.length();return this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(v){return this.x*v.x+this.y*v.y},cross:function(v){return this.x*v.y-this.y*v.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var angle=Math.atan2(this.y,this.x);return angle<0&&(angle+=2*Math.PI),angle},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy},manhattanDistanceTo:function(v){return Math.abs(this.x-v.x)+Math.abs(this.y-v.y)},setLength:function(length){return this.normalize().multiplyScalar(length)},lerp:function(v,alpha){return this.x+=(v.x-this.x)*alpha,this.y+=(v.y-this.y)*alpha,this},lerpVectors:function(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)},equals:function(v){return v.x===this.x&&v.y===this.y},fromArray:function(array,offset){return void 0===offset&&(offset=0),this.x=array[offset],this.y=array[offset+1],this},toArray:function(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.x,array[offset+1]=this.y,array},fromBufferAttribute:function(attribute,index,offset){return void 0!==offset&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=attribute.getX(index),this.y=attribute.getY(index),this},rotateAround:function(center,angle){var c=Math.cos(angle),s=Math.sin(angle),x=this.x-center.x,y=this.y-center.y;return this.x=x*c-y*s+center.x,this.y=x*s+y*c+center.y,this}}),Object.assign(Quaternion,{slerp:function(qa,qb,qm,t){return qm.copy(qa).slerp(qb,t)},slerpFlat:function(dst,dstOffset,src0,srcOffset0,src1,srcOffset1,t){var x0=src0[srcOffset0+0],y0=src0[srcOffset0+1],z0=src0[srcOffset0+2],w0=src0[srcOffset0+3],x1=src1[srcOffset1+0],y1=src1[srcOffset1+1],z1=src1[srcOffset1+2],w1=src1[srcOffset1+3];if(w0!==w1||x0!==x1||y0!==y1||z0!==z1){var s=1-t,cos=x0*x1+y0*y1+z0*z1+w0*w1,dir=0<=cos?1:-1,sqrSin=1-cos*cos;if(sqrSin>Number.EPSILON){var sin=Math.sqrt(sqrSin),len=Math.atan2(sin,cos*dir);s=Math.sin(s*len)/sin,t=Math.sin(t*len)/sin}var tDir=t*dir;if(x0=x0*s+x1*tDir,y0=y0*s+y1*tDir,z0=z0*s+z1*tDir,w0=w0*s+w1*tDir,s===1-t){var f=1/Math.sqrt(x0*x0+y0*y0+z0*z0+w0*w0);x0*=f,y0*=f,z0*=f,w0*=f}}dst[dstOffset]=x0,dst[dstOffset+1]=y0,dst[dstOffset+2]=z0,dst[dstOffset+3]=w0}}),Object.defineProperties(Quaternion.prototype,{x:{get:function(){return this._x},set:function(value){this._x=value,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(value){this._y=value,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(value){this._z=value,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(value){this._w=value,this.onChangeCallback()}}}),Object.assign(Quaternion.prototype,{isQuaternion:!0,set:function(x,y,z,w){return this._x=x,this._y=y,this._z=z,this._w=w,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(quaternion){return this._x=quaternion.x,this._y=quaternion.y,this._z=quaternion.z,this._w=quaternion.w,this.onChangeCallback(),this},setFromEuler:function(euler,update){if(!euler||!euler.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var x=euler._x,y=euler._y,z=euler._z,order=euler.order,cos=Math.cos,sin=Math.sin,c1=cos(x/2),c2=cos(y/2),c3=cos(z/2),s1=sin(x/2),s2=sin(y/2),s3=sin(z/2);return"XYZ"===order?(this._x=s1*c2*c3+c1*s2*s3,this._y=c1*s2*c3-s1*c2*s3,this._z=c1*c2*s3+s1*s2*c3,this._w=c1*c2*c3-s1*s2*s3):"YXZ"===order?(this._x=s1*c2*c3+c1*s2*s3,this._y=c1*s2*c3-s1*c2*s3,this._z=c1*c2*s3-s1*s2*c3,this._w=c1*c2*c3+s1*s2*s3):"ZXY"===order?(this._x=s1*c2*c3-c1*s2*s3,this._y=c1*s2*c3+s1*c2*s3,this._z=c1*c2*s3+s1*s2*c3,this._w=c1*c2*c3-s1*s2*s3):"ZYX"===order?(this._x=s1*c2*c3-c1*s2*s3,this._y=c1*s2*c3+s1*c2*s3,this._z=c1*c2*s3-s1*s2*c3,this._w=c1*c2*c3+s1*s2*s3):"YZX"===order?(this._x=s1*c2*c3+c1*s2*s3,this._y=c1*s2*c3+s1*c2*s3,this._z=c1*c2*s3-s1*s2*c3,this._w=c1*c2*c3-s1*s2*s3):"XZY"===order&&(this._x=s1*c2*c3-c1*s2*s3,this._y=c1*s2*c3-s1*c2*s3,this._z=c1*c2*s3+s1*s2*c3,this._w=c1*c2*c3+s1*s2*s3),!1!==update&&this.onChangeCallback(),this},setFromAxisAngle:function(axis,angle){var halfAngle=angle/2,s=Math.sin(halfAngle);return this._x=axis.x*s,this._y=axis.y*s,this._z=axis.z*s,this._w=Math.cos(halfAngle),this.onChangeCallback(),this},setFromRotationMatrix:function(m){var s,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],trace=m11+m22+m33;return 0<trace?(s=.5/Math.sqrt(trace+1),this._w=.25/s,this._x=(m32-m23)*s,this._y=(m13-m31)*s,this._z=(m21-m12)*s):m22<m11&&m33<m11?(s=2*Math.sqrt(1+m11-m22-m33),this._w=(m32-m23)/s,this._x=.25*s,this._y=(m12+m21)/s,this._z=(m13+m31)/s):m33<m22?(s=2*Math.sqrt(1+m22-m11-m33),this._w=(m13-m31)/s,this._x=(m12+m21)/s,this._y=.25*s,this._z=(m23+m32)/s):(s=2*Math.sqrt(1+m33-m11-m22),this._w=(m21-m12)/s,this._x=(m13+m31)/s,this._y=(m23+m32)/s,this._z=.25*s),this.onChangeCallback(),this},setFromUnitVectors:function(vFrom,vTo){var r=vFrom.dot(vTo)+1;return r<1e-6?(r=0,Math.abs(vFrom.x)>Math.abs(vFrom.z)?(this._x=-vFrom.y,this._y=vFrom.x,this._z=0):(this._x=0,this._y=-vFrom.z,this._z=vFrom.y)):(this._x=vFrom.y*vTo.z-vFrom.z*vTo.y,this._y=vFrom.z*vTo.x-vFrom.x*vTo.z,this._z=vFrom.x*vTo.y-vFrom.y*vTo.x),this._w=r,this.normalize()},angleTo:function(q){return 2*Math.acos(Math.abs(_Math.clamp(this.dot(q),-1,1)))},rotateTowards:function(q,step){var angle=this.angleTo(q);if(0===angle)return this;var t=Math.min(1,step/angle);return this.slerp(q,t),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(v){return this._x*v._x+this._y*v._y+this._z*v._z+this._w*v._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var l=this.length();return 0===l?(this._x=0,this._y=0,this._z=0,this._w=1):(l=1/l,this._x=this._x*l,this._y=this._y*l,this._z=this._z*l,this._w=this._w*l),this.onChangeCallback(),this},multiply:function(q,p){return void 0!==p?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(q,p)):this.multiplyQuaternions(this,q)},premultiply:function(q){return this.multiplyQuaternions(q,this)},multiplyQuaternions:function(a,b){var qax=a._x,qay=a._y,qaz=a._z,qaw=a._w,qbx=b._x,qby=b._y,qbz=b._z,qbw=b._w;return this._x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby,this._y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz,this._z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx,this._w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz,this.onChangeCallback(),this},slerp:function(qb,t){if(0===t)return this;if(1===t)return this.copy(qb);var x=this._x,y=this._y,z=this._z,w=this._w,cosHalfTheta=w*qb._w+x*qb._x+y*qb._y+z*qb._z;if(cosHalfTheta<0?(this._w=-qb._w,this._x=-qb._x,this._y=-qb._y,this._z=-qb._z,cosHalfTheta=-cosHalfTheta):this.copy(qb),1<=cosHalfTheta)return this._w=w,this._x=x,this._y=y,this._z=z,this;var sqrSinHalfTheta=1-cosHalfTheta*cosHalfTheta;if(sqrSinHalfTheta<=Number.EPSILON){var s=1-t;return this._w=s*w+t*this._w,this._x=s*x+t*this._x,this._y=s*y+t*this._y,this._z=s*z+t*this._z,this.normalize()}var sinHalfTheta=Math.sqrt(sqrSinHalfTheta),halfTheta=Math.atan2(sinHalfTheta,cosHalfTheta),ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,ratioB=Math.sin(t*halfTheta)/sinHalfTheta;return this._w=w*ratioA+this._w*ratioB,this._x=x*ratioA+this._x*ratioB,this._y=y*ratioA+this._y*ratioB,this._z=z*ratioA+this._z*ratioB,this.onChangeCallback(),this},equals:function(quaternion){return quaternion._x===this._x&&quaternion._y===this._y&&quaternion._z===this._z&&quaternion._w===this._w},fromArray:function(array,offset){return void 0===offset&&(offset=0),this._x=array[offset],this._y=array[offset+1],this._z=array[offset+2],this._w=array[offset+3],this.onChangeCallback(),this},toArray:function(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this._x,array[offset+1]=this._y,array[offset+2]=this._z,array[offset+3]=this._w,array},onChange:function(callback){return this.onChangeCallback=callback,this},onChangeCallback:function(){}}),Object.assign(Vector3.prototype,{isVector3:!0,set:function(x,y,z){return this.x=x,this.y=y,this.z=z,this},setScalar:function(scalar){return this.x=scalar,this.y=scalar,this.z=scalar,this},setX:function(x){return this.x=x,this},setY:function(y){return this.y=y,this},setZ:function(z){return this.z=z,this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;default:throw new Error("index is out of range: "+index)}return this},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+index)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this},add:function(v,w){return void 0!==w?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(v,w)):(this.x+=v.x,this.y+=v.y,this.z+=v.z,this)},addScalar:function(s){return this.x+=s,this.y+=s,this.z+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},addScaledVector:function(v,s){return this.x+=v.x*s,this.y+=v.y*s,this.z+=v.z*s,this},sub:function(v,w){return void 0!==w?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(v,w)):(this.x-=v.x,this.y-=v.y,this.z-=v.z,this)},subScalar:function(s){return this.x-=s,this.y-=s,this.z-=s,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(v,w){return void 0!==w?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(v,w)):(this.x*=v.x,this.y*=v.y,this.z*=v.z,this)},multiplyScalar:function(scalar){return this.x*=scalar,this.y*=scalar,this.z*=scalar,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyEuler:(quaternion=new Quaternion,function(euler){return euler&&euler.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(quaternion.setFromEuler(euler))}),applyAxisAngle:function(){var quaternion=new Quaternion;return function(axis,angle){return this.applyQuaternion(quaternion.setFromAxisAngle(axis,angle))}}(),applyMatrix3:function(m){var x=this.x,y=this.y,z=this.z,e=m.elements;return this.x=e[0]*x+e[3]*y+e[6]*z,this.y=e[1]*x+e[4]*y+e[7]*z,this.z=e[2]*x+e[5]*y+e[8]*z,this},applyMatrix4:function(m){var x=this.x,y=this.y,z=this.z,e=m.elements,w=1/(e[3]*x+e[7]*y+e[11]*z+e[15]);return this.x=(e[0]*x+e[4]*y+e[8]*z+e[12])*w,this.y=(e[1]*x+e[5]*y+e[9]*z+e[13])*w,this.z=(e[2]*x+e[6]*y+e[10]*z+e[14])*w,this},applyQuaternion:function(q){var x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,qw=q.w,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy,this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz,this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx,this},project:function(camera){return this.applyMatrix4(camera.matrixWorldInverse).applyMatrix4(camera.projectionMatrix)},unproject:function(camera){return this.applyMatrix4(camera.projectionMatrixInverse).applyMatrix4(camera.matrixWorld)},transformDirection:function(m){var x=this.x,y=this.y,z=this.z,e=m.elements;return this.x=e[0]*x+e[4]*y+e[8]*z,this.y=e[1]*x+e[5]*y+e[9]*z,this.z=e[2]*x+e[6]*y+e[10]*z,this.normalize()},divide:function(v){return this.x/=v.x,this.y/=v.y,this.z/=v.z,this},divideScalar:function(scalar){return this.multiplyScalar(1/scalar)},min:function(v){return this.x=Math.min(this.x,v.x),this.y=Math.min(this.y,v.y),this.z=Math.min(this.z,v.z),this},max:function(v){return this.x=Math.max(this.x,v.x),this.y=Math.max(this.y,v.y),this.z=Math.max(this.z,v.z),this},clamp:function(min,max){return this.x=Math.max(min.x,Math.min(max.x,this.x)),this.y=Math.max(min.y,Math.min(max.y,this.y)),this.z=Math.max(min.z,Math.min(max.z,this.z)),this},clampScalar:function(minVal,maxVal){return this.x=Math.max(minVal,Math.min(maxVal,this.x)),this.y=Math.max(minVal,Math.min(maxVal,this.y)),this.z=Math.max(minVal,Math.min(maxVal,this.z)),this},clampLength:function(min,max){var length=this.length();return this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(length){return this.normalize().multiplyScalar(length)},lerp:function(v,alpha){return this.x+=(v.x-this.x)*alpha,this.y+=(v.y-this.y)*alpha,this.z+=(v.z-this.z)*alpha,this},lerpVectors:function(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)},cross:function(v,w){return void 0!==w?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(v,w)):this.crossVectors(this,v)},crossVectors:function(a,b){var ax=a.x,ay=a.y,az=a.z,bx=b.x,by=b.y,bz=b.z;return this.x=ay*bz-az*by,this.y=az*bx-ax*bz,this.z=ax*by-ay*bx,this},projectOnVector:function(vector){var scalar=vector.dot(this)/vector.lengthSq();return this.copy(vector).multiplyScalar(scalar)},projectOnPlane:(v1=new Vector3,function(planeNormal){return v1.copy(this).projectOnVector(planeNormal),this.sub(v1)}),reflect:function(){var v1=new Vector3;return function(normal){return this.sub(v1.copy(normal).multiplyScalar(2*this.dot(normal)))}}(),angleTo:function(v){var theta=this.dot(v)/Math.sqrt(this.lengthSq()*v.lengthSq());return Math.acos(_Math.clamp(theta,-1,1))},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y,dz=this.z-v.z;return dx*dx+dy*dy+dz*dz},manhattanDistanceTo:function(v){return Math.abs(this.x-v.x)+Math.abs(this.y-v.y)+Math.abs(this.z-v.z)},setFromSpherical:function(s){return this.setFromSphericalCoords(s.radius,s.phi,s.theta)},setFromSphericalCoords:function(radius,phi,theta){var sinPhiRadius=Math.sin(phi)*radius;return this.x=sinPhiRadius*Math.sin(theta),this.y=Math.cos(phi)*radius,this.z=sinPhiRadius*Math.cos(theta),this},setFromCylindrical:function(c){return this.setFromCylindricalCoords(c.radius,c.theta,c.y)},setFromCylindricalCoords:function(radius,theta,y){return this.x=radius*Math.sin(theta),this.y=y,this.z=radius*Math.cos(theta),this},setFromMatrixPosition:function(m){var e=m.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(m){var sx=this.setFromMatrixColumn(m,0).length(),sy=this.setFromMatrixColumn(m,1).length(),sz=this.setFromMatrixColumn(m,2).length();return this.x=sx,this.y=sy,this.z=sz,this},setFromMatrixColumn:function(m,index){return this.fromArray(m.elements,4*index)},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z},fromArray:function(array,offset){return void 0===offset&&(offset=0),this.x=array[offset],this.y=array[offset+1],this.z=array[offset+2],this},toArray:function(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.x,array[offset+1]=this.y,array[offset+2]=this.z,array},fromBufferAttribute:function(attribute,index,offset){return void 0!==offset&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=attribute.getX(index),this.y=attribute.getY(index),this.z=attribute.getZ(index),this}}),Object.assign(Matrix3.prototype,{isMatrix3:!0,set:function(n11,n12,n13,n21,n22,n23,n31,n32,n33){var te=this.elements;return te[0]=n11,te[1]=n21,te[2]=n31,te[3]=n12,te[4]=n22,te[5]=n32,te[6]=n13,te[7]=n23,te[8]=n33,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],this},setFromMatrix4:function(m){var me=m.elements;return this.set(me[0],me[4],me[8],me[1],me[5],me[9],me[2],me[6],me[10]),this},applyToBufferAttribute:function(){var v1=new Vector3;return function(attribute){for(var i=0,l=attribute.count;i<l;i++)v1.x=attribute.getX(i),v1.y=attribute.getY(i),v1.z=attribute.getZ(i),v1.applyMatrix3(this),attribute.setXYZ(i,v1.x,v1.y,v1.z);return attribute}}(),multiply:function(m){return this.multiplyMatrices(this,m)},premultiply:function(m){return this.multiplyMatrices(m,this)},multiplyMatrices:function(a,b){var ae=a.elements,be=b.elements,te=this.elements,a11=ae[0],a12=ae[3],a13=ae[6],a21=ae[1],a22=ae[4],a23=ae[7],a31=ae[2],a32=ae[5],a33=ae[8],b11=be[0],b12=be[3],b13=be[6],b21=be[1],b22=be[4],b23=be[7],b31=be[2],b32=be[5],b33=be[8];return te[0]=a11*b11+a12*b21+a13*b31,te[3]=a11*b12+a12*b22+a13*b32,te[6]=a11*b13+a12*b23+a13*b33,te[1]=a21*b11+a22*b21+a23*b31,te[4]=a21*b12+a22*b22+a23*b32,te[7]=a21*b13+a22*b23+a23*b33,te[2]=a31*b11+a32*b21+a33*b31,te[5]=a31*b12+a32*b22+a33*b32,te[8]=a31*b13+a32*b23+a33*b33,this},multiplyScalar:function(s){var te=this.elements;return te[0]*=s,te[3]*=s,te[6]*=s,te[1]*=s,te[4]*=s,te[7]*=s,te[2]*=s,te[5]*=s,te[8]*=s,this},determinant:function(){var te=this.elements,a=te[0],b=te[1],c=te[2],d=te[3],e=te[4],f=te[5],g=te[6],h=te[7],i=te[8];return a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g},getInverse:function(matrix,throwOnDegenerate){matrix&&matrix.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var me=matrix.elements,te=this.elements,n11=me[0],n21=me[1],n31=me[2],n12=me[3],n22=me[4],n32=me[5],n13=me[6],n23=me[7],n33=me[8],t11=n33*n22-n32*n23,t12=n32*n13-n33*n12,t13=n23*n12-n22*n13,det=n11*t11+n21*t12+n31*t13;if(0==det){var msg="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===throwOnDegenerate)throw new Error(msg);return console.warn(msg),this.identity()}var detInv=1/det;return te[0]=t11*detInv,te[1]=(n31*n23-n33*n21)*detInv,te[2]=(n32*n21-n31*n22)*detInv,te[3]=t12*detInv,te[4]=(n33*n11-n31*n13)*detInv,te[5]=(n31*n12-n32*n11)*detInv,te[6]=t13*detInv,te[7]=(n21*n13-n23*n11)*detInv,te[8]=(n22*n11-n21*n12)*detInv,this},transpose:function(){var tmp,m=this.elements;return tmp=m[1],m[1]=m[3],m[3]=tmp,tmp=m[2],m[2]=m[6],m[6]=tmp,tmp=m[5],m[5]=m[7],m[7]=tmp,this},getNormalMatrix:function(matrix4){return this.setFromMatrix4(matrix4).getInverse(this).transpose()},transposeIntoArray:function(r){var m=this.elements;return r[0]=m[0],r[1]=m[3],r[2]=m[6],r[3]=m[1],r[4]=m[4],r[5]=m[7],r[6]=m[2],r[7]=m[5],r[8]=m[8],this},setUvTransform:function(tx,ty,sx,sy,rotation,cx,cy){var c=Math.cos(rotation),s=Math.sin(rotation);this.set(sx*c,sx*s,-sx*(c*cx+s*cy)+cx+tx,-sy*s,sy*c,-sy*(-s*cx+c*cy)+cy+ty,0,0,1)},scale:function(sx,sy){var te=this.elements;return te[0]*=sx,te[3]*=sx,te[6]*=sx,te[1]*=sy,te[4]*=sy,te[7]*=sy,this},rotate:function(theta){var c=Math.cos(theta),s=Math.sin(theta),te=this.elements,a11=te[0],a12=te[3],a13=te[6],a21=te[1],a22=te[4],a23=te[7];return te[0]=c*a11+s*a21,te[3]=c*a12+s*a22,te[6]=c*a13+s*a23,te[1]=-s*a11+c*a21,te[4]=-s*a12+c*a22,te[7]=-s*a13+c*a23,this},translate:function(tx,ty){var te=this.elements;return te[0]+=tx*te[2],te[3]+=tx*te[5],te[6]+=tx*te[8],te[1]+=ty*te[2],te[4]+=ty*te[5],te[7]+=ty*te[8],this},equals:function(matrix){for(var te=this.elements,me=matrix.elements,i=0;i<9;i++)if(te[i]!==me[i])return!1;return!0},fromArray:function(array,offset){void 0===offset&&(offset=0);for(var i=0;i<9;i++)this.elements[i]=array[i+offset];return this},toArray:function(array,offset){void 0===array&&(array=[]),void 0===offset&&(offset=0);var te=this.elements;return array[offset]=te[0],array[offset+1]=te[1],array[offset+2]=te[2],array[offset+3]=te[3],array[offset+4]=te[4],array[offset+5]=te[5],array[offset+6]=te[6],array[offset+7]=te[7],array[offset+8]=te[8],array}});var min,max,points,closestPoint,box,p,sphere,vector,matrix,x,y,z,zero,one,ImageUtils={getDataURL:function(image){var canvas;if("undefined"==typeof HTMLCanvasElement)return image.src;if(image instanceof HTMLCanvasElement)canvas=image;else{void 0===_canvas&&(_canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),_canvas.width=image.width,_canvas.height=image.height;var context=_canvas.getContext("2d");image instanceof ImageData?context.putImageData(image,0,0):context.drawImage(image,0,0,image.width,image.height),canvas=_canvas}return 2048<canvas.width||2048<canvas.height?canvas.toDataURL("image/jpeg",.6):canvas.toDataURL("image/png")}},textureId=0;function Texture(image,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding){Object.defineProperty(this,"id",{value:textureId++}),this.uuid=_Math.generateUUID(),this.name="",this.image=void 0!==image?image:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==mapping?mapping:Texture.DEFAULT_MAPPING,this.wrapS=void 0!==wrapS?wrapS:ClampToEdgeWrapping,this.wrapT=void 0!==wrapT?wrapT:ClampToEdgeWrapping,this.magFilter=void 0!==magFilter?magFilter:LinearFilter,this.minFilter=void 0!==minFilter?minFilter:LinearMipMapLinearFilter,this.anisotropy=void 0!==anisotropy?anisotropy:1,this.format=void 0!==format?format:RGBAFormat,this.type=void 0!==type?type:UnsignedByteType,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==encoding?encoding:LinearEncoding,this.version=0,this.onUpdate=null}function Vector4(x,y,z,w){this.x=x||0,this.y=y||0,this.z=z||0,this.w=void 0!==w?w:1}function WebGLRenderTarget(width,height,options){this.width=width,this.height=height,this.scissor=new Vector4(0,0,width,height),this.scissorTest=!1,this.viewport=new Vector4(0,0,width,height),options=options||{},this.texture=new Texture(void 0,void 0,options.wrapS,options.wrapT,options.magFilter,options.minFilter,options.format,options.type,options.anisotropy,options.encoding),this.texture.generateMipmaps=void 0!==options.generateMipmaps&&options.generateMipmaps,this.texture.minFilter=void 0!==options.minFilter?options.minFilter:LinearFilter,this.depthBuffer=void 0===options.depthBuffer||options.depthBuffer,this.stencilBuffer=void 0===options.stencilBuffer||options.stencilBuffer,this.depthTexture=void 0!==options.depthTexture?options.depthTexture:null}function WebGLMultisampleRenderTarget(width,height,options){WebGLRenderTarget.call(this,width,height,options),this.samples=4}function WebGLRenderTargetCube(width,height,options){WebGLRenderTarget.call(this,width,height,options)}function DataTexture(data,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,encoding){Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding),this.image={data:data,width:width,height:height},this.magFilter=void 0!==magFilter?magFilter:NearestFilter,this.minFilter=void 0!==minFilter?minFilter:NearestFilter,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function Box3(min,max){this.min=void 0!==min?min:new Vector3(1/0,1/0,1/0),this.max=void 0!==max?max:new Vector3(-1/0,-1/0,-1/0)}function Sphere(center,radius){this.center=void 0!==center?center:new Vector3,this.radius=void 0!==radius?radius:0}function Plane(normal,constant){this.normal=void 0!==normal?normal:new Vector3(1,0,0),this.constant=void 0!==constant?constant:0}function Frustum(p0,p1,p2,p3,p4,p5){this.planes=[void 0!==p0?p0:new Plane,void 0!==p1?p1:new Plane,void 0!==p2?p2:new Plane,void 0!==p3?p3:new Plane,void 0!==p4?p4:new Plane,void 0!==p5?p5:new Plane]}function Matrix4(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=300,Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(source){return this.name=source.name,this.image=source.image,this.mipmaps=source.mipmaps.slice(0),this.mapping=source.mapping,this.wrapS=source.wrapS,this.wrapT=source.wrapT,this.magFilter=source.magFilter,this.minFilter=source.minFilter,this.anisotropy=source.anisotropy,this.format=source.format,this.type=source.type,this.offset.copy(source.offset),this.repeat.copy(source.repeat),this.center.copy(source.center),this.rotation=source.rotation,this.matrixAutoUpdate=source.matrixAutoUpdate,this.matrix.copy(source.matrix),this.generateMipmaps=source.generateMipmaps,this.premultiplyAlpha=source.premultiplyAlpha,this.flipY=source.flipY,this.unpackAlignment=source.unpackAlignment,this.encoding=source.encoding,this},toJSON:function(meta){var isRootObject=void 0===meta||"string"==typeof meta;if(!isRootObject&&void 0!==meta.textures[this.uuid])return meta.textures[this.uuid];var output={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var image=this.image;if(void 0===image.uuid&&(image.uuid=_Math.generateUUID()),!isRootObject&&void 0===meta.images[image.uuid]){var url;if(Array.isArray(image)){url=[];for(var i=0,l=image.length;i<l;i++)url.push(ImageUtils.getDataURL(image[i]))}else url=ImageUtils.getDataURL(image);meta.images[image.uuid]={uuid:image.uuid,url:url}}output.image=image.uuid}return isRootObject||(meta.textures[this.uuid]=output),output},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(uv){if(300!==this.mapping)return uv;if(uv.applyMatrix3(this.matrix),uv.x<0||1<uv.x)switch(this.wrapS){case RepeatWrapping:uv.x=uv.x-Math.floor(uv.x);break;case ClampToEdgeWrapping:uv.x=uv.x<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(uv.x)%2)?uv.x=Math.ceil(uv.x)-uv.x:uv.x=uv.x-Math.floor(uv.x)}if(uv.y<0||1<uv.y)switch(this.wrapT){case RepeatWrapping:uv.y=uv.y-Math.floor(uv.y);break;case ClampToEdgeWrapping:uv.y=uv.y<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(uv.y)%2)?uv.y=Math.ceil(uv.y)-uv.y:uv.y=uv.y-Math.floor(uv.y)}return this.flipY&&(uv.y=1-uv.y),uv}}),Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(value){!0===value&&this.version++}}),Object.assign(Vector4.prototype,{isVector4:!0,set:function(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this},setScalar:function(scalar){return this.x=scalar,this.y=scalar,this.z=scalar,this.w=scalar,this},setX:function(x){return this.x=x,this},setY:function(y){return this.y=y,this},setZ:function(z){return this.z=z,this},setW:function(w){return this.w=w,this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;case 3:this.w=value;break;default:throw new Error("index is out of range: "+index)}return this},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+index)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=void 0!==v.w?v.w:1,this},add:function(v,w){return void 0!==w?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(v,w)):(this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this)},addScalar:function(s){return this.x+=s,this.y+=s,this.z+=s,this.w+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},addScaledVector:function(v,s){return this.x+=v.x*s,this.y+=v.y*s,this.z+=v.z*s,this.w+=v.w*s,this},sub:function(v,w){return void 0!==w?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(v,w)):(this.x-=v.x,this.y-=v.y,this.z-=v.z,this.w-=v.w,this)},subScalar:function(s){return this.x-=s,this.y-=s,this.z-=s,this.w-=s,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},multiplyScalar:function(scalar){return this.x*=scalar,this.y*=scalar,this.z*=scalar,this.w*=scalar,this},applyMatrix4:function(m){var x=this.x,y=this.y,z=this.z,w=this.w,e=m.elements;return this.x=e[0]*x+e[4]*y+e[8]*z+e[12]*w,this.y=e[1]*x+e[5]*y+e[9]*z+e[13]*w,this.z=e[2]*x+e[6]*y+e[10]*z+e[14]*w,this.w=e[3]*x+e[7]*y+e[11]*z+e[15]*w,this},divideScalar:function(scalar){return this.multiplyScalar(1/scalar)},setAxisAngleFromQuaternion:function(q){this.w=2*Math.acos(q.w);var s=Math.sqrt(1-q.w*q.w);return s<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=q.x/s,this.y=q.y/s,this.z=q.z/s),this},setAxisAngleFromRotationMatrix:function(m){var angle,x,y,z,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];if(Math.abs(m12-m21)<.01&&Math.abs(m13-m31)<.01&&Math.abs(m23-m32)<.01){if(Math.abs(m12+m21)<.1&&Math.abs(m13+m31)<.1&&Math.abs(m23+m32)<.1&&Math.abs(m11+m22+m33-3)<.1)return this.set(1,0,0,0),this;angle=Math.PI;var xx=(m11+1)/2,yy=(m22+1)/2,zz=(m33+1)/2,xy=(m12+m21)/4,xz=(m13+m31)/4,yz=(m23+m32)/4;return yy<xx&&zz<xx?z=xx<.01?(x=0,y=.707106781):(y=xy/(x=Math.sqrt(xx)),xz/x):zz<yy?z=yy<.01?(y=0,x=.707106781):(x=xy/(y=Math.sqrt(yy)),yz/y):zz<.01?(y=x=.707106781,z=0):(x=xz/(z=Math.sqrt(zz)),y=yz/z),this.set(x,y,z,angle),this}var s=Math.sqrt((m32-m23)*(m32-m23)+(m13-m31)*(m13-m31)+(m21-m12)*(m21-m12));return Math.abs(s)<.001&&(s=1),this.x=(m32-m23)/s,this.y=(m13-m31)/s,this.z=(m21-m12)/s,this.w=Math.acos((m11+m22+m33-1)/2),this},min:function(v){return this.x=Math.min(this.x,v.x),this.y=Math.min(this.y,v.y),this.z=Math.min(this.z,v.z),this.w=Math.min(this.w,v.w),this},max:function(v){return this.x=Math.max(this.x,v.x),this.y=Math.max(this.y,v.y),this.z=Math.max(this.z,v.z),this.w=Math.max(this.w,v.w),this},clamp:function(min,max){return this.x=Math.max(min.x,Math.min(max.x,this.x)),this.y=Math.max(min.y,Math.min(max.y,this.y)),this.z=Math.max(min.z,Math.min(max.z,this.z)),this.w=Math.max(min.w,Math.min(max.w,this.w)),this},clampScalar:function(minVal,maxVal){return void 0===min&&(min=new Vector4,max=new Vector4),min.set(minVal,minVal,minVal,minVal),max.set(maxVal,maxVal,maxVal,maxVal),this.clamp(min,max)},clampLength:function(min,max){var length=this.length();return this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(length){return this.normalize().multiplyScalar(length)},lerp:function(v,alpha){return this.x+=(v.x-this.x)*alpha,this.y+=(v.y-this.y)*alpha,this.z+=(v.z-this.z)*alpha,this.w+=(v.w-this.w)*alpha,this},lerpVectors:function(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z&&v.w===this.w},fromArray:function(array,offset){return void 0===offset&&(offset=0),this.x=array[offset],this.y=array[offset+1],this.z=array[offset+2],this.w=array[offset+3],this},toArray:function(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.x,array[offset+1]=this.y,array[offset+2]=this.z,array[offset+3]=this.w,array},fromBufferAttribute:function(attribute,index,offset){return void 0!==offset&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=attribute.getX(index),this.y=attribute.getY(index),this.z=attribute.getZ(index),this.w=attribute.getW(index),this}}),WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(width,height){this.width===width&&this.height===height||(this.width=width,this.height=height,this.dispose()),this.viewport.set(0,0,width,height),this.scissor.set(0,0,width,height)},clone:function(){return(new this.constructor).copy(this)},copy:function(source){return this.width=source.width,this.height=source.height,this.viewport.copy(source.viewport),this.texture=source.texture.clone(),this.depthBuffer=source.depthBuffer,this.stencilBuffer=source.stencilBuffer,this.depthTexture=source.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),WebGLMultisampleRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultisampleRenderTarget,isWebGLMultisampleRenderTarget:!0,copy:function(source){return WebGLRenderTarget.prototype.copy.call(this,source),this.samples=source.samples,this}}),((WebGLRenderTargetCube.prototype=Object.create(WebGLRenderTarget.prototype)).constructor=WebGLRenderTargetCube).prototype.isWebGLRenderTargetCube=!0,((DataTexture.prototype=Object.create(Texture.prototype)).constructor=DataTexture).prototype.isDataTexture=!0,Object.assign(Box3.prototype,{isBox3:!0,set:function(min,max){return this.min.copy(min),this.max.copy(max),this},setFromArray:function(array){for(var minX=1/0,minY=1/0,minZ=1/0,maxX=-1/0,maxY=-1/0,maxZ=-1/0,i=0,l=array.length;i<l;i+=3){var x=array[i],y=array[i+1],z=array[i+2];x<minX&&(minX=x),y<minY&&(minY=y),z<minZ&&(minZ=z),maxX<x&&(maxX=x),maxY<y&&(maxY=y),maxZ<z&&(maxZ=z)}return this.min.set(minX,minY,minZ),this.max.set(maxX,maxY,maxZ),this},setFromBufferAttribute:function(attribute){for(var minX=1/0,minY=1/0,minZ=1/0,maxX=-1/0,maxY=-1/0,maxZ=-1/0,i=0,l=attribute.count;i<l;i++){var x=attribute.getX(i),y=attribute.getY(i),z=attribute.getZ(i);x<minX&&(minX=x),y<minY&&(minY=y),z<minZ&&(minZ=z),maxX<x&&(maxX=x),maxY<y&&(maxY=y),maxZ<z&&(maxZ=z)}return this.min.set(minX,minY,minZ),this.max.set(maxX,maxY,maxZ),this},setFromPoints:function(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++)this.expandByPoint(points[i]);return this},setFromCenterAndSize:function(){var v1=new Vector3;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);return this.min.copy(center).sub(halfSize),this.max.copy(center).add(halfSize),this}}(),setFromObject:function(object){return this.makeEmpty(),this.expandByObject(object)},clone:function(){return(new this.constructor).copy(this)},copy:function(box){return this.min.copy(box.min),this.max.copy(box.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(target){return void 0===target&&(console.warn("THREE.Box3: .getCenter() target is now required"),target=new Vector3),this.isEmpty()?target.set(0,0,0):target.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(target){return void 0===target&&(console.warn("THREE.Box3: .getSize() target is now required"),target=new Vector3),this.isEmpty()?target.set(0,0,0):target.subVectors(this.max,this.min)},expandByPoint:function(point){return this.min.min(point),this.max.max(point),this},expandByVector:function(vector){return this.min.sub(vector),this.max.add(vector),this},expandByScalar:function(scalar){return this.min.addScalar(-scalar),this.max.addScalar(scalar),this},expandByObject:function(){var scope,i,l,v1=new Vector3;function traverse(node){var geometry=node.geometry;if(void 0!==geometry)if(geometry.isGeometry){var vertices=geometry.vertices;for(i=0,l=vertices.length;i<l;i++)v1.copy(vertices[i]),v1.applyMatrix4(node.matrixWorld),scope.expandByPoint(v1)}else if(geometry.isBufferGeometry){var attribute=geometry.attributes.position;if(void 0!==attribute)for(i=0,l=attribute.count;i<l;i++)v1.fromBufferAttribute(attribute,i).applyMatrix4(node.matrixWorld),scope.expandByPoint(v1)}}return function(object){return scope=this,object.updateMatrixWorld(!0),object.traverse(traverse),this}}(),containsPoint:function(point){return!(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y||point.z<this.min.z||point.z>this.max.z)},containsBox:function(box){return this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y&&this.min.z<=box.min.z&&box.max.z<=this.max.z},getParameter:function(point,target){return void 0===target&&(console.warn("THREE.Box3: .getParameter() target is now required"),target=new Vector3),target.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y),(point.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(box){return!(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y||box.max.z<this.min.z||box.min.z>this.max.z)},intersectsSphere:(closestPoint=new Vector3,function(sphere){return this.clampPoint(sphere.center,closestPoint),closestPoint.distanceToSquared(sphere.center)<=sphere.radius*sphere.radius}),intersectsPlane:function(plane){var min,max;return max=0<plane.normal.x?(min=plane.normal.x*this.min.x,plane.normal.x*this.max.x):(min=plane.normal.x*this.max.x,plane.normal.x*this.min.x),0<plane.normal.y?(min+=plane.normal.y*this.min.y,max+=plane.normal.y*this.max.y):(min+=plane.normal.y*this.max.y,max+=plane.normal.y*this.min.y),0<plane.normal.z?(min+=plane.normal.z*this.min.z,max+=plane.normal.z*this.max.z):(min+=plane.normal.z*this.max.z,max+=plane.normal.z*this.min.z),min<=-plane.constant&&max>=-plane.constant},intersectsTriangle:function(){var v0=new Vector3,v1=new Vector3,v2=new Vector3,f0=new Vector3,f1=new Vector3,f2=new Vector3,testAxis=new Vector3,center=new Vector3,extents=new Vector3,triangleNormal=new Vector3;function satForAxes(axes){var i,j;for(i=0,j=axes.length-3;i<=j;i+=3){testAxis.fromArray(axes,i);var r=extents.x*Math.abs(testAxis.x)+extents.y*Math.abs(testAxis.y)+extents.z*Math.abs(testAxis.z),p0=v0.dot(testAxis),p1=v1.dot(testAxis),p2=v2.dot(testAxis);if(Math.max(-Math.max(p0,p1,p2),Math.min(p0,p1,p2))>r)return!1}return!0}return function(triangle){if(this.isEmpty())return!1;this.getCenter(center),extents.subVectors(this.max,center),v0.subVectors(triangle.a,center),v1.subVectors(triangle.b,center),v2.subVectors(triangle.c,center),f0.subVectors(v1,v0),f1.subVectors(v2,v1),f2.subVectors(v0,v2);var axes=[0,-f0.z,f0.y,0,-f1.z,f1.y,0,-f2.z,f2.y,f0.z,0,-f0.x,f1.z,0,-f1.x,f2.z,0,-f2.x,-f0.y,f0.x,0,-f1.y,f1.x,0,-f2.y,f2.x,0];return!!satForAxes(axes)&&(!!satForAxes(axes=[1,0,0,0,1,0,0,0,1])&&(triangleNormal.crossVectors(f0,f1),satForAxes(axes=[triangleNormal.x,triangleNormal.y,triangleNormal.z])))}}(),clampPoint:function(point,target){return void 0===target&&(console.warn("THREE.Box3: .clampPoint() target is now required"),target=new Vector3),target.copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new Vector3;return function(point){return v1.copy(point).clamp(this.min,this.max).sub(point).length()}}(),getBoundingSphere:function(){var v1=new Vector3;return function(target){return void 0===target&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(target.center),target.radius=.5*this.getSize(v1).length(),target}}(),intersect:function(box){return this.min.max(box.min),this.max.min(box.max),this.isEmpty()&&this.makeEmpty(),this},union:function(box){return this.min.min(box.min),this.max.max(box.max),this},applyMatrix4:(points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],function(matrix){return this.isEmpty()||(points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(matrix),points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(matrix),points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(matrix),points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(matrix),points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(matrix),points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(matrix),points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(matrix),points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(matrix),this.setFromPoints(points)),this}),translate:function(offset){return this.min.add(offset),this.max.add(offset),this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)}}),Object.assign(Sphere.prototype,{set:function(center,radius){return this.center.copy(center),this.radius=radius,this},setFromPoints:(box=new Box3,function(points,optionalCenter){var center=this.center;void 0!==optionalCenter?center.copy(optionalCenter):box.setFromPoints(points).getCenter(center);for(var maxRadiusSq=0,i=0,il=points.length;i<il;i++)maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(points[i]));return this.radius=Math.sqrt(maxRadiusSq),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(sphere){return this.center.copy(sphere.center),this.radius=sphere.radius,this},empty:function(){return this.radius<=0},containsPoint:function(point){return point.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(point){return point.distanceTo(this.center)-this.radius},intersectsSphere:function(sphere){var radiusSum=this.radius+sphere.radius;return sphere.center.distanceToSquared(this.center)<=radiusSum*radiusSum},intersectsBox:function(box){return box.intersectsSphere(this)},intersectsPlane:function(plane){return Math.abs(plane.distanceToPoint(this.center))<=this.radius},clampPoint:function(point,target){var deltaLengthSq=this.center.distanceToSquared(point);return void 0===target&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),target=new Vector3),target.copy(point),deltaLengthSq>this.radius*this.radius&&(target.sub(this.center).normalize(),target.multiplyScalar(this.radius).add(this.center)),target},getBoundingBox:function(target){return void 0===target&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),target=new Box3),target.set(this.center,this.center),target.expandByScalar(this.radius),target},applyMatrix4:function(matrix){return this.center.applyMatrix4(matrix),this.radius=this.radius*matrix.getMaxScaleOnAxis(),this},translate:function(offset){return this.center.add(offset),this},equals:function(sphere){return sphere.center.equals(this.center)&&sphere.radius===this.radius}}),Object.assign(Plane.prototype,{set:function(normal,constant){return this.normal.copy(normal),this.constant=constant,this},setComponents:function(x,y,z,w){return this.normal.set(x,y,z),this.constant=w,this},setFromNormalAndCoplanarPoint:function(normal,point){return this.normal.copy(normal),this.constant=-point.dot(this.normal),this},setFromCoplanarPoints:function(){var v1=new Vector3,v2=new Vector3;return function(a,b,c){var normal=v1.subVectors(c,b).cross(v2.subVectors(a,b)).normalize();return this.setFromNormalAndCoplanarPoint(normal,a),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(plane){return this.normal.copy(plane.normal),this.constant=plane.constant,this},normalize:function(){var inverseNormalLength=1/this.normal.length();return this.normal.multiplyScalar(inverseNormalLength),this.constant*=inverseNormalLength,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(point){return this.normal.dot(point)+this.constant},distanceToSphere:function(sphere){return this.distanceToPoint(sphere.center)-sphere.radius},projectPoint:function(point,target){return void 0===target&&(console.warn("THREE.Plane: .projectPoint() target is now required"),target=new Vector3),target.copy(this.normal).multiplyScalar(-this.distanceToPoint(point)).add(point)},intersectLine:function(){var v1=new Vector3;return function(line,target){void 0===target&&(console.warn("THREE.Plane: .intersectLine() target is now required"),target=new Vector3);var direction=line.delta(v1),denominator=this.normal.dot(direction);if(0===denominator)return 0===this.distanceToPoint(line.start)?target.copy(line.start):void 0;var t=-(line.start.dot(this.normal)+this.constant)/denominator;return t<0||1<t?void 0:target.copy(direction).multiplyScalar(t).add(line.start)}}(),intersectsLine:function(line){var startSign=this.distanceToPoint(line.start),endSign=this.distanceToPoint(line.end);return startSign<0&&0<endSign||endSign<0&&0<startSign},intersectsBox:function(box){return box.intersectsPlane(this)},intersectsSphere:function(sphere){return sphere.intersectsPlane(this)},coplanarPoint:function(target){return void 0===target&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),target=new Vector3),target.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var v1=new Vector3,m1=new Matrix3;return function(matrix,optionalNormalMatrix){var normalMatrix=optionalNormalMatrix||m1.getNormalMatrix(matrix),referencePoint=this.coplanarPoint(v1).applyMatrix4(matrix),normal=this.normal.applyMatrix3(normalMatrix).normalize();return this.constant=-referencePoint.dot(normal),this}}(),translate:function(offset){return this.constant-=offset.dot(this.normal),this},equals:function(plane){return plane.normal.equals(this.normal)&&plane.constant===this.constant}}),Object.assign(Frustum.prototype,{set:function(p0,p1,p2,p3,p4,p5){var planes=this.planes;return planes[0].copy(p0),planes[1].copy(p1),planes[2].copy(p2),planes[3].copy(p3),planes[4].copy(p4),planes[5].copy(p5),this},clone:function(){return(new this.constructor).copy(this)},copy:function(frustum){for(var planes=this.planes,i=0;i<6;i++)planes[i].copy(frustum.planes[i]);return this},setFromMatrix:function(m){var planes=this.planes,me=m.elements,me0=me[0],me1=me[1],me2=me[2],me3=me[3],me4=me[4],me5=me[5],me6=me[6],me7=me[7],me8=me[8],me9=me[9],me10=me[10],me11=me[11],me12=me[12],me13=me[13],me14=me[14],me15=me[15];return planes[0].setComponents(me3-me0,me7-me4,me11-me8,me15-me12).normalize(),planes[1].setComponents(me3+me0,me7+me4,me11+me8,me15+me12).normalize(),planes[2].setComponents(me3+me1,me7+me5,me11+me9,me15+me13).normalize(),planes[3].setComponents(me3-me1,me7-me5,me11-me9,me15-me13).normalize(),planes[4].setComponents(me3-me2,me7-me6,me11-me10,me15-me14).normalize(),planes[5].setComponents(me3+me2,me7+me6,me11+me10,me15+me14).normalize(),this},intersectsObject:(sphere=new Sphere,function(object){var geometry=object.geometry;return null===geometry.boundingSphere&&geometry.computeBoundingSphere(),sphere.copy(geometry.boundingSphere).applyMatrix4(object.matrixWorld),this.intersectsSphere(sphere)}),intersectsSprite:function(){var sphere=new Sphere;return function(sprite){return sphere.center.set(0,0,0),sphere.radius=.7071067811865476,sphere.applyMatrix4(sprite.matrixWorld),this.intersectsSphere(sphere)}}(),intersectsSphere:function(sphere){for(var planes=this.planes,center=sphere.center,negRadius=-sphere.radius,i=0;i<6;i++){if(planes[i].distanceToPoint(center)<negRadius)return!1}return!0},intersectsBox:(p=new Vector3,function(box){for(var planes=this.planes,i=0;i<6;i++){var plane=planes[i];if(p.x=0<plane.normal.x?box.max.x:box.min.x,p.y=0<plane.normal.y?box.max.y:box.min.y,p.z=0<plane.normal.z?box.max.z:box.min.z,plane.distanceToPoint(p)<0)return!1}return!0}),containsPoint:function(point){for(var planes=this.planes,i=0;i<6;i++)if(planes[i].distanceToPoint(point)<0)return!1;return!0}}),Object.assign(Matrix4.prototype,{isMatrix4:!0,set:function(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){var te=this.elements;return te[0]=n11,te[4]=n12,te[8]=n13,te[12]=n14,te[1]=n21,te[5]=n22,te[9]=n23,te[13]=n24,te[2]=n31,te[6]=n32,te[10]=n33,te[14]=n34,te[3]=n41,te[7]=n42,te[11]=n43,te[15]=n44,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Matrix4).fromArray(this.elements)},copy:function(m){var te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],te[9]=me[9],te[10]=me[10],te[11]=me[11],te[12]=me[12],te[13]=me[13],te[14]=me[14],te[15]=me[15],this},copyPosition:function(m){var te=this.elements,me=m.elements;return te[12]=me[12],te[13]=me[13],te[14]=me[14],this},extractBasis:function(xAxis,yAxis,zAxis){return xAxis.setFromMatrixColumn(this,0),yAxis.setFromMatrixColumn(this,1),zAxis.setFromMatrixColumn(this,2),this},makeBasis:function(xAxis,yAxis,zAxis){return this.set(xAxis.x,yAxis.x,zAxis.x,0,xAxis.y,yAxis.y,zAxis.y,0,xAxis.z,yAxis.z,zAxis.z,0,0,0,0,1),this},extractRotation:function(){var v1=new Vector3;return function(m){var te=this.elements,me=m.elements,scaleX=1/v1.setFromMatrixColumn(m,0).length(),scaleY=1/v1.setFromMatrixColumn(m,1).length(),scaleZ=1/v1.setFromMatrixColumn(m,2).length();return te[0]=me[0]*scaleX,te[1]=me[1]*scaleX,te[2]=me[2]*scaleX,te[3]=0,te[4]=me[4]*scaleY,te[5]=me[5]*scaleY,te[6]=me[6]*scaleY,te[7]=0,te[8]=me[8]*scaleZ,te[9]=me[9]*scaleZ,te[10]=me[10]*scaleZ,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this}}(),makeRotationFromEuler:function(euler){euler&&euler.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var te=this.elements,x=euler.x,y=euler.y,z=euler.z,a=Math.cos(x),b=Math.sin(x),c=Math.cos(y),d=Math.sin(y),e=Math.cos(z),f=Math.sin(z);if("XYZ"===euler.order){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e,te[4]=-c*f,te[8]=d,te[1]=af+be*d,te[5]=ae-bf*d,te[9]=-b*c,te[2]=bf-ae*d,te[6]=be+af*d,te[10]=a*c}else if("YXZ"===euler.order){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b,te[4]=de*b-cf,te[8]=a*d,te[1]=a*f,te[5]=a*e,te[9]=-b,te[2]=cf*b-de,te[6]=df+ce*b,te[10]=a*c}else if("ZXY"===euler.order){ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce-df*b,te[4]=-a*f,te[8]=de+cf*b,te[1]=cf+de*b,te[5]=a*e,te[9]=df-ce*b,te[2]=-a*d,te[6]=b,te[10]=a*c}else if("ZYX"===euler.order){ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e,te[4]=be*d-af,te[8]=ae*d+bf,te[1]=c*f,te[5]=bf*d+ae,te[9]=af*d-be,te[2]=-d,te[6]=b*c,te[10]=a*c}else if("YZX"===euler.order){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e,te[4]=bd-ac*f,te[8]=bc*f+ad,te[1]=f,te[5]=a*e,te[9]=-b*e,te[2]=-d*e,te[6]=ad*f+bc,te[10]=ac-bd*f}else if("XZY"===euler.order){ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e,te[4]=-f,te[8]=d*e,te[1]=ac*f+bd,te[5]=a*e,te[9]=ad*f-bc,te[2]=bc*f-ad,te[6]=b*e,te[10]=bd*f+ac}return te[3]=0,te[7]=0,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this},makeRotationFromQuaternion:(zero=new Vector3(0,0,0),one=new Vector3(1,1,1),function(q){return this.compose(zero,q,one)}),lookAt:(x=new Vector3,y=new Vector3,z=new Vector3,function(eye,target,up){var te=this.elements;return z.subVectors(eye,target),0===z.lengthSq()&&(z.z=1),z.normalize(),x.crossVectors(up,z),0===x.lengthSq()&&(1===Math.abs(up.z)?z.x+=1e-4:z.z+=1e-4,z.normalize(),x.crossVectors(up,z)),x.normalize(),y.crossVectors(z,x),te[0]=x.x,te[4]=y.x,te[8]=z.x,te[1]=x.y,te[5]=y.y,te[9]=z.y,te[2]=x.z,te[6]=y.z,te[10]=z.z,this}),multiply:function(m,n){return void 0!==n?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(m,n)):this.multiplyMatrices(this,m)},premultiply:function(m){return this.multiplyMatrices(m,this)},multiplyMatrices:function(a,b){var ae=a.elements,be=b.elements,te=this.elements,a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12],a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13],a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14],a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15],b11=be[0],b12=be[4],b13=be[8],b14=be[12],b21=be[1],b22=be[5],b23=be[9],b24=be[13],b31=be[2],b32=be[6],b33=be[10],b34=be[14],b41=be[3],b42=be[7],b43=be[11],b44=be[15];return te[0]=a11*b11+a12*b21+a13*b31+a14*b41,te[4]=a11*b12+a12*b22+a13*b32+a14*b42,te[8]=a11*b13+a12*b23+a13*b33+a14*b43,te[12]=a11*b14+a12*b24+a13*b34+a14*b44,te[1]=a21*b11+a22*b21+a23*b31+a24*b41,te[5]=a21*b12+a22*b22+a23*b32+a24*b42,te[9]=a21*b13+a22*b23+a23*b33+a24*b43,te[13]=a21*b14+a22*b24+a23*b34+a24*b44,te[2]=a31*b11+a32*b21+a33*b31+a34*b41,te[6]=a31*b12+a32*b22+a33*b32+a34*b42,te[10]=a31*b13+a32*b23+a33*b33+a34*b43,te[14]=a31*b14+a32*b24+a33*b34+a34*b44,te[3]=a41*b11+a42*b21+a43*b31+a44*b41,te[7]=a41*b12+a42*b22+a43*b32+a44*b42,te[11]=a41*b13+a42*b23+a43*b33+a44*b43,te[15]=a41*b14+a42*b24+a43*b34+a44*b44,this},multiplyScalar:function(s){var te=this.elements;return te[0]*=s,te[4]*=s,te[8]*=s,te[12]*=s,te[1]*=s,te[5]*=s,te[9]*=s,te[13]*=s,te[2]*=s,te[6]*=s,te[10]*=s,te[14]*=s,te[3]*=s,te[7]*=s,te[11]*=s,te[15]*=s,this},applyToBufferAttribute:function(){var v1=new Vector3;return function(attribute){for(var i=0,l=attribute.count;i<l;i++)v1.x=attribute.getX(i),v1.y=attribute.getY(i),v1.z=attribute.getZ(i),v1.applyMatrix4(this),attribute.setXYZ(i,v1.x,v1.y,v1.z);return attribute}}(),determinant:function(){var te=this.elements,n11=te[0],n12=te[4],n13=te[8],n14=te[12],n21=te[1],n22=te[5],n23=te[9],n24=te[13],n31=te[2],n32=te[6],n33=te[10],n34=te[14];return te[3]*(+n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34)+te[7]*(+n11*n23*n34-n11*n24*n33+n14*n21*n33-n13*n21*n34+n13*n24*n31-n14*n23*n31)+te[11]*(+n11*n24*n32-n11*n22*n34-n14*n21*n32+n12*n21*n34+n14*n22*n31-n12*n24*n31)+te[15]*(-n13*n22*n31-n11*n23*n32+n11*n22*n33+n13*n21*n32-n12*n21*n33+n12*n23*n31)},transpose:function(){var tmp,te=this.elements;return tmp=te[1],te[1]=te[4],te[4]=tmp,tmp=te[2],te[2]=te[8],te[8]=tmp,tmp=te[6],te[6]=te[9],te[9]=tmp,tmp=te[3],te[3]=te[12],te[12]=tmp,tmp=te[7],te[7]=te[13],te[13]=tmp,tmp=te[11],te[11]=te[14],te[14]=tmp,this},setPosition:function(v){var te=this.elements;return te[12]=v.x,te[13]=v.y,te[14]=v.z,this},getInverse:function(m,throwOnDegenerate){var te=this.elements,me=m.elements,n11=me[0],n21=me[1],n31=me[2],n41=me[3],n12=me[4],n22=me[5],n32=me[6],n42=me[7],n13=me[8],n23=me[9],n33=me[10],n43=me[11],n14=me[12],n24=me[13],n34=me[14],n44=me[15],t11=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44,t12=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44,t13=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44,t14=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34,det=n11*t11+n21*t12+n31*t13+n41*t14;if(0==det){var msg="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===throwOnDegenerate)throw new Error(msg);return console.warn(msg),this.identity()}var detInv=1/det;return te[0]=t11*detInv,te[1]=(n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44)*detInv,te[2]=(n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44)*detInv,te[3]=(n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43)*detInv,te[4]=t12*detInv,te[5]=(n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44)*detInv,te[6]=(n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44)*detInv,te[7]=(n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43)*detInv,te[8]=t13*detInv,te[9]=(n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44)*detInv,te[10]=(n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44)*detInv,te[11]=(n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43)*detInv,te[12]=t14*detInv,te[13]=(n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34)*detInv,te[14]=(n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34)*detInv,te[15]=(n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33)*detInv,this},scale:function(v){var te=this.elements,x=v.x,y=v.y,z=v.z;return te[0]*=x,te[4]*=y,te[8]*=z,te[1]*=x,te[5]*=y,te[9]*=z,te[2]*=x,te[6]*=y,te[10]*=z,te[3]*=x,te[7]*=y,te[11]*=z,this},getMaxScaleOnAxis:function(){var te=this.elements,scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2],scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6],scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];return Math.sqrt(Math.max(scaleXSq,scaleYSq,scaleZSq))},makeTranslation:function(x,y,z){return this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1),this},makeRotationX:function(theta){var c=Math.cos(theta),s=Math.sin(theta);return this.set(1,0,0,0,0,c,-s,0,0,s,c,0,0,0,0,1),this},makeRotationY:function(theta){var c=Math.cos(theta),s=Math.sin(theta);return this.set(c,0,s,0,0,1,0,0,-s,0,c,0,0,0,0,1),this},makeRotationZ:function(theta){var c=Math.cos(theta),s=Math.sin(theta);return this.set(c,-s,0,0,s,c,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(axis,angle){var c=Math.cos(angle),s=Math.sin(angle),t=1-c,x=axis.x,y=axis.y,z=axis.z,tx=t*x,ty=t*y;return this.set(tx*x+c,tx*y-s*z,tx*z+s*y,0,tx*y+s*z,ty*y+c,ty*z-s*x,0,tx*z-s*y,ty*z+s*x,t*z*z+c,0,0,0,0,1),this},makeScale:function(x,y,z){return this.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1),this},makeShear:function(x,y,z){return this.set(1,y,z,0,x,1,z,0,x,y,1,0,0,0,0,1),this},compose:function(position,quaternion,scale){var te=this.elements,x=quaternion._x,y=quaternion._y,z=quaternion._z,w=quaternion._w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=scale.x,sy=scale.y,sz=scale.z;return te[0]=(1-(yy+zz))*sx,te[1]=(xy+wz)*sx,te[2]=(xz-wy)*sx,te[3]=0,te[4]=(xy-wz)*sy,te[5]=(1-(xx+zz))*sy,te[6]=(yz+wx)*sy,te[7]=0,te[8]=(xz+wy)*sz,te[9]=(yz-wx)*sz,te[10]=(1-(xx+yy))*sz,te[11]=0,te[12]=position.x,te[13]=position.y,te[14]=position.z,te[15]=1,this},decompose:(vector=new Vector3,matrix=new Matrix4,function(position,quaternion,scale){var te=this.elements,sx=vector.set(te[0],te[1],te[2]).length(),sy=vector.set(te[4],te[5],te[6]).length(),sz=vector.set(te[8],te[9],te[10]).length();this.determinant()<0&&(sx=-sx),position.x=te[12],position.y=te[13],position.z=te[14],matrix.copy(this);var invSX=1/sx,invSY=1/sy,invSZ=1/sz;return matrix.elements[0]*=invSX,matrix.elements[1]*=invSX,matrix.elements[2]*=invSX,matrix.elements[4]*=invSY,matrix.elements[5]*=invSY,matrix.elements[6]*=invSY,matrix.elements[8]*=invSZ,matrix.elements[9]*=invSZ,matrix.elements[10]*=invSZ,quaternion.setFromRotationMatrix(matrix),scale.x=sx,scale.y=sy,scale.z=sz,this}),makePerspective:function(left,right,top,bottom,near,far){void 0===far&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var te=this.elements,x=2*near/(right-left),y=2*near/(top-bottom),a=(right+left)/(right-left),b=(top+bottom)/(top-bottom),c=-(far+near)/(far-near),d=-2*far*near/(far-near);return te[0]=x,te[4]=0,te[8]=a,te[12]=0,te[1]=0,te[5]=y,te[9]=b,te[13]=0,te[2]=0,te[6]=0,te[10]=c,te[14]=d,te[3]=0,te[7]=0,te[11]=-1,te[15]=0,this},makeOrthographic:function(left,right,top,bottom,near,far){var te=this.elements,w=1/(right-left),h=1/(top-bottom),p=1/(far-near),x=(right+left)*w,y=(top+bottom)*h,z=(far+near)*p;return te[0]=2*w,te[4]=0,te[8]=0,te[12]=-x,te[1]=0,te[5]=2*h,te[9]=0,te[13]=-y,te[2]=0,te[6]=0,te[10]=-2*p,te[14]=-z,te[3]=0,te[7]=0,te[11]=0,te[15]=1,this},equals:function(matrix){for(var te=this.elements,me=matrix.elements,i=0;i<16;i++)if(te[i]!==me[i])return!1;return!0},fromArray:function(array,offset){void 0===offset&&(offset=0);for(var i=0;i<16;i++)this.elements[i]=array[i+offset];return this},toArray:function(array,offset){void 0===array&&(array=[]),void 0===offset&&(offset=0);var te=this.elements;return array[offset]=te[0],array[offset+1]=te[1],array[offset+2]=te[2],array[offset+3]=te[3],array[offset+4]=te[4],array[offset+5]=te[5],array[offset+6]=te[6],array[offset+7]=te[7],array[offset+8]=te[8],array[offset+9]=te[9],array[offset+10]=te[10],array[offset+11]=te[11],array[offset+12]=te[12],array[offset+13]=te[13],array[offset+14]=te[14],array[offset+15]=te[15],array}});var ShaderChunk={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick( specularColor, dotNV );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#endif\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\tfloat clearCoatInv = 1.0 - clearCoatDHR;\n\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec3 singleScattering = vec3( 0.0 );\n\t\tvec3 multiScattering = vec3( 0.0 );\n\t\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\t\tvec3 diffuse = material.diffuseColor;\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * singleScattering;\n\t\treflectedLight.indirectDiffuse += multiScattering * cosineWeightedIrradiance;\n\t\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\t#else\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#endif\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, irradiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t#endif\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\t#ifdef USE_TANGENT\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy = normalScale * mapN.xy;\n\t\t\tnormal = normalize( vTBN * mapN );\n\t\t#else\n\t\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t\t#endif\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"};function cloneUniforms(src){var dst={};for(var u in src)for(var p in dst[u]={},src[u]){var property=src[u][p];property&&(property.isColor||property.isMatrix3||property.isMatrix4||property.isVector2||property.isVector3||property.isVector4||property.isTexture)?dst[u][p]=property.clone():Array.isArray(property)?dst[u][p]=property.slice():dst[u][p]=property}return dst}function mergeUniforms(uniforms){for(var merged={},u=0;u<uniforms.length;u++){var tmp=cloneUniforms(uniforms[u]);for(var p in tmp)merged[p]=tmp[p]}return merged}var hslA,hslB,hsl,UniformsUtils={clone:cloneUniforms,merge:mergeUniforms},ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Color(r,g,b){return void 0===g&&void 0===b?this.set(r):this.setRGB(r,g,b)}function LinearToSRGB(c){return c<.0031308?12.92*c:1.055*Math.pow(c,.41666)-.055}function SRGBToLinear(c){return c<.04045?.0773993808*c:Math.pow(.9478672986*c+.0521327014,2.4)}function hue2rgb(p,q,t){return t<0&&(t+=1),1<t&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+6*(q-p)*(2/3-t):p}Object.assign(Color.prototype,{isColor:!0,r:1,g:1,b:1,set:function(value){return value&&value.isColor?this.copy(value):"number"==typeof value?this.setHex(value):"string"==typeof value&&this.setStyle(value),this},setScalar:function(scalar){return this.r=scalar,this.g=scalar,this.b=scalar,this},setHex:function(hex){return hex=Math.floor(hex),this.r=(hex>>16&255)/255,this.g=(hex>>8&255)/255,this.b=(255&hex)/255,this},setRGB:function(r,g,b){return this.r=r,this.g=g,this.b=b,this},setHSL:function(h,s,l){if(h=_Math.euclideanModulo(h,1),s=_Math.clamp(s,0,1),l=_Math.clamp(l,0,1),0===s)this.r=this.g=this.b=l;else{var p=l<=.5?l*(1+s):l+s-l*s,q=2*l-p;this.r=hue2rgb(q,p,h+1/3),this.g=hue2rgb(q,p,h),this.b=hue2rgb(q,p,h-1/3)}return this},setStyle:function(style){function handleAlpha(string){void 0!==string&&parseFloat(string)<1&&console.warn("THREE.Color: Alpha component of "+style+" will be ignored.")}var m;if(m=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(style)){var color,name=m[1],components=m[2];switch(name){case"rgb":case"rgba":if(color=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(components))return this.r=Math.min(255,parseInt(color[1],10))/255,this.g=Math.min(255,parseInt(color[2],10))/255,this.b=Math.min(255,parseInt(color[3],10))/255,handleAlpha(color[5]),this;if(color=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(components))return this.r=Math.min(100,parseInt(color[1],10))/100,this.g=Math.min(100,parseInt(color[2],10))/100,this.b=Math.min(100,parseInt(color[3],10))/100,handleAlpha(color[5]),this;break;case"hsl":case"hsla":if(color=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(components)){var h=parseFloat(color[1])/360,s=parseInt(color[2],10)/100,l=parseInt(color[3],10)/100;return handleAlpha(color[5]),this.setHSL(h,s,l)}}}else if(m=/^\#([A-Fa-f0-9]+)$/.exec(style)){var hex,size=(hex=m[1]).length;if(3===size)return this.r=parseInt(hex.charAt(0)+hex.charAt(0),16)/255,this.g=parseInt(hex.charAt(1)+hex.charAt(1),16)/255,this.b=parseInt(hex.charAt(2)+hex.charAt(2),16)/255,this;if(6===size)return this.r=parseInt(hex.charAt(0)+hex.charAt(1),16)/255,this.g=parseInt(hex.charAt(2)+hex.charAt(3),16)/255,this.b=parseInt(hex.charAt(4)+hex.charAt(5),16)/255,this}style&&0<style.length&&(void 0!==(hex=ColorKeywords[style])?this.setHex(hex):console.warn("THREE.Color: Unknown color "+style));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(color){return this.r=color.r,this.g=color.g,this.b=color.b,this},copyGammaToLinear:function(color,gammaFactor){return void 0===gammaFactor&&(gammaFactor=2),this.r=Math.pow(color.r,gammaFactor),this.g=Math.pow(color.g,gammaFactor),this.b=Math.pow(color.b,gammaFactor),this},copyLinearToGamma:function(color,gammaFactor){void 0===gammaFactor&&(gammaFactor=2);var safeInverse=0<gammaFactor?1/gammaFactor:1;return this.r=Math.pow(color.r,safeInverse),this.g=Math.pow(color.g,safeInverse),this.b=Math.pow(color.b,safeInverse),this},convertGammaToLinear:function(gammaFactor){return this.copyGammaToLinear(this,gammaFactor),this},convertLinearToGamma:function(gammaFactor){return this.copyLinearToGamma(this,gammaFactor),this},copySRGBToLinear:function(color){return this.r=SRGBToLinear(color.r),this.g=SRGBToLinear(color.g),this.b=SRGBToLinear(color.b),this},copyLinearToSRGB:function(color){return this.r=LinearToSRGB(color.r),this.g=LinearToSRGB(color.g),this.b=LinearToSRGB(color.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(target){void 0===target&&(console.warn("THREE.Color: .getHSL() target is now required"),target={h:0,s:0,l:0});var hue,saturation,r=this.r,g=this.g,b=this.b,max=Math.max(r,g,b),min=Math.min(r,g,b),lightness=(min+max)/2;if(min===max)saturation=hue=0;else{var delta=max-min;switch(saturation=lightness<=.5?delta/(max+min):delta/(2-max-min),max){case r:hue=(g-b)/delta+(g<b?6:0);break;case g:hue=(b-r)/delta+2;break;case b:hue=(r-g)/delta+4}hue/=6}return target.h=hue,target.s=saturation,target.l=lightness,target},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(hsl={},function(h,s,l){return this.getHSL(hsl),hsl.h+=h,hsl.s+=s,hsl.l+=l,this.setHSL(hsl.h,hsl.s,hsl.l),this}),add:function(color){return this.r+=color.r,this.g+=color.g,this.b+=color.b,this},addColors:function(color1,color2){return this.r=color1.r+color2.r,this.g=color1.g+color2.g,this.b=color1.b+color2.b,this},addScalar:function(s){return this.r+=s,this.g+=s,this.b+=s,this},sub:function(color){return this.r=Math.max(0,this.r-color.r),this.g=Math.max(0,this.g-color.g),this.b=Math.max(0,this.b-color.b),this},multiply:function(color){return this.r*=color.r,this.g*=color.g,this.b*=color.b,this},multiplyScalar:function(s){return this.r*=s,this.g*=s,this.b*=s,this},lerp:function(color,alpha){return this.r+=(color.r-this.r)*alpha,this.g+=(color.g-this.g)*alpha,this.b+=(color.b-this.b)*alpha,this},lerpHSL:(hslA={h:0,s:0,l:0},hslB={h:0,s:0,l:0},function(color,alpha){this.getHSL(hslA),color.getHSL(hslB);var h=_Math.lerp(hslA.h,hslB.h,alpha),s=_Math.lerp(hslA.s,hslB.s,alpha),l=_Math.lerp(hslA.l,hslB.l,alpha);return this.setHSL(h,s,l),this}),equals:function(c){return c.r===this.r&&c.g===this.g&&c.b===this.b},fromArray:function(array,offset){return void 0===offset&&(offset=0),this.r=array[offset],this.g=array[offset+1],this.b=array[offset+2],this},toArray:function(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.r,array[offset+1]=this.g,array[offset+2]=this.b,array},toJSON:function(){return this.getHex()}});var q,UniformsLib={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Matrix3}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};function WebGLAnimation(){var context=null,isAnimating=!1,animationLoop=null;function onAnimationFrame(time,frame){!1!==isAnimating&&(animationLoop(time,frame),context.requestAnimationFrame(onAnimationFrame))}return{start:function(){!0!==isAnimating&&null!==animationLoop&&(context.requestAnimationFrame(onAnimationFrame),isAnimating=!0)},stop:function(){isAnimating=!1},setAnimationLoop:function(callback){animationLoop=callback},setContext:function(value){context=value}}}function WebGLAttributes(gl){var buffers=new WeakMap;return{get:function(attribute){return attribute.isInterleavedBufferAttribute&&(attribute=attribute.data),buffers.get(attribute)},remove:function(attribute){attribute.isInterleavedBufferAttribute&&(attribute=attribute.data);var data=buffers.get(attribute);data&&(gl.deleteBuffer(data.buffer),buffers.delete(attribute))},update:function(attribute,bufferType){attribute.isInterleavedBufferAttribute&&(attribute=attribute.data);var data=buffers.get(attribute);void 0===data?buffers.set(attribute,function(attribute,bufferType){var array=attribute.array,usage=attribute.dynamic?35048:35044,buffer=gl.createBuffer();gl.bindBuffer(bufferType,buffer),gl.bufferData(bufferType,array,usage),attribute.onUploadCallback();var type=5126;return array instanceof Float32Array?type=5126:array instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):array instanceof Uint16Array?type=5123:array instanceof Int16Array?type=5122:array instanceof Uint32Array?type=5125:array instanceof Int32Array?type=5124:array instanceof Int8Array?type=5120:array instanceof Uint8Array&&(type=5121),{buffer:buffer,type:type,bytesPerElement:array.BYTES_PER_ELEMENT,version:attribute.version}}(attribute,bufferType)):data.version<attribute.version&&(function(buffer,attribute,bufferType){var array=attribute.array,updateRange=attribute.updateRange;gl.bindBuffer(bufferType,buffer),!1===attribute.dynamic?gl.bufferData(bufferType,array,35044):-1===updateRange.count?gl.bufferSubData(bufferType,0,array):0===updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(gl.bufferSubData(bufferType,updateRange.offset*array.BYTES_PER_ELEMENT,array.subarray(updateRange.offset,updateRange.offset+updateRange.count)),updateRange.count=-1)}(data.buffer,attribute,bufferType),data.version=attribute.version)}}}function Face3(a,b,c,normal,color,materialIndex){this.a=a,this.b=b,this.c=c,this.normal=normal&&normal.isVector3?normal:new Vector3,this.vertexNormals=Array.isArray(normal)?normal:[],this.color=color&&color.isColor?color:new Color,this.vertexColors=Array.isArray(color)?color:[],this.materialIndex=void 0!==materialIndex?materialIndex:0}function Euler(x,y,z,order){this._x=x||0,this._y=y||0,this._z=z||0,this._order=order||Euler.DefaultOrder}function Layers(){this.mask=1}ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},Object.assign(Face3.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(source){this.a=source.a,this.b=source.b,this.c=source.c,this.normal.copy(source.normal),this.color.copy(source.color),this.materialIndex=source.materialIndex;for(var i=0,il=source.vertexNormals.length;i<il;i++)this.vertexNormals[i]=source.vertexNormals[i].clone();for(i=0,il=source.vertexColors.length;i<il;i++)this.vertexColors[i]=source.vertexColors[i].clone();return this}}),Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Euler.DefaultOrder="XYZ",Object.defineProperties(Euler.prototype,{x:{get:function(){return this._x},set:function(value){this._x=value,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(value){this._y=value,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(value){this._z=value,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(value){this._order=value,this.onChangeCallback()}}}),Object.assign(Euler.prototype,{isEuler:!0,set:function(x,y,z,order){return this._x=x,this._y=y,this._z=z,this._order=order||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(euler){return this._x=euler._x,this._y=euler._y,this._z=euler._z,this._order=euler._order,this.onChangeCallback(),this},setFromRotationMatrix:function(m,order,update){var clamp=_Math.clamp,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];return"XYZ"===(order=order||this._order)?(this._y=Math.asin(clamp(m13,-1,1)),Math.abs(m13)<.99999?(this._x=Math.atan2(-m23,m33),this._z=Math.atan2(-m12,m11)):(this._x=Math.atan2(m32,m22),this._z=0)):"YXZ"===order?(this._x=Math.asin(-clamp(m23,-1,1)),Math.abs(m23)<.99999?(this._y=Math.atan2(m13,m33),this._z=Math.atan2(m21,m22)):(this._y=Math.atan2(-m31,m11),this._z=0)):"ZXY"===order?(this._x=Math.asin(clamp(m32,-1,1)),Math.abs(m32)<.99999?(this._y=Math.atan2(-m31,m33),this._z=Math.atan2(-m12,m22)):(this._y=0,this._z=Math.atan2(m21,m11))):"ZYX"===order?(this._y=Math.asin(-clamp(m31,-1,1)),Math.abs(m31)<.99999?(this._x=Math.atan2(m32,m33),this._z=Math.atan2(m21,m11)):(this._x=0,this._z=Math.atan2(-m12,m22))):"YZX"===order?(this._z=Math.asin(clamp(m21,-1,1)),Math.abs(m21)<.99999?(this._x=Math.atan2(-m23,m22),this._y=Math.atan2(-m31,m11)):(this._x=0,this._y=Math.atan2(m13,m33))):"XZY"===order?(this._z=Math.asin(-clamp(m12,-1,1)),Math.abs(m12)<.99999?(this._x=Math.atan2(m32,m22),this._y=Math.atan2(m13,m11)):(this._x=Math.atan2(-m23,m33),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+order),this._order=order,!1!==update&&this.onChangeCallback(),this},setFromQuaternion:function(){var matrix=new Matrix4;return function(q,order,update){return matrix.makeRotationFromQuaternion(q),this.setFromRotationMatrix(matrix,order,update)}}(),setFromVector3:function(v,order){return this.set(v.x,v.y,v.z,order||this._order)},reorder:(q=new Quaternion,function(newOrder){return q.setFromEuler(this),this.setFromQuaternion(q,newOrder)}),equals:function(euler){return euler._x===this._x&&euler._y===this._y&&euler._z===this._z&&euler._order===this._order},fromArray:function(array){return this._x=array[0],this._y=array[1],this._z=array[2],void 0!==array[3]&&(this._order=array[3]),this.onChangeCallback(),this},toArray:function(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this._x,array[offset+1]=this._y,array[offset+2]=this._z,array[offset+3]=this._order,array},toVector3:function(optionalResult){return optionalResult?optionalResult.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)},onChange:function(callback){return this.onChangeCallback=callback,this},onChangeCallback:function(){}}),Object.assign(Layers.prototype,{set:function(channel){this.mask=1<<channel|0},enable:function(channel){this.mask|=1<<channel|0},toggle:function(channel){this.mask^=1<<channel|0},disable:function(channel){this.mask&=~(1<<channel|0)},test:function(layers){return 0!=(this.mask&layers.mask)}});var position,scale,m1,q1,object3DId=0;function Object3D(){Object.defineProperty(this,"id",{value:object3DId++}),this.uuid=_Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var position=new Vector3,rotation=new Euler,quaternion=new Quaternion,scale=new Vector3(1,1,1);rotation.onChange(function(){quaternion.setFromEuler(rotation,!1)}),quaternion.onChange(function(){rotation.setFromQuaternion(quaternion,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:position},rotation:{configurable:!0,enumerable:!0,value:rotation},quaternion:{configurable:!0,enumerable:!0,value:quaternion},scale:{configurable:!0,enumerable:!0,value:scale},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(matrix){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(q){return this.quaternion.premultiply(q),this},setRotationFromAxisAngle:function(axis,angle){this.quaternion.setFromAxisAngle(axis,angle)},setRotationFromEuler:function(euler){this.quaternion.setFromEuler(euler,!0)},setRotationFromMatrix:function(m){this.quaternion.setFromRotationMatrix(m)},setRotationFromQuaternion:function(q){this.quaternion.copy(q)},rotateOnAxis:(q1=new Quaternion,function(axis,angle){return q1.setFromAxisAngle(axis,angle),this.quaternion.multiply(q1),this}),rotateOnWorldAxis:function(){var q1=new Quaternion;return function(axis,angle){return q1.setFromAxisAngle(axis,angle),this.quaternion.premultiply(q1),this}}(),rotateX:function(){var v1=new Vector3(1,0,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateY:function(){var v1=new Vector3(0,1,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateZ:function(){var v1=new Vector3(0,0,1);return function(angle){return this.rotateOnAxis(v1,angle)}}(),translateOnAxis:function(){var v1=new Vector3;return function(axis,distance){return v1.copy(axis).applyQuaternion(this.quaternion),this.position.add(v1.multiplyScalar(distance)),this}}(),translateX:function(){var v1=new Vector3(1,0,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateY:function(){var v1=new Vector3(0,1,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateZ:function(){var v1=new Vector3(0,0,1);return function(distance){return this.translateOnAxis(v1,distance)}}(),localToWorld:function(vector){return vector.applyMatrix4(this.matrixWorld)},worldToLocal:(m1=new Matrix4,function(vector){return vector.applyMatrix4(m1.getInverse(this.matrixWorld))}),lookAt:function(){var q1=new Quaternion,m1=new Matrix4,target=new Vector3,position=new Vector3;return function(x,y,z){x.isVector3?target.copy(x):target.set(x,y,z);var parent=this.parent;this.updateWorldMatrix(!0,!1),position.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?m1.lookAt(position,target,this.up):m1.lookAt(target,position,this.up),this.quaternion.setFromRotationMatrix(m1),parent&&(m1.extractRotation(parent.matrixWorld),q1.setFromRotationMatrix(m1),this.quaternion.premultiply(q1.inverse()))}}(),add:function(object){if(1<arguments.length){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return object===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",object):object&&object.isObject3D?(null!==object.parent&&object.parent.remove(object),object.parent=this,object.dispatchEvent({type:"added"}),this.children.push(object)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",object),this},remove:function(object){if(1<arguments.length){for(var i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}var index=this.children.indexOf(object);return-1!==index&&(object.parent=null,object.dispatchEvent({type:"removed"}),this.children.splice(index,1)),this},getObjectById:function(id){return this.getObjectByProperty("id",id)},getObjectByName:function(name){return this.getObjectByProperty("name",name)},getObjectByProperty:function(name,value){if(this[name]===value)return this;for(var i=0,l=this.children.length;i<l;i++){var object=this.children[i].getObjectByProperty(name,value);if(void 0!==object)return object}},getWorldPosition:function(target){return void 0===target&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),target=new Vector3),this.updateMatrixWorld(!0),target.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(position=new Vector3,scale=new Vector3,function(target){return void 0===target&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),target=new Quaternion),this.updateMatrixWorld(!0),this.matrixWorld.decompose(position,target,scale),target}),getWorldScale:function(){var position=new Vector3,quaternion=new Quaternion;return function(target){return void 0===target&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),target=new Vector3),this.updateMatrixWorld(!0),this.matrixWorld.decompose(position,quaternion,target),target}}(),getWorldDirection:function(target){void 0===target&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),target=new Vector3),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return target.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(callback){callback(this);for(var children=this.children,i=0,l=children.length;i<l;i++)children[i].traverse(callback)},traverseVisible:function(callback){if(!1!==this.visible){callback(this);for(var children=this.children,i=0,l=children.length;i<l;i++)children[i].traverseVisible(callback)}},traverseAncestors:function(callback){var parent=this.parent;null!==parent&&(callback(parent),parent.traverseAncestors(callback))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(force){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||force)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),force=!(this.matrixWorldNeedsUpdate=!1));for(var children=this.children,i=0,l=children.length;i<l;i++)children[i].updateMatrixWorld(force)},updateWorldMatrix:function(updateParents,updateChildren){var parent=this.parent;if(!0===updateParents&&null!==parent&&parent.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===updateChildren)for(var children=this.children,i=0,l=children.length;i<l;i++)children[i].updateWorldMatrix(!1,!0)},toJSON:function(meta){var isRootObject=void 0===meta||"string"==typeof meta,output={};isRootObject&&(meta={geometries:{},materials:{},textures:{},images:{},shapes:{}},output.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var object={};function serialize(library,element){return void 0===library[element.uuid]&&(library[element.uuid]=element.toJSON(meta)),element.uuid}if(object.uuid=this.uuid,object.type=this.type,""!==this.name&&(object.name=this.name),!0===this.castShadow&&(object.castShadow=!0),!0===this.receiveShadow&&(object.receiveShadow=!0),!1===this.visible&&(object.visible=!1),!1===this.frustumCulled&&(object.frustumCulled=!1),0!==this.renderOrder&&(object.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(object.userData=this.userData),object.layers=this.layers.mask,object.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(object.matrixAutoUpdate=!1),this.isMesh&&this.drawMode!==TrianglesDrawMode&&(object.drawMode=this.drawMode),this.isMesh||this.isLine||this.isPoints){object.geometry=serialize(meta.geometries,this.geometry);var parameters=this.geometry.parameters;if(void 0!==parameters&&void 0!==parameters.shapes){var shapes=parameters.shapes;if(Array.isArray(shapes))for(var i=0,l=shapes.length;i<l;i++){var shape=shapes[i];serialize(meta.shapes,shape)}else serialize(meta.shapes,shapes)}}if(void 0!==this.material)if(Array.isArray(this.material)){var uuids=[];for(i=0,l=this.material.length;i<l;i++)uuids.push(serialize(meta.materials,this.material[i]));object.material=uuids}else object.material=serialize(meta.materials,this.material);if(0<this.children.length){object.children=[];for(i=0;i<this.children.length;i++)object.children.push(this.children[i].toJSON(meta).object)}if(isRootObject){var geometries=extractFromCache(meta.geometries),materials=extractFromCache(meta.materials),textures=extractFromCache(meta.textures),images=extractFromCache(meta.images);shapes=extractFromCache(meta.shapes);0<geometries.length&&(output.geometries=geometries),0<materials.length&&(output.materials=materials),0<textures.length&&(output.textures=textures),0<images.length&&(output.images=images),0<shapes.length&&(output.shapes=shapes)}return output.object=object,output;function extractFromCache(cache){var values=[];for(var key in cache){var data=cache[key];delete data.metadata,values.push(data)}return values}},clone:function(recursive){return(new this.constructor).copy(this,recursive)},copy:function(source,recursive){if(void 0===recursive&&(recursive=!0),this.name=source.name,this.up.copy(source.up),this.position.copy(source.position),this.quaternion.copy(source.quaternion),this.scale.copy(source.scale),this.matrix.copy(source.matrix),this.matrixWorld.copy(source.matrixWorld),this.matrixAutoUpdate=source.matrixAutoUpdate,this.matrixWorldNeedsUpdate=source.matrixWorldNeedsUpdate,this.layers.mask=source.layers.mask,this.visible=source.visible,this.castShadow=source.castShadow,this.receiveShadow=source.receiveShadow,this.frustumCulled=source.frustumCulled,this.renderOrder=source.renderOrder,this.userData=JSON.parse(JSON.stringify(source.userData)),!0===recursive)for(var i=0;i<source.children.length;i++){var child=source.children[i];this.add(child.clone())}return this}});var offset,obj,geometryId=0;function Geometry(){Object.defineProperty(this,"id",{value:geometryId+=2}),this.uuid=_Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function BufferAttribute(array,itemSize,normalized){if(Array.isArray(array))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=array,this.itemSize=itemSize,this.count=void 0!==array?array.length/itemSize:0,this.normalized=!0===normalized,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Int8BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Int8Array(array),itemSize,normalized)}function Uint8BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Uint8Array(array),itemSize,normalized)}function Uint8ClampedBufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Uint8ClampedArray(array),itemSize,normalized)}function Int16BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Int16Array(array),itemSize,normalized)}function Uint16BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Uint16Array(array),itemSize,normalized)}function Int32BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Int32Array(array),itemSize,normalized)}function Uint32BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Uint32Array(array),itemSize,normalized)}function Float32BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Float32Array(array),itemSize,normalized)}function Float64BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Float64Array(array),itemSize,normalized)}function DirectGeometry(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function arrayMax(array){if(0===array.length)return-1/0;for(var max=array[0],i=1,l=array.length;i<l;++i)array[i]>max&&(max=array[i]);return max}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix:function(matrix){for(var normalMatrix=(new Matrix3).getNormalMatrix(matrix),i=0,il=this.vertices.length;i<il;i++){this.vertices[i].applyMatrix4(matrix)}for(i=0,il=this.faces.length;i<il;i++){var face=this.faces[i];face.normal.applyMatrix3(normalMatrix).normalize();for(var j=0,jl=face.vertexNormals.length;j<jl;j++)face.vertexNormals[j].applyMatrix3(normalMatrix).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var m1=new Matrix4;return function(angle){return m1.makeRotationX(angle),this.applyMatrix(m1),this}}(),rotateY:function(){var m1=new Matrix4;return function(angle){return m1.makeRotationY(angle),this.applyMatrix(m1),this}}(),rotateZ:function(){var m1=new Matrix4;return function(angle){return m1.makeRotationZ(angle),this.applyMatrix(m1),this}}(),translate:function(){var m1=new Matrix4;return function(x,y,z){return m1.makeTranslation(x,y,z),this.applyMatrix(m1),this}}(),scale:function(){var m1=new Matrix4;return function(x,y,z){return m1.makeScale(x,y,z),this.applyMatrix(m1),this}}(),lookAt:(obj=new Object3D,function(vector){obj.lookAt(vector),obj.updateMatrix(),this.applyMatrix(obj.matrix)}),fromBufferGeometry:function(geometry){var scope=this,indices=null!==geometry.index?geometry.index.array:void 0,attributes=geometry.attributes,positions=attributes.position.array,normals=void 0!==attributes.normal?attributes.normal.array:void 0,colors=void 0!==attributes.color?attributes.color.array:void 0,uvs=void 0!==attributes.uv?attributes.uv.array:void 0,uvs2=void 0!==attributes.uv2?attributes.uv2.array:void 0;void 0!==uvs2&&(this.faceVertexUvs[1]=[]);for(var i=0,j=0;i<positions.length;i+=3,j+=2)scope.vertices.push((new Vector3).fromArray(positions,i)),void 0!==colors&&scope.colors.push((new Color).fromArray(colors,i));function addFace(a,b,c,materialIndex){var vertexColors=void 0===colors?[]:[scope.colors[a].clone(),scope.colors[b].clone(),scope.colors[c].clone()],face=new Face3(a,b,c,void 0===normals?[]:[(new Vector3).fromArray(normals,3*a),(new Vector3).fromArray(normals,3*b),(new Vector3).fromArray(normals,3*c)],vertexColors,materialIndex);scope.faces.push(face),void 0!==uvs&&scope.faceVertexUvs[0].push([(new Vector2).fromArray(uvs,2*a),(new Vector2).fromArray(uvs,2*b),(new Vector2).fromArray(uvs,2*c)]),void 0!==uvs2&&scope.faceVertexUvs[1].push([(new Vector2).fromArray(uvs2,2*a),(new Vector2).fromArray(uvs2,2*b),(new Vector2).fromArray(uvs2,2*c)])}var groups=geometry.groups;if(0<groups.length)for(i=0;i<groups.length;i++)for(var group=groups[i],start=group.start,jl=(j=start,start+group.count);j<jl;j+=3)void 0!==indices?addFace(indices[j],indices[j+1],indices[j+2],group.materialIndex):addFace(j,j+1,j+2,group.materialIndex);else if(void 0!==indices)for(i=0;i<indices.length;i+=3)addFace(indices[i],indices[i+1],indices[i+2]);else for(i=0;i<positions.length/3;i+=3)addFace(i,i+1,i+2);return this.computeFaceNormals(),null!==geometry.boundingBox&&(this.boundingBox=geometry.boundingBox.clone()),null!==geometry.boundingSphere&&(this.boundingSphere=geometry.boundingSphere.clone()),this},center:(offset=new Vector3,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(offset).negate(),this.translate(offset.x,offset.y,offset.z),this}),normalize:function(){this.computeBoundingSphere();var center=this.boundingSphere.center,radius=this.boundingSphere.radius,s=0===radius?1:1/radius,matrix=new Matrix4;return matrix.set(s,0,0,-s*center.x,0,s,0,-s*center.y,0,0,s,-s*center.z,0,0,0,1),this.applyMatrix(matrix),this},computeFaceNormals:function(){for(var cb=new Vector3,ab=new Vector3,f=0,fl=this.faces.length;f<fl;f++){var face=this.faces[f],vA=this.vertices[face.a],vB=this.vertices[face.b],vC=this.vertices[face.c];cb.subVectors(vC,vB),ab.subVectors(vA,vB),cb.cross(ab),cb.normalize(),face.normal.copy(cb)}},computeVertexNormals:function(areaWeighted){var v,vl,f,fl,face,vertices;for(void 0===areaWeighted&&(areaWeighted=!0),vertices=new Array(this.vertices.length),v=0,vl=this.vertices.length;v<vl;v++)vertices[v]=new Vector3;if(areaWeighted){var vA,vB,vC,cb=new Vector3,ab=new Vector3;for(f=0,fl=this.faces.length;f<fl;f++)face=this.faces[f],vA=this.vertices[face.a],vB=this.vertices[face.b],vC=this.vertices[face.c],cb.subVectors(vC,vB),ab.subVectors(vA,vB),cb.cross(ab),vertices[face.a].add(cb),vertices[face.b].add(cb),vertices[face.c].add(cb)}else for(this.computeFaceNormals(),f=0,fl=this.faces.length;f<fl;f++)vertices[(face=this.faces[f]).a].add(face.normal),vertices[face.b].add(face.normal),vertices[face.c].add(face.normal);for(v=0,vl=this.vertices.length;v<vl;v++)vertices[v].normalize();for(f=0,fl=this.faces.length;f<fl;f++){var vertexNormals=(face=this.faces[f]).vertexNormals;3===vertexNormals.length?(vertexNormals[0].copy(vertices[face.a]),vertexNormals[1].copy(vertices[face.b]),vertexNormals[2].copy(vertices[face.c])):(vertexNormals[0]=vertices[face.a].clone(),vertexNormals[1]=vertices[face.b].clone(),vertexNormals[2]=vertices[face.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var f,fl,face;for(this.computeFaceNormals(),f=0,fl=this.faces.length;f<fl;f++){var vertexNormals=(face=this.faces[f]).vertexNormals;3===vertexNormals.length?(vertexNormals[0].copy(face.normal),vertexNormals[1].copy(face.normal),vertexNormals[2].copy(face.normal)):(vertexNormals[0]=face.normal.clone(),vertexNormals[1]=face.normal.clone(),vertexNormals[2]=face.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var i,il,f,fl,face;for(f=0,fl=this.faces.length;f<fl;f++)for((face=this.faces[f]).__originalFaceNormal?face.__originalFaceNormal.copy(face.normal):face.__originalFaceNormal=face.normal.clone(),face.__originalVertexNormals||(face.__originalVertexNormals=[]),i=0,il=face.vertexNormals.length;i<il;i++)face.__originalVertexNormals[i]?face.__originalVertexNormals[i].copy(face.vertexNormals[i]):face.__originalVertexNormals[i]=face.vertexNormals[i].clone();var tmpGeo=new Geometry;for(tmpGeo.faces=this.faces,i=0,il=this.morphTargets.length;i<il;i++){if(!this.morphNormals[i]){this.morphNormals[i]={},this.morphNormals[i].faceNormals=[],this.morphNormals[i].vertexNormals=[];var dstNormalsFace=this.morphNormals[i].faceNormals,dstNormalsVertex=this.morphNormals[i].vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++)faceNormal=new Vector3,vertexNormals={a:new Vector3,b:new Vector3,c:new Vector3},dstNormalsFace.push(faceNormal),dstNormalsVertex.push(vertexNormals)}var faceNormal,vertexNormals,morphNormals=this.morphNormals[i];for(tmpGeo.vertices=this.morphTargets[i].vertices,tmpGeo.computeFaceNormals(),tmpGeo.computeVertexNormals(),f=0,fl=this.faces.length;f<fl;f++)face=this.faces[f],faceNormal=morphNormals.faceNormals[f],vertexNormals=morphNormals.vertexNormals[f],faceNormal.copy(face.normal),vertexNormals.a.copy(face.vertexNormals[0]),vertexNormals.b.copy(face.vertexNormals[1]),vertexNormals.c.copy(face.vertexNormals[2])}for(f=0,fl=this.faces.length;f<fl;f++)(face=this.faces[f]).normal=face.__originalFaceNormal,face.vertexNormals=face.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(geometry,matrix,materialIndexOffset){if(geometry&&geometry.isGeometry){var normalMatrix,vertexOffset=this.vertices.length,vertices1=this.vertices,vertices2=geometry.vertices,faces1=this.faces,faces2=geometry.faces,uvs1=this.faceVertexUvs[0],uvs2=geometry.faceVertexUvs[0],colors1=this.colors,colors2=geometry.colors;void 0===materialIndexOffset&&(materialIndexOffset=0),void 0!==matrix&&(normalMatrix=(new Matrix3).getNormalMatrix(matrix));for(var i=0,il=vertices2.length;i<il;i++){var vertexCopy=vertices2[i].clone();void 0!==matrix&&vertexCopy.applyMatrix4(matrix),vertices1.push(vertexCopy)}for(i=0,il=colors2.length;i<il;i++)colors1.push(colors2[i].clone());for(i=0,il=faces2.length;i<il;i++){var faceCopy,normal,color,face=faces2[i],faceVertexNormals=face.vertexNormals,faceVertexColors=face.vertexColors;(faceCopy=new Face3(face.a+vertexOffset,face.b+vertexOffset,face.c+vertexOffset)).normal.copy(face.normal),void 0!==normalMatrix&&faceCopy.normal.applyMatrix3(normalMatrix).normalize();for(var j=0,jl=faceVertexNormals.length;j<jl;j++)normal=faceVertexNormals[j].clone(),void 0!==normalMatrix&&normal.applyMatrix3(normalMatrix).normalize(),faceCopy.vertexNormals.push(normal);faceCopy.color.copy(face.color);for(j=0,jl=faceVertexColors.length;j<jl;j++)color=faceVertexColors[j],faceCopy.vertexColors.push(color.clone());faceCopy.materialIndex=face.materialIndex+materialIndexOffset,faces1.push(faceCopy)}for(i=0,il=uvs2.length;i<il;i++){var uv=uvs2[i],uvCopy=[];if(void 0!==uv){for(j=0,jl=uv.length;j<jl;j++)uvCopy.push(uv[j].clone());uvs1.push(uvCopy)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",geometry)},mergeMesh:function(mesh){mesh&&mesh.isMesh?(mesh.matrixAutoUpdate&&mesh.updateMatrix(),this.merge(mesh.geometry,mesh.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",mesh)},mergeVertices:function(){var v,key,i,il,face,indices,j,jl,verticesMap={},unique=[],changes=[],precision=Math.pow(10,4);for(i=0,il=this.vertices.length;i<il;i++)v=this.vertices[i],void 0===verticesMap[key=Math.round(v.x*precision)+"_"+Math.round(v.y*precision)+"_"+Math.round(v.z*precision)]?(verticesMap[key]=i,unique.push(this.vertices[i]),changes[i]=unique.length-1):changes[i]=changes[verticesMap[key]];var faceIndicesToRemove=[];for(i=0,il=this.faces.length;i<il;i++){(face=this.faces[i]).a=changes[face.a],face.b=changes[face.b],face.c=changes[face.c],indices=[face.a,face.b,face.c];for(var n=0;n<3;n++)if(indices[n]===indices[(n+1)%3]){faceIndicesToRemove.push(i);break}}for(i=faceIndicesToRemove.length-1;0<=i;i--){var idx=faceIndicesToRemove[i];for(this.faces.splice(idx,1),j=0,jl=this.faceVertexUvs.length;j<jl;j++)this.faceVertexUvs[j].splice(idx,1)}var diff=this.vertices.length-unique.length;return this.vertices=unique,diff},setFromPoints:function(points){this.vertices=[];for(var i=0,l=points.length;i<l;i++){var point=points[i];this.vertices.push(new Vector3(point.x,point.y,point.z||0))}return this},sortFacesByMaterialIndex:function(){for(var faces=this.faces,length=faces.length,i=0;i<length;i++)faces[i]._id=i;faces.sort(function(a,b){return a.materialIndex-b.materialIndex});var newUvs1,newUvs2,uvs1=this.faceVertexUvs[0],uvs2=this.faceVertexUvs[1];uvs1&&uvs1.length===length&&(newUvs1=[]),uvs2&&uvs2.length===length&&(newUvs2=[]);for(i=0;i<length;i++){var id=faces[i]._id;newUvs1&&newUvs1.push(uvs1[id]),newUvs2&&newUvs2.push(uvs2[id])}newUvs1&&(this.faceVertexUvs[0]=newUvs1),newUvs2&&(this.faceVertexUvs[1]=newUvs2)},toJSON:function(){var data={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(data.uuid=this.uuid,data.type=this.type,""!==this.name&&(data.name=this.name),void 0!==this.parameters){var parameters=this.parameters;for(var key in parameters)void 0!==parameters[key]&&(data[key]=parameters[key]);return data}for(var vertices=[],i=0;i<this.vertices.length;i++){var vertex=this.vertices[i];vertices.push(vertex.x,vertex.y,vertex.z)}var faces=[],normals=[],normalsHash={},colors=[],colorsHash={},uvs=[],uvsHash={};for(i=0;i<this.faces.length;i++){var face=this.faces[i],hasFaceVertexUv=void 0!==this.faceVertexUvs[0][i],hasFaceNormal=0<face.normal.length(),hasFaceVertexNormal=0<face.vertexNormals.length,hasFaceColor=1!==face.color.r||1!==face.color.g||1!==face.color.b,hasFaceVertexColor=0<face.vertexColors.length,faceType=0;if(faceType=setBit(faceType=setBit(faceType=setBit(faceType=setBit(faceType=setBit(faceType=setBit(faceType=setBit(faceType=setBit(faceType,0,0),1,!0),2,!1),3,hasFaceVertexUv),4,hasFaceNormal),5,hasFaceVertexNormal),6,hasFaceColor),7,hasFaceVertexColor),faces.push(faceType),faces.push(face.a,face.b,face.c),faces.push(face.materialIndex),hasFaceVertexUv){var faceVertexUvs=this.faceVertexUvs[0][i];faces.push(getUvIndex(faceVertexUvs[0]),getUvIndex(faceVertexUvs[1]),getUvIndex(faceVertexUvs[2]))}if(hasFaceNormal&&faces.push(getNormalIndex(face.normal)),hasFaceVertexNormal){var vertexNormals=face.vertexNormals;faces.push(getNormalIndex(vertexNormals[0]),getNormalIndex(vertexNormals[1]),getNormalIndex(vertexNormals[2]))}if(hasFaceColor&&faces.push(getColorIndex(face.color)),hasFaceVertexColor){var vertexColors=face.vertexColors;faces.push(getColorIndex(vertexColors[0]),getColorIndex(vertexColors[1]),getColorIndex(vertexColors[2]))}}function setBit(value,position,enabled){return enabled?value|1<<position:value&~(1<<position)}function getNormalIndex(normal){var hash=normal.x.toString()+normal.y.toString()+normal.z.toString();return void 0!==normalsHash[hash]||(normalsHash[hash]=normals.length/3,normals.push(normal.x,normal.y,normal.z)),normalsHash[hash]}function getColorIndex(color){var hash=color.r.toString()+color.g.toString()+color.b.toString();return void 0!==colorsHash[hash]||(colorsHash[hash]=colors.length,colors.push(color.getHex())),colorsHash[hash]}function getUvIndex(uv){var hash=uv.x.toString()+uv.y.toString();return void 0!==uvsHash[hash]||(uvsHash[hash]=uvs.length/2,uvs.push(uv.x,uv.y)),uvsHash[hash]}return data.data={},data.data.vertices=vertices,data.data.normals=normals,0<colors.length&&(data.data.colors=colors),0<uvs.length&&(data.data.uvs=[uvs]),data.data.faces=faces,data},clone:function(){return(new Geometry).copy(this)},copy:function(source){var i,il,j,jl,k,kl;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=source.name;var vertices=source.vertices;for(i=0,il=vertices.length;i<il;i++)this.vertices.push(vertices[i].clone());var colors=source.colors;for(i=0,il=colors.length;i<il;i++)this.colors.push(colors[i].clone());var faces=source.faces;for(i=0,il=faces.length;i<il;i++)this.faces.push(faces[i].clone());for(i=0,il=source.faceVertexUvs.length;i<il;i++){var faceVertexUvs=source.faceVertexUvs[i];for(void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]),j=0,jl=faceVertexUvs.length;j<jl;j++){var uvs=faceVertexUvs[j],uvsCopy=[];for(k=0,kl=uvs.length;k<kl;k++){var uv=uvs[k];uvsCopy.push(uv.clone())}this.faceVertexUvs[i].push(uvsCopy)}}var morphTargets=source.morphTargets;for(i=0,il=morphTargets.length;i<il;i++){var morphTarget={};if(morphTarget.name=morphTargets[i].name,void 0!==morphTargets[i].vertices)for(morphTarget.vertices=[],j=0,jl=morphTargets[i].vertices.length;j<jl;j++)morphTarget.vertices.push(morphTargets[i].vertices[j].clone());if(void 0!==morphTargets[i].normals)for(morphTarget.normals=[],j=0,jl=morphTargets[i].normals.length;j<jl;j++)morphTarget.normals.push(morphTargets[i].normals[j].clone());this.morphTargets.push(morphTarget)}var morphNormals=source.morphNormals;for(i=0,il=morphNormals.length;i<il;i++){var morphNormal={};if(void 0!==morphNormals[i].vertexNormals)for(morphNormal.vertexNormals=[],j=0,jl=morphNormals[i].vertexNormals.length;j<jl;j++){var srcVertexNormal=morphNormals[i].vertexNormals[j],destVertexNormal={};destVertexNormal.a=srcVertexNormal.a.clone(),destVertexNormal.b=srcVertexNormal.b.clone(),destVertexNormal.c=srcVertexNormal.c.clone(),morphNormal.vertexNormals.push(destVertexNormal)}if(void 0!==morphNormals[i].faceNormals)for(morphNormal.faceNormals=[],j=0,jl=morphNormals[i].faceNormals.length;j<jl;j++)morphNormal.faceNormals.push(morphNormals[i].faceNormals[j].clone());this.morphNormals.push(morphNormal)}var skinWeights=source.skinWeights;for(i=0,il=skinWeights.length;i<il;i++)this.skinWeights.push(skinWeights[i].clone());var skinIndices=source.skinIndices;for(i=0,il=skinIndices.length;i<il;i++)this.skinIndices.push(skinIndices[i].clone());var lineDistances=source.lineDistances;for(i=0,il=lineDistances.length;i<il;i++)this.lineDistances.push(lineDistances[i]);var boundingBox=source.boundingBox;null!==boundingBox&&(this.boundingBox=boundingBox.clone());var boundingSphere=source.boundingSphere;return null!==boundingSphere&&(this.boundingSphere=boundingSphere.clone()),this.elementsNeedUpdate=source.elementsNeedUpdate,this.verticesNeedUpdate=source.verticesNeedUpdate,this.uvsNeedUpdate=source.uvsNeedUpdate,this.normalsNeedUpdate=source.normalsNeedUpdate,this.colorsNeedUpdate=source.colorsNeedUpdate,this.lineDistancesNeedUpdate=source.lineDistancesNeedUpdate,this.groupsNeedUpdate=source.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(value){!0===value&&this.version++}}),Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(array){if(Array.isArray(array))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==array?array.length/this.itemSize:0,this.array=array,this},setDynamic:function(value){return this.dynamic=value,this},copy:function(source){return this.name=source.name,this.array=new source.array.constructor(source.array),this.itemSize=source.itemSize,this.count=source.count,this.normalized=source.normalized,this.dynamic=source.dynamic,this},copyAt:function(index1,attribute,index2){index1*=this.itemSize,index2*=attribute.itemSize;for(var i=0,l=this.itemSize;i<l;i++)this.array[index1+i]=attribute.array[index2+i];return this},copyArray:function(array){return this.array.set(array),this},copyColorsArray:function(colors){for(var array=this.array,offset=0,i=0,l=colors.length;i<l;i++){var color=colors[i];void 0===color&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),color=new Color),array[offset++]=color.r,array[offset++]=color.g,array[offset++]=color.b}return this},copyVector2sArray:function(vectors){for(var array=this.array,offset=0,i=0,l=vectors.length;i<l;i++){var vector=vectors[i];void 0===vector&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),vector=new Vector2),array[offset++]=vector.x,array[offset++]=vector.y}return this},copyVector3sArray:function(vectors){for(var array=this.array,offset=0,i=0,l=vectors.length;i<l;i++){var vector=vectors[i];void 0===vector&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),vector=new Vector3),array[offset++]=vector.x,array[offset++]=vector.y,array[offset++]=vector.z}return this},copyVector4sArray:function(vectors){for(var array=this.array,offset=0,i=0,l=vectors.length;i<l;i++){var vector=vectors[i];void 0===vector&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),vector=new Vector4),array[offset++]=vector.x,array[offset++]=vector.y,array[offset++]=vector.z,array[offset++]=vector.w}return this},set:function(value,offset){return void 0===offset&&(offset=0),this.array.set(value,offset),this},getX:function(index){return this.array[index*this.itemSize]},setX:function(index,x){return this.array[index*this.itemSize]=x,this},getY:function(index){return this.array[index*this.itemSize+1]},setY:function(index,y){return this.array[index*this.itemSize+1]=y,this},getZ:function(index){return this.array[index*this.itemSize+2]},setZ:function(index,z){return this.array[index*this.itemSize+2]=z,this},getW:function(index){return this.array[index*this.itemSize+3]},setW:function(index,w){return this.array[index*this.itemSize+3]=w,this},setXY:function(index,x,y){return index*=this.itemSize,this.array[index+0]=x,this.array[index+1]=y,this},setXYZ:function(index,x,y,z){return index*=this.itemSize,this.array[index+0]=x,this.array[index+1]=y,this.array[index+2]=z,this},setXYZW:function(index,x,y,z,w){return index*=this.itemSize,this.array[index+0]=x,this.array[index+1]=y,this.array[index+2]=z,this.array[index+3]=w,this},onUpload:function(callback){return this.onUploadCallback=callback,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Int8BufferAttribute,(Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Uint8BufferAttribute,(Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Uint8ClampedBufferAttribute,(Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Int16BufferAttribute,(Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Uint16BufferAttribute,(Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Int32BufferAttribute,(Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Uint32BufferAttribute,(Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Float32BufferAttribute,(Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype)).constructor=Float64BufferAttribute,Object.assign(DirectGeometry.prototype,{computeGroups:function(geometry){for(var group,groups=[],materialIndex=void 0,faces=geometry.faces,i=0;i<faces.length;i++){var face=faces[i];face.materialIndex!==materialIndex&&(materialIndex=face.materialIndex,void 0!==group&&(group.count=3*i-group.start,groups.push(group)),group={start:3*i,materialIndex:materialIndex})}void 0!==group&&(group.count=3*i-group.start,groups.push(group)),this.groups=groups},fromGeometry:function(geometry){var morphTargetsPosition,faces=geometry.faces,vertices=geometry.vertices,faceVertexUvs=geometry.faceVertexUvs,hasFaceVertexUv=faceVertexUvs[0]&&0<faceVertexUvs[0].length,hasFaceVertexUv2=faceVertexUvs[1]&&0<faceVertexUvs[1].length,morphTargets=geometry.morphTargets,morphTargetsLength=morphTargets.length;if(0<morphTargetsLength){morphTargetsPosition=[];for(var i=0;i<morphTargetsLength;i++)morphTargetsPosition[i]={name:morphTargets[i].name,data:[]};this.morphTargets.position=morphTargetsPosition}var morphTargetsNormal,morphNormals=geometry.morphNormals,morphNormalsLength=morphNormals.length;if(0<morphNormalsLength){morphTargetsNormal=[];for(i=0;i<morphNormalsLength;i++)morphTargetsNormal[i]={name:morphNormals[i].name,data:[]};this.morphTargets.normal=morphTargetsNormal}var skinIndices=geometry.skinIndices,skinWeights=geometry.skinWeights,hasSkinIndices=skinIndices.length===vertices.length,hasSkinWeights=skinWeights.length===vertices.length;0<vertices.length&&0===faces.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(i=0;i<faces.length;i++){var face=faces[i];this.vertices.push(vertices[face.a],vertices[face.b],vertices[face.c]);var vertexNormals=face.vertexNormals;if(3===vertexNormals.length)this.normals.push(vertexNormals[0],vertexNormals[1],vertexNormals[2]);else{var normal=face.normal;this.normals.push(normal,normal,normal)}var vertexUvs,vertexColors=face.vertexColors;if(3===vertexColors.length)this.colors.push(vertexColors[0],vertexColors[1],vertexColors[2]);else{var color=face.color;this.colors.push(color,color,color)}if(!0===hasFaceVertexUv)void 0!==(vertexUvs=faceVertexUvs[0][i])?this.uvs.push(vertexUvs[0],vertexUvs[1],vertexUvs[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",i),this.uvs.push(new Vector2,new Vector2,new Vector2));if(!0===hasFaceVertexUv2)void 0!==(vertexUvs=faceVertexUvs[1][i])?this.uvs2.push(vertexUvs[0],vertexUvs[1],vertexUvs[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",i),this.uvs2.push(new Vector2,new Vector2,new Vector2));for(var j=0;j<morphTargetsLength;j++){var morphTarget=morphTargets[j].vertices;morphTargetsPosition[j].data.push(morphTarget[face.a],morphTarget[face.b],morphTarget[face.c])}for(j=0;j<morphNormalsLength;j++){var morphNormal=morphNormals[j].vertexNormals[i];morphTargetsNormal[j].data.push(morphNormal.a,morphNormal.b,morphNormal.c)}hasSkinIndices&&this.skinIndices.push(skinIndices[face.a],skinIndices[face.b],skinIndices[face.c]),hasSkinWeights&&this.skinWeights.push(skinWeights[face.a],skinWeights[face.b],skinWeights[face.c])}return this.computeGroups(geometry),this.verticesNeedUpdate=geometry.verticesNeedUpdate,this.normalsNeedUpdate=geometry.normalsNeedUpdate,this.colorsNeedUpdate=geometry.colorsNeedUpdate,this.uvsNeedUpdate=geometry.uvsNeedUpdate,this.groupsNeedUpdate=geometry.groupsNeedUpdate,this}});var bufferGeometryId=1;function BufferGeometry(){Object.defineProperty(this,"id",{value:bufferGeometryId+=2}),this.uuid=_Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function BoxGeometry(width,height,depth,widthSegments,heightSegments,depthSegments){Geometry.call(this),this.type="BoxGeometry",this.parameters={width:width,height:height,depth:depth,widthSegments:widthSegments,heightSegments:heightSegments,depthSegments:depthSegments},this.fromBufferGeometry(new BoxBufferGeometry(width,height,depth,widthSegments,heightSegments,depthSegments)),this.mergeVertices()}function BoxBufferGeometry(width,height,depth,widthSegments,heightSegments,depthSegments){BufferGeometry.call(this),this.type="BoxBufferGeometry",this.parameters={width:width,height:height,depth:depth,widthSegments:widthSegments,heightSegments:heightSegments,depthSegments:depthSegments};var scope=this;width=width||1,height=height||1,depth=depth||1,widthSegments=Math.floor(widthSegments)||1,heightSegments=Math.floor(heightSegments)||1,depthSegments=Math.floor(depthSegments)||1;var indices=[],vertices=[],normals=[],uvs=[],numberOfVertices=0,groupStart=0;function buildPlane(u,v,w,udir,vdir,width,height,depth,gridX,gridY,materialIndex){var ix,iy,segmentWidth=width/gridX,segmentHeight=height/gridY,widthHalf=width/2,heightHalf=height/2,depthHalf=depth/2,gridX1=gridX+1,gridY1=gridY+1,vertexCounter=0,groupCount=0,vector=new Vector3;for(iy=0;iy<gridY1;iy++){var y=iy*segmentHeight-heightHalf;for(ix=0;ix<gridX1;ix++){var x=ix*segmentWidth-widthHalf;vector[u]=x*udir,vector[v]=y*vdir,vector[w]=depthHalf,vertices.push(vector.x,vector.y,vector.z),vector[u]=0,vector[v]=0,vector[w]=0<depth?1:-1,normals.push(vector.x,vector.y,vector.z),uvs.push(ix/gridX),uvs.push(1-iy/gridY),vertexCounter+=1}}for(iy=0;iy<gridY;iy++)for(ix=0;ix<gridX;ix++){var a=numberOfVertices+ix+gridX1*iy,b=numberOfVertices+ix+gridX1*(iy+1),c=numberOfVertices+(ix+1)+gridX1*(iy+1),d=numberOfVertices+(ix+1)+gridX1*iy;indices.push(a,b,d),indices.push(b,c,d),groupCount+=6}scope.addGroup(groupStart,groupCount,materialIndex),groupStart+=groupCount,numberOfVertices+=vertexCounter}buildPlane("z","y","x",-1,-1,depth,height,width,depthSegments,heightSegments,0),buildPlane("z","y","x",1,-1,depth,height,-width,depthSegments,heightSegments,1),buildPlane("x","z","y",1,1,width,depth,height,widthSegments,depthSegments,2),buildPlane("x","z","y",1,-1,width,depth,-height,widthSegments,depthSegments,3),buildPlane("x","y","z",1,-1,width,height,depth,widthSegments,heightSegments,4),buildPlane("x","y","z",-1,-1,width,height,-depth,widthSegments,heightSegments,5),this.setIndex(indices),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("normal",new Float32BufferAttribute(normals,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}function PlaneGeometry(width,height,widthSegments,heightSegments){Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments},this.fromBufferGeometry(new PlaneBufferGeometry(width,height,widthSegments,heightSegments)),this.mergeVertices()}function PlaneBufferGeometry(width,height,widthSegments,heightSegments){BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};var ix,iy,width_half=(width=width||1)/2,height_half=(height=height||1)/2,gridX=Math.floor(widthSegments)||1,gridY=Math.floor(heightSegments)||1,gridX1=gridX+1,gridY1=gridY+1,segment_width=width/gridX,segment_height=height/gridY,indices=[],vertices=[],normals=[],uvs=[];for(iy=0;iy<gridY1;iy++){var y=iy*segment_height-height_half;for(ix=0;ix<gridX1;ix++){var x=ix*segment_width-width_half;vertices.push(x,-y,0),normals.push(0,0,1),uvs.push(ix/gridX),uvs.push(1-iy/gridY)}}for(iy=0;iy<gridY;iy++)for(ix=0;ix<gridX;ix++){var a=ix+gridX1*iy,b=ix+gridX1*(iy+1),c=ix+1+gridX1*(iy+1),d=ix+1+gridX1*iy;indices.push(a,b,d),indices.push(b,c,d)}this.setIndex(indices),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("normal",new Float32BufferAttribute(normals,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(index){Array.isArray(index)?this.index=new(65535<arrayMax(index)?Uint32BufferAttribute:Uint16BufferAttribute)(index,1):this.index=index},addAttribute:function(name,attribute){return attribute&&attribute.isBufferAttribute||attribute&&attribute.isInterleavedBufferAttribute?("index"===name?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(attribute)):this.attributes[name]=attribute,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(name,new BufferAttribute(attribute,arguments[2])))},getAttribute:function(name){return this.attributes[name]},removeAttribute:function(name){return delete this.attributes[name],this},addGroup:function(start,count,materialIndex){this.groups.push({start:start,count:count,materialIndex:void 0!==materialIndex?materialIndex:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(start,count){this.drawRange.start=start,this.drawRange.count=count},applyMatrix:function(matrix){var position=this.attributes.position;void 0!==position&&(matrix.applyToBufferAttribute(position),position.needsUpdate=!0);var normal=this.attributes.normal;void 0!==normal&&((new Matrix3).getNormalMatrix(matrix).applyToBufferAttribute(normal),normal.needsUpdate=!0);var tangent=this.attributes.tangent;void 0!==tangent&&((new Matrix3).getNormalMatrix(matrix).applyToBufferAttribute(tangent),tangent.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var m1=new Matrix4;return function(angle){return m1.makeRotationX(angle),this.applyMatrix(m1),this}}(),rotateY:function(){var m1=new Matrix4;return function(angle){return m1.makeRotationY(angle),this.applyMatrix(m1),this}}(),rotateZ:function(){var m1=new Matrix4;return function(angle){return m1.makeRotationZ(angle),this.applyMatrix(m1),this}}(),translate:function(){var m1=new Matrix4;return function(x,y,z){return m1.makeTranslation(x,y,z),this.applyMatrix(m1),this}}(),scale:function(){var m1=new Matrix4;return function(x,y,z){return m1.makeScale(x,y,z),this.applyMatrix(m1),this}}(),lookAt:function(){var obj=new Object3D;return function(vector){obj.lookAt(vector),obj.updateMatrix(),this.applyMatrix(obj.matrix)}}(),center:function(){var offset=new Vector3;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(offset).negate(),this.translate(offset.x,offset.y,offset.z),this}}(),setFromObject:function(object){var geometry=object.geometry;if(object.isPoints||object.isLine){var positions=new Float32BufferAttribute(3*geometry.vertices.length,3),colors=new Float32BufferAttribute(3*geometry.colors.length,3);if(this.addAttribute("position",positions.copyVector3sArray(geometry.vertices)),this.addAttribute("color",colors.copyColorsArray(geometry.colors)),geometry.lineDistances&&geometry.lineDistances.length===geometry.vertices.length){var lineDistances=new Float32BufferAttribute(geometry.lineDistances.length,1);this.addAttribute("lineDistance",lineDistances.copyArray(geometry.lineDistances))}null!==geometry.boundingSphere&&(this.boundingSphere=geometry.boundingSphere.clone()),null!==geometry.boundingBox&&(this.boundingBox=geometry.boundingBox.clone())}else object.isMesh&&geometry&&geometry.isGeometry&&this.fromGeometry(geometry);return this},setFromPoints:function(points){for(var position=[],i=0,l=points.length;i<l;i++){var point=points[i];position.push(point.x,point.y,point.z||0)}return this.addAttribute("position",new Float32BufferAttribute(position,3)),this},updateFromObject:function(object){var attribute,geometry=object.geometry;if(object.isMesh){var direct=geometry.__directGeometry;if(!0===geometry.elementsNeedUpdate&&(direct=void 0,geometry.elementsNeedUpdate=!1),void 0===direct)return this.fromGeometry(geometry);direct.verticesNeedUpdate=geometry.verticesNeedUpdate,direct.normalsNeedUpdate=geometry.normalsNeedUpdate,direct.colorsNeedUpdate=geometry.colorsNeedUpdate,direct.uvsNeedUpdate=geometry.uvsNeedUpdate,direct.groupsNeedUpdate=geometry.groupsNeedUpdate,geometry.verticesNeedUpdate=!1,geometry.normalsNeedUpdate=!1,geometry.colorsNeedUpdate=!1,geometry.uvsNeedUpdate=!1,geometry.groupsNeedUpdate=!1,geometry=direct}return!0===geometry.verticesNeedUpdate&&(void 0!==(attribute=this.attributes.position)&&(attribute.copyVector3sArray(geometry.vertices),attribute.needsUpdate=!0),geometry.verticesNeedUpdate=!1),!0===geometry.normalsNeedUpdate&&(void 0!==(attribute=this.attributes.normal)&&(attribute.copyVector3sArray(geometry.normals),attribute.needsUpdate=!0),geometry.normalsNeedUpdate=!1),!0===geometry.colorsNeedUpdate&&(void 0!==(attribute=this.attributes.color)&&(attribute.copyColorsArray(geometry.colors),attribute.needsUpdate=!0),geometry.colorsNeedUpdate=!1),geometry.uvsNeedUpdate&&(void 0!==(attribute=this.attributes.uv)&&(attribute.copyVector2sArray(geometry.uvs),attribute.needsUpdate=!0),geometry.uvsNeedUpdate=!1),geometry.lineDistancesNeedUpdate&&(void 0!==(attribute=this.attributes.lineDistance)&&(attribute.copyArray(geometry.lineDistances),attribute.needsUpdate=!0),geometry.lineDistancesNeedUpdate=!1),geometry.groupsNeedUpdate&&(geometry.computeGroups(object.geometry),this.groups=geometry.groups,geometry.groupsNeedUpdate=!1),this},fromGeometry:function(geometry){return geometry.__directGeometry=(new DirectGeometry).fromGeometry(geometry),this.fromDirectGeometry(geometry.__directGeometry)},fromDirectGeometry:function(geometry){var positions=new Float32Array(3*geometry.vertices.length);if(this.addAttribute("position",new BufferAttribute(positions,3).copyVector3sArray(geometry.vertices)),0<geometry.normals.length){var normals=new Float32Array(3*geometry.normals.length);this.addAttribute("normal",new BufferAttribute(normals,3).copyVector3sArray(geometry.normals))}if(0<geometry.colors.length){var colors=new Float32Array(3*geometry.colors.length);this.addAttribute("color",new BufferAttribute(colors,3).copyColorsArray(geometry.colors))}if(0<geometry.uvs.length){var uvs=new Float32Array(2*geometry.uvs.length);this.addAttribute("uv",new BufferAttribute(uvs,2).copyVector2sArray(geometry.uvs))}if(0<geometry.uvs2.length){var uvs2=new Float32Array(2*geometry.uvs2.length);this.addAttribute("uv2",new BufferAttribute(uvs2,2).copyVector2sArray(geometry.uvs2))}for(var name in this.groups=geometry.groups,geometry.morphTargets){for(var array=[],morphTargets=geometry.morphTargets[name],i=0,l=morphTargets.length;i<l;i++){var morphTarget=morphTargets[i],attribute=new Float32BufferAttribute(3*morphTarget.data.length,3);attribute.name=morphTarget.name,array.push(attribute.copyVector3sArray(morphTarget.data))}this.morphAttributes[name]=array}if(0<geometry.skinIndices.length){var skinIndices=new Float32BufferAttribute(4*geometry.skinIndices.length,4);this.addAttribute("skinIndex",skinIndices.copyVector4sArray(geometry.skinIndices))}if(0<geometry.skinWeights.length){var skinWeights=new Float32BufferAttribute(4*geometry.skinWeights.length,4);this.addAttribute("skinWeight",skinWeights.copyVector4sArray(geometry.skinWeights))}return null!==geometry.boundingSphere&&(this.boundingSphere=geometry.boundingSphere.clone()),null!==geometry.boundingBox&&(this.boundingBox=geometry.boundingBox.clone()),this},computeBoundingBox:function(){var box=new Box3;return function(){null===this.boundingBox&&(this.boundingBox=new Box3);var position=this.attributes.position,morphAttributesPosition=this.morphAttributes.position;if(void 0!==position){if(this.boundingBox.setFromBufferAttribute(position),morphAttributesPosition)for(var i=0,il=morphAttributesPosition.length;i<il;i++){var morphAttribute=morphAttributesPosition[i];box.setFromBufferAttribute(morphAttribute),this.boundingBox.expandByPoint(box.min),this.boundingBox.expandByPoint(box.max)}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var box=new Box3,boxMorphTargets=new Box3,vector=new Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var position=this.attributes.position,morphAttributesPosition=this.morphAttributes.position;if(position){var center=this.boundingSphere.center;if(box.setFromBufferAttribute(position),morphAttributesPosition)for(var i=0,il=morphAttributesPosition.length;i<il;i++){var morphAttribute=morphAttributesPosition[i];boxMorphTargets.setFromBufferAttribute(morphAttribute),box.expandByPoint(boxMorphTargets.min),box.expandByPoint(boxMorphTargets.max)}box.getCenter(center);var maxRadiusSq=0;for(i=0,il=position.count;i<il;i++)vector.fromBufferAttribute(position,i),maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(vector));if(morphAttributesPosition)for(i=0,il=morphAttributesPosition.length;i<il;i++)for(var j=0,jl=(morphAttribute=morphAttributesPosition[i]).count;j<jl;j++)vector.fromBufferAttribute(morphAttribute,j),maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(vector));this.boundingSphere.radius=Math.sqrt(maxRadiusSq),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var index=this.index,attributes=this.attributes;if(attributes.position){var positions=attributes.position.array;if(void 0===attributes.normal)this.addAttribute("normal",new BufferAttribute(new Float32Array(positions.length),3));else for(var array=attributes.normal.array,i=0,il=array.length;i<il;i++)array[i]=0;var vA,vB,vC,normals=attributes.normal.array,pA=new Vector3,pB=new Vector3,pC=new Vector3,cb=new Vector3,ab=new Vector3;if(index){var indices=index.array;for(i=0,il=index.count;i<il;i+=3)vA=3*indices[i+0],vB=3*indices[i+1],vC=3*indices[i+2],pA.fromArray(positions,vA),pB.fromArray(positions,vB),pC.fromArray(positions,vC),cb.subVectors(pC,pB),ab.subVectors(pA,pB),cb.cross(ab),normals[vA]+=cb.x,normals[1+vA]+=cb.y,normals[2+vA]+=cb.z,normals[vB]+=cb.x,normals[1+vB]+=cb.y,normals[2+vB]+=cb.z,normals[vC]+=cb.x,normals[1+vC]+=cb.y,normals[2+vC]+=cb.z}else for(i=0,il=positions.length;i<il;i+=9)pA.fromArray(positions,i),pB.fromArray(positions,i+3),pC.fromArray(positions,i+6),cb.subVectors(pC,pB),ab.subVectors(pA,pB),cb.cross(ab),normals[i]=cb.x,normals[i+1]=cb.y,normals[i+2]=cb.z,normals[i+3]=cb.x,normals[i+4]=cb.y,normals[i+5]=cb.z,normals[i+6]=cb.x,normals[i+7]=cb.y,normals[i+8]=cb.z;this.normalizeNormals(),attributes.normal.needsUpdate=!0}},merge:function(geometry,offset){if(geometry&&geometry.isBufferGeometry){void 0===offset&&(offset=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var attributes=this.attributes;for(var key in attributes)if(void 0!==geometry.attributes[key])for(var attributeArray1=attributes[key].array,attribute2=geometry.attributes[key],attributeArray2=attribute2.array,attributeOffset=attribute2.itemSize*offset,length=Math.min(attributeArray2.length,attributeArray1.length-attributeOffset),i=0,j=attributeOffset;i<length;i++,j++)attributeArray1[j]=attributeArray2[i];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",geometry)},normalizeNormals:function(){var vector=new Vector3;return function(){for(var normals=this.attributes.normal,i=0,il=normals.count;i<il;i++)vector.x=normals.getX(i),vector.y=normals.getY(i),vector.z=normals.getZ(i),vector.normalize(),normals.setXYZ(i,vector.x,vector.y,vector.z)}}(),toNonIndexed:function(){function convertBufferAttribute(attribute,indices){for(var array=attribute.array,itemSize=attribute.itemSize,array2=new array.constructor(indices.length*itemSize),index=0,index2=0,i=0,l=indices.length;i<l;i++){index=indices[i]*itemSize;for(var j=0;j<itemSize;j++)array2[index2++]=array[index++]}return new BufferAttribute(array2,itemSize)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var geometry2=new BufferGeometry,indices=this.index.array,attributes=this.attributes;for(var name in attributes){var newAttribute=convertBufferAttribute(attributes[name],indices);geometry2.addAttribute(name,newAttribute)}var morphAttributes=this.morphAttributes;for(name in morphAttributes){for(var morphArray=[],morphAttribute=morphAttributes[name],i=0,il=morphAttribute.length;i<il;i++){newAttribute=convertBufferAttribute(morphAttribute[i],indices);morphArray.push(newAttribute)}geometry2.morphAttributes[name]=morphArray}for(var groups=this.groups,l=(i=0,groups.length);i<l;i++){var group=groups[i];geometry2.addGroup(group.start,group.count,group.materialIndex)}return geometry2},toJSON:function(){var data={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(data.uuid=this.uuid,data.type=this.type,""!==this.name&&(data.name=this.name),0<Object.keys(this.userData).length&&(data.userData=this.userData),void 0!==this.parameters){var parameters=this.parameters;for(var key in parameters)void 0!==parameters[key]&&(data[key]=parameters[key]);return data}data.data={attributes:{}};var index=this.index;null!==index&&(data.data.index={type:index.array.constructor.name,array:Array.prototype.slice.call(index.array)});var attributes=this.attributes;for(var key in attributes){var attributeData={itemSize:(attribute=attributes[key]).itemSize,type:attribute.array.constructor.name,array:Array.prototype.slice.call(attribute.array),normalized:attribute.normalized};""!==attribute.name&&(attributeData.name=attribute.name),data.data.attributes[key]=attributeData}var morphAttributes={},hasMorphAttributes=!1;for(var key in this.morphAttributes){for(var attributeArray=this.morphAttributes[key],array=[],i=0,il=attributeArray.length;i<il;i++){var attribute;attributeData={itemSize:(attribute=attributeArray[i]).itemSize,type:attribute.array.constructor.name,array:Array.prototype.slice.call(attribute.array),normalized:attribute.normalized};""!==attribute.name&&(attributeData.name=attribute.name),array.push(attributeData)}0<array.length&&(morphAttributes[key]=array,hasMorphAttributes=!0)}hasMorphAttributes&&(data.data.morphAttributes=morphAttributes);var groups=this.groups;0<groups.length&&(data.data.groups=JSON.parse(JSON.stringify(groups)));var boundingSphere=this.boundingSphere;return null!==boundingSphere&&(data.data.boundingSphere={center:boundingSphere.center.toArray(),radius:boundingSphere.radius}),data},clone:function(){return(new BufferGeometry).copy(this)},copy:function(source){var name,i,l;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=source.name;var index=source.index;null!==index&&this.setIndex(index.clone());var attributes=source.attributes;for(name in attributes){var attribute=attributes[name];this.addAttribute(name,attribute.clone())}var morphAttributes=source.morphAttributes;for(name in morphAttributes){var array=[],morphAttribute=morphAttributes[name];for(i=0,l=morphAttribute.length;i<l;i++)array.push(morphAttribute[i].clone());this.morphAttributes[name]=array}var groups=source.groups;for(i=0,l=groups.length;i<l;i++){var group=groups[i];this.addGroup(group.start,group.count,group.materialIndex)}var boundingBox=source.boundingBox;null!==boundingBox&&(this.boundingBox=boundingBox.clone());var boundingSphere=source.boundingSphere;return null!==boundingSphere&&(this.boundingSphere=boundingSphere.clone()),this.drawRange.start=source.drawRange.start,this.drawRange.count=source.drawRange.count,this.userData=source.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(BoxGeometry.prototype=Object.create(Geometry.prototype)).constructor=BoxGeometry,(BoxBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=BoxBufferGeometry,(PlaneGeometry.prototype=Object.create(Geometry.prototype)).constructor=PlaneGeometry,(PlaneBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=PlaneBufferGeometry;var materialId=0;function Material(){Object.defineProperty(this,"id",{value:materialId++}),this.uuid=_Math.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=NormalBlending,this.side=FrontSide,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=NoColors,this.opacity=1,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},setValues:function(values){if(void 0!==values)for(var key in values){var newValue=values[key];if(void 0!==newValue)if("shading"!==key){var currentValue=this[key];void 0!==currentValue?currentValue&&currentValue.isColor?currentValue.set(newValue):currentValue&&currentValue.isVector3&&newValue&&newValue.isVector3?currentValue.copy(newValue):this[key]=newValue:console.warn("THREE."+this.type+": '"+key+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===newValue;else console.warn("THREE.Material: '"+key+"' parameter is undefined.")}},toJSON:function(meta){var isRoot=void 0===meta||"string"==typeof meta;isRoot&&(meta={textures:{},images:{}});var data={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function extractFromCache(cache){var values=[];for(var key in cache){var data=cache[key];delete data.metadata,values.push(data)}return values}if(data.uuid=this.uuid,data.type=this.type,""!==this.name&&(data.name=this.name),this.color&&this.color.isColor&&(data.color=this.color.getHex()),void 0!==this.roughness&&(data.roughness=this.roughness),void 0!==this.metalness&&(data.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(data.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(data.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(data.specular=this.specular.getHex()),void 0!==this.shininess&&(data.shininess=this.shininess),void 0!==this.clearCoat&&(data.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(data.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(data.map=this.map.toJSON(meta).uuid),this.matcap&&this.matcap.isTexture&&(data.matcap=this.matcap.toJSON(meta).uuid),this.alphaMap&&this.alphaMap.isTexture&&(data.alphaMap=this.alphaMap.toJSON(meta).uuid),this.lightMap&&this.lightMap.isTexture&&(data.lightMap=this.lightMap.toJSON(meta).uuid),this.aoMap&&this.aoMap.isTexture&&(data.aoMap=this.aoMap.toJSON(meta).uuid,data.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(data.bumpMap=this.bumpMap.toJSON(meta).uuid,data.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(data.normalMap=this.normalMap.toJSON(meta).uuid,data.normalMapType=this.normalMapType,data.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(data.displacementMap=this.displacementMap.toJSON(meta).uuid,data.displacementScale=this.displacementScale,data.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(data.roughnessMap=this.roughnessMap.toJSON(meta).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(data.metalnessMap=this.metalnessMap.toJSON(meta).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(data.emissiveMap=this.emissiveMap.toJSON(meta).uuid),this.specularMap&&this.specularMap.isTexture&&(data.specularMap=this.specularMap.toJSON(meta).uuid),this.envMap&&this.envMap.isTexture&&(data.envMap=this.envMap.toJSON(meta).uuid,data.reflectivity=this.reflectivity,void 0!==this.combine&&(data.combine=this.combine),void 0!==this.envMapIntensity&&(data.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(data.gradientMap=this.gradientMap.toJSON(meta).uuid),void 0!==this.size&&(data.size=this.size),void 0!==this.sizeAttenuation&&(data.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(data.blending=this.blending),!0===this.flatShading&&(data.flatShading=this.flatShading),this.side!==FrontSide&&(data.side=this.side),this.vertexColors!==NoColors&&(data.vertexColors=this.vertexColors),this.opacity<1&&(data.opacity=this.opacity),!0===this.transparent&&(data.transparent=this.transparent),data.depthFunc=this.depthFunc,data.depthTest=this.depthTest,data.depthWrite=this.depthWrite,0!==this.rotation&&(data.rotation=this.rotation),!0===this.polygonOffset&&(data.polygonOffset=!0),0!==this.polygonOffsetFactor&&(data.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(data.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(data.linewidth=this.linewidth),void 0!==this.dashSize&&(data.dashSize=this.dashSize),void 0!==this.gapSize&&(data.gapSize=this.gapSize),void 0!==this.scale&&(data.scale=this.scale),!0===this.dithering&&(data.dithering=!0),0<this.alphaTest&&(data.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(data.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(data.wireframe=this.wireframe),1<this.wireframeLinewidth&&(data.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(data.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(data.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(data.morphTargets=!0),!0===this.skinning&&(data.skinning=!0),!1===this.visible&&(data.visible=!1),"{}"!==JSON.stringify(this.userData)&&(data.userData=this.userData),isRoot){var textures=extractFromCache(meta.textures),images=extractFromCache(meta.images);0<textures.length&&(data.textures=textures),0<images.length&&(data.images=images)}return data},clone:function(){return(new this.constructor).copy(this)},copy:function(source){this.name=source.name,this.fog=source.fog,this.lights=source.lights,this.blending=source.blending,this.side=source.side,this.flatShading=source.flatShading,this.vertexColors=source.vertexColors,this.opacity=source.opacity,this.transparent=source.transparent,this.blendSrc=source.blendSrc,this.blendDst=source.blendDst,this.blendEquation=source.blendEquation,this.blendSrcAlpha=source.blendSrcAlpha,this.blendDstAlpha=source.blendDstAlpha,this.blendEquationAlpha=source.blendEquationAlpha,this.depthFunc=source.depthFunc,this.depthTest=source.depthTest,this.depthWrite=source.depthWrite,this.colorWrite=source.colorWrite,this.precision=source.precision,this.polygonOffset=source.polygonOffset,this.polygonOffsetFactor=source.polygonOffsetFactor,this.polygonOffsetUnits=source.polygonOffsetUnits,this.dithering=source.dithering,this.alphaTest=source.alphaTest,this.premultipliedAlpha=source.premultipliedAlpha,this.visible=source.visible,this.userData=JSON.parse(JSON.stringify(source.userData)),this.clipShadows=source.clipShadows,this.clipIntersection=source.clipIntersection;var srcPlanes=source.clippingPlanes,dstPlanes=null;if(null!==srcPlanes){var n=srcPlanes.length;dstPlanes=new Array(n);for(var i=0;i!==n;++i)dstPlanes[i]=srcPlanes[i].clone()}return this.clippingPlanes=dstPlanes,this.shadowSide=source.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var v,segCenter,segDir,diff,barycoord,v0,vab,vac,vbc,vap,vbp,vcp,default_vertex="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",default_fragment="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function ShaderMaterial(parameters){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==parameters&&(void 0!==parameters.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(parameters))}function Ray(origin,direction){this.origin=void 0!==origin?origin:new Vector3,this.direction=void 0!==direction?direction:new Vector3}function Triangle(a,b,c){this.a=void 0!==a?a:new Vector3,this.b=void 0!==b?b:new Vector3,this.c=void 0!==c?c:new Vector3}function MeshBasicMaterial(parameters){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(parameters)}function Mesh(geometry,material){Object3D.call(this),this.type="Mesh",this.geometry=void 0!==geometry?geometry:new BufferGeometry,this.material=void 0!==material?material:new MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=TrianglesDrawMode,this.updateMorphTargets()}function WebGLBackground(renderer,state,objects,premultipliedAlpha){var planeMesh,boxMesh,clearColor=new Color(0),clearAlpha=0,currentBackground=null,currentBackgroundVersion=0;function setClear(color,alpha){state.buffers.color.setClear(color.r,color.g,color.b,alpha,premultipliedAlpha)}return{getClearColor:function(){return clearColor},setClearColor:function(color,alpha){clearColor.set(color),setClear(clearColor,clearAlpha=void 0!==alpha?alpha:1)},getClearAlpha:function(){return clearAlpha},setClearAlpha:function(alpha){setClear(clearColor,clearAlpha=alpha)},render:function(renderList,scene,camera,forceClear){var background=scene.background,vr=renderer.vr,session=vr.getSession&&vr.getSession();if(session&&"additive"===session.environmentBlendMode&&(background=null),null===background?(setClear(clearColor,clearAlpha),currentBackground=null,currentBackgroundVersion=0):background&&background.isColor&&(setClear(background,1),forceClear=!0,currentBackground=null,currentBackgroundVersion=0),(renderer.autoClear||forceClear)&&renderer.clear(renderer.autoClearColor,renderer.autoClearDepth,renderer.autoClearStencil),background&&(background.isCubeTexture||background.isWebGLRenderTargetCube)){void 0===boxMesh&&((boxMesh=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({type:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.cube.uniforms),vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),boxMesh.geometry.removeAttribute("uv"),boxMesh.onBeforeRender=function(renderer,scene,camera){this.matrixWorld.copyPosition(camera.matrixWorld)},Object.defineProperty(boxMesh.material,"map",{get:function(){return this.uniforms.tCube.value}}),objects.update(boxMesh));var texture=background.isWebGLRenderTargetCube?background.texture:background;boxMesh.material.uniforms.tCube.value=texture,boxMesh.material.uniforms.tFlip.value=background.isWebGLRenderTargetCube?1:-1,currentBackground===background&&currentBackgroundVersion===texture.version||(boxMesh.material.needsUpdate=!0,currentBackground=background,currentBackgroundVersion=texture.version),renderList.unshift(boxMesh,boxMesh.geometry,boxMesh.material,0,0,null)}else background&&background.isTexture&&(void 0===planeMesh&&((planeMesh=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({type:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(planeMesh.material,"map",{get:function(){return this.uniforms.t2D.value}}),objects.update(planeMesh)),!0===(planeMesh.material.uniforms.t2D.value=background).matrixAutoUpdate&&background.updateMatrix(),planeMesh.material.uniforms.uvTransform.value.copy(background.matrix),currentBackground===background&&currentBackgroundVersion===background.version||(planeMesh.material.needsUpdate=!0,currentBackgroundVersion=(currentBackground=background).version),renderList.unshift(planeMesh,planeMesh.geometry,planeMesh.material,0,0,null))}}}function WebGLBufferRenderer(gl,extensions,info,capabilities){var mode;this.setMode=function(value){mode=value},this.render=function(start,count){gl.drawArrays(mode,start,count),info.update(count,mode)},this.renderInstances=function(geometry,start,count){var extension;if(capabilities.isWebGL2)extension=gl;else if(null===(extension=extensions.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");extension[capabilities.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](mode,start,count,geometry.maxInstancedCount),info.update(count,mode,geometry.maxInstancedCount)}}function WebGLCapabilities(gl,extensions,parameters){var maxAnisotropy;function getMaxPrecision(precision){if("highp"===precision){if(0<gl.getShaderPrecisionFormat(35633,36338).precision&&0<gl.getShaderPrecisionFormat(35632,36338).precision)return"highp";precision="mediump"}return"mediump"===precision&&0<gl.getShaderPrecisionFormat(35633,36337).precision&&0<gl.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var isWebGL2="undefined"!=typeof WebGL2RenderingContext&&gl instanceof WebGL2RenderingContext,precision=void 0!==parameters.precision?parameters.precision:"highp",maxPrecision=getMaxPrecision(precision);maxPrecision!==precision&&(console.warn("THREE.WebGLRenderer:",precision,"not supported, using",maxPrecision,"instead."),precision=maxPrecision);var logarithmicDepthBuffer=!0===parameters.logarithmicDepthBuffer,maxTextures=gl.getParameter(34930),maxVertexTextures=gl.getParameter(35660),maxTextureSize=gl.getParameter(3379),maxCubemapSize=gl.getParameter(34076),maxAttributes=gl.getParameter(34921),maxVertexUniforms=gl.getParameter(36347),maxVaryings=gl.getParameter(36348),maxFragmentUniforms=gl.getParameter(36349),vertexTextures=0<maxVertexTextures,floatFragmentTextures=isWebGL2||!!extensions.get("OES_texture_float");return{isWebGL2:isWebGL2,getMaxAnisotropy:function(){if(void 0!==maxAnisotropy)return maxAnisotropy;var extension=extensions.get("EXT_texture_filter_anisotropic");return maxAnisotropy=null!==extension?gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:getMaxPrecision,precision:precision,logarithmicDepthBuffer:logarithmicDepthBuffer,maxTextures:maxTextures,maxVertexTextures:maxVertexTextures,maxTextureSize:maxTextureSize,maxCubemapSize:maxCubemapSize,maxAttributes:maxAttributes,maxVertexUniforms:maxVertexUniforms,maxVaryings:maxVaryings,maxFragmentUniforms:maxFragmentUniforms,vertexTextures:vertexTextures,floatFragmentTextures:floatFragmentTextures,floatVertexTextures:vertexTextures&&floatFragmentTextures,maxSamples:isWebGL2?gl.getParameter(36183):0}}function WebGLClipping(){var scope=this,globalState=null,numGlobalPlanes=0,localClippingEnabled=!1,renderingShadows=!1,plane=new Plane,viewNormalMatrix=new Matrix3,uniform={value:null,needsUpdate:!1};function resetGlobalState(){uniform.value!==globalState&&(uniform.value=globalState,uniform.needsUpdate=0<numGlobalPlanes),scope.numPlanes=numGlobalPlanes,scope.numIntersection=0}function projectPlanes(planes,camera,dstOffset,skipTransform){var nPlanes=null!==planes?planes.length:0,dstArray=null;if(0!==nPlanes){if(dstArray=uniform.value,!0!==skipTransform||null===dstArray){var flatSize=dstOffset+4*nPlanes,viewMatrix=camera.matrixWorldInverse;viewNormalMatrix.getNormalMatrix(viewMatrix),(null===dstArray||dstArray.length<flatSize)&&(dstArray=new Float32Array(flatSize));for(var i=0,i4=dstOffset;i!==nPlanes;++i,i4+=4)plane.copy(planes[i]).applyMatrix4(viewMatrix,viewNormalMatrix),plane.normal.toArray(dstArray,i4),dstArray[i4+3]=plane.constant}uniform.value=dstArray,uniform.needsUpdate=!0}return scope.numPlanes=nPlanes,dstArray}this.uniform=uniform,this.numPlanes=0,this.numIntersection=0,this.init=function(planes,enableLocalClipping,camera){var enabled=0!==planes.length||enableLocalClipping||0!==numGlobalPlanes||localClippingEnabled;return localClippingEnabled=enableLocalClipping,globalState=projectPlanes(planes,camera,0),numGlobalPlanes=planes.length,enabled},this.beginShadows=function(){renderingShadows=!0,projectPlanes(null)},this.endShadows=function(){renderingShadows=!1,resetGlobalState()},this.setState=function(planes,clipIntersection,clipShadows,camera,cache,fromCache){if(!localClippingEnabled||null===planes||0===planes.length||renderingShadows&&!clipShadows)renderingShadows?projectPlanes(null):resetGlobalState();else{var nGlobal=renderingShadows?0:numGlobalPlanes,lGlobal=4*nGlobal,dstArray=cache.clippingState||null;uniform.value=dstArray,dstArray=projectPlanes(planes,camera,lGlobal,fromCache);for(var i=0;i!==lGlobal;++i)dstArray[i]=globalState[i];cache.clippingState=dstArray,this.numIntersection=clipIntersection?this.numPlanes:0,this.numPlanes+=nGlobal}}}function WebGLExtensions(gl){var extensions={};return{get:function(name){if(void 0!==extensions[name])return extensions[name];var extension;switch(name){case"WEBGL_depth_texture":extension=gl.getExtension("WEBGL_depth_texture")||gl.getExtension("MOZ_WEBGL_depth_texture")||gl.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":extension=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":extension=gl.getExtension("WEBGL_compressed_texture_s3tc")||gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":extension=gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:extension=gl.getExtension(name)}return null===extension&&console.warn("THREE.WebGLRenderer: "+name+" extension not supported."),extensions[name]=extension}}}function WebGLGeometries(gl,attributes,info){var geometries={},wireframeAttributes={};function onGeometryDispose(event){var geometry=event.target,buffergeometry=geometries[geometry.id];for(var name in null!==buffergeometry.index&&attributes.remove(buffergeometry.index),buffergeometry.attributes)attributes.remove(buffergeometry.attributes[name]);geometry.removeEventListener("dispose",onGeometryDispose),delete geometries[geometry.id];var attribute=wireframeAttributes[buffergeometry.id];attribute&&(attributes.remove(attribute),delete wireframeAttributes[buffergeometry.id]),info.memory.geometries--}return{get:function(object,geometry){var buffergeometry=geometries[geometry.id];return buffergeometry||(geometry.addEventListener("dispose",onGeometryDispose),geometry.isBufferGeometry?buffergeometry=geometry:geometry.isGeometry&&(void 0===geometry._bufferGeometry&&(geometry._bufferGeometry=(new BufferGeometry).setFromObject(object)),buffergeometry=geometry._bufferGeometry),geometries[geometry.id]=buffergeometry,info.memory.geometries++,buffergeometry)},update:function(geometry){var index=geometry.index,geometryAttributes=geometry.attributes;for(var name in null!==index&&attributes.update(index,34963),geometryAttributes)attributes.update(geometryAttributes[name],34962);var morphAttributes=geometry.morphAttributes;for(var name in morphAttributes)for(var array=morphAttributes[name],i=0,l=array.length;i<l;i++)attributes.update(array[i],34962)},getWireframeAttribute:function(geometry){var attribute=wireframeAttributes[geometry.id];if(attribute)return attribute;var array,indices=[],geometryIndex=geometry.index,geometryAttributes=geometry.attributes;if(null!==geometryIndex)for(var i=0,l=(array=geometryIndex.array).length;i<l;i+=3){var a=array[i+0],b=array[i+1],c=array[i+2];indices.push(a,b,b,c,c,a)}else for(i=0,l=(array=geometryAttributes.position.array).length/3-1;i<l;i+=3){a=i+0,b=i+1,c=i+2;indices.push(a,b,b,c,c,a)}return attribute=new(65535<arrayMax(indices)?Uint32BufferAttribute:Uint16BufferAttribute)(indices,1),attributes.update(attribute,34963),wireframeAttributes[geometry.id]=attribute}}}function WebGLIndexedBufferRenderer(gl,extensions,info,capabilities){var mode,type,bytesPerElement;this.setMode=function(value){mode=value},this.setIndex=function(value){type=value.type,bytesPerElement=value.bytesPerElement},this.render=function(start,count){gl.drawElements(mode,count,type,start*bytesPerElement),info.update(count,mode)},this.renderInstances=function(geometry,start,count){var extension;if(capabilities.isWebGL2)extension=gl;else if(null===(extension=extensions.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");extension[capabilities.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](mode,count,type,start*bytesPerElement,geometry.maxInstancedCount),info.update(count,mode,geometry.maxInstancedCount)}}function WebGLInfo(gl){var render={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:render,programs:null,autoReset:!0,reset:function(){render.frame++,render.calls=0,render.triangles=0,render.points=0,render.lines=0},update:function(count,mode,instanceCount){switch(instanceCount=instanceCount||1,render.calls++,mode){case 4:render.triangles+=instanceCount*(count/3);break;case 5:case 6:render.triangles+=instanceCount*(count-2);break;case 1:render.lines+=instanceCount*(count/2);break;case 3:render.lines+=instanceCount*(count-1);break;case 2:render.lines+=instanceCount*count;break;case 0:render.points+=instanceCount*count;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",mode)}}}}function absNumericalSort(a,b){return Math.abs(b[1])-Math.abs(a[1])}function WebGLMorphtargets(gl){var influencesList={},morphInfluences=new Float32Array(8);return{update:function(object,geometry,material,program){var objectInfluences=object.morphTargetInfluences,length=objectInfluences.length,influences=influencesList[geometry.id];if(void 0===influences){influences=[];for(var i=0;i<length;i++)influences[i]=[i,0];influencesList[geometry.id]=influences}var morphTargets=material.morphTargets&&geometry.morphAttributes.position,morphNormals=material.morphNormals&&geometry.morphAttributes.normal;for(i=0;i<length;i++){0!==(influence=influences[i])[1]&&(morphTargets&&geometry.removeAttribute("morphTarget"+i),morphNormals&&geometry.removeAttribute("morphNormal"+i))}for(i=0;i<length;i++){(influence=influences[i])[0]=i,influence[1]=objectInfluences[i]}for(influences.sort(absNumericalSort),i=0;i<8;i++){var influence;if(influence=influences[i]){var index=influence[0],value=influence[1];if(value){morphTargets&&geometry.addAttribute("morphTarget"+i,morphTargets[index]),morphNormals&&geometry.addAttribute("morphNormal"+i,morphNormals[index]),morphInfluences[i]=value;continue}}morphInfluences[i]=0}program.getUniforms().setValue(gl,"morphTargetInfluences",morphInfluences)}}}function WebGLObjects(geometries,info){var updateList={};return{update:function(object){var frame=info.render.frame,geometry=object.geometry,buffergeometry=geometries.get(object,geometry);return updateList[buffergeometry.id]!==frame&&(geometry.isGeometry&&buffergeometry.updateFromObject(object),geometries.update(buffergeometry),updateList[buffergeometry.id]=frame),buffergeometry},dispose:function(){updateList={}}}}function CubeTexture(images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding){Texture.call(this,images=void 0!==images?images:[],mapping=void 0!==mapping?mapping:CubeReflectionMapping,wrapS,wrapT,magFilter,minFilter,format=void 0!==format?format:RGBFormat,type,anisotropy,encoding),this.flipY=!1}function DataTexture2DArray(data,width,height,depth){Texture.call(this,null),this.image={data:data,width:width,height:height,depth:depth},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1}function DataTexture3D(data,width,height,depth){Texture.call(this,null),this.image={data:data,width:width,height:height,depth:depth},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1}((ShaderMaterial.prototype=Object.create(Material.prototype)).constructor=ShaderMaterial).prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.fragmentShader=source.fragmentShader,this.vertexShader=source.vertexShader,this.uniforms=cloneUniforms(source.uniforms),this.defines=Object.assign({},source.defines),this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.lights=source.lights,this.clipping=source.clipping,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this.extensions=source.extensions,this},ShaderMaterial.prototype.toJSON=function(meta){var data=Material.prototype.toJSON.call(this,meta);for(var name in data.uniforms={},this.uniforms){var value=this.uniforms[name].value;value&&value.isTexture?data.uniforms[name]={type:"t",value:value.toJSON(meta).uuid}:value&&value.isColor?data.uniforms[name]={type:"c",value:value.getHex()}:value&&value.isVector2?data.uniforms[name]={type:"v2",value:value.toArray()}:value&&value.isVector3?data.uniforms[name]={type:"v3",value:value.toArray()}:value&&value.isVector4?data.uniforms[name]={type:"v4",value:value.toArray()}:value&&value.isMatrix3?data.uniforms[name]={type:"m3",value:value.toArray()}:value&&value.isMatrix4?data.uniforms[name]={type:"m4",value:value.toArray()}:data.uniforms[name]={value:value}}0<Object.keys(this.defines).length&&(data.defines=this.defines),data.vertexShader=this.vertexShader,data.fragmentShader=this.fragmentShader;var extensions={};for(var key in this.extensions)!0===this.extensions[key]&&(extensions[key]=!0);return 0<Object.keys(extensions).length&&(data.extensions=extensions),data},Object.assign(Ray.prototype,{set:function(origin,direction){return this.origin.copy(origin),this.direction.copy(direction),this},clone:function(){return(new this.constructor).copy(this)},copy:function(ray){return this.origin.copy(ray.origin),this.direction.copy(ray.direction),this},at:function(t,target){return void 0===target&&(console.warn("THREE.Ray: .at() target is now required"),target=new Vector3),target.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(v){return this.direction.copy(v).sub(this.origin).normalize(),this},recast:function(){var v1=new Vector3;return function(t){return this.origin.copy(this.at(t,v1)),this}}(),closestPointToPoint:function(point,target){void 0===target&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),target=new Vector3),target.subVectors(point,this.origin);var directionDistance=target.dot(this.direction);return directionDistance<0?target.copy(this.origin):target.copy(this.direction).multiplyScalar(directionDistance).add(this.origin)},distanceToPoint:function(point){return Math.sqrt(this.distanceSqToPoint(point))},distanceSqToPoint:function(){var v1=new Vector3;return function(point){var directionDistance=v1.subVectors(point,this.origin).dot(this.direction);return directionDistance<0?this.origin.distanceToSquared(point):(v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin),v1.distanceToSquared(point))}}(),distanceSqToSegment:(segCenter=new Vector3,segDir=new Vector3,diff=new Vector3,function(v0,v1,optionalPointOnRay,optionalPointOnSegment){segCenter.copy(v0).add(v1).multiplyScalar(.5),segDir.copy(v1).sub(v0).normalize(),diff.copy(this.origin).sub(segCenter);var s0,s1,sqrDist,extDet,segExtent=.5*v0.distanceTo(v1),a01=-this.direction.dot(segDir),b0=diff.dot(this.direction),b1=-diff.dot(segDir),c=diff.lengthSq(),det=Math.abs(1-a01*a01);if(0<det)if(s1=a01*b0-b1,extDet=segExtent*det,0<=(s0=a01*b1-b0))if(-extDet<=s1)if(s1<=extDet){var invDet=1/det;sqrDist=(s0*=invDet)*(s0+a01*(s1*=invDet)+2*b0)+s1*(a01*s0+s1+2*b1)+c}else s1=segExtent,sqrDist=-(s0=Math.max(0,-(a01*s1+b0)))*s0+s1*(s1+2*b1)+c;else s1=-segExtent,sqrDist=-(s0=Math.max(0,-(a01*s1+b0)))*s0+s1*(s1+2*b1)+c;else sqrDist=s1<=-extDet?-(s0=Math.max(0,-(-a01*segExtent+b0)))*s0+(s1=0<s0?-segExtent:Math.min(Math.max(-segExtent,-b1),segExtent))*(s1+2*b1)+c:s1<=extDet?(s0=0,(s1=Math.min(Math.max(-segExtent,-b1),segExtent))*(s1+2*b1)+c):-(s0=Math.max(0,-(a01*segExtent+b0)))*s0+(s1=0<s0?segExtent:Math.min(Math.max(-segExtent,-b1),segExtent))*(s1+2*b1)+c;else s1=0<a01?-segExtent:segExtent,sqrDist=-(s0=Math.max(0,-(a01*s1+b0)))*s0+s1*(s1+2*b1)+c;return optionalPointOnRay&&optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin),optionalPointOnSegment&&optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter),sqrDist}),intersectSphere:function(){var v1=new Vector3;return function(sphere,target){v1.subVectors(sphere.center,this.origin);var tca=v1.dot(this.direction),d2=v1.dot(v1)-tca*tca,radius2=sphere.radius*sphere.radius;if(radius2<d2)return null;var thc=Math.sqrt(radius2-d2),t0=tca-thc,t1=tca+thc;return t0<0&&t1<0?null:t0<0?this.at(t1,target):this.at(t0,target)}}(),intersectsSphere:function(sphere){return this.distanceSqToPoint(sphere.center)<=sphere.radius*sphere.radius},distanceToPlane:function(plane){var denominator=plane.normal.dot(this.direction);if(0===denominator)return 0===plane.distanceToPoint(this.origin)?0:null;var t=-(this.origin.dot(plane.normal)+plane.constant)/denominator;return 0<=t?t:null},intersectPlane:function(plane,target){var t=this.distanceToPlane(plane);return null===t?null:this.at(t,target)},intersectsPlane:function(plane){var distToPoint=plane.distanceToPoint(this.origin);return 0===distToPoint||plane.normal.dot(this.direction)*distToPoint<0},intersectBox:function(box,target){var tmin,tmax,tymin,tymax,tzmin,tzmax,invdirx=1/this.direction.x,invdiry=1/this.direction.y,invdirz=1/this.direction.z,origin=this.origin;return tmax=0<=invdirx?(tmin=(box.min.x-origin.x)*invdirx,(box.max.x-origin.x)*invdirx):(tmin=(box.max.x-origin.x)*invdirx,(box.min.x-origin.x)*invdirx),(tymax=0<=invdiry?(tymin=(box.min.y-origin.y)*invdiry,(box.max.y-origin.y)*invdiry):(tymin=(box.max.y-origin.y)*invdiry,(box.min.y-origin.y)*invdiry))<tmin||tmax<tymin?null:((tmin<tymin||tmin!=tmin)&&(tmin=tymin),(tymax<tmax||tmax!=tmax)&&(tmax=tymax),(tzmax=0<=invdirz?(tzmin=(box.min.z-origin.z)*invdirz,(box.max.z-origin.z)*invdirz):(tzmin=(box.max.z-origin.z)*invdirz,(box.min.z-origin.z)*invdirz))<tmin||tmax<tzmin?null:((tmin<tzmin||tmin!=tmin)&&(tmin=tzmin),(tzmax<tmax||tmax!=tmax)&&(tmax=tzmax),tmax<0?null:this.at(0<=tmin?tmin:tmax,target)))},intersectsBox:(v=new Vector3,function(box){return null!==this.intersectBox(box,v)}),intersectTriangle:function(){var diff=new Vector3,edge1=new Vector3,edge2=new Vector3,normal=new Vector3;return function(a,b,c,backfaceCulling,target){edge1.subVectors(b,a),edge2.subVectors(c,a),normal.crossVectors(edge1,edge2);var sign,DdN=this.direction.dot(normal);if(0<DdN){if(backfaceCulling)return null;sign=1}else{if(!(DdN<0))return null;sign=-1,DdN=-DdN}diff.subVectors(this.origin,a);var DdQxE2=sign*this.direction.dot(edge2.crossVectors(diff,edge2));if(DdQxE2<0)return null;var DdE1xQ=sign*this.direction.dot(edge1.cross(diff));if(DdE1xQ<0)return null;if(DdN<DdQxE2+DdE1xQ)return null;var QdN=-sign*diff.dot(normal);return QdN<0?null:this.at(QdN/DdN,target)}}(),applyMatrix4:function(matrix4){return this.origin.applyMatrix4(matrix4),this.direction.transformDirection(matrix4),this},equals:function(ray){return ray.origin.equals(this.origin)&&ray.direction.equals(this.direction)}}),Object.assign(Triangle,{getNormal:(v0=new Vector3,function(a,b,c,target){void 0===target&&(console.warn("THREE.Triangle: .getNormal() target is now required"),target=new Vector3),target.subVectors(c,b),v0.subVectors(a,b),target.cross(v0);var targetLengthSq=target.lengthSq();return 0<targetLengthSq?target.multiplyScalar(1/Math.sqrt(targetLengthSq)):target.set(0,0,0)}),getBarycoord:function(){var v0=new Vector3,v1=new Vector3,v2=new Vector3;return function(point,a,b,c,target){v0.subVectors(c,a),v1.subVectors(b,a),v2.subVectors(point,a);var dot00=v0.dot(v0),dot01=v0.dot(v1),dot02=v0.dot(v2),dot11=v1.dot(v1),dot12=v1.dot(v2),denom=dot00*dot11-dot01*dot01;if(void 0===target&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),target=new Vector3),0==denom)return target.set(-2,-1,-1);var invDenom=1/denom,u=(dot11*dot02-dot01*dot12)*invDenom,v=(dot00*dot12-dot01*dot02)*invDenom;return target.set(1-u-v,v,u)}}(),containsPoint:function(){var v1=new Vector3;return function(point,a,b,c){return Triangle.getBarycoord(point,a,b,c,v1),0<=v1.x&&0<=v1.y&&v1.x+v1.y<=1}}(),getUV:(barycoord=new Vector3,function(point,p1,p2,p3,uv1,uv2,uv3,target){return this.getBarycoord(point,p1,p2,p3,barycoord),target.set(0,0),target.addScaledVector(uv1,barycoord.x),target.addScaledVector(uv2,barycoord.y),target.addScaledVector(uv3,barycoord.z),target})}),Object.assign(Triangle.prototype,{set:function(a,b,c){return this.a.copy(a),this.b.copy(b),this.c.copy(c),this},setFromPointsAndIndices:function(points,i0,i1,i2){return this.a.copy(points[i0]),this.b.copy(points[i1]),this.c.copy(points[i2]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(triangle){return this.a.copy(triangle.a),this.b.copy(triangle.b),this.c.copy(triangle.c),this},getArea:function(){var v0=new Vector3,v1=new Vector3;return function(){return v0.subVectors(this.c,this.b),v1.subVectors(this.a,this.b),.5*v0.cross(v1).length()}}(),getMidpoint:function(target){return void 0===target&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),target=new Vector3),target.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(target){return Triangle.getNormal(this.a,this.b,this.c,target)},getPlane:function(target){return void 0===target&&(console.warn("THREE.Triangle: .getPlane() target is now required"),target=new Vector3),target.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(point,target){return Triangle.getBarycoord(point,this.a,this.b,this.c,target)},containsPoint:function(point){return Triangle.containsPoint(point,this.a,this.b,this.c)},getUV:function(point,uv1,uv2,uv3,result){return Triangle.getUV(point,this.a,this.b,this.c,uv1,uv2,uv3,result)},intersectsBox:function(box){return box.intersectsTriangle(this)},closestPointToPoint:(vab=new Vector3,vac=new Vector3,vbc=new Vector3,vap=new Vector3,vbp=new Vector3,vcp=new Vector3,function(p,target){void 0===target&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),target=new Vector3);var v,w,a=this.a,b=this.b,c=this.c;vab.subVectors(b,a),vac.subVectors(c,a),vap.subVectors(p,a);var d1=vab.dot(vap),d2=vac.dot(vap);if(d1<=0&&d2<=0)return target.copy(a);vbp.subVectors(p,b);var d3=vab.dot(vbp),d4=vac.dot(vbp);if(0<=d3&&d4<=d3)return target.copy(b);var vc=d1*d4-d3*d2;if(vc<=0&&0<=d1&&d3<=0)return v=d1/(d1-d3),target.copy(a).addScaledVector(vab,v);vcp.subVectors(p,c);var d5=vab.dot(vcp),d6=vac.dot(vcp);if(0<=d6&&d5<=d6)return target.copy(c);var vb=d5*d2-d1*d6;if(vb<=0&&0<=d2&&d6<=0)return w=d2/(d2-d6),target.copy(a).addScaledVector(vac,w);var va=d3*d6-d5*d4;if(va<=0&&0<=d4-d3&&0<=d5-d6)return vbc.subVectors(c,b),w=(d4-d3)/(d4-d3+(d5-d6)),target.copy(b).addScaledVector(vbc,w);var denom=1/(va+vb+vc);return v=vb*denom,w=vc*denom,target.copy(a).addScaledVector(vab,v).addScaledVector(vac,w)}),equals:function(triangle){return triangle.a.equals(this.a)&&triangle.b.equals(this.b)&&triangle.c.equals(this.c)}}),((MeshBasicMaterial.prototype=Object.create(Material.prototype)).constructor=MeshBasicMaterial).prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.specularMap=source.specularMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.combine=source.combine,this.reflectivity=source.reflectivity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this},Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,setDrawMode:function(value){this.drawMode=value},copy:function(source){return Object3D.prototype.copy.call(this,source),this.drawMode=source.drawMode,void 0!==source.morphTargetInfluences&&(this.morphTargetInfluences=source.morphTargetInfluences.slice()),void 0!==source.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},source.morphTargetDictionary)),this},updateMorphTargets:function(){var m,ml,name,geometry=this.geometry;if(geometry.isBufferGeometry){var morphAttributes=geometry.morphAttributes,keys=Object.keys(morphAttributes);if(0<keys.length){var morphAttribute=morphAttributes[keys[0]];if(void 0!==morphAttribute)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},m=0,ml=morphAttribute.length;m<ml;m++)name=morphAttribute[m].name||String(m),this.morphTargetInfluences.push(0),this.morphTargetDictionary[name]=m}}else{var morphTargets=geometry.morphTargets;void 0!==morphTargets&&0<morphTargets.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(){var inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere,vA=new Vector3,vB=new Vector3,vC=new Vector3,tempA=new Vector3,tempB=new Vector3,tempC=new Vector3,morphA=new Vector3,morphB=new Vector3,morphC=new Vector3,uvA=new Vector2,uvB=new Vector2,uvC=new Vector2,intersectionPoint=new Vector3,intersectionPointWorld=new Vector3;function checkIntersection(object,material,raycaster,ray,pA,pB,pC,point){if(null===(material.side===BackSide?ray.intersectTriangle(pC,pB,pA,!0,point):ray.intersectTriangle(pA,pB,pC,material.side!==DoubleSide,point)))return null;intersectionPointWorld.copy(point),intersectionPointWorld.applyMatrix4(object.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPointWorld);return distance<raycaster.near||distance>raycaster.far?null:{distance:distance,point:intersectionPointWorld.clone(),object:object}}function checkBufferGeometryIntersection(object,material,raycaster,ray,position,morphPosition,uv,a,b,c){vA.fromBufferAttribute(position,a),vB.fromBufferAttribute(position,b),vC.fromBufferAttribute(position,c);var morphInfluences=object.morphTargetInfluences;if(material.morphTargets&&morphPosition&&morphInfluences){morphA.set(0,0,0),morphB.set(0,0,0),morphC.set(0,0,0);for(var i=0,il=morphPosition.length;i<il;i++){var influence=morphInfluences[i],morphAttribute=morphPosition[i];0!==influence&&(tempA.fromBufferAttribute(morphAttribute,a),tempB.fromBufferAttribute(morphAttribute,b),tempC.fromBufferAttribute(morphAttribute,c),morphA.addScaledVector(tempA.sub(vA),influence),morphB.addScaledVector(tempB.sub(vB),influence),morphC.addScaledVector(tempC.sub(vC),influence))}vA.add(morphA),vB.add(morphB),vC.add(morphC)}var intersection=checkIntersection(object,material,raycaster,ray,vA,vB,vC,intersectionPoint);if(intersection){uv&&(uvA.fromBufferAttribute(uv,a),uvB.fromBufferAttribute(uv,b),uvC.fromBufferAttribute(uv,c),intersection.uv=Triangle.getUV(intersectionPoint,vA,vB,vC,uvA,uvB,uvC,new Vector2));var face=new Face3(a,b,c);Triangle.getNormal(vA,vB,vC,face.normal),intersection.face=face}return intersection}return function(raycaster,intersects){var intersection,geometry=this.geometry,material=this.material,matrixWorld=this.matrixWorld;if(void 0!==material&&(null===geometry.boundingSphere&&geometry.computeBoundingSphere(),sphere.copy(geometry.boundingSphere),sphere.applyMatrix4(matrixWorld),!1!==raycaster.ray.intersectsSphere(sphere)&&(inverseMatrix.getInverse(matrixWorld),ray.copy(raycaster.ray).applyMatrix4(inverseMatrix),null===geometry.boundingBox||!1!==ray.intersectsBox(geometry.boundingBox))))if(geometry.isBufferGeometry){var a,b,c,i,j,il,jl,group,groupMaterial,index=geometry.index,position=geometry.attributes.position,morphPosition=geometry.morphAttributes.position,uv=geometry.attributes.uv,groups=geometry.groups,drawRange=geometry.drawRange;if(null!==index)if(Array.isArray(material))for(i=0,il=groups.length;i<il;i++)for(groupMaterial=material[(group=groups[i]).materialIndex],j=Math.max(group.start,drawRange.start),jl=Math.min(group.start+group.count,drawRange.start+drawRange.count);j<jl;j+=3)a=index.getX(j),b=index.getX(j+1),c=index.getX(j+2),(intersection=checkBufferGeometryIntersection(this,groupMaterial,raycaster,ray,position,morphPosition,uv,a,b,c))&&(intersection.faceIndex=Math.floor(j/3),intersection.face.materialIndex=group.materialIndex,intersects.push(intersection));else for(i=Math.max(0,drawRange.start),il=Math.min(index.count,drawRange.start+drawRange.count);i<il;i+=3)a=index.getX(i),b=index.getX(i+1),c=index.getX(i+2),(intersection=checkBufferGeometryIntersection(this,material,raycaster,ray,position,morphPosition,uv,a,b,c))&&(intersection.faceIndex=Math.floor(i/3),intersects.push(intersection));else if(void 0!==position)if(Array.isArray(material))for(i=0,il=groups.length;i<il;i++)for(groupMaterial=material[(group=groups[i]).materialIndex],j=Math.max(group.start,drawRange.start),jl=Math.min(group.start+group.count,drawRange.start+drawRange.count);j<jl;j+=3)(intersection=checkBufferGeometryIntersection(this,groupMaterial,raycaster,ray,position,morphPosition,uv,a=j,b=j+1,c=j+2))&&(intersection.faceIndex=Math.floor(j/3),intersection.face.materialIndex=group.materialIndex,intersects.push(intersection));else for(i=Math.max(0,drawRange.start),il=Math.min(position.count,drawRange.start+drawRange.count);i<il;i+=3)(intersection=checkBufferGeometryIntersection(this,material,raycaster,ray,position,morphPosition,uv,a=i,b=i+1,c=i+2))&&(intersection.faceIndex=Math.floor(i/3),intersects.push(intersection))}else if(geometry.isGeometry){var fvA,fvB,fvC,uvs,isMultiMaterial=Array.isArray(material),vertices=geometry.vertices,faces=geometry.faces,faceVertexUvs=geometry.faceVertexUvs[0];0<faceVertexUvs.length&&(uvs=faceVertexUvs);for(var f=0,fl=faces.length;f<fl;f++){var face=faces[f],faceMaterial=isMultiMaterial?material[face.materialIndex]:material;if(void 0!==faceMaterial&&(fvA=vertices[face.a],fvB=vertices[face.b],fvC=vertices[face.c],intersection=checkIntersection(this,faceMaterial,raycaster,ray,fvA,fvB,fvC,intersectionPoint))){if(uvs&&uvs[f]){var uvs_f=uvs[f];uvA.copy(uvs_f[0]),uvB.copy(uvs_f[1]),uvC.copy(uvs_f[2]),intersection.uv=Triangle.getUV(intersectionPoint,fvA,fvB,fvC,uvA,uvB,uvC,new Vector2)}intersection.face=face,intersection.faceIndex=f,intersects.push(intersection)}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),((CubeTexture.prototype=Object.create(Texture.prototype)).constructor=CubeTexture).prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(value){this.image=value}}),((DataTexture2DArray.prototype=Object.create(Texture.prototype)).constructor=DataTexture2DArray).prototype.isDataTexture2DArray=!0,((DataTexture3D.prototype=Object.create(Texture.prototype)).constructor=DataTexture3D).prototype.isDataTexture3D=!0;var emptyTexture=new Texture,emptyTexture2dArray=new DataTexture2DArray,emptyTexture3d=new DataTexture3D,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(array,nBlocks,blockSize){var firstElem=array[0];if(firstElem<=0||0<firstElem)return array;var n=nBlocks*blockSize,r=arrayCacheF32[n];if(void 0===r&&(r=new Float32Array(n),arrayCacheF32[n]=r),0!==nBlocks){firstElem.toArray(r,0);for(var i=1,offset=0;i!==nBlocks;++i)offset+=blockSize,array[i].toArray(r,offset)}return r}function arraysEqual(a,b){if(a.length!==b.length)return!1;for(var i=0,l=a.length;i<l;i++)if(a[i]!==b[i])return!1;return!0}function copyArray(a,b){for(var i=0,l=b.length;i<l;i++)a[i]=b[i]}function allocTexUnits(textures,n){var r=arrayCacheI32[n];void 0===r&&(r=new Int32Array(n),arrayCacheI32[n]=r);for(var i=0;i!==n;++i)r[i]=textures.allocateTextureUnit();return r}function setValue1f(gl,v){var cache=this.cache;cache[0]!==v&&(gl.uniform1f(this.addr,v),cache[0]=v)}function setValue1i(gl,v){var cache=this.cache;cache[0]!==v&&(gl.uniform1i(this.addr,v),cache[0]=v)}function setValue2fv(gl,v){var cache=this.cache;if(void 0!==v.x)cache[0]===v.x&&cache[1]===v.y||(gl.uniform2f(this.addr,v.x,v.y),cache[0]=v.x,cache[1]=v.y);else{if(arraysEqual(cache,v))return;gl.uniform2fv(this.addr,v),copyArray(cache,v)}}function setValue3fv(gl,v){var cache=this.cache;if(void 0!==v.x)cache[0]===v.x&&cache[1]===v.y&&cache[2]===v.z||(gl.uniform3f(this.addr,v.x,v.y,v.z),cache[0]=v.x,cache[1]=v.y,cache[2]=v.z);else if(void 0!==v.r)cache[0]===v.r&&cache[1]===v.g&&cache[2]===v.b||(gl.uniform3f(this.addr,v.r,v.g,v.b),cache[0]=v.r,cache[1]=v.g,cache[2]=v.b);else{if(arraysEqual(cache,v))return;gl.uniform3fv(this.addr,v),copyArray(cache,v)}}function setValue4fv(gl,v){var cache=this.cache;if(void 0!==v.x)cache[0]===v.x&&cache[1]===v.y&&cache[2]===v.z&&cache[3]===v.w||(gl.uniform4f(this.addr,v.x,v.y,v.z,v.w),cache[0]=v.x,cache[1]=v.y,cache[2]=v.z,cache[3]=v.w);else{if(arraysEqual(cache,v))return;gl.uniform4fv(this.addr,v),copyArray(cache,v)}}function setValue2fm(gl,v){var cache=this.cache,elements=v.elements;if(void 0===elements){if(arraysEqual(cache,v))return;gl.uniformMatrix2fv(this.addr,!1,v),copyArray(cache,v)}else{if(arraysEqual(cache,elements))return;mat2array.set(elements),gl.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(cache,elements)}}function setValue3fm(gl,v){var cache=this.cache,elements=v.elements;if(void 0===elements){if(arraysEqual(cache,v))return;gl.uniformMatrix3fv(this.addr,!1,v),copyArray(cache,v)}else{if(arraysEqual(cache,elements))return;mat3array.set(elements),gl.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(cache,elements)}}function setValue4fm(gl,v){var cache=this.cache,elements=v.elements;if(void 0===elements){if(arraysEqual(cache,v))return;gl.uniformMatrix4fv(this.addr,!1,v),copyArray(cache,v)}else{if(arraysEqual(cache,elements))return;mat4array.set(elements),gl.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(cache,elements)}}function setValueT1(gl,v,textures){var cache=this.cache,unit=textures.allocateTextureUnit();cache[0]!==unit&&(gl.uniform1i(this.addr,unit),cache[0]=unit),textures.safeSetTexture2D(v||emptyTexture,unit)}function setValueT2DArray1(gl,v,textures){var cache=this.cache,unit=textures.allocateTextureUnit();cache[0]!==unit&&(gl.uniform1i(this.addr,unit),cache[0]=unit),textures.setTexture2DArray(v||emptyTexture2dArray,unit)}function setValueT3D1(gl,v,textures){var cache=this.cache,unit=textures.allocateTextureUnit();cache[0]!==unit&&(gl.uniform1i(this.addr,unit),cache[0]=unit),textures.setTexture3D(v||emptyTexture3d,unit)}function setValueT6(gl,v,textures){var cache=this.cache,unit=textures.allocateTextureUnit();cache[0]!==unit&&(gl.uniform1i(this.addr,unit),cache[0]=unit),textures.safeSetTextureCube(v||emptyCubeTexture,unit)}function setValue2iv(gl,v){var cache=this.cache;arraysEqual(cache,v)||(gl.uniform2iv(this.addr,v),copyArray(cache,v))}function setValue3iv(gl,v){var cache=this.cache;arraysEqual(cache,v)||(gl.uniform3iv(this.addr,v),copyArray(cache,v))}function setValue4iv(gl,v){var cache=this.cache;arraysEqual(cache,v)||(gl.uniform4iv(this.addr,v),copyArray(cache,v))}function setValue1fv(gl,v){var cache=this.cache;arraysEqual(cache,v)||(gl.uniform1fv(this.addr,v),copyArray(cache,v))}function setValue1iv(gl,v){var cache=this.cache;arraysEqual(cache,v)||(gl.uniform1iv(this.addr,v),copyArray(cache,v))}function setValueV2a(gl,v){var cache=this.cache,data=flatten(v,this.size,2);arraysEqual(cache,data)||(gl.uniform2fv(this.addr,data),this.updateCache(data))}function setValueV3a(gl,v){var cache=this.cache,data=flatten(v,this.size,3);arraysEqual(cache,data)||(gl.uniform3fv(this.addr,data),this.updateCache(data))}function setValueV4a(gl,v){var cache=this.cache,data=flatten(v,this.size,4);arraysEqual(cache,data)||(gl.uniform4fv(this.addr,data),this.updateCache(data))}function setValueM2a(gl,v){var cache=this.cache,data=flatten(v,this.size,4);arraysEqual(cache,data)||(gl.uniformMatrix2fv(this.addr,!1,data),this.updateCache(data))}function setValueM3a(gl,v){var cache=this.cache,data=flatten(v,this.size,9);arraysEqual(cache,data)||(gl.uniformMatrix3fv(this.addr,!1,data),this.updateCache(data))}function setValueM4a(gl,v){var cache=this.cache,data=flatten(v,this.size,16);arraysEqual(cache,data)||(gl.uniformMatrix4fv(this.addr,!1,data),this.updateCache(data))}function setValueT1a(gl,v,textures){var cache=this.cache,n=v.length,units=allocTexUnits(textures,n);!1===arraysEqual(cache,units)&&(gl.uniform1iv(this.addr,units),copyArray(cache,units));for(var i=0;i!==n;++i)textures.safeSetTexture2D(v[i]||emptyTexture,units[i])}function setValueT6a(gl,v,textures){var cache=this.cache,n=v.length,units=allocTexUnits(textures,n);!1===arraysEqual(cache,units)&&(gl.uniform1iv(this.addr,units),copyArray(cache,units));for(var i=0;i!==n;++i)textures.safeSetTextureCube(v[i]||emptyCubeTexture,units[i])}function SingleUniform(id,activeInfo,addr){this.id=id,this.addr=addr,this.cache=[],this.setValue=function(type){switch(type){case 5126:return setValue1f;case 35664:return setValue2fv;case 35665:return setValue3fv;case 35666:return setValue4fv;case 35674:return setValue2fm;case 35675:return setValue3fm;case 35676:return setValue4fm;case 35678:case 36198:return setValueT1;case 35679:return setValueT3D1;case 35680:return setValueT6;case 36289:return setValueT2DArray1;case 5124:case 35670:return setValue1i;case 35667:case 35671:return setValue2iv;case 35668:case 35672:return setValue3iv;case 35669:case 35673:return setValue4iv}}(activeInfo.type)}function PureArrayUniform(id,activeInfo,addr){this.id=id,this.addr=addr,this.cache=[],this.size=activeInfo.size,this.setValue=function(type){switch(type){case 5126:return setValue1fv;case 35664:return setValueV2a;case 35665:return setValueV3a;case 35666:return setValueV4a;case 35674:return setValueM2a;case 35675:return setValueM3a;case 35676:return setValueM4a;case 35678:return setValueT1a;case 35680:return setValueT6a;case 5124:case 35670:return setValue1iv;case 35667:case 35671:return setValue2iv;case 35668:case 35672:return setValue3iv;case 35669:case 35673:return setValue4iv}}(activeInfo.type)}function StructuredUniform(id){this.id=id,this.seq=[],this.map={}}PureArrayUniform.prototype.updateCache=function(data){var cache=this.cache;data instanceof Float32Array&&cache.length!==data.length&&(this.cache=new Float32Array(data.length)),copyArray(cache,data)},StructuredUniform.prototype.setValue=function(gl,value,textures){for(var seq=this.seq,i=0,n=seq.length;i!==n;++i){var u=seq[i];u.setValue(gl,value[u.id],textures)}};var RePathPart=/([\w\d_]+)(\])?(\[|\.)?/g;function addUniform(container,uniformObject){container.seq.push(uniformObject),container.map[uniformObject.id]=uniformObject}function parseUniform(activeInfo,addr,container){var path=activeInfo.name,pathLength=path.length;for(RePathPart.lastIndex=0;;){var match=RePathPart.exec(path),matchEnd=RePathPart.lastIndex,id=match[1],idIsIndex="]"===match[2],subscript=match[3];if(idIsIndex&&(id|=0),void 0===subscript||"["===subscript&&matchEnd+2===pathLength){addUniform(container,void 0===subscript?new SingleUniform(id,activeInfo,addr):new PureArrayUniform(id,activeInfo,addr));break}var next=container.map[id];void 0===next&&addUniform(container,next=new StructuredUniform(id)),container=next}}function WebGLUniforms(gl,program){this.seq=[],this.map={};for(var n=gl.getProgramParameter(program,35718),i=0;i<n;++i){var info=gl.getActiveUniform(program,i);parseUniform(info,gl.getUniformLocation(program,info.name),this)}}function WebGLShader(gl,type,string,debug){var shader=gl.createShader(type);return gl.shaderSource(shader,string),gl.compileShader(shader),!0===debug&&(!1===gl.getShaderParameter(shader,35713)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==gl.getShaderInfoLog(shader)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",35633===type?"vertex":"fragment",gl.getShaderInfoLog(shader),function(string){for(var lines=string.split("\n"),i=0;i<lines.length;i++)lines[i]=i+1+": "+lines[i];return lines.join("\n")}(string))),shader}WebGLUniforms.prototype.setValue=function(gl,name,value,textures){var u=this.map[name];void 0!==u&&u.setValue(gl,value,textures)},WebGLUniforms.prototype.setOptional=function(gl,object,name){var v=object[name];void 0!==v&&this.setValue(gl,name,v)},WebGLUniforms.upload=function(gl,seq,values,textures){for(var i=0,n=seq.length;i!==n;++i){var u=seq[i],v=values[u.id];!1!==v.needsUpdate&&u.setValue(gl,v.value,textures)}},WebGLUniforms.seqWithValue=function(seq,values){for(var r=[],i=0,n=seq.length;i!==n;++i){var u=seq[i];u.id in values&&r.push(u)}return r};var programIdCount=0;function getEncodingComponents(encoding){switch(encoding){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+encoding)}}function getTexelDecodingFunction(functionName,encoding){var components=getEncodingComponents(encoding);return"vec4 "+functionName+"( vec4 value ) { return "+components[0]+"ToLinear"+components[1]+"; }"}function filterEmptyLine(string){return""!==string}function replaceLightNums(string,parameters){return string.replace(/NUM_DIR_LIGHTS/g,parameters.numDirLights).replace(/NUM_SPOT_LIGHTS/g,parameters.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,parameters.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,parameters.numPointLights).replace(/NUM_HEMI_LIGHTS/g,parameters.numHemiLights)}function replaceClippingPlaneNums(string,parameters){return string.replace(/NUM_CLIPPING_PLANES/g,parameters.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,parameters.numClippingPlanes-parameters.numClipIntersection)}function parseIncludes(string){return string.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(match,include){var replace=ShaderChunk[include];if(void 0===replace)throw new Error("Can not resolve #include <"+include+">");return parseIncludes(replace)})}function unrollLoops(string){return string.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(match,start,end,snippet){for(var unroll="",i=parseInt(start);i<parseInt(end);i++)unroll+=snippet.replace(/\[ i \]/g,"[ "+i+" ]");return unroll})}function WebGLProgram(renderer,extensions,code,material,shader,parameters,capabilities,textures){var gl=renderer.context,defines=material.defines,vertexShader=shader.vertexShader,fragmentShader=shader.fragmentShader,shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC";parameters.shadowMapType===PCFShadowMap?shadowMapTypeDefine="SHADOWMAP_TYPE_PCF":parameters.shadowMapType===PCFSoftShadowMap&&(shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT");var envMapTypeDefine="ENVMAP_TYPE_CUBE",envMapModeDefine="ENVMAP_MODE_REFLECTION",envMapBlendingDefine="ENVMAP_BLENDING_MULTIPLY";if(parameters.envMap){switch(material.envMap.mapping){case CubeReflectionMapping:case CubeRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_CUBE_UV";break;case EquirectangularReflectionMapping:case EquirectangularRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_EQUIREC";break;case SphericalReflectionMapping:envMapTypeDefine="ENVMAP_TYPE_SPHERE"}switch(material.envMap.mapping){case CubeRefractionMapping:case EquirectangularRefractionMapping:envMapModeDefine="ENVMAP_MODE_REFRACTION"}switch(material.combine){case MultiplyOperation:envMapBlendingDefine="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:envMapBlendingDefine="ENVMAP_BLENDING_MIX";break;case AddOperation:envMapBlendingDefine="ENVMAP_BLENDING_ADD"}}var prefixVertex,prefixFragment,gammaFactorDefine=0<renderer.gammaFactor?renderer.gammaFactor:1,customExtensions=capabilities.isWebGL2?"":function(extensions,parameters,rendererExtensions){return[(extensions=extensions||{}).derivatives||parameters.envMapCubeUV||parameters.bumpMap||parameters.normalMap&&!parameters.objectSpaceNormalMap||parameters.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(extensions.fragDepth||parameters.logarithmicDepthBuffer)&&rendererExtensions.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",extensions.drawBuffers&&rendererExtensions.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(extensions.shaderTextureLOD||parameters.envMap)&&rendererExtensions.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}(material.extensions,parameters,extensions),customDefines=function(defines){var chunks=[];for(var name in defines){var value=defines[name];!1!==value&&chunks.push("#define "+name+" "+value)}return chunks.join("\n")}(defines),program=gl.createProgram();if(material.isRawShaderMaterial?(0<(prefixVertex=[customDefines].filter(filterEmptyLine).join("\n")).length&&(prefixVertex+="\n"),0<(prefixFragment=[customExtensions,customDefines].filter(filterEmptyLine).join("\n")).length&&(prefixFragment+="\n")):(prefixVertex=["precision "+parameters.precision+" float;","precision "+parameters.precision+" int;","#define SHADER_NAME "+shader.name,customDefines,parameters.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+gammaFactorDefine,"#define MAX_BONES "+parameters.maxBones,parameters.useFog&&parameters.fog?"#define USE_FOG":"",parameters.useFog&&parameters.fogExp?"#define FOG_EXP2":"",parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.envMap?"#define "+envMapModeDefine:"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.aoMap?"#define USE_AOMAP":"",parameters.emissiveMap?"#define USE_EMISSIVEMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.normalMap&&parameters.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",parameters.displacementMap&&parameters.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.roughnessMap?"#define USE_ROUGHNESSMAP":"",parameters.metalnessMap?"#define USE_METALNESSMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexTangents?"#define USE_TANGENT":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.flatShading?"#define FLAT_SHADED":"",parameters.skinning?"#define USE_SKINNING":"",parameters.useVertexTexture?"#define BONE_TEXTURE":"",parameters.morphTargets?"#define USE_MORPHTARGETS":"",parameters.morphNormals&&!1===parameters.flatShading?"#define USE_MORPHNORMALS":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.sizeAttenuation?"#define USE_SIZEATTENUATION":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",parameters.logarithmicDepthBuffer&&(capabilities.isWebGL2||extensions.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),prefixFragment=[customExtensions,"precision "+parameters.precision+" float;","precision "+parameters.precision+" int;","#define SHADER_NAME "+shader.name,customDefines,parameters.alphaTest?"#define ALPHATEST "+parameters.alphaTest+(parameters.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+gammaFactorDefine,parameters.useFog&&parameters.fog?"#define USE_FOG":"",parameters.useFog&&parameters.fogExp?"#define FOG_EXP2":"",parameters.map?"#define USE_MAP":"",parameters.matcap?"#define USE_MATCAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.envMap?"#define "+envMapTypeDefine:"",parameters.envMap?"#define "+envMapModeDefine:"",parameters.envMap?"#define "+envMapBlendingDefine:"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.aoMap?"#define USE_AOMAP":"",parameters.emissiveMap?"#define USE_EMISSIVEMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.normalMap&&parameters.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.roughnessMap?"#define USE_ROUGHNESSMAP":"",parameters.metalnessMap?"#define USE_METALNESSMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexTangents?"#define USE_TANGENT":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.gradientMap?"#define USE_GRADIENTMAP":"",parameters.flatShading?"#define FLAT_SHADED":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",parameters.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",parameters.logarithmicDepthBuffer&&(capabilities.isWebGL2||extensions.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",parameters.envMap&&(capabilities.isWebGL2||extensions.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",parameters.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",parameters.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",parameters.toneMapping!==NoToneMapping?function(functionName,toneMapping){var toneMappingName;switch(toneMapping){case LinearToneMapping:toneMappingName="Linear";break;case ReinhardToneMapping:toneMappingName="Reinhard";break;case Uncharted2ToneMapping:toneMappingName="Uncharted2";break;case CineonToneMapping:toneMappingName="OptimizedCineon";break;case ACESFilmicToneMapping:toneMappingName="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+toneMapping)}return"vec3 "+functionName+"( vec3 color ) { return "+toneMappingName+"ToneMapping( color ); }"}("toneMapping",parameters.toneMapping):"",parameters.dithering?"#define DITHERING":"",parameters.outputEncoding||parameters.mapEncoding||parameters.matcapEncoding||parameters.envMapEncoding||parameters.emissiveMapEncoding?ShaderChunk.encodings_pars_fragment:"",parameters.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",parameters.mapEncoding):"",parameters.matcapEncoding?getTexelDecodingFunction("matcapTexelToLinear",parameters.matcapEncoding):"",parameters.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",parameters.envMapEncoding):"",parameters.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",parameters.emissiveMapEncoding):"",parameters.outputEncoding?function(functionName,encoding){var components=getEncodingComponents(encoding);return"vec4 "+functionName+"( vec4 value ) { return LinearTo"+components[0]+components[1]+"; }"}("linearToOutputTexel",parameters.outputEncoding):"",parameters.depthPacking?"#define DEPTH_PACKING "+material.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),vertexShader=replaceClippingPlaneNums(vertexShader=replaceLightNums(vertexShader=parseIncludes(vertexShader),parameters),parameters),fragmentShader=replaceClippingPlaneNums(fragmentShader=replaceLightNums(fragmentShader=parseIncludes(fragmentShader),parameters),parameters),vertexShader=unrollLoops(vertexShader),fragmentShader=unrollLoops(fragmentShader),capabilities.isWebGL2&&!material.isRawShaderMaterial){var isGLSL3ShaderMaterial=!1,versionRegex=/^\s*#version\s+300\s+es\s*\n/;material.isShaderMaterial&&null!==vertexShader.match(versionRegex)&&null!==fragmentShader.match(versionRegex)&&(isGLSL3ShaderMaterial=!0,vertexShader=vertexShader.replace(versionRegex,""),fragmentShader=fragmentShader.replace(versionRegex,"")),prefixVertex=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+prefixVertex,prefixFragment=["#version 300 es\n","#define varying in",isGLSL3ShaderMaterial?"":"out highp vec4 pc_fragColor;",isGLSL3ShaderMaterial?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+prefixFragment}var cachedUniforms,cachedAttributes,fragmentGlsl=prefixFragment+fragmentShader,glVertexShader=WebGLShader(gl,35633,prefixVertex+vertexShader,renderer.debug.checkShaderErrors),glFragmentShader=WebGLShader(gl,35632,fragmentGlsl,renderer.debug.checkShaderErrors);if(gl.attachShader(program,glVertexShader),gl.attachShader(program,glFragmentShader),void 0!==material.index0AttributeName?gl.bindAttribLocation(program,0,material.index0AttributeName):!0===parameters.morphTargets&&gl.bindAttribLocation(program,0,"position"),gl.linkProgram(program),renderer.debug.checkShaderErrors){var programLog=gl.getProgramInfoLog(program).trim(),vertexLog=gl.getShaderInfoLog(glVertexShader).trim(),fragmentLog=gl.getShaderInfoLog(glFragmentShader).trim(),runnable=!0,haveDiagnostics=!0;!1===gl.getProgramParameter(program,35714)?(runnable=!1,console.error("THREE.WebGLProgram: shader error: ",gl.getError(),"35715",gl.getProgramParameter(program,35715),"gl.getProgramInfoLog",programLog,vertexLog,fragmentLog)):""!==programLog?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",programLog):""!==vertexLog&&""!==fragmentLog||(haveDiagnostics=!1),haveDiagnostics&&(this.diagnostics={runnable:runnable,material:material,programLog:programLog,vertexShader:{log:vertexLog,prefix:prefixVertex},fragmentShader:{log:fragmentLog,prefix:prefixFragment}})}return gl.deleteShader(glVertexShader),gl.deleteShader(glFragmentShader),this.getUniforms=function(){return void 0===cachedUniforms&&(cachedUniforms=new WebGLUniforms(gl,program,textures)),cachedUniforms},this.getAttributes=function(){return void 0===cachedAttributes&&(cachedAttributes=function(gl,program){for(var attributes={},n=gl.getProgramParameter(program,35721),i=0;i<n;i++){var name=gl.getActiveAttrib(program,i).name;attributes[name]=gl.getAttribLocation(program,name)}return attributes}(gl,program)),cachedAttributes},this.destroy=function(){gl.deleteProgram(program),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=shader.name,this.id=programIdCount++,this.code=code,this.usedTimes=1,this.program=program,this.vertexShader=glVertexShader,this.fragmentShader=glFragmentShader,this}function WebGLPrograms(renderer,extensions,capabilities,textures){var programs=[],shaderIDs={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},parameterNames=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function getTextureEncodingFromMap(map,gammaOverrideLinear){var encoding;return map?map.isTexture?encoding=map.encoding:map.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),encoding=map.texture.encoding):encoding=LinearEncoding,encoding===LinearEncoding&&gammaOverrideLinear&&(encoding=GammaEncoding),encoding}this.getParameters=function(material,lights,shadows,fog,nClipPlanes,nClipIntersection,object){var shaderID=shaderIDs[material.type],maxBones=object.isSkinnedMesh?function(object){var bones=object.skeleton.bones;if(capabilities.floatVertexTextures)return 1024;var nVertexUniforms=capabilities.maxVertexUniforms,nVertexMatrices=Math.floor((nVertexUniforms-20)/4),maxBones=Math.min(nVertexMatrices,bones.length);return maxBones<bones.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+bones.length+" bones. This GPU supports "+maxBones+"."),0):maxBones}(object):0,precision=capabilities.precision;null!==material.precision&&(precision=capabilities.getMaxPrecision(material.precision))!==material.precision&&console.warn("THREE.WebGLProgram.getParameters:",material.precision,"not supported, using",precision,"instead.");var currentRenderTarget=renderer.getRenderTarget();return{shaderID:shaderID,precision:precision,supportsVertexTextures:capabilities.vertexTextures,outputEncoding:getTextureEncodingFromMap(currentRenderTarget?currentRenderTarget.texture:null,renderer.gammaOutput),map:!!material.map,mapEncoding:getTextureEncodingFromMap(material.map,renderer.gammaInput),matcap:!!material.matcap,matcapEncoding:getTextureEncodingFromMap(material.matcap,renderer.gammaInput),envMap:!!material.envMap,envMapMode:material.envMap&&material.envMap.mapping,envMapEncoding:getTextureEncodingFromMap(material.envMap,renderer.gammaInput),envMapCubeUV:!!material.envMap&&(material.envMap.mapping===CubeUVReflectionMapping||material.envMap.mapping===CubeUVRefractionMapping),lightMap:!!material.lightMap,aoMap:!!material.aoMap,emissiveMap:!!material.emissiveMap,emissiveMapEncoding:getTextureEncodingFromMap(material.emissiveMap,renderer.gammaInput),bumpMap:!!material.bumpMap,normalMap:!!material.normalMap,objectSpaceNormalMap:material.normalMapType===ObjectSpaceNormalMap,displacementMap:!!material.displacementMap,roughnessMap:!!material.roughnessMap,metalnessMap:!!material.metalnessMap,specularMap:!!material.specularMap,alphaMap:!!material.alphaMap,gradientMap:!!material.gradientMap,combine:material.combine,vertexTangents:material.normalMap&&material.vertexTangents,vertexColors:material.vertexColors,fog:!!fog,useFog:material.fog,fogExp:fog&&fog.isFogExp2,flatShading:material.flatShading,sizeAttenuation:material.sizeAttenuation,logarithmicDepthBuffer:capabilities.logarithmicDepthBuffer,skinning:material.skinning&&0<maxBones,maxBones:maxBones,useVertexTexture:capabilities.floatVertexTextures,morphTargets:material.morphTargets,morphNormals:material.morphNormals,maxMorphTargets:renderer.maxMorphTargets,maxMorphNormals:renderer.maxMorphNormals,numDirLights:lights.directional.length,numPointLights:lights.point.length,numSpotLights:lights.spot.length,numRectAreaLights:lights.rectArea.length,numHemiLights:lights.hemi.length,numClippingPlanes:nClipPlanes,numClipIntersection:nClipIntersection,dithering:material.dithering,shadowMapEnabled:renderer.shadowMap.enabled&&object.receiveShadow&&0<shadows.length,shadowMapType:renderer.shadowMap.type,toneMapping:renderer.toneMapping,physicallyCorrectLights:renderer.physicallyCorrectLights,premultipliedAlpha:material.premultipliedAlpha,alphaTest:material.alphaTest,doubleSided:material.side===DoubleSide,flipSided:material.side===BackSide,depthPacking:void 0!==material.depthPacking&&material.depthPacking}},this.getProgramCode=function(material,parameters){var array=[];if(parameters.shaderID?array.push(parameters.shaderID):(array.push(material.fragmentShader),array.push(material.vertexShader)),void 0!==material.defines)for(var name in material.defines)array.push(name),array.push(material.defines[name]);for(var i=0;i<parameterNames.length;i++)array.push(parameters[parameterNames[i]]);return array.push(material.onBeforeCompile.toString()),array.push(renderer.gammaOutput),array.push(renderer.gammaFactor),array.join()},this.acquireProgram=function(material,shader,parameters,code){for(var program,p=0,pl=programs.length;p<pl;p++){var programInfo=programs[p];if(programInfo.code===code){++(program=programInfo).usedTimes;break}}return void 0===program&&(program=new WebGLProgram(renderer,extensions,code,material,shader,parameters,capabilities,textures),programs.push(program)),program},this.releaseProgram=function(program){if(0==--program.usedTimes){var i=programs.indexOf(program);programs[i]=programs[programs.length-1],programs.pop(),program.destroy()}},this.programs=programs}function WebGLProperties(){var properties=new WeakMap;return{get:function(object){var map=properties.get(object);return void 0===map&&(map={},properties.set(object,map)),map},remove:function(object){properties.delete(object)},update:function(object,key,value){properties.get(object)[key]=value},dispose:function(){properties=new WeakMap}}}function painterSortStable(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.program!==b.program?a.program.id-b.program.id:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function reversePainterSortStable(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function WebGLRenderList(){var renderItems=[],renderItemsIndex=0,opaque=[],transparent=[],defaultProgram={id:-1};function getNextRenderItem(object,geometry,material,groupOrder,z,group){var renderItem=renderItems[renderItemsIndex];return void 0===renderItem?(renderItem={id:object.id,object:object,geometry:geometry,material:material,program:material.program||defaultProgram,groupOrder:groupOrder,renderOrder:object.renderOrder,z:z,group:group},renderItems[renderItemsIndex]=renderItem):(renderItem.id=object.id,renderItem.object=object,renderItem.geometry=geometry,renderItem.material=material,renderItem.program=material.program||defaultProgram,renderItem.groupOrder=groupOrder,renderItem.renderOrder=object.renderOrder,renderItem.z=z,renderItem.group=group),renderItemsIndex++,renderItem}return{opaque:opaque,transparent:transparent,init:function(){renderItemsIndex=0,opaque.length=0,transparent.length=0},push:function(object,geometry,material,groupOrder,z,group){var renderItem=getNextRenderItem(object,geometry,material,groupOrder,z,group);(!0===material.transparent?transparent:opaque).push(renderItem)},unshift:function(object,geometry,material,groupOrder,z,group){var renderItem=getNextRenderItem(object,geometry,material,groupOrder,z,group);(!0===material.transparent?transparent:opaque).unshift(renderItem)},sort:function(){1<opaque.length&&opaque.sort(painterSortStable),1<transparent.length&&transparent.sort(reversePainterSortStable)}}}function WebGLRenderLists(){var lists={};function onSceneDispose(event){var scene=event.target;scene.removeEventListener("dispose",onSceneDispose),delete lists[scene.id]}return{get:function(scene,camera){var list,cameras=lists[scene.id];return void 0===cameras?(list=new WebGLRenderList,lists[scene.id]={},lists[scene.id][camera.id]=list,scene.addEventListener("dispose",onSceneDispose)):void 0===(list=cameras[camera.id])&&(list=new WebGLRenderList,cameras[camera.id]=list),list},dispose:function(){lists={}}}}function UniformsCache(){var lights={};return{get:function(light){if(void 0!==lights[light.id])return lights[light.id];var uniforms;switch(light.type){case"DirectionalLight":uniforms={direction:new Vector3,color:new Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":uniforms={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":uniforms={position:new Vector3,color:new Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":uniforms={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":uniforms={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return lights[light.id]=uniforms}}}var count=0;function WebGLLights(){for(var cache=new UniformsCache,state={id:count++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=0;i<9;i++)state.probe.push(new Vector3);var vector3=new Vector3,matrix4=new Matrix4,matrix42=new Matrix4;return{setup:function(lights,shadows,camera){for(var r=0,g=0,b=0,i=0;i<9;i++)state.probe[i].set(0,0,0);for(var directionalLength=0,pointLength=0,spotLength=0,rectAreaLength=0,hemiLength=0,viewMatrix=camera.matrixWorldInverse,l=(i=0,lights.length);i<l;i++){var light=lights[i],color=light.color,intensity=light.intensity,distance=light.distance,shadowMap=light.shadow&&light.shadow.map?light.shadow.map.texture:null;if(light.isAmbientLight)r+=color.r*intensity,g+=color.g*intensity,b+=color.b*intensity;else if(light.isLightProbe)for(var j=0;j<9;j++)state.probe[j].addScaledVector(light.sh.coefficients[j],intensity);else if(light.isDirectionalLight){if((uniforms=cache.get(light)).color.copy(light.color).multiplyScalar(light.intensity),uniforms.direction.setFromMatrixPosition(light.matrixWorld),vector3.setFromMatrixPosition(light.target.matrixWorld),uniforms.direction.sub(vector3),uniforms.direction.transformDirection(viewMatrix),uniforms.shadow=light.castShadow,light.castShadow){var shadow=light.shadow;uniforms.shadowBias=shadow.bias,uniforms.shadowRadius=shadow.radius,uniforms.shadowMapSize=shadow.mapSize}state.directionalShadowMap[directionalLength]=shadowMap,state.directionalShadowMatrix[directionalLength]=light.shadow.matrix,state.directional[directionalLength]=uniforms,directionalLength++}else if(light.isSpotLight){if((uniforms=cache.get(light)).position.setFromMatrixPosition(light.matrixWorld),uniforms.position.applyMatrix4(viewMatrix),uniforms.color.copy(color).multiplyScalar(intensity),uniforms.distance=distance,uniforms.direction.setFromMatrixPosition(light.matrixWorld),vector3.setFromMatrixPosition(light.target.matrixWorld),uniforms.direction.sub(vector3),uniforms.direction.transformDirection(viewMatrix),uniforms.coneCos=Math.cos(light.angle),uniforms.penumbraCos=Math.cos(light.angle*(1-light.penumbra)),uniforms.decay=light.decay,uniforms.shadow=light.castShadow,light.castShadow){shadow=light.shadow;uniforms.shadowBias=shadow.bias,uniforms.shadowRadius=shadow.radius,uniforms.shadowMapSize=shadow.mapSize}state.spotShadowMap[spotLength]=shadowMap,state.spotShadowMatrix[spotLength]=light.shadow.matrix,state.spot[spotLength]=uniforms,spotLength++}else if(light.isRectAreaLight){(uniforms=cache.get(light)).color.copy(color).multiplyScalar(intensity),uniforms.position.setFromMatrixPosition(light.matrixWorld),uniforms.position.applyMatrix4(viewMatrix),matrix42.identity(),matrix4.copy(light.matrixWorld),matrix4.premultiply(viewMatrix),matrix42.extractRotation(matrix4),uniforms.halfWidth.set(.5*light.width,0,0),uniforms.halfHeight.set(0,.5*light.height,0),uniforms.halfWidth.applyMatrix4(matrix42),uniforms.halfHeight.applyMatrix4(matrix42),state.rectArea[rectAreaLength]=uniforms,rectAreaLength++}else if(light.isPointLight){if((uniforms=cache.get(light)).position.setFromMatrixPosition(light.matrixWorld),uniforms.position.applyMatrix4(viewMatrix),uniforms.color.copy(light.color).multiplyScalar(light.intensity),uniforms.distance=light.distance,uniforms.decay=light.decay,uniforms.shadow=light.castShadow,light.castShadow){shadow=light.shadow;uniforms.shadowBias=shadow.bias,uniforms.shadowRadius=shadow.radius,uniforms.shadowMapSize=shadow.mapSize,uniforms.shadowCameraNear=shadow.camera.near,uniforms.shadowCameraFar=shadow.camera.far}state.pointShadowMap[pointLength]=shadowMap,state.pointShadowMatrix[pointLength]=light.shadow.matrix,state.point[pointLength]=uniforms,pointLength++}else if(light.isHemisphereLight){var uniforms;(uniforms=cache.get(light)).direction.setFromMatrixPosition(light.matrixWorld),uniforms.direction.transformDirection(viewMatrix),uniforms.direction.normalize(),uniforms.skyColor.copy(light.color).multiplyScalar(intensity),uniforms.groundColor.copy(light.groundColor).multiplyScalar(intensity),state.hemi[hemiLength]=uniforms,hemiLength++}}state.ambient[0]=r,state.ambient[1]=g,state.ambient[2]=b,state.directional.length=directionalLength,state.spot.length=spotLength,state.rectArea.length=rectAreaLength,state.point.length=pointLength,state.hemi.length=hemiLength,state.hash.stateID=state.id,state.hash.directionalLength=directionalLength,state.hash.pointLength=pointLength,state.hash.spotLength=spotLength,state.hash.rectAreaLength=rectAreaLength,state.hash.hemiLength=hemiLength,state.hash.shadowsLength=shadows.length},state:state}}function WebGLRenderState(){var lights=new WebGLLights,lightsArray=[],shadowsArray=[];return{init:function(){lightsArray.length=0,shadowsArray.length=0},state:{lightsArray:lightsArray,shadowsArray:shadowsArray,lights:lights},setupLights:function(camera){lights.setup(lightsArray,shadowsArray,camera)},pushLight:function(light){lightsArray.push(light)},pushShadow:function(shadowLight){shadowsArray.push(shadowLight)}}}function WebGLRenderStates(){var renderStates={};function onSceneDispose(event){var scene=event.target;scene.removeEventListener("dispose",onSceneDispose),delete renderStates[scene.id]}return{get:function(scene,camera){var renderState;return void 0===renderStates[scene.id]?(renderState=new WebGLRenderState,renderStates[scene.id]={},renderStates[scene.id][camera.id]=renderState,scene.addEventListener("dispose",onSceneDispose)):void 0===renderStates[scene.id][camera.id]?(renderState=new WebGLRenderState,renderStates[scene.id][camera.id]=renderState):renderState=renderStates[scene.id][camera.id],renderState},dispose:function(){renderStates={}}}}function MeshDepthMaterial(parameters){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(parameters)}function MeshDistanceMaterial(parameters){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(parameters)}function WebGLShadowMap(_renderer,_objects,maxTextureSize){for(var _frustum=new Frustum,_projScreenMatrix=new Matrix4,_shadowMapSize=new Vector2,_maxShadowMapSize=new Vector2(maxTextureSize,maxTextureSize),_lookTarget=new Vector3,_lightPositionWorld=new Vector3,_MorphingFlag=1,_SkinningFlag=2,_NumberOfMaterialVariants=1+(_MorphingFlag|_SkinningFlag),_depthMaterials=new Array(_NumberOfMaterialVariants),_distanceMaterials=new Array(_NumberOfMaterialVariants),_materialCache={},shadowSide={0:BackSide,1:FrontSide,2:DoubleSide},cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)],cube2DViewPorts=[new Vector4,new Vector4,new Vector4,new Vector4,new Vector4,new Vector4],i=0;i!==_NumberOfMaterialVariants;++i){var useMorphing=0!=(i&_MorphingFlag),useSkinning=0!=(i&_SkinningFlag),depthMaterial=new MeshDepthMaterial({depthPacking:RGBADepthPacking,morphTargets:useMorphing,skinning:useSkinning});_depthMaterials[i]=depthMaterial;var distanceMaterial=new MeshDistanceMaterial({morphTargets:useMorphing,skinning:useSkinning});_distanceMaterials[i]=distanceMaterial}var scope=this;function getDepthMaterial(object,material,isPointLight,lightPositionWorld,shadowCameraNear,shadowCameraFar){var geometry=object.geometry,result=null,materialVariants=_depthMaterials,customMaterial=object.customDepthMaterial;if(isPointLight&&(materialVariants=_distanceMaterials,customMaterial=object.customDistanceMaterial),customMaterial)result=customMaterial;else{var useMorphing=!1;material.morphTargets&&(geometry&&geometry.isBufferGeometry?useMorphing=geometry.morphAttributes&&geometry.morphAttributes.position&&0<geometry.morphAttributes.position.length:geometry&&geometry.isGeometry&&(useMorphing=geometry.morphTargets&&0<geometry.morphTargets.length)),object.isSkinnedMesh&&!1===material.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",object);var useSkinning=object.isSkinnedMesh&&material.skinning,variantIndex=0;useMorphing&&(variantIndex|=_MorphingFlag),useSkinning&&(variantIndex|=_SkinningFlag),result=materialVariants[variantIndex]}if(_renderer.localClippingEnabled&&!0===material.clipShadows&&0!==material.clippingPlanes.length){var keyA=result.uuid,keyB=material.uuid,materialsForVariant=_materialCache[keyA];void 0===materialsForVariant&&(materialsForVariant={},_materialCache[keyA]=materialsForVariant);var cachedMaterial=materialsForVariant[keyB];void 0===cachedMaterial&&(cachedMaterial=result.clone(),materialsForVariant[keyB]=cachedMaterial),result=cachedMaterial}return result.visible=material.visible,result.wireframe=material.wireframe,result.side=null!=material.shadowSide?material.shadowSide:shadowSide[material.side],result.clipShadows=material.clipShadows,result.clippingPlanes=material.clippingPlanes,result.clipIntersection=material.clipIntersection,result.wireframeLinewidth=material.wireframeLinewidth,result.linewidth=material.linewidth,isPointLight&&result.isMeshDistanceMaterial&&(result.referencePosition.copy(lightPositionWorld),result.nearDistance=shadowCameraNear,result.farDistance=shadowCameraFar),result}function renderObject(object,camera,shadowCamera,isPointLight){if(!1!==object.visible){if(object.layers.test(camera.layers)&&(object.isMesh||object.isLine||object.isPoints)&&object.castShadow&&(!object.frustumCulled||_frustum.intersectsObject(object))){object.modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse,object.matrixWorld);var geometry=_objects.update(object),material=object.material;if(Array.isArray(material))for(var groups=geometry.groups,k=0,kl=groups.length;k<kl;k++){var group=groups[k],groupMaterial=material[group.materialIndex];if(groupMaterial&&groupMaterial.visible){var depthMaterial=getDepthMaterial(object,groupMaterial,isPointLight,_lightPositionWorld,shadowCamera.near,shadowCamera.far);_renderer.renderBufferDirect(shadowCamera,null,geometry,depthMaterial,object,group)}}else if(material.visible){depthMaterial=getDepthMaterial(object,material,isPointLight,_lightPositionWorld,shadowCamera.near,shadowCamera.far);_renderer.renderBufferDirect(shadowCamera,null,geometry,depthMaterial,object,null)}}for(var children=object.children,i=0,l=children.length;i<l;i++)renderObject(children[i],camera,shadowCamera,isPointLight)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap,this.render=function(lights,scene,camera){if(!1!==scope.enabled&&(!1!==scope.autoUpdate||!1!==scope.needsUpdate)&&0!==lights.length){var faceCount,currentRenderTarget=_renderer.getRenderTarget(),_state=_renderer.state;_state.setBlending(NoBlending),_state.buffers.color.setClear(1,1,1,1),_state.buffers.depth.setTest(!0),_state.setScissorTest(!1);for(var i=0,il=lights.length;i<il;i++){var light=lights[i],shadow=light.shadow,isPointLight=light&&light.isPointLight;if(void 0!==shadow){var shadowCamera=shadow.camera;if(_shadowMapSize.copy(shadow.mapSize),_shadowMapSize.min(_maxShadowMapSize),isPointLight){var vpWidth=_shadowMapSize.x,vpHeight=_shadowMapSize.y;cube2DViewPorts[0].set(2*vpWidth,vpHeight,vpWidth,vpHeight),cube2DViewPorts[1].set(0,vpHeight,vpWidth,vpHeight),cube2DViewPorts[2].set(3*vpWidth,vpHeight,vpWidth,vpHeight),cube2DViewPorts[3].set(vpWidth,vpHeight,vpWidth,vpHeight),cube2DViewPorts[4].set(3*vpWidth,0,vpWidth,vpHeight),cube2DViewPorts[5].set(vpWidth,0,vpWidth,vpHeight),_shadowMapSize.x*=4,_shadowMapSize.y*=2}if(null===shadow.map){var pars={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat};shadow.map=new WebGLRenderTarget(_shadowMapSize.x,_shadowMapSize.y,pars),shadow.map.texture.name=light.name+".shadowMap",shadowCamera.updateProjectionMatrix()}shadow.isSpotLightShadow&&shadow.update(light);var shadowMap=shadow.map,shadowMatrix=shadow.matrix;_lightPositionWorld.setFromMatrixPosition(light.matrixWorld),shadowCamera.position.copy(_lightPositionWorld),isPointLight?(faceCount=6,shadowMatrix.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z)):(faceCount=1,_lookTarget.setFromMatrixPosition(light.target.matrixWorld),shadowCamera.lookAt(_lookTarget),shadowCamera.updateMatrixWorld(),shadowMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),shadowMatrix.multiply(shadowCamera.projectionMatrix),shadowMatrix.multiply(shadowCamera.matrixWorldInverse)),_renderer.setRenderTarget(shadowMap),_renderer.clear();for(var face=0;face<faceCount;face++){if(isPointLight){_lookTarget.copy(shadowCamera.position),_lookTarget.add(cubeDirections[face]),shadowCamera.up.copy(cubeUps[face]),shadowCamera.lookAt(_lookTarget),shadowCamera.updateMatrixWorld();var vpDimensions=cube2DViewPorts[face];_state.viewport(vpDimensions)}_projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix,shadowCamera.matrixWorldInverse),_frustum.setFromMatrix(_projScreenMatrix),renderObject(scene,camera,shadowCamera,isPointLight)}}else console.warn("THREE.WebGLShadowMap:",light,"has no shadow.")}scope.needsUpdate=!1,_renderer.setRenderTarget(currentRenderTarget)}}}function WebGLState(gl,extensions,utils,capabilities){var colorBuffer=new function(){var locked=!1,color=new Vector4,currentColorMask=null,currentColorClear=new Vector4(0,0,0,0);return{setMask:function(colorMask){currentColorMask===colorMask||locked||(gl.colorMask(colorMask,colorMask,colorMask,colorMask),currentColorMask=colorMask)},setLocked:function(lock){locked=lock},setClear:function(r,g,b,a,premultipliedAlpha){!0===premultipliedAlpha&&(r*=a,g*=a,b*=a),color.set(r,g,b,a),!1===currentColorClear.equals(color)&&(gl.clearColor(r,g,b,a),currentColorClear.copy(color))},reset:function(){locked=!1,currentColorMask=null,currentColorClear.set(-1,0,0,0)}}},depthBuffer=new function(){var locked=!1,currentDepthMask=null,currentDepthFunc=null,currentDepthClear=null;return{setTest:function(depthTest){depthTest?enable(2929):disable(2929)},setMask:function(depthMask){currentDepthMask===depthMask||locked||(gl.depthMask(depthMask),currentDepthMask=depthMask)},setFunc:function(depthFunc){if(currentDepthFunc!==depthFunc){if(depthFunc)switch(depthFunc){case NeverDepth:gl.depthFunc(512);break;case AlwaysDepth:gl.depthFunc(519);break;case LessDepth:gl.depthFunc(513);break;case LessEqualDepth:gl.depthFunc(515);break;case EqualDepth:gl.depthFunc(514);break;case GreaterEqualDepth:gl.depthFunc(518);break;case GreaterDepth:gl.depthFunc(516);break;case NotEqualDepth:gl.depthFunc(517);break;default:gl.depthFunc(515)}else gl.depthFunc(515);currentDepthFunc=depthFunc}},setLocked:function(lock){locked=lock},setClear:function(depth){currentDepthClear!==depth&&(gl.clearDepth(depth),currentDepthClear=depth)},reset:function(){locked=!1,currentDepthClear=currentDepthFunc=currentDepthMask=null}}},stencilBuffer=new function(){var locked=!1,currentStencilMask=null,currentStencilFunc=null,currentStencilRef=null,currentStencilFuncMask=null,currentStencilFail=null,currentStencilZFail=null,currentStencilZPass=null,currentStencilClear=null;return{setTest:function(stencilTest){stencilTest?enable(2960):disable(2960)},setMask:function(stencilMask){currentStencilMask===stencilMask||locked||(gl.stencilMask(stencilMask),currentStencilMask=stencilMask)},setFunc:function(stencilFunc,stencilRef,stencilMask){currentStencilFunc===stencilFunc&&currentStencilRef===stencilRef&&currentStencilFuncMask===stencilMask||(gl.stencilFunc(stencilFunc,stencilRef,stencilMask),currentStencilFunc=stencilFunc,currentStencilRef=stencilRef,currentStencilFuncMask=stencilMask)},setOp:function(stencilFail,stencilZFail,stencilZPass){currentStencilFail===stencilFail&&currentStencilZFail===stencilZFail&&currentStencilZPass===stencilZPass||(gl.stencilOp(stencilFail,stencilZFail,stencilZPass),currentStencilFail=stencilFail,currentStencilZFail=stencilZFail,currentStencilZPass=stencilZPass)},setLocked:function(lock){locked=lock},setClear:function(stencil){currentStencilClear!==stencil&&(gl.clearStencil(stencil),currentStencilClear=stencil)},reset:function(){locked=!1,currentStencilClear=currentStencilZPass=currentStencilZFail=currentStencilFail=currentStencilFuncMask=currentStencilRef=currentStencilFunc=currentStencilMask=null}}},maxVertexAttributes=gl.getParameter(34921),newAttributes=new Uint8Array(maxVertexAttributes),enabledAttributes=new Uint8Array(maxVertexAttributes),attributeDivisors=new Uint8Array(maxVertexAttributes),enabledCapabilities={},compressedTextureFormats=null,currentProgram=null,currentBlendingEnabled=null,currentBlending=null,currentBlendEquation=null,currentBlendSrc=null,currentBlendDst=null,currentBlendEquationAlpha=null,currentBlendSrcAlpha=null,currentBlendDstAlpha=null,currentPremultipledAlpha=!1,currentFlipSided=null,currentCullFace=null,currentLineWidth=null,currentPolygonOffsetFactor=null,currentPolygonOffsetUnits=null,maxTextures=gl.getParameter(35661),lineWidthAvailable=!1,version=0,glVersion=gl.getParameter(7938);-1!==glVersion.indexOf("WebGL")?(version=parseFloat(/^WebGL\ ([0-9])/.exec(glVersion)[1]),lineWidthAvailable=1<=version):-1!==glVersion.indexOf("OpenGL ES")&&(version=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(glVersion)[1]),lineWidthAvailable=2<=version);var currentTextureSlot=null,currentBoundTextures={},currentScissor=new Vector4,currentViewport=new Vector4;function createTexture(type,target,count){var data=new Uint8Array(4),texture=gl.createTexture();gl.bindTexture(type,texture),gl.texParameteri(type,10241,9728),gl.texParameteri(type,10240,9728);for(var i=0;i<count;i++)gl.texImage2D(target+i,0,6408,1,1,0,6408,5121,data);return texture}var emptyTextures={};function enableAttributeAndDivisor(attribute,meshPerAttribute){newAttributes[attribute]=1,0===enabledAttributes[attribute]&&(gl.enableVertexAttribArray(attribute),enabledAttributes[attribute]=1),attributeDivisors[attribute]!==meshPerAttribute&&((capabilities.isWebGL2?gl:extensions.get("ANGLE_instanced_arrays"))[capabilities.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](attribute,meshPerAttribute),attributeDivisors[attribute]=meshPerAttribute)}function enable(id){!0!==enabledCapabilities[id]&&(gl.enable(id),enabledCapabilities[id]=!0)}function disable(id){!1!==enabledCapabilities[id]&&(gl.disable(id),enabledCapabilities[id]=!1)}function setBlending(blending,blendEquation,blendSrc,blendDst,blendEquationAlpha,blendSrcAlpha,blendDstAlpha,premultipliedAlpha){if(blending!==NoBlending){if(currentBlendingEnabled||(enable(3042),currentBlendingEnabled=!0),blending===CustomBlending)blendEquationAlpha=blendEquationAlpha||blendEquation,blendSrcAlpha=blendSrcAlpha||blendSrc,blendDstAlpha=blendDstAlpha||blendDst,blendEquation===currentBlendEquation&&blendEquationAlpha===currentBlendEquationAlpha||(gl.blendEquationSeparate(utils.convert(blendEquation),utils.convert(blendEquationAlpha)),currentBlendEquation=blendEquation,currentBlendEquationAlpha=blendEquationAlpha),blendSrc===currentBlendSrc&&blendDst===currentBlendDst&&blendSrcAlpha===currentBlendSrcAlpha&&blendDstAlpha===currentBlendDstAlpha||(gl.blendFuncSeparate(utils.convert(blendSrc),utils.convert(blendDst),utils.convert(blendSrcAlpha),utils.convert(blendDstAlpha)),currentBlendSrc=blendSrc,currentBlendDst=blendDst,currentBlendSrcAlpha=blendSrcAlpha,currentBlendDstAlpha=blendDstAlpha),currentBlending=blending,currentPremultipledAlpha=null;else if(blending!==currentBlending||premultipliedAlpha!==currentPremultipledAlpha){if(currentBlendEquation===AddEquation&&currentBlendEquationAlpha===AddEquation||(gl.blendEquation(32774),currentBlendEquationAlpha=currentBlendEquation=AddEquation),premultipliedAlpha)switch(blending){case NormalBlending:gl.blendFuncSeparate(1,771,1,771);break;case AdditiveBlending:gl.blendFunc(1,1);break;case SubtractiveBlending:gl.blendFuncSeparate(0,0,769,771);break;case MultiplyBlending:gl.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",blending)}else switch(blending){case NormalBlending:gl.blendFuncSeparate(770,771,1,771);break;case AdditiveBlending:gl.blendFunc(770,1);break;case SubtractiveBlending:gl.blendFunc(0,769);break;case MultiplyBlending:gl.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",blending)}currentBlendDstAlpha=currentBlendSrcAlpha=currentBlendDst=currentBlendSrc=null,currentBlending=blending,currentPremultipledAlpha=premultipliedAlpha}}else currentBlendingEnabled&&(disable(3042),currentBlendingEnabled=!1)}function setFlipSided(flipSided){currentFlipSided!==flipSided&&(flipSided?gl.frontFace(2304):gl.frontFace(2305),currentFlipSided=flipSided)}function setCullFace(cullFace){cullFace!==CullFaceNone?(enable(2884),cullFace!==currentCullFace&&(cullFace===CullFaceBack?gl.cullFace(1029):cullFace===CullFaceFront?gl.cullFace(1028):gl.cullFace(1032))):disable(2884),currentCullFace=cullFace}function setPolygonOffset(polygonOffset,factor,units){polygonOffset?(enable(32823),currentPolygonOffsetFactor===factor&&currentPolygonOffsetUnits===units||(gl.polygonOffset(factor,units),currentPolygonOffsetFactor=factor,currentPolygonOffsetUnits=units)):disable(32823)}function activeTexture(webglSlot){void 0===webglSlot&&(webglSlot=33984+maxTextures-1),currentTextureSlot!==webglSlot&&(gl.activeTexture(webglSlot),currentTextureSlot=webglSlot)}return emptyTextures[3553]=createTexture(3553,3553,1),emptyTextures[34067]=createTexture(34067,34069,6),colorBuffer.setClear(0,0,0,1),depthBuffer.setClear(1),stencilBuffer.setClear(0),enable(2929),depthBuffer.setFunc(LessEqualDepth),setFlipSided(!1),setCullFace(CullFaceBack),enable(2884),setBlending(NoBlending),{buffers:{color:colorBuffer,depth:depthBuffer,stencil:stencilBuffer},initAttributes:function(){for(var i=0,l=newAttributes.length;i<l;i++)newAttributes[i]=0},enableAttribute:function(attribute){enableAttributeAndDivisor(attribute,0)},enableAttributeAndDivisor:enableAttributeAndDivisor,disableUnusedAttributes:function(){for(var i=0,l=enabledAttributes.length;i!==l;++i)enabledAttributes[i]!==newAttributes[i]&&(gl.disableVertexAttribArray(i),enabledAttributes[i]=0)},enable:enable,disable:disable,getCompressedTextureFormats:function(){if(null===compressedTextureFormats&&(compressedTextureFormats=[],extensions.get("WEBGL_compressed_texture_pvrtc")||extensions.get("WEBGL_compressed_texture_s3tc")||extensions.get("WEBGL_compressed_texture_etc1")||extensions.get("WEBGL_compressed_texture_astc")))for(var formats=gl.getParameter(34467),i=0;i<formats.length;i++)compressedTextureFormats.push(formats[i]);return compressedTextureFormats},useProgram:function(program){return currentProgram!==program&&(gl.useProgram(program),currentProgram=program,!0)},setBlending:setBlending,setMaterial:function(material,frontFaceCW){material.side===DoubleSide?disable(2884):enable(2884);var flipSided=material.side===BackSide;frontFaceCW&&(flipSided=!flipSided),setFlipSided(flipSided),material.blending===NormalBlending&&!1===material.transparent?setBlending(NoBlending):setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst,material.blendEquationAlpha,material.blendSrcAlpha,material.blendDstAlpha,material.premultipliedAlpha),depthBuffer.setFunc(material.depthFunc),depthBuffer.setTest(material.depthTest),depthBuffer.setMask(material.depthWrite),colorBuffer.setMask(material.colorWrite),setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits)},setFlipSided:setFlipSided,setCullFace:setCullFace,setLineWidth:function(width){width!==currentLineWidth&&(lineWidthAvailable&&gl.lineWidth(width),currentLineWidth=width)},setPolygonOffset:setPolygonOffset,setScissorTest:function(scissorTest){scissorTest?enable(3089):disable(3089)},activeTexture:activeTexture,bindTexture:function(webglType,webglTexture){null===currentTextureSlot&&activeTexture();var boundTexture=currentBoundTextures[currentTextureSlot];void 0===boundTexture&&(boundTexture={type:void 0,texture:void 0},currentBoundTextures[currentTextureSlot]=boundTexture),boundTexture.type===webglType&&boundTexture.texture===webglTexture||(gl.bindTexture(webglType,webglTexture||emptyTextures[webglType]),boundTexture.type=webglType,boundTexture.texture=webglTexture)},compressedTexImage2D:function(){try{gl.compressedTexImage2D.apply(gl,arguments)}catch(error){console.error("THREE.WebGLState:",error)}},texImage2D:function(){try{gl.texImage2D.apply(gl,arguments)}catch(error){console.error("THREE.WebGLState:",error)}},texImage3D:function(){try{gl.texImage3D.apply(gl,arguments)}catch(error){console.error("THREE.WebGLState:",error)}},scissor:function(scissor){!1===currentScissor.equals(scissor)&&(gl.scissor(scissor.x,scissor.y,scissor.z,scissor.w),currentScissor.copy(scissor))},viewport:function(viewport){!1===currentViewport.equals(viewport)&&(gl.viewport(viewport.x,viewport.y,viewport.z,viewport.w),currentViewport.copy(viewport))},reset:function(){for(var i=0;i<enabledAttributes.length;i++)1===enabledAttributes[i]&&(gl.disableVertexAttribArray(i),enabledAttributes[i]=0);enabledCapabilities={},currentBoundTextures={},currentCullFace=currentFlipSided=currentBlending=currentProgram=currentTextureSlot=compressedTextureFormats=null,colorBuffer.reset(),depthBuffer.reset(),stencilBuffer.reset()}}}function WebGLTextures(_gl,extensions,state,properties,capabilities,utils,info){var _canvas,_videoTextures={},useOffscreenCanvas="undefined"!=typeof OffscreenCanvas;function createCanvas(width,height){return useOffscreenCanvas?new OffscreenCanvas(width,height):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function resizeImage(image,needsPowerOfTwo,needsNewCanvas,maxSize){var scale=1;if((image.width>maxSize||image.height>maxSize)&&(scale=maxSize/Math.max(image.width,image.height)),scale<1||!0===needsPowerOfTwo){if("undefined"!=typeof HTMLImageElement&&image instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&image instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&image instanceof ImageBitmap){var floor=needsPowerOfTwo?_Math.floorPowerOfTwo:Math.floor,width=floor(scale*image.width),height=floor(scale*image.height);void 0===_canvas&&(_canvas=createCanvas(width,height));var canvas=needsNewCanvas?createCanvas(width,height):_canvas;return canvas.width=width,canvas.height=height,canvas.getContext("2d").drawImage(image,0,0,width,height),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+image.width+"x"+image.height+") to ("+width+"x"+height+")."),canvas}return"data"in image&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+image.width+"x"+image.height+")."),image}return image}function isPowerOfTwo(image){return _Math.isPowerOfTwo(image.width)&&_Math.isPowerOfTwo(image.height)}function textureNeedsGenerateMipmaps(texture,supportsMips){return texture.generateMipmaps&&supportsMips&&texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter}function generateMipmap(target,texture,width,height){_gl.generateMipmap(target),properties.get(texture).__maxMipLevel=Math.log(Math.max(width,height))*Math.LOG2E}function getInternalFormat(glFormat,glType){if(!capabilities.isWebGL2)return glFormat;var internalFormat=glFormat;return 6403===glFormat&&(5126===glType&&(internalFormat=33326),5131===glType&&(internalFormat=33325),5121===glType&&(internalFormat=33321)),6407===glFormat&&(5126===glType&&(internalFormat=34837),5131===glType&&(internalFormat=34843),5121===glType&&(internalFormat=32849)),6408===glFormat&&(5126===glType&&(internalFormat=34836),5131===glType&&(internalFormat=34842),5121===glType&&(internalFormat=32856)),33325===internalFormat||33326===internalFormat||34842===internalFormat||34836===internalFormat?extensions.get("EXT_color_buffer_float"):34843!==internalFormat&&34837!==internalFormat||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),internalFormat}function filterFallback(f){return f===NearestFilter||f===NearestMipMapNearestFilter||f===NearestMipMapLinearFilter?9728:9729}function onTextureDispose(event){var texture=event.target;texture.removeEventListener("dispose",onTextureDispose),function(texture){var textureProperties=properties.get(texture);if(void 0===textureProperties.__webglInit)return;_gl.deleteTexture(textureProperties.__webglTexture),properties.remove(texture)}(texture),texture.isVideoTexture&&delete _videoTextures[texture.id],info.memory.textures--}function onRenderTargetDispose(event){var renderTarget=event.target;renderTarget.removeEventListener("dispose",onRenderTargetDispose),function(renderTarget){var renderTargetProperties=properties.get(renderTarget),textureProperties=properties.get(renderTarget.texture);if(!renderTarget)return;void 0!==textureProperties.__webglTexture&&_gl.deleteTexture(textureProperties.__webglTexture);renderTarget.depthTexture&&renderTarget.depthTexture.dispose();if(renderTarget.isWebGLRenderTargetCube)for(var i=0;i<6;i++)_gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer[i]),renderTargetProperties.__webglDepthbuffer&&_gl.deleteRenderbuffer(renderTargetProperties.__webglDepthbuffer[i]);else _gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer),renderTargetProperties.__webglDepthbuffer&&_gl.deleteRenderbuffer(renderTargetProperties.__webglDepthbuffer);properties.remove(renderTarget.texture),properties.remove(renderTarget)}(renderTarget),info.memory.textures--}var textureUnits=0;function setTexture2D(texture,slot){var textureProperties=properties.get(texture);if(texture.isVideoTexture&&function(texture){var id=texture.id,frame=info.render.frame;_videoTextures[id]!==frame&&(_videoTextures[id]=frame,texture.update())}(texture),0<texture.version&&textureProperties.__version!==texture.version){var image=texture.image;if(void 0===image)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==image.complete)return void uploadTexture(textureProperties,texture,slot);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}state.activeTexture(33984+slot),state.bindTexture(3553,textureProperties.__webglTexture)}function setTextureCube(texture,slot){var textureProperties=properties.get(texture);if(6===texture.image.length)if(0<texture.version&&textureProperties.__version!==texture.version){initTexture(textureProperties,texture),state.activeTexture(33984+slot),state.bindTexture(34067,textureProperties.__webglTexture),_gl.pixelStorei(37440,texture.flipY);for(var isCompressed=texture&&texture.isCompressedTexture,isDataTexture=texture.image[0]&&texture.image[0].isDataTexture,cubeImage=[],i=0;i<6;i++)cubeImage[i]=isCompressed||isDataTexture?isDataTexture?texture.image[i].image:texture.image[i]:resizeImage(texture.image[i],!1,!0,capabilities.maxCubemapSize);var image=cubeImage[0],supportsMips=isPowerOfTwo(image)||capabilities.isWebGL2,glFormat=utils.convert(texture.format),glType=utils.convert(texture.type),glInternalFormat=getInternalFormat(glFormat,glType);setTextureParameters(34067,texture,supportsMips);for(i=0;i<6;i++)if(isCompressed)for(var mipmap,mipmaps=cubeImage[i].mipmaps,j=0,jl=mipmaps.length;j<jl;j++)mipmap=mipmaps[j],texture.format!==RGBAFormat&&texture.format!==RGBFormat?-1<state.getCompressedTextureFormats().indexOf(glFormat)?state.compressedTexImage2D(34069+i,j,glInternalFormat,mipmap.width,mipmap.height,0,mipmap.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):state.texImage2D(34069+i,j,glInternalFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data);else isDataTexture?state.texImage2D(34069+i,0,glInternalFormat,cubeImage[i].width,cubeImage[i].height,0,glFormat,glType,cubeImage[i].data):state.texImage2D(34069+i,0,glInternalFormat,glFormat,glType,cubeImage[i]);textureProperties.__maxMipLevel=isCompressed?mipmaps.length-1:0,textureNeedsGenerateMipmaps(texture,supportsMips)&&generateMipmap(34067,texture,image.width,image.height),textureProperties.__version=texture.version,texture.onUpdate&&texture.onUpdate(texture)}else state.activeTexture(33984+slot),state.bindTexture(34067,textureProperties.__webglTexture)}function setTextureCubeDynamic(texture,slot){state.activeTexture(33984+slot),state.bindTexture(34067,properties.get(texture).__webglTexture)}function setTextureParameters(textureType,texture,supportsMips){var extension;if(supportsMips?(_gl.texParameteri(textureType,10242,utils.convert(texture.wrapS)),_gl.texParameteri(textureType,10243,utils.convert(texture.wrapT)),32879!==textureType&&35866!==textureType||_gl.texParameteri(textureType,32882,utils.convert(texture.wrapR)),_gl.texParameteri(textureType,10240,utils.convert(texture.magFilter)),_gl.texParameteri(textureType,10241,utils.convert(texture.minFilter))):(_gl.texParameteri(textureType,10242,33071),_gl.texParameteri(textureType,10243,33071),32879!==textureType&&35866!==textureType||_gl.texParameteri(textureType,32882,33071),texture.wrapS===ClampToEdgeWrapping&&texture.wrapT===ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),_gl.texParameteri(textureType,10240,filterFallback(texture.magFilter)),_gl.texParameteri(textureType,10241,filterFallback(texture.minFilter)),texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),extension=extensions.get("EXT_texture_filter_anisotropic")){if(texture.type===FloatType&&null===extensions.get("OES_texture_float_linear"))return;if(texture.type===HalfFloatType&&null===(capabilities.isWebGL2||extensions.get("OES_texture_half_float_linear")))return;(1<texture.anisotropy||properties.get(texture).__currentAnisotropy)&&(_gl.texParameterf(textureType,extension.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(texture.anisotropy,capabilities.getMaxAnisotropy())),properties.get(texture).__currentAnisotropy=texture.anisotropy)}}function initTexture(textureProperties,texture){void 0===textureProperties.__webglInit&&(textureProperties.__webglInit=!0,texture.addEventListener("dispose",onTextureDispose),textureProperties.__webglTexture=_gl.createTexture(),info.memory.textures++)}function uploadTexture(textureProperties,texture,slot){var textureType=3553;texture.isDataTexture2DArray&&(textureType=35866),texture.isDataTexture3D&&(textureType=32879),initTexture(textureProperties,texture),state.activeTexture(33984+slot),state.bindTexture(textureType,textureProperties.__webglTexture),_gl.pixelStorei(37440,texture.flipY),_gl.pixelStorei(37441,texture.premultiplyAlpha),_gl.pixelStorei(3317,texture.unpackAlignment);var needsPowerOfTwo=function(texture){return!capabilities.isWebGL2&&(texture.wrapS!==ClampToEdgeWrapping||texture.wrapT!==ClampToEdgeWrapping||texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter)}(texture)&&!1===isPowerOfTwo(texture.image),image=resizeImage(texture.image,needsPowerOfTwo,!1,capabilities.maxTextureSize),supportsMips=isPowerOfTwo(image)||capabilities.isWebGL2,glFormat=utils.convert(texture.format),glType=utils.convert(texture.type),glInternalFormat=getInternalFormat(glFormat,glType);setTextureParameters(textureType,texture,supportsMips);var mipmap,mipmaps=texture.mipmaps;if(texture.isDepthTexture){if(glInternalFormat=6402,texture.type===FloatType){if(!capabilities.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");glInternalFormat=36012}else capabilities.isWebGL2&&(glInternalFormat=33189);texture.format===DepthFormat&&6402===glInternalFormat&&texture.type!==UnsignedShortType&&texture.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),texture.type=UnsignedShortType,glType=utils.convert(texture.type)),texture.format===DepthStencilFormat&&(glInternalFormat=34041,texture.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),texture.type=UnsignedInt248Type,glType=utils.convert(texture.type))),state.texImage2D(3553,0,glInternalFormat,image.width,image.height,0,glFormat,glType,null)}else if(texture.isDataTexture)if(0<mipmaps.length&&supportsMips){for(var i=0,il=mipmaps.length;i<il;i++)mipmap=mipmaps[i],state.texImage2D(3553,i,glInternalFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data);texture.generateMipmaps=!1,textureProperties.__maxMipLevel=mipmaps.length-1}else state.texImage2D(3553,0,glInternalFormat,image.width,image.height,0,glFormat,glType,image.data),textureProperties.__maxMipLevel=0;else if(texture.isCompressedTexture){for(i=0,il=mipmaps.length;i<il;i++)mipmap=mipmaps[i],texture.format!==RGBAFormat&&texture.format!==RGBFormat?-1<state.getCompressedTextureFormats().indexOf(glFormat)?state.compressedTexImage2D(3553,i,glInternalFormat,mipmap.width,mipmap.height,0,mipmap.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):state.texImage2D(3553,i,glInternalFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data);textureProperties.__maxMipLevel=mipmaps.length-1}else if(texture.isDataTexture2DArray)state.texImage3D(35866,0,glInternalFormat,image.width,image.height,image.depth,0,glFormat,glType,image.data),textureProperties.__maxMipLevel=0;else if(texture.isDataTexture3D)state.texImage3D(32879,0,glInternalFormat,image.width,image.height,image.depth,0,glFormat,glType,image.data),textureProperties.__maxMipLevel=0;else if(0<mipmaps.length&&supportsMips){for(i=0,il=mipmaps.length;i<il;i++)mipmap=mipmaps[i],state.texImage2D(3553,i,glInternalFormat,glFormat,glType,mipmap);texture.generateMipmaps=!1,textureProperties.__maxMipLevel=mipmaps.length-1}else state.texImage2D(3553,0,glInternalFormat,glFormat,glType,image),textureProperties.__maxMipLevel=0;textureNeedsGenerateMipmaps(texture,supportsMips)&&generateMipmap(3553,texture,image.width,image.height),textureProperties.__version=texture.version,texture.onUpdate&&texture.onUpdate(texture)}function setupFrameBufferTexture(framebuffer,renderTarget,attachment,textureTarget){var glFormat=utils.convert(renderTarget.texture.format),glType=utils.convert(renderTarget.texture.type),glInternalFormat=getInternalFormat(glFormat,glType);state.texImage2D(textureTarget,0,glInternalFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null),_gl.bindFramebuffer(36160,framebuffer),_gl.framebufferTexture2D(36160,attachment,textureTarget,properties.get(renderTarget.texture).__webglTexture,0),_gl.bindFramebuffer(36160,null)}function setupRenderBufferStorage(renderbuffer,renderTarget,isMultisample){if(_gl.bindRenderbuffer(36161,renderbuffer),renderTarget.depthBuffer&&!renderTarget.stencilBuffer){if(isMultisample){var samples=getRenderTargetSamples(renderTarget);_gl.renderbufferStorageMultisample(36161,samples,33189,renderTarget.width,renderTarget.height)}else _gl.renderbufferStorage(36161,33189,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(36160,36096,36161,renderbuffer)}else if(renderTarget.depthBuffer&&renderTarget.stencilBuffer){if(isMultisample){samples=getRenderTargetSamples(renderTarget);_gl.renderbufferStorageMultisample(36161,samples,34041,renderTarget.width,renderTarget.height)}else _gl.renderbufferStorage(36161,34041,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(36160,33306,36161,renderbuffer)}else{var glInternalFormat=getInternalFormat(utils.convert(renderTarget.texture.format),utils.convert(renderTarget.texture.type));if(isMultisample){samples=getRenderTargetSamples(renderTarget);_gl.renderbufferStorageMultisample(36161,samples,glInternalFormat,renderTarget.width,renderTarget.height)}else _gl.renderbufferStorage(36161,glInternalFormat,renderTarget.width,renderTarget.height)}_gl.bindRenderbuffer(36161,null)}function setupDepthRenderbuffer(renderTarget){var renderTargetProperties=properties.get(renderTarget),isCube=!0===renderTarget.isWebGLRenderTargetCube;if(renderTarget.depthTexture){if(isCube)throw new Error("target.depthTexture not supported in Cube render targets");!function(framebuffer,renderTarget){if(renderTarget&&renderTarget.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(_gl.bindFramebuffer(36160,framebuffer),!renderTarget.depthTexture||!renderTarget.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");properties.get(renderTarget.depthTexture).__webglTexture&&renderTarget.depthTexture.image.width===renderTarget.width&&renderTarget.depthTexture.image.height===renderTarget.height||(renderTarget.depthTexture.image.width=renderTarget.width,renderTarget.depthTexture.image.height=renderTarget.height,renderTarget.depthTexture.needsUpdate=!0),setTexture2D(renderTarget.depthTexture,0);var webglDepthTexture=properties.get(renderTarget.depthTexture).__webglTexture;if(renderTarget.depthTexture.format===DepthFormat)_gl.framebufferTexture2D(36160,36096,3553,webglDepthTexture,0);else{if(renderTarget.depthTexture.format!==DepthStencilFormat)throw new Error("Unknown depthTexture format");_gl.framebufferTexture2D(36160,33306,3553,webglDepthTexture,0)}}(renderTargetProperties.__webglFramebuffer,renderTarget)}else if(isCube){renderTargetProperties.__webglDepthbuffer=[];for(var i=0;i<6;i++)_gl.bindFramebuffer(36160,renderTargetProperties.__webglFramebuffer[i]),renderTargetProperties.__webglDepthbuffer[i]=_gl.createRenderbuffer(),setupRenderBufferStorage(renderTargetProperties.__webglDepthbuffer[i],renderTarget)}else _gl.bindFramebuffer(36160,renderTargetProperties.__webglFramebuffer),renderTargetProperties.__webglDepthbuffer=_gl.createRenderbuffer(),setupRenderBufferStorage(renderTargetProperties.__webglDepthbuffer,renderTarget);_gl.bindFramebuffer(36160,null)}function getRenderTargetSamples(renderTarget){return capabilities.isWebGL2&&renderTarget.isWebGLMultisampleRenderTarget?Math.min(capabilities.maxSamples,renderTarget.samples):0}var warnedTexture2D=!1,warnedTextureCube=!1;this.allocateTextureUnit=function(){var textureUnit=textureUnits;return textureUnit>=capabilities.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+textureUnit+" texture units while this GPU supports only "+capabilities.maxTextures),textureUnits+=1,textureUnit},this.resetTextureUnits=function(){textureUnits=0},this.setTexture2D=setTexture2D,this.setTexture2DArray=function(texture,slot){var textureProperties=properties.get(texture);0<texture.version&&textureProperties.__version!==texture.version?uploadTexture(textureProperties,texture,slot):(state.activeTexture(33984+slot),state.bindTexture(35866,textureProperties.__webglTexture))},this.setTexture3D=function(texture,slot){var textureProperties=properties.get(texture);0<texture.version&&textureProperties.__version!==texture.version?uploadTexture(textureProperties,texture,slot):(state.activeTexture(33984+slot),state.bindTexture(32879,textureProperties.__webglTexture))},this.setTextureCube=setTextureCube,this.setTextureCubeDynamic=setTextureCubeDynamic,this.setupRenderTarget=function(renderTarget){var renderTargetProperties=properties.get(renderTarget),textureProperties=properties.get(renderTarget.texture);renderTarget.addEventListener("dispose",onRenderTargetDispose),textureProperties.__webglTexture=_gl.createTexture(),info.memory.textures++;var isCube=!0===renderTarget.isWebGLRenderTargetCube,isMultisample=!0===renderTarget.isWebGLMultisampleRenderTarget,supportsMips=isPowerOfTwo(renderTarget)||capabilities.isWebGL2;if(isCube){renderTargetProperties.__webglFramebuffer=[];for(var i=0;i<6;i++)renderTargetProperties.__webglFramebuffer[i]=_gl.createFramebuffer()}else if(renderTargetProperties.__webglFramebuffer=_gl.createFramebuffer(),isMultisample)if(capabilities.isWebGL2){renderTargetProperties.__webglMultisampledFramebuffer=_gl.createFramebuffer(),renderTargetProperties.__webglColorRenderbuffer=_gl.createRenderbuffer(),_gl.bindRenderbuffer(36161,renderTargetProperties.__webglColorRenderbuffer);var glInternalFormat=getInternalFormat(utils.convert(renderTarget.texture.format),utils.convert(renderTarget.texture.type)),samples=getRenderTargetSamples(renderTarget);_gl.renderbufferStorageMultisample(36161,samples,glInternalFormat,renderTarget.width,renderTarget.height),_gl.bindFramebuffer(36160,renderTargetProperties.__webglMultisampledFramebuffer),_gl.framebufferRenderbuffer(36160,36064,36161,renderTargetProperties.__webglColorRenderbuffer),_gl.bindRenderbuffer(36161,null),renderTarget.depthBuffer&&(renderTargetProperties.__webglDepthRenderbuffer=_gl.createRenderbuffer(),setupRenderBufferStorage(renderTargetProperties.__webglDepthRenderbuffer,renderTarget,!0)),_gl.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(isCube){state.bindTexture(34067,textureProperties.__webglTexture),setTextureParameters(34067,renderTarget.texture,supportsMips);for(i=0;i<6;i++)setupFrameBufferTexture(renderTargetProperties.__webglFramebuffer[i],renderTarget,36064,34069+i);textureNeedsGenerateMipmaps(renderTarget.texture,supportsMips)&&generateMipmap(34067,renderTarget.texture,renderTarget.width,renderTarget.height),state.bindTexture(34067,null)}else state.bindTexture(3553,textureProperties.__webglTexture),setTextureParameters(3553,renderTarget.texture,supportsMips),setupFrameBufferTexture(renderTargetProperties.__webglFramebuffer,renderTarget,36064,3553),textureNeedsGenerateMipmaps(renderTarget.texture,supportsMips)&&generateMipmap(3553,renderTarget.texture,renderTarget.width,renderTarget.height),state.bindTexture(3553,null);renderTarget.depthBuffer&&setupDepthRenderbuffer(renderTarget)},this.updateRenderTargetMipmap=function(renderTarget){var texture=renderTarget.texture;if(textureNeedsGenerateMipmaps(texture,isPowerOfTwo(renderTarget)||capabilities.isWebGL2)){var target=renderTarget.isWebGLRenderTargetCube?34067:3553,webglTexture=properties.get(texture).__webglTexture;state.bindTexture(target,webglTexture),generateMipmap(target,texture,renderTarget.width,renderTarget.height),state.bindTexture(target,null)}},this.updateMultisampleRenderTarget=function(renderTarget){if(renderTarget.isWebGLMultisampleRenderTarget)if(capabilities.isWebGL2){var renderTargetProperties=properties.get(renderTarget);_gl.bindFramebuffer(36008,renderTargetProperties.__webglMultisampledFramebuffer),_gl.bindFramebuffer(36009,renderTargetProperties.__webglFramebuffer);var width=renderTarget.width,height=renderTarget.height,mask=16384;renderTarget.depthBuffer&&(mask|=256),renderTarget.stencilBuffer&&(mask|=1024),_gl.blitFramebuffer(0,0,width,height,0,0,width,height,mask,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(texture,slot){texture&&texture.isWebGLRenderTarget&&(!1===warnedTexture2D&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),warnedTexture2D=!0),texture=texture.texture),setTexture2D(texture,slot)},this.safeSetTextureCube=function(texture,slot){texture&&texture.isWebGLRenderTargetCube&&(!1===warnedTextureCube&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),warnedTextureCube=!0),texture=texture.texture),texture&&texture.isCubeTexture||Array.isArray(texture.image)&&6===texture.image.length?setTextureCube(texture,slot):setTextureCubeDynamic(texture,slot)}}function WebGLUtils(gl,extensions,capabilities){return{convert:function(p){var extension;if(p===RepeatWrapping)return 10497;if(p===ClampToEdgeWrapping)return 33071;if(p===MirroredRepeatWrapping)return 33648;if(p===NearestFilter)return 9728;if(p===NearestMipMapNearestFilter)return 9984;if(p===NearestMipMapLinearFilter)return 9986;if(p===LinearFilter)return 9729;if(p===LinearMipMapNearestFilter)return 9985;if(p===LinearMipMapLinearFilter)return 9987;if(p===UnsignedByteType)return 5121;if(p===UnsignedShort4444Type)return 32819;if(p===UnsignedShort5551Type)return 32820;if(p===UnsignedShort565Type)return 33635;if(p===ByteType)return 5120;if(p===ShortType)return 5122;if(p===UnsignedShortType)return 5123;if(p===IntType)return 5124;if(p===UnsignedIntType)return 5125;if(p===FloatType)return 5126;if(p===HalfFloatType){if(capabilities.isWebGL2)return 5131;if(null!==(extension=extensions.get("OES_texture_half_float")))return extension.HALF_FLOAT_OES}if(p===AlphaFormat)return 6406;if(p===RGBFormat)return 6407;if(p===RGBAFormat)return 6408;if(p===LuminanceFormat)return 6409;if(p===LuminanceAlphaFormat)return 6410;if(p===DepthFormat)return 6402;if(p===DepthStencilFormat)return 34041;if(p===RedFormat)return 6403;if(p===AddEquation)return 32774;if(p===SubtractEquation)return 32778;if(p===ReverseSubtractEquation)return 32779;if(p===ZeroFactor)return 0;if(p===OneFactor)return 1;if(p===SrcColorFactor)return 768;if(p===OneMinusSrcColorFactor)return 769;if(p===SrcAlphaFactor)return 770;if(p===OneMinusSrcAlphaFactor)return 771;if(p===DstAlphaFactor)return 772;if(p===OneMinusDstAlphaFactor)return 773;if(p===DstColorFactor)return 774;if(p===OneMinusDstColorFactor)return 775;if(p===SrcAlphaSaturateFactor)return 776;if((p===RGB_S3TC_DXT1_Format||p===RGBA_S3TC_DXT1_Format||p===RGBA_S3TC_DXT3_Format||p===RGBA_S3TC_DXT5_Format)&&null!==(extension=extensions.get("WEBGL_compressed_texture_s3tc"))){if(p===RGB_S3TC_DXT1_Format)return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;if(p===RGBA_S3TC_DXT1_Format)return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(p===RGBA_S3TC_DXT3_Format)return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(p===RGBA_S3TC_DXT5_Format)return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((p===RGB_PVRTC_4BPPV1_Format||p===RGB_PVRTC_2BPPV1_Format||p===RGBA_PVRTC_4BPPV1_Format||p===RGBA_PVRTC_2BPPV1_Format)&&null!==(extension=extensions.get("WEBGL_compressed_texture_pvrtc"))){if(p===RGB_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(p===RGB_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(p===RGBA_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(p===RGBA_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(p===RGB_ETC1_Format&&null!==(extension=extensions.get("WEBGL_compressed_texture_etc1")))return extension.COMPRESSED_RGB_ETC1_WEBGL;if((p===RGBA_ASTC_4x4_Format||p===RGBA_ASTC_5x4_Format||p===RGBA_ASTC_5x5_Format||p===RGBA_ASTC_6x5_Format||p===RGBA_ASTC_6x6_Format||p===RGBA_ASTC_8x5_Format||p===RGBA_ASTC_8x6_Format||p===RGBA_ASTC_8x8_Format||p===RGBA_ASTC_10x5_Format||p===RGBA_ASTC_10x6_Format||p===RGBA_ASTC_10x8_Format||p===RGBA_ASTC_10x10_Format||p===RGBA_ASTC_12x10_Format||p===RGBA_ASTC_12x12_Format)&&null!==(extension=extensions.get("WEBGL_compressed_texture_astc")))return p;if(p===MinEquation||p===MaxEquation){if(capabilities.isWebGL2){if(p===MinEquation)return 32775;if(p===MaxEquation)return 32776}if(null!==(extension=extensions.get("EXT_blend_minmax"))){if(p===MinEquation)return extension.MIN_EXT;if(p===MaxEquation)return extension.MAX_EXT}}if(p===UnsignedInt248Type){if(capabilities.isWebGL2)return 34042;if(null!==(extension=extensions.get("WEBGL_depth_texture")))return extension.UNSIGNED_INT_24_8_WEBGL}return 0}}}function Group(){Object3D.call(this),this.type="Group"}function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}function PerspectiveCamera(fov,aspect,near,far){Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==fov?fov:50,this.zoom=1,this.near=void 0!==near?near:.1,this.far=void 0!==far?far:2e3,this.focus=10,this.aspect=void 0!==aspect?aspect:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function ArrayCamera(array){PerspectiveCamera.call(this),this.cameras=array||[]}((MeshDepthMaterial.prototype=Object.create(Material.prototype)).constructor=MeshDepthMaterial).prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.depthPacking=source.depthPacking,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.map=source.map,this.alphaMap=source.alphaMap,this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this},((MeshDistanceMaterial.prototype=Object.create(Material.prototype)).constructor=MeshDistanceMaterial).prototype.isMeshDistanceMaterial=!0,MeshDistanceMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.referencePosition.copy(source.referencePosition),this.nearDistance=source.nearDistance,this.farDistance=source.farDistance,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.map=source.map,this.alphaMap=source.alphaMap,this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this},Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0}),Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(source,recursive){return Object3D.prototype.copy.call(this,source,recursive),this.matrixWorldInverse.copy(source.matrixWorldInverse),this.projectionMatrix.copy(source.projectionMatrix),this.projectionMatrixInverse.copy(source.projectionMatrixInverse),this},getWorldDirection:function(target){void 0===target&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),target=new Vector3),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return target.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(force){Object3D.prototype.updateMatrixWorld.call(this,force),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(source,recursive){return Camera.prototype.copy.call(this,source,recursive),this.fov=source.fov,this.zoom=source.zoom,this.near=source.near,this.far=source.far,this.focus=source.focus,this.aspect=source.aspect,this.view=null===source.view?null:Object.assign({},source.view),this.filmGauge=source.filmGauge,this.filmOffset=source.filmOffset,this},setFocalLength:function(focalLength){var vExtentSlope=.5*this.getFilmHeight()/focalLength;this.fov=2*_Math.RAD2DEG*Math.atan(vExtentSlope),this.updateProjectionMatrix()},getFocalLength:function(){var vExtentSlope=Math.tan(.5*_Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/vExtentSlope},getEffectiveFOV:function(){return 2*_Math.RAD2DEG*Math.atan(Math.tan(.5*_Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(fullWidth,fullHeight,x,y,width,height){this.aspect=fullWidth/fullHeight,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=fullWidth,this.view.fullHeight=fullHeight,this.view.offsetX=x,this.view.offsetY=y,this.view.width=width,this.view.height=height,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var near=this.near,top=near*Math.tan(.5*_Math.DEG2RAD*this.fov)/this.zoom,height=2*top,width=this.aspect*height,left=-.5*width,view=this.view;if(null!==this.view&&this.view.enabled){var fullWidth=view.fullWidth,fullHeight=view.fullHeight;left+=view.offsetX*width/fullWidth,top-=view.offsetY*height/fullHeight,width*=view.width/fullWidth,height*=view.height/fullHeight}var skew=this.filmOffset;0!==skew&&(left+=near*skew/this.getFilmWidth()),this.projectionMatrix.makePerspective(left,left+width,top,top-height,near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);return data.object.fov=this.fov,data.object.zoom=this.zoom,data.object.near=this.near,data.object.far=this.far,data.object.focus=this.focus,data.object.aspect=this.aspect,null!==this.view&&(data.object.view=Object.assign({},this.view)),data.object.filmGauge=this.filmGauge,data.object.filmOffset=this.filmOffset,data}}),ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0});var geometry,intersectPoint,worldScale,mvPosition,alignedPosition,rotatedPosition,viewWorldMatrix,vA,vB,vC,uvA,uvB,uvC,matrixPosition,offsetMatrix,identityMatrix,start,end,cameraLPos=new Vector3,cameraRPos=new Vector3;function setProjectionFromUnion(camera,cameraL,cameraR){cameraLPos.setFromMatrixPosition(cameraL.matrixWorld),cameraRPos.setFromMatrixPosition(cameraR.matrixWorld);var ipd=cameraLPos.distanceTo(cameraRPos),projL=cameraL.projectionMatrix.elements,projR=cameraR.projectionMatrix.elements,near=projL[14]/(projL[10]-1),far=projL[14]/(projL[10]+1),topFov=(projL[9]+1)/projL[5],bottomFov=(projL[9]-1)/projL[5],leftFov=(projL[8]-1)/projL[0],rightFov=(projR[8]+1)/projR[0],left=near*leftFov,right=near*rightFov,zOffset=ipd/(rightFov-leftFov),xOffset=zOffset*-leftFov;cameraL.matrixWorld.decompose(camera.position,camera.quaternion,camera.scale),camera.translateX(xOffset),camera.translateZ(zOffset),camera.matrixWorld.compose(camera.position,camera.quaternion,camera.scale),camera.matrixWorldInverse.getInverse(camera.matrixWorld);var near2=near+zOffset,far2=far+zOffset,left2=left-xOffset,right2=ipd-xOffset+right,top2=topFov*far/far2*near2,bottom2=bottomFov*far/far2*near2;camera.projectionMatrix.makePerspective(left2,right2,top2,bottom2,near2,far2)}function WebVRManager(renderer){var scope=this,device=null,frameData=null,poseTarget=null,controllers=[],standingMatrix=new Matrix4,standingMatrixInverse=new Matrix4,framebufferScaleFactor=1,frameOfReferenceType="stage";"undefined"!=typeof window&&"VRFrameData"in window&&(frameData=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",onVRDisplayPresentChange,!1));var matrixWorldInverse=new Matrix4,tempQuaternion=new Quaternion,tempPosition=new Vector3,cameraL=new PerspectiveCamera;cameraL.bounds=new Vector4(0,0,.5,1),cameraL.layers.enable(1);var cameraR=new PerspectiveCamera;cameraR.bounds=new Vector4(.5,0,.5,1),cameraR.layers.enable(2);var cameraVR=new ArrayCamera([cameraL,cameraR]);function isPresenting(){return null!==device&&!0===device.isPresenting}cameraVR.layers.enable(1),cameraVR.layers.enable(2);var currentPixelRatio,currentSize=new Vector2;function onVRDisplayPresentChange(){if(isPresenting()){var eyeParameters=device.getEyeParameters("left"),renderWidth=eyeParameters.renderWidth*framebufferScaleFactor,renderHeight=eyeParameters.renderHeight*framebufferScaleFactor;currentPixelRatio=renderer.getPixelRatio(),renderer.getSize(currentSize),renderer.setDrawingBufferSize(2*renderWidth,renderHeight,1),animation.start()}else scope.enabled&&renderer.setDrawingBufferSize(currentSize.width,currentSize.height,currentPixelRatio),animation.stop()}var triggers=[];function findGamepad(id){for(var gamepads=navigator.getGamepads&&navigator.getGamepads(),i=0,j=0,l=gamepads.length;i<l;i++){var gamepad=gamepads[i];if(gamepad&&("Daydream Controller"===gamepad.id||"Gear VR Controller"===gamepad.id||"Oculus Go Controller"===gamepad.id||"OpenVR Gamepad"===gamepad.id||gamepad.id.startsWith("Oculus Touch")||gamepad.id.startsWith("Spatial Controller"))){if(j===id)return gamepad;j++}}}this.enabled=!1,this.getController=function(id){var controller=controllers[id];return void 0===controller&&((controller=new Group).matrixAutoUpdate=!1,controller.visible=!1,controllers[id]=controller),controller},this.getDevice=function(){return device},this.setDevice=function(value){void 0!==value&&(device=value),animation.setContext(value)},this.setFramebufferScaleFactor=function(value){framebufferScaleFactor=value},this.setFrameOfReferenceType=function(value){frameOfReferenceType=value},this.setPoseTarget=function(object){void 0!==object&&(poseTarget=object)},this.getCamera=function(camera){var userHeight="stage"===frameOfReferenceType?1.6:0;if(!1===isPresenting())return camera.position.set(0,userHeight,0),camera.rotation.set(0,0,0),camera;if(device.depthNear=camera.near,device.depthFar=camera.far,device.getFrameData(frameData),"stage"===frameOfReferenceType){var stageParameters=device.stageParameters;stageParameters?standingMatrix.fromArray(stageParameters.sittingToStandingTransform):standingMatrix.makeTranslation(0,userHeight,0)}var pose=frameData.pose,poseObject=null!==poseTarget?poseTarget:camera;poseObject.matrix.copy(standingMatrix),poseObject.matrix.decompose(poseObject.position,poseObject.quaternion,poseObject.scale),null!==pose.orientation&&(tempQuaternion.fromArray(pose.orientation),poseObject.quaternion.multiply(tempQuaternion)),null!==pose.position&&(tempQuaternion.setFromRotationMatrix(standingMatrix),tempPosition.fromArray(pose.position),tempPosition.applyQuaternion(tempQuaternion),poseObject.position.add(tempPosition)),poseObject.updateMatrixWorld(),cameraL.near=camera.near,cameraR.near=camera.near,cameraL.far=camera.far,cameraR.far=camera.far,cameraL.matrixWorldInverse.fromArray(frameData.leftViewMatrix),cameraR.matrixWorldInverse.fromArray(frameData.rightViewMatrix),standingMatrixInverse.getInverse(standingMatrix),"stage"===frameOfReferenceType&&(cameraL.matrixWorldInverse.multiply(standingMatrixInverse),cameraR.matrixWorldInverse.multiply(standingMatrixInverse));var parent=poseObject.parent;null!==parent&&(matrixWorldInverse.getInverse(parent.matrixWorld),cameraL.matrixWorldInverse.multiply(matrixWorldInverse),cameraR.matrixWorldInverse.multiply(matrixWorldInverse)),cameraL.matrixWorld.getInverse(cameraL.matrixWorldInverse),cameraR.matrixWorld.getInverse(cameraR.matrixWorldInverse),cameraL.projectionMatrix.fromArray(frameData.leftProjectionMatrix),cameraR.projectionMatrix.fromArray(frameData.rightProjectionMatrix),setProjectionFromUnion(cameraVR,cameraL,cameraR);var layers=device.getLayers();if(layers.length){var layer=layers[0];null!==layer.leftBounds&&4===layer.leftBounds.length&&cameraL.bounds.fromArray(layer.leftBounds),null!==layer.rightBounds&&4===layer.rightBounds.length&&cameraR.bounds.fromArray(layer.rightBounds)}return function(){for(var i=0;i<controllers.length;i++){var controller=controllers[i],gamepad=findGamepad(i);if(void 0!==gamepad&&void 0!==gamepad.pose){if(null===gamepad.pose)return;var pose=gamepad.pose;!1===pose.hasPosition&&controller.position.set(.2,-.6,-.05),null!==pose.position&&controller.position.fromArray(pose.position),null!==pose.orientation&&controller.quaternion.fromArray(pose.orientation),controller.matrix.compose(controller.position,controller.quaternion,controller.scale),controller.matrix.premultiply(standingMatrix),controller.matrix.decompose(controller.position,controller.quaternion,controller.scale),controller.matrixWorldNeedsUpdate=!0,controller.visible=!0;var buttonId="Daydream Controller"===gamepad.id?0:1;triggers[i]!==gamepad.buttons[buttonId].pressed&&(triggers[i]=gamepad.buttons[buttonId].pressed,!0===triggers[i]?controller.dispatchEvent({type:"selectstart"}):(controller.dispatchEvent({type:"selectend"}),controller.dispatchEvent({type:"select"})))}else controller.visible=!1}}(),cameraVR},this.getStandingMatrix=function(){return standingMatrix},this.isPresenting=isPresenting;var animation=new WebGLAnimation;this.setAnimationLoop=function(callback){animation.setAnimationLoop(callback),isPresenting()&&animation.start()},this.submitFrame=function(){isPresenting()&&device.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",onVRDisplayPresentChange)}}function WebXRManager(renderer){var gl=renderer.context,device=null,session=null,framebufferScaleFactor=1,frameOfReference=null,frameOfReferenceType="stage",pose=null,controllers=[],inputSources=[];function isPresenting(){return null!==session&&null!==frameOfReference}var cameraL=new PerspectiveCamera;cameraL.layers.enable(1),cameraL.viewport=new Vector4;var cameraR=new PerspectiveCamera;cameraR.layers.enable(2),cameraR.viewport=new Vector4;var cameraVR=new ArrayCamera([cameraL,cameraR]);function onSessionEvent(event){var controller=controllers[inputSources.indexOf(event.inputSource)];controller&&controller.dispatchEvent({type:event.type})}function onSessionEnd(){renderer.setFramebuffer(null),renderer.setRenderTarget(renderer.getRenderTarget()),animation.stop()}function updateCamera(camera,parent){null===parent?camera.matrixWorld.copy(camera.matrix):camera.matrixWorld.multiplyMatrices(parent.matrixWorld,camera.matrix),camera.matrixWorldInverse.getInverse(camera.matrixWorld)}cameraVR.layers.enable(1),cameraVR.layers.enable(2),this.enabled=!1,this.getController=function(id){var controller=controllers[id];return void 0===controller&&((controller=new Group).matrixAutoUpdate=!1,controller.visible=!1,controllers[id]=controller),controller},this.getDevice=function(){return device},this.setDevice=function(value){void 0!==value&&(device=value),value instanceof XRDevice&&gl.setCompatibleXRDevice(value)},this.setFramebufferScaleFactor=function(value){framebufferScaleFactor=value},this.setFrameOfReferenceType=function(value){frameOfReferenceType=value},this.setSession=function(value){null!==(session=value)&&(session.addEventListener("select",onSessionEvent),session.addEventListener("selectstart",onSessionEvent),session.addEventListener("selectend",onSessionEvent),session.addEventListener("end",onSessionEnd),session.baseLayer=new XRWebGLLayer(session,gl,{framebufferScaleFactor:framebufferScaleFactor}),session.requestFrameOfReference(frameOfReferenceType).then(function(value){frameOfReference=value,renderer.setFramebuffer(session.baseLayer.framebuffer),animation.setContext(session),animation.start()}),inputSources=session.getInputSources(),session.addEventListener("inputsourceschange",function(){inputSources=session.getInputSources(),console.log(inputSources);for(var i=0;i<controllers.length;i++){controllers[i].userData.inputSource=inputSources[i]}}))},this.getCamera=function(camera){if(isPresenting()){var parent=camera.parent,cameras=cameraVR.cameras;updateCamera(cameraVR,parent);for(var i=0;i<cameras.length;i++)updateCamera(cameras[i],parent);camera.matrixWorld.copy(cameraVR.matrixWorld);for(var children=camera.children,l=(i=0,children.length);i<l;i++)children[i].updateMatrixWorld(!0);return setProjectionFromUnion(cameraVR,cameraL,cameraR),cameraVR}return camera},this.isPresenting=isPresenting;var onAnimationFrameCallback=null;var animation=new WebGLAnimation;animation.setAnimationLoop(function(time,frame){if(null!==(pose=frame.getDevicePose(frameOfReference)))for(var layer=session.baseLayer,views=frame.views,i=0;i<views.length;i++){var view=views[i],viewport=layer.getViewport(view),viewMatrix=pose.getViewMatrix(view),camera=cameraVR.cameras[i];camera.matrix.fromArray(viewMatrix).getInverse(camera.matrix),camera.projectionMatrix.fromArray(view.projectionMatrix),camera.viewport.set(viewport.x,viewport.y,viewport.width,viewport.height),0===i&&cameraVR.matrix.copy(camera.matrix)}for(i=0;i<controllers.length;i++){var controller=controllers[i],inputSource=inputSources[i];if(inputSource){var inputPose=frame.getInputPose(inputSource,frameOfReference);if(null!==inputPose){"targetRay"in inputPose?controller.matrix.elements=inputPose.targetRay.transformMatrix:"pointerMatrix"in inputPose&&(controller.matrix.elements=inputPose.pointerMatrix),controller.matrix.decompose(controller.position,controller.rotation,controller.scale),controller.visible=!0;continue}}controller.visible=!1}onAnimationFrameCallback&&onAnimationFrameCallback(time)}),this.setAnimationLoop=function(callback){onAnimationFrameCallback=callback},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new Matrix4},this.submitFrame=function(){}}function WebGLRenderer(parameters){console.log("THREE.WebGLRenderer","104");var _canvas=void 0!==(parameters=parameters||{}).canvas?parameters.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),_context=void 0!==parameters.context?parameters.context:null,_alpha=void 0!==parameters.alpha&&parameters.alpha,_depth=void 0===parameters.depth||parameters.depth,_stencil=void 0===parameters.stencil||parameters.stencil,_antialias=void 0!==parameters.antialias&&parameters.antialias,_premultipliedAlpha=void 0===parameters.premultipliedAlpha||parameters.premultipliedAlpha,_preserveDrawingBuffer=void 0!==parameters.preserveDrawingBuffer&&parameters.preserveDrawingBuffer,_powerPreference=void 0!==parameters.powerPreference?parameters.powerPreference:"default",currentRenderList=null,currentRenderState=null;this.domElement=_canvas,this.context=null,this.debug={checkShaderErrors:!1},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=LinearToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var _gl,extensions,capabilities,state,info,properties,textures,attributes,geometries,objects,programCache,renderLists,renderStates,background,morphtargets,bufferRenderer,indexedBufferRenderer,utils,_this=this,_isContextLost=!1,_framebuffer=null,_currentRenderTarget=null,_currentFramebuffer=null,_currentMaterialId=-1,_currentGeometryProgram={geometry:null,program:null,wireframe:!1},_currentCamera=null,_currentArrayCamera=null,_currentViewport=new Vector4,_currentScissor=new Vector4,_currentScissorTest=null,_width=_canvas.width,_height=_canvas.height,_pixelRatio=1,_viewport=new Vector4(0,0,_width,_height),_scissor=new Vector4(0,0,_width,_height),_scissorTest=!1,_frustum=new Frustum,_clipping=new WebGLClipping,_clippingEnabled=!1,_localClippingEnabled=!1,_projScreenMatrix=new Matrix4,_vector3=new Vector3;function getTargetPixelRatio(){return null===_currentRenderTarget?_pixelRatio:1}try{var contextAttributes={alpha:_alpha,depth:_depth,stencil:_stencil,antialias:_antialias,premultipliedAlpha:_premultipliedAlpha,preserveDrawingBuffer:_preserveDrawingBuffer,powerPreference:_powerPreference};if(_canvas.addEventListener("webglcontextlost",onContextLost,!1),_canvas.addEventListener("webglcontextrestored",onContextRestore,!1),null===(_gl=_context||_canvas.getContext("webgl",contextAttributes)||_canvas.getContext("experimental-webgl",contextAttributes)))throw null!==_canvas.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===_gl.getShaderPrecisionFormat&&(_gl.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(error){throw console.error("THREE.WebGLRenderer: "+error.message),error}function initGLContext(){extensions=new WebGLExtensions(_gl),(capabilities=new WebGLCapabilities(_gl,extensions,parameters)).isWebGL2||(extensions.get("WEBGL_depth_texture"),extensions.get("OES_texture_float"),extensions.get("OES_texture_half_float"),extensions.get("OES_texture_half_float_linear"),extensions.get("OES_standard_derivatives"),extensions.get("OES_element_index_uint"),extensions.get("ANGLE_instanced_arrays")),extensions.get("OES_texture_float_linear"),utils=new WebGLUtils(_gl,extensions,capabilities),(state=new WebGLState(_gl,extensions,utils,capabilities)).scissor(_currentScissor.copy(_scissor).multiplyScalar(_pixelRatio)),state.viewport(_currentViewport.copy(_viewport).multiplyScalar(_pixelRatio)),info=new WebGLInfo(_gl),properties=new WebGLProperties,textures=new WebGLTextures(_gl,extensions,state,properties,capabilities,utils,info),attributes=new WebGLAttributes(_gl),geometries=new WebGLGeometries(_gl,attributes,info),objects=new WebGLObjects(geometries,info),morphtargets=new WebGLMorphtargets(_gl),programCache=new WebGLPrograms(_this,extensions,capabilities,textures),renderLists=new WebGLRenderLists,renderStates=new WebGLRenderStates,background=new WebGLBackground(_this,state,objects,_premultipliedAlpha),bufferRenderer=new WebGLBufferRenderer(_gl,extensions,info,capabilities),indexedBufferRenderer=new WebGLIndexedBufferRenderer(_gl,extensions,info,capabilities),info.programs=programCache.programs,_this.context=_gl,_this.capabilities=capabilities,_this.extensions=extensions,_this.properties=properties,_this.renderLists=renderLists,_this.state=state,_this.info=info}initGLContext();var vr="undefined"!=typeof navigator&&"xr"in navigator?new WebXRManager(_this):new WebVRManager(_this);this.vr=vr;var shadowMap=new WebGLShadowMap(_this,objects,capabilities.maxTextureSize);function onContextLost(event){event.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_isContextLost=!0}function onContextRestore(){console.log("THREE.WebGLRenderer: Context Restored."),_isContextLost=!1,initGLContext()}function onMaterialDispose(event){var material=event.target;material.removeEventListener("dispose",onMaterialDispose),function(material){releaseMaterialProgramReference(material),properties.remove(material)}(material)}function releaseMaterialProgramReference(material){var programInfo=properties.get(material).program;(material.program=void 0)!==programInfo&&programCache.releaseProgram(programInfo)}this.shadowMap=shadowMap,this.getContext=function(){return _gl},this.getContextAttributes=function(){return _gl.getContextAttributes()},this.forceContextLoss=function(){var extension=extensions.get("WEBGL_lose_context");extension&&extension.loseContext()},this.forceContextRestore=function(){var extension=extensions.get("WEBGL_lose_context");extension&&extension.restoreContext()},this.getPixelRatio=function(){return _pixelRatio},this.setPixelRatio=function(value){void 0!==value&&(_pixelRatio=value,this.setSize(_width,_height,!1))},this.getSize=function(target){return void 0===target&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),target=new Vector2),target.set(_width,_height)},this.setSize=function(width,height,updateStyle){vr.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(_width=width,_height=height,_canvas.width=width*_pixelRatio,_canvas.height=height*_pixelRatio,!1!==updateStyle&&(_canvas.style.width=width+"px",_canvas.style.height=height+"px"),this.setViewport(0,0,width,height))},this.getDrawingBufferSize=function(target){return void 0===target&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),target=new Vector2),target.set(_width*_pixelRatio,_height*_pixelRatio)},this.setDrawingBufferSize=function(width,height,pixelRatio){_width=width,_height=height,_pixelRatio=pixelRatio,_canvas.width=width*pixelRatio,_canvas.height=height*pixelRatio,this.setViewport(0,0,width,height)},this.getCurrentViewport=function(target){return void 0===target&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),target=new Vector4),target.copy(_currentViewport)},this.getViewport=function(target){return target.copy(_viewport)},this.setViewport=function(x,y,width,height){x.isVector4?_viewport.set(x.x,x.y,x.z,x.w):_viewport.set(x,y,width,height),state.viewport(_currentViewport.copy(_viewport).multiplyScalar(_pixelRatio))},this.getScissor=function(target){return target.copy(_scissor)},this.setScissor=function(x,y,width,height){x.isVector4?_scissor.set(x.x,x.y,x.z,x.w):_scissor.set(x,y,width,height),state.scissor(_currentScissor.copy(_scissor).multiplyScalar(_pixelRatio))},this.getScissorTest=function(){return _scissorTest},this.setScissorTest=function(boolean){state.setScissorTest(_scissorTest=boolean)},this.getClearColor=function(){return background.getClearColor()},this.setClearColor=function(){background.setClearColor.apply(background,arguments)},this.getClearAlpha=function(){return background.getClearAlpha()},this.setClearAlpha=function(){background.setClearAlpha.apply(background,arguments)},this.clear=function(color,depth,stencil){var bits=0;void 0!==color&&!color||(bits|=16384),void 0!==depth&&!depth||(bits|=256),void 0!==stencil&&!stencil||(bits|=1024),_gl.clear(bits)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){_canvas.removeEventListener("webglcontextlost",onContextLost,!1),_canvas.removeEventListener("webglcontextrestored",onContextRestore,!1),renderLists.dispose(),renderStates.dispose(),properties.dispose(),objects.dispose(),vr.dispose(),animation.stop()},this.renderBufferImmediate=function(object,program){state.initAttributes();var buffers=properties.get(object);object.hasPositions&&!buffers.position&&(buffers.position=_gl.createBuffer()),object.hasNormals&&!buffers.normal&&(buffers.normal=_gl.createBuffer()),object.hasUvs&&!buffers.uv&&(buffers.uv=_gl.createBuffer()),object.hasColors&&!buffers.color&&(buffers.color=_gl.createBuffer());var programAttributes=program.getAttributes();object.hasPositions&&(_gl.bindBuffer(34962,buffers.position),_gl.bufferData(34962,object.positionArray,35048),state.enableAttribute(programAttributes.position),_gl.vertexAttribPointer(programAttributes.position,3,5126,!1,0,0)),object.hasNormals&&(_gl.bindBuffer(34962,buffers.normal),_gl.bufferData(34962,object.normalArray,35048),state.enableAttribute(programAttributes.normal),_gl.vertexAttribPointer(programAttributes.normal,3,5126,!1,0,0)),object.hasUvs&&(_gl.bindBuffer(34962,buffers.uv),_gl.bufferData(34962,object.uvArray,35048),state.enableAttribute(programAttributes.uv),_gl.vertexAttribPointer(programAttributes.uv,2,5126,!1,0,0)),object.hasColors&&(_gl.bindBuffer(34962,buffers.color),_gl.bufferData(34962,object.colorArray,35048),state.enableAttribute(programAttributes.color),_gl.vertexAttribPointer(programAttributes.color,3,5126,!1,0,0)),state.disableUnusedAttributes(),_gl.drawArrays(4,0,object.count),object.count=0},this.renderBufferDirect=function(camera,fog,geometry,material,object,group){var frontFaceCW=object.isMesh&&object.matrixWorld.determinant()<0;state.setMaterial(material,frontFaceCW);var program=setProgram(camera,fog,material,object),updateBuffers=!1;_currentGeometryProgram.geometry===geometry.id&&_currentGeometryProgram.program===program.id&&_currentGeometryProgram.wireframe===(!0===material.wireframe)||(_currentGeometryProgram.geometry=geometry.id,_currentGeometryProgram.program=program.id,_currentGeometryProgram.wireframe=!0===material.wireframe,updateBuffers=!0),object.morphTargetInfluences&&(morphtargets.update(object,geometry,material,program),updateBuffers=!0);var attribute,index=geometry.index,position=geometry.attributes.position,rangeFactor=1;!0===material.wireframe&&(index=geometries.getWireframeAttribute(geometry),rangeFactor=2);var renderer=bufferRenderer;null!==index&&(attribute=attributes.get(index),(renderer=indexedBufferRenderer).setIndex(attribute)),updateBuffers&&(function(material,program,geometry){if(geometry&&geometry.isInstancedBufferGeometry&&!capabilities.isWebGL2&&null===extensions.get("ANGLE_instanced_arrays"))return console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");state.initAttributes();var geometryAttributes=geometry.attributes,programAttributes=program.getAttributes(),materialDefaultAttributeValues=material.defaultAttributeValues;for(var name in programAttributes){var programAttribute=programAttributes[name];if(0<=programAttribute){var geometryAttribute=geometryAttributes[name];if(void 0!==geometryAttribute){var normalized=geometryAttribute.normalized,size=geometryAttribute.itemSize,attribute=attributes.get(geometryAttribute);if(void 0===attribute)continue;var buffer=attribute.buffer,type=attribute.type,bytesPerElement=attribute.bytesPerElement;if(geometryAttribute.isInterleavedBufferAttribute){var data=geometryAttribute.data,stride=data.stride,offset=geometryAttribute.offset;data&&data.isInstancedInterleavedBuffer?(state.enableAttributeAndDivisor(programAttribute,data.meshPerAttribute),void 0===geometry.maxInstancedCount&&(geometry.maxInstancedCount=data.meshPerAttribute*data.count)):state.enableAttribute(programAttribute),_gl.bindBuffer(34962,buffer),_gl.vertexAttribPointer(programAttribute,size,type,normalized,stride*bytesPerElement,offset*bytesPerElement)}else geometryAttribute.isInstancedBufferAttribute?(state.enableAttributeAndDivisor(programAttribute,geometryAttribute.meshPerAttribute),void 0===geometry.maxInstancedCount&&(geometry.maxInstancedCount=geometryAttribute.meshPerAttribute*geometryAttribute.count)):state.enableAttribute(programAttribute),_gl.bindBuffer(34962,buffer),_gl.vertexAttribPointer(programAttribute,size,type,normalized,0,0)}else if(void 0!==materialDefaultAttributeValues){var value=materialDefaultAttributeValues[name];if(void 0!==value)switch(value.length){case 2:_gl.vertexAttrib2fv(programAttribute,value);break;case 3:_gl.vertexAttrib3fv(programAttribute,value);break;case 4:_gl.vertexAttrib4fv(programAttribute,value);break;default:_gl.vertexAttrib1fv(programAttribute,value)}}}}state.disableUnusedAttributes()}(material,program,geometry),null!==index&&_gl.bindBuffer(34963,attribute.buffer));var dataCount=1/0;null!==index?dataCount=index.count:void 0!==position&&(dataCount=position.count);var rangeStart=geometry.drawRange.start*rangeFactor,rangeCount=geometry.drawRange.count*rangeFactor,groupStart=null!==group?group.start*rangeFactor:0,groupCount=null!==group?group.count*rangeFactor:1/0,drawStart=Math.max(rangeStart,groupStart),drawEnd=Math.min(dataCount,rangeStart+rangeCount,groupStart+groupCount)-1,drawCount=Math.max(0,drawEnd-drawStart+1);if(0!==drawCount){if(object.isMesh)if(!0===material.wireframe)state.setLineWidth(material.wireframeLinewidth*getTargetPixelRatio()),renderer.setMode(1);else switch(object.drawMode){case TrianglesDrawMode:renderer.setMode(4);break;case 1:renderer.setMode(5);break;case 2:renderer.setMode(6)}else if(object.isLine){var lineWidth=material.linewidth;void 0===lineWidth&&(lineWidth=1),state.setLineWidth(lineWidth*getTargetPixelRatio()),object.isLineSegments?renderer.setMode(1):object.isLineLoop?renderer.setMode(2):renderer.setMode(3)}else object.isPoints?renderer.setMode(0):object.isSprite&&renderer.setMode(4);geometry&&geometry.isInstancedBufferGeometry?0<geometry.maxInstancedCount&&renderer.renderInstances(geometry,drawStart,drawCount):renderer.render(drawStart,drawCount)}},this.compile=function(scene,camera){(currentRenderState=renderStates.get(scene,camera)).init(),scene.traverse(function(object){object.isLight&&(currentRenderState.pushLight(object),object.castShadow&&currentRenderState.pushShadow(object))}),currentRenderState.setupLights(camera),scene.traverse(function(object){if(object.material)if(Array.isArray(object.material))for(var i=0;i<object.material.length;i++)initMaterial(object.material[i],scene.fog,object);else initMaterial(object.material,scene.fog,object)})};var onAnimationFrameCallback=null;var animation=new WebGLAnimation;function renderObjects(renderList,scene,camera,overrideMaterial){for(var i=0,l=renderList.length;i<l;i++){var renderItem=renderList[i],object=renderItem.object,geometry=renderItem.geometry,material=void 0===overrideMaterial?renderItem.material:overrideMaterial,group=renderItem.group;if(camera.isArrayCamera)for(var cameras=(_currentArrayCamera=camera).cameras,j=0,jl=cameras.length;j<jl;j++){var camera2=cameras[j];if(object.layers.test(camera2.layers)){if("viewport"in camera2)state.viewport(_currentViewport.copy(camera2.viewport));else{var bounds=camera2.bounds,x=bounds.x*_width,y=bounds.y*_height,width=bounds.z*_width,height=bounds.w*_height;state.viewport(_currentViewport.set(x,y,width,height).multiplyScalar(_pixelRatio))}currentRenderState.setupLights(camera2),renderObject(object,scene,camera2,geometry,material,group)}}else _currentArrayCamera=null,renderObject(object,scene,camera,geometry,material,group)}}function renderObject(object,scene,camera,geometry,material,group){if(object.onBeforeRender(_this,scene,camera,geometry,material,group),currentRenderState=renderStates.get(scene,_currentArrayCamera||camera),object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld),object.normalMatrix.getNormalMatrix(object.modelViewMatrix),object.isImmediateRenderObject){state.setMaterial(material);var program=setProgram(camera,scene.fog,material,object);_currentGeometryProgram.geometry=null,_currentGeometryProgram.program=null,_currentGeometryProgram.wireframe=!1,function(object,program){object.render(function(object){_this.renderBufferImmediate(object,program)})}(object,program)}else _this.renderBufferDirect(camera,scene.fog,geometry,material,object,group);object.onAfterRender(_this,scene,camera,geometry,material,group),currentRenderState=renderStates.get(scene,_currentArrayCamera||camera)}function initMaterial(material,fog,object){var materialProperties=properties.get(material),lights=currentRenderState.state.lights,shadowsArray=currentRenderState.state.shadowsArray,lightsHash=materialProperties.lightsHash,lightsStateHash=lights.state.hash,parameters=programCache.getParameters(material,lights.state,shadowsArray,fog,_clipping.numPlanes,_clipping.numIntersection,object),code=programCache.getProgramCode(material,parameters),program=materialProperties.program,programChange=!0;if(void 0===program)material.addEventListener("dispose",onMaterialDispose);else if(program.code!==code)releaseMaterialProgramReference(material);else if(lightsHash.stateID!==lightsStateHash.stateID||lightsHash.directionalLength!==lightsStateHash.directionalLength||lightsHash.pointLength!==lightsStateHash.pointLength||lightsHash.spotLength!==lightsStateHash.spotLength||lightsHash.rectAreaLength!==lightsStateHash.rectAreaLength||lightsHash.hemiLength!==lightsStateHash.hemiLength||lightsHash.shadowsLength!==lightsStateHash.shadowsLength)lightsHash.stateID=lightsStateHash.stateID,lightsHash.directionalLength=lightsStateHash.directionalLength,lightsHash.pointLength=lightsStateHash.pointLength,lightsHash.spotLength=lightsStateHash.spotLength,lightsHash.rectAreaLength=lightsStateHash.rectAreaLength,lightsHash.hemiLength=lightsStateHash.hemiLength,lightsHash.shadowsLength=lightsStateHash.shadowsLength,programChange=!1;else{if(void 0!==parameters.shaderID)return;programChange=!1}if(programChange){if(parameters.shaderID){var shader=ShaderLib[parameters.shaderID];materialProperties.shader={name:material.type,uniforms:cloneUniforms(shader.uniforms),vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader}}else materialProperties.shader={name:material.type,uniforms:material.uniforms,vertexShader:material.vertexShader,fragmentShader:material.fragmentShader};material.onBeforeCompile(materialProperties.shader,_this),code=programCache.getProgramCode(material,parameters),program=programCache.acquireProgram(material,materialProperties.shader,parameters,code),materialProperties.program=program,material.program=program}var programAttributes=program.getAttributes();if(material.morphTargets)for(var i=material.numSupportedMorphTargets=0;i<_this.maxMorphTargets;i++)0<=programAttributes["morphTarget"+i]&&material.numSupportedMorphTargets++;if(material.morphNormals)for(i=material.numSupportedMorphNormals=0;i<_this.maxMorphNormals;i++)0<=programAttributes["morphNormal"+i]&&material.numSupportedMorphNormals++;var uniforms=materialProperties.shader.uniforms;(material.isShaderMaterial||material.isRawShaderMaterial)&&!0!==material.clipping||(materialProperties.numClippingPlanes=_clipping.numPlanes,materialProperties.numIntersection=_clipping.numIntersection,uniforms.clippingPlanes=_clipping.uniform),materialProperties.fog=fog,void 0===lightsHash&&(materialProperties.lightsHash=lightsHash={}),lightsHash.stateID=lightsStateHash.stateID,lightsHash.directionalLength=lightsStateHash.directionalLength,lightsHash.pointLength=lightsStateHash.pointLength,lightsHash.spotLength=lightsStateHash.spotLength,lightsHash.rectAreaLength=lightsStateHash.rectAreaLength,lightsHash.hemiLength=lightsStateHash.hemiLength,lightsHash.shadowsLength=lightsStateHash.shadowsLength,material.lights&&(uniforms.ambientLightColor.value=lights.state.ambient,uniforms.lightProbe.value=lights.state.probe,uniforms.directionalLights.value=lights.state.directional,uniforms.spotLights.value=lights.state.spot,uniforms.rectAreaLights.value=lights.state.rectArea,uniforms.pointLights.value=lights.state.point,uniforms.hemisphereLights.value=lights.state.hemi,uniforms.directionalShadowMap.value=lights.state.directionalShadowMap,uniforms.directionalShadowMatrix.value=lights.state.directionalShadowMatrix,uniforms.spotShadowMap.value=lights.state.spotShadowMap,uniforms.spotShadowMatrix.value=lights.state.spotShadowMatrix,uniforms.pointShadowMap.value=lights.state.pointShadowMap,uniforms.pointShadowMatrix.value=lights.state.pointShadowMatrix);var progUniforms=materialProperties.program.getUniforms(),uniformsList=WebGLUniforms.seqWithValue(progUniforms.seq,uniforms);materialProperties.uniformsList=uniformsList}function setProgram(camera,fog,material,object){textures.resetTextureUnits();var materialProperties=properties.get(material),lights=currentRenderState.state.lights,lightsHash=materialProperties.lightsHash,lightsStateHash=lights.state.hash;if(_clippingEnabled&&(_localClippingEnabled||camera!==_currentCamera)){var useCache=camera===_currentCamera&&material.id===_currentMaterialId;_clipping.setState(material.clippingPlanes,material.clipIntersection,material.clipShadows,camera,materialProperties,useCache)}!1===material.needsUpdate&&(void 0===materialProperties.program?material.needsUpdate=!0:material.fog&&materialProperties.fog!==fog?material.needsUpdate=!0:(!material.lights||lightsHash.stateID===lightsStateHash.stateID&&lightsHash.directionalLength===lightsStateHash.directionalLength&&lightsHash.pointLength===lightsStateHash.pointLength&&lightsHash.spotLength===lightsStateHash.spotLength&&lightsHash.rectAreaLength===lightsStateHash.rectAreaLength&&lightsHash.hemiLength===lightsStateHash.hemiLength&&lightsHash.shadowsLength===lightsStateHash.shadowsLength)&&(void 0===materialProperties.numClippingPlanes||materialProperties.numClippingPlanes===_clipping.numPlanes&&materialProperties.numIntersection===_clipping.numIntersection)||(material.needsUpdate=!0)),material.needsUpdate&&(initMaterial(material,fog,object),material.needsUpdate=!1);var refreshProgram=!1,refreshMaterial=!1,refreshLights=!1,program=materialProperties.program,p_uniforms=program.getUniforms(),m_uniforms=materialProperties.shader.uniforms;if(state.useProgram(program.program)&&(refreshLights=refreshMaterial=refreshProgram=!0),material.id!==_currentMaterialId&&(_currentMaterialId=material.id,refreshMaterial=!0),refreshProgram||_currentCamera!==camera){if(p_uniforms.setValue(_gl,"projectionMatrix",camera.projectionMatrix),capabilities.logarithmicDepthBuffer&&p_uniforms.setValue(_gl,"logDepthBufFC",2/(Math.log(camera.far+1)/Math.LN2)),_currentCamera!==camera&&(_currentCamera=camera,refreshLights=refreshMaterial=!0),material.isShaderMaterial||material.isMeshPhongMaterial||material.isMeshStandardMaterial||material.envMap){var uCamPos=p_uniforms.map.cameraPosition;void 0!==uCamPos&&uCamPos.setValue(_gl,_vector3.setFromMatrixPosition(camera.matrixWorld))}(material.isMeshPhongMaterial||material.isMeshLambertMaterial||material.isMeshBasicMaterial||material.isMeshStandardMaterial||material.isShaderMaterial||material.skinning)&&p_uniforms.setValue(_gl,"viewMatrix",camera.matrixWorldInverse)}if(material.skinning){p_uniforms.setOptional(_gl,object,"bindMatrix"),p_uniforms.setOptional(_gl,object,"bindMatrixInverse");var skeleton=object.skeleton;if(skeleton){var bones=skeleton.bones;if(capabilities.floatVertexTextures){if(void 0===skeleton.boneTexture){var size=Math.sqrt(4*bones.length);size=_Math.ceilPowerOfTwo(size),size=Math.max(size,4);var boneMatrices=new Float32Array(size*size*4);boneMatrices.set(skeleton.boneMatrices);var boneTexture=new DataTexture(boneMatrices,size,size,RGBAFormat,FloatType);boneTexture.needsUpdate=!0,skeleton.boneMatrices=boneMatrices,skeleton.boneTexture=boneTexture,skeleton.boneTextureSize=size}p_uniforms.setValue(_gl,"boneTexture",skeleton.boneTexture,textures),p_uniforms.setValue(_gl,"boneTextureSize",skeleton.boneTextureSize)}else p_uniforms.setOptional(_gl,skeleton,"boneMatrices")}}return refreshMaterial&&(p_uniforms.setValue(_gl,"toneMappingExposure",_this.toneMappingExposure),p_uniforms.setValue(_gl,"toneMappingWhitePoint",_this.toneMappingWhitePoint),material.lights&&function(uniforms,value){uniforms.ambientLightColor.needsUpdate=value,uniforms.lightProbe.needsUpdate=value,uniforms.directionalLights.needsUpdate=value,uniforms.pointLights.needsUpdate=value,uniforms.spotLights.needsUpdate=value,uniforms.rectAreaLights.needsUpdate=value,uniforms.hemisphereLights.needsUpdate=value}(m_uniforms,refreshLights),fog&&material.fog&&function(uniforms,fog){uniforms.fogColor.value.copy(fog.color),fog.isFog?(uniforms.fogNear.value=fog.near,uniforms.fogFar.value=fog.far):fog.isFogExp2&&(uniforms.fogDensity.value=fog.density)}(m_uniforms,fog),material.isMeshBasicMaterial?refreshUniformsCommon(m_uniforms,material):material.isMeshLambertMaterial?(refreshUniformsCommon(m_uniforms,material),function(uniforms,material){material.emissiveMap&&(uniforms.emissiveMap.value=material.emissiveMap)}(m_uniforms,material)):material.isMeshPhongMaterial?(refreshUniformsCommon(m_uniforms,material),material.isMeshToonMaterial?function(uniforms,material){refreshUniformsPhong(uniforms,material),material.gradientMap&&(uniforms.gradientMap.value=material.gradientMap)}(m_uniforms,material):refreshUniformsPhong(m_uniforms,material)):material.isMeshStandardMaterial?(refreshUniformsCommon(m_uniforms,material),material.isMeshPhysicalMaterial?function(uniforms,material){refreshUniformsStandard(uniforms,material),uniforms.reflectivity.value=material.reflectivity,uniforms.clearCoat.value=material.clearCoat,uniforms.clearCoatRoughness.value=material.clearCoatRoughness}(m_uniforms,material):refreshUniformsStandard(m_uniforms,material)):material.isMeshMatcapMaterial?(refreshUniformsCommon(m_uniforms,material),function(uniforms,material){material.matcap&&(uniforms.matcap.value=material.matcap);material.bumpMap&&(uniforms.bumpMap.value=material.bumpMap,uniforms.bumpScale.value=material.bumpScale,material.side===BackSide&&(uniforms.bumpScale.value*=-1));material.normalMap&&(uniforms.normalMap.value=material.normalMap,uniforms.normalScale.value.copy(material.normalScale),material.side===BackSide&&uniforms.normalScale.value.negate());material.displacementMap&&(uniforms.displacementMap.value=material.displacementMap,uniforms.displacementScale.value=material.displacementScale,uniforms.displacementBias.value=material.displacementBias)}(m_uniforms,material)):material.isMeshDepthMaterial?(refreshUniformsCommon(m_uniforms,material),function(uniforms,material){material.displacementMap&&(uniforms.displacementMap.value=material.displacementMap,uniforms.displacementScale.value=material.displacementScale,uniforms.displacementBias.value=material.displacementBias)}(m_uniforms,material)):material.isMeshDistanceMaterial?(refreshUniformsCommon(m_uniforms,material),function(uniforms,material){material.displacementMap&&(uniforms.displacementMap.value=material.displacementMap,uniforms.displacementScale.value=material.displacementScale,uniforms.displacementBias.value=material.displacementBias);uniforms.referencePosition.value.copy(material.referencePosition),uniforms.nearDistance.value=material.nearDistance,uniforms.farDistance.value=material.farDistance}(m_uniforms,material)):material.isMeshNormalMaterial?(refreshUniformsCommon(m_uniforms,material),function(uniforms,material){material.bumpMap&&(uniforms.bumpMap.value=material.bumpMap,uniforms.bumpScale.value=material.bumpScale,material.side===BackSide&&(uniforms.bumpScale.value*=-1));material.normalMap&&(uniforms.normalMap.value=material.normalMap,uniforms.normalScale.value.copy(material.normalScale),material.side===BackSide&&uniforms.normalScale.value.negate());material.displacementMap&&(uniforms.displacementMap.value=material.displacementMap,uniforms.displacementScale.value=material.displacementScale,uniforms.displacementBias.value=material.displacementBias)}(m_uniforms,material)):material.isLineBasicMaterial?(function(uniforms,material){uniforms.diffuse.value.copy(material.color),uniforms.opacity.value=material.opacity}(m_uniforms,material),material.isLineDashedMaterial&&function(uniforms,material){uniforms.dashSize.value=material.dashSize,uniforms.totalSize.value=material.dashSize+material.gapSize,uniforms.scale.value=material.scale}(m_uniforms,material)):material.isPointsMaterial?function(uniforms,material){uniforms.diffuse.value.copy(material.color),uniforms.opacity.value=material.opacity,uniforms.size.value=material.size*_pixelRatio,uniforms.scale.value=.5*_height,uniforms.map.value=material.map,null!==material.map&&(!0===material.map.matrixAutoUpdate&&material.map.updateMatrix(),uniforms.uvTransform.value.copy(material.map.matrix))}(m_uniforms,material):material.isSpriteMaterial?function(uniforms,material){uniforms.diffuse.value.copy(material.color),uniforms.opacity.value=material.opacity,uniforms.rotation.value=material.rotation,uniforms.map.value=material.map,null!==material.map&&(!0===material.map.matrixAutoUpdate&&material.map.updateMatrix(),uniforms.uvTransform.value.copy(material.map.matrix))}(m_uniforms,material):material.isShadowMaterial&&(m_uniforms.color.value.copy(material.color),m_uniforms.opacity.value=material.opacity),void 0!==m_uniforms.ltc_1&&(m_uniforms.ltc_1.value=UniformsLib.LTC_1),void 0!==m_uniforms.ltc_2&&(m_uniforms.ltc_2.value=UniformsLib.LTC_2),WebGLUniforms.upload(_gl,materialProperties.uniformsList,m_uniforms,textures)),material.isShaderMaterial&&!0===material.uniformsNeedUpdate&&(WebGLUniforms.upload(_gl,materialProperties.uniformsList,m_uniforms,textures),material.uniformsNeedUpdate=!1),material.isSpriteMaterial&&p_uniforms.setValue(_gl,"center",object.center),p_uniforms.setValue(_gl,"modelViewMatrix",object.modelViewMatrix),p_uniforms.setValue(_gl,"normalMatrix",object.normalMatrix),p_uniforms.setValue(_gl,"modelMatrix",object.matrixWorld),program}function refreshUniformsCommon(uniforms,material){var uvScaleMap;uniforms.opacity.value=material.opacity,material.color&&uniforms.diffuse.value.copy(material.color),material.emissive&&uniforms.emissive.value.copy(material.emissive).multiplyScalar(material.emissiveIntensity),material.map&&(uniforms.map.value=material.map),material.alphaMap&&(uniforms.alphaMap.value=material.alphaMap),material.specularMap&&(uniforms.specularMap.value=material.specularMap),material.envMap&&(uniforms.envMap.value=material.envMap,uniforms.flipEnvMap.value=material.envMap.isCubeTexture?-1:1,uniforms.reflectivity.value=material.reflectivity,uniforms.refractionRatio.value=material.refractionRatio,uniforms.maxMipLevel.value=properties.get(material.envMap).__maxMipLevel),material.lightMap&&(uniforms.lightMap.value=material.lightMap,uniforms.lightMapIntensity.value=material.lightMapIntensity),material.aoMap&&(uniforms.aoMap.value=material.aoMap,uniforms.aoMapIntensity.value=material.aoMapIntensity),material.map?uvScaleMap=material.map:material.specularMap?uvScaleMap=material.specularMap:material.displacementMap?uvScaleMap=material.displacementMap:material.normalMap?uvScaleMap=material.normalMap:material.bumpMap?uvScaleMap=material.bumpMap:material.roughnessMap?uvScaleMap=material.roughnessMap:material.metalnessMap?uvScaleMap=material.metalnessMap:material.alphaMap?uvScaleMap=material.alphaMap:material.emissiveMap&&(uvScaleMap=material.emissiveMap),void 0!==uvScaleMap&&(uvScaleMap.isWebGLRenderTarget&&(uvScaleMap=uvScaleMap.texture),!0===uvScaleMap.matrixAutoUpdate&&uvScaleMap.updateMatrix(),uniforms.uvTransform.value.copy(uvScaleMap.matrix))}function refreshUniformsPhong(uniforms,material){uniforms.specular.value.copy(material.specular),uniforms.shininess.value=Math.max(material.shininess,1e-4),material.emissiveMap&&(uniforms.emissiveMap.value=material.emissiveMap),material.bumpMap&&(uniforms.bumpMap.value=material.bumpMap,uniforms.bumpScale.value=material.bumpScale,material.side===BackSide&&(uniforms.bumpScale.value*=-1)),material.normalMap&&(uniforms.normalMap.value=material.normalMap,uniforms.normalScale.value.copy(material.normalScale),material.side===BackSide&&uniforms.normalScale.value.negate()),material.displacementMap&&(uniforms.displacementMap.value=material.displacementMap,uniforms.displacementScale.value=material.displacementScale,uniforms.displacementBias.value=material.displacementBias)}function refreshUniformsStandard(uniforms,material){uniforms.roughness.value=material.roughness,uniforms.metalness.value=material.metalness,material.roughnessMap&&(uniforms.roughnessMap.value=material.roughnessMap),material.metalnessMap&&(uniforms.metalnessMap.value=material.metalnessMap),material.emissiveMap&&(uniforms.emissiveMap.value=material.emissiveMap),material.bumpMap&&(uniforms.bumpMap.value=material.bumpMap,uniforms.bumpScale.value=material.bumpScale,material.side===BackSide&&(uniforms.bumpScale.value*=-1)),material.normalMap&&(uniforms.normalMap.value=material.normalMap,uniforms.normalScale.value.copy(material.normalScale),material.side===BackSide&&uniforms.normalScale.value.negate()),material.displacementMap&&(uniforms.displacementMap.value=material.displacementMap,uniforms.displacementScale.value=material.displacementScale,uniforms.displacementBias.value=material.displacementBias),material.envMap&&(uniforms.envMapIntensity.value=material.envMapIntensity)}animation.setAnimationLoop(function(time){vr.isPresenting()||onAnimationFrameCallback&&onAnimationFrameCallback(time)}),"undefined"!=typeof window&&animation.setContext(window),this.setAnimationLoop=function(callback){onAnimationFrameCallback=callback,vr.setAnimationLoop(callback),animation.start()},this.render=function(scene,camera){var renderTarget,forceClear;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),renderTarget=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),forceClear=arguments[3]),camera&&camera.isCamera){if(!_isContextLost){_currentGeometryProgram.geometry=null,_currentGeometryProgram.program=null,_currentGeometryProgram.wireframe=!1,_currentMaterialId=-1,!(_currentCamera=null)===scene.autoUpdate&&scene.updateMatrixWorld(),null===camera.parent&&camera.updateMatrixWorld(),vr.enabled&&(camera=vr.getCamera(camera)),(currentRenderState=renderStates.get(scene,camera)).init(),scene.onBeforeRender(_this,scene,camera,renderTarget||_currentRenderTarget),_projScreenMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse),_frustum.setFromMatrix(_projScreenMatrix),_localClippingEnabled=this.localClippingEnabled,_clippingEnabled=_clipping.init(this.clippingPlanes,_localClippingEnabled,camera),(currentRenderList=renderLists.get(scene,camera)).init(),function projectObject(object,camera,groupOrder,sortObjects){if(!1===object.visible)return;var visible=object.layers.test(camera.layers);if(visible)if(object.isGroup)groupOrder=object.renderOrder;else if(object.isLight)currentRenderState.pushLight(object),object.castShadow&&currentRenderState.pushShadow(object);else if(object.isSprite){if(!object.frustumCulled||_frustum.intersectsSprite(object)){sortObjects&&_vector3.setFromMatrixPosition(object.matrixWorld).applyMatrix4(_projScreenMatrix);var geometry=objects.update(object),material=object.material;material.visible&&currentRenderList.push(object,geometry,material,groupOrder,_vector3.z,null)}}else if(object.isImmediateRenderObject)sortObjects&&_vector3.setFromMatrixPosition(object.matrixWorld).applyMatrix4(_projScreenMatrix),currentRenderList.push(object,null,object.material,groupOrder,_vector3.z,null);else if((object.isMesh||object.isLine||object.isPoints)&&(object.isSkinnedMesh&&object.skeleton.update(),!object.frustumCulled||_frustum.intersectsObject(object))){sortObjects&&_vector3.setFromMatrixPosition(object.matrixWorld).applyMatrix4(_projScreenMatrix);var geometry=objects.update(object),material=object.material;if(Array.isArray(material))for(var groups=geometry.groups,i=0,l=groups.length;i<l;i++){var group=groups[i],groupMaterial=material[group.materialIndex];groupMaterial&&groupMaterial.visible&&currentRenderList.push(object,geometry,groupMaterial,groupOrder,_vector3.z,group)}else material.visible&&currentRenderList.push(object,geometry,material,groupOrder,_vector3.z,null)}var children=object.children;for(var i=0,l=children.length;i<l;i++)projectObject(children[i],camera,groupOrder,sortObjects)}(scene,camera,0,_this.sortObjects),!0===_this.sortObjects&&currentRenderList.sort(),_clippingEnabled&&_clipping.beginShadows();var shadowsArray=currentRenderState.state.shadowsArray;shadowMap.render(shadowsArray,scene,camera),currentRenderState.setupLights(camera),_clippingEnabled&&_clipping.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==renderTarget&&this.setRenderTarget(renderTarget),background.render(currentRenderList,scene,camera,forceClear);var opaqueObjects=currentRenderList.opaque,transparentObjects=currentRenderList.transparent;if(scene.overrideMaterial){var overrideMaterial=scene.overrideMaterial;opaqueObjects.length&&renderObjects(opaqueObjects,scene,camera,overrideMaterial),transparentObjects.length&&renderObjects(transparentObjects,scene,camera,overrideMaterial)}else opaqueObjects.length&&renderObjects(opaqueObjects,scene,camera),transparentObjects.length&&renderObjects(transparentObjects,scene,camera);scene.onAfterRender(_this,scene,camera),null!==_currentRenderTarget&&(textures.updateRenderTargetMipmap(_currentRenderTarget),textures.updateMultisampleRenderTarget(_currentRenderTarget)),state.buffers.depth.setTest(!0),state.buffers.depth.setMask(!0),state.buffers.color.setMask(!0),state.setPolygonOffset(!1),vr.enabled&&vr.submitFrame(),currentRenderState=currentRenderList=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(value){_framebuffer=value},this.getRenderTarget=function(){return _currentRenderTarget},this.setRenderTarget=function(renderTarget,activeCubeFace,activeMipMapLevel){(_currentRenderTarget=renderTarget)&&void 0===properties.get(renderTarget).__webglFramebuffer&&textures.setupRenderTarget(renderTarget);var framebuffer=_framebuffer,isCube=!1;if(renderTarget){var __webglFramebuffer=properties.get(renderTarget).__webglFramebuffer;renderTarget.isWebGLRenderTargetCube?(framebuffer=__webglFramebuffer[activeCubeFace||0],isCube=!0):framebuffer=renderTarget.isWebGLMultisampleRenderTarget?properties.get(renderTarget).__webglMultisampledFramebuffer:__webglFramebuffer,_currentViewport.copy(renderTarget.viewport),_currentScissor.copy(renderTarget.scissor),_currentScissorTest=renderTarget.scissorTest}else _currentViewport.copy(_viewport).multiplyScalar(_pixelRatio),_currentScissor.copy(_scissor).multiplyScalar(_pixelRatio),_currentScissorTest=_scissorTest;if(_currentFramebuffer!==framebuffer&&(_gl.bindFramebuffer(36160,framebuffer),_currentFramebuffer=framebuffer),state.viewport(_currentViewport),state.scissor(_currentScissor),state.setScissorTest(_currentScissorTest),isCube){var textureProperties=properties.get(renderTarget.texture);_gl.framebufferTexture2D(36160,36064,34069+(activeCubeFace||0),textureProperties.__webglTexture,activeMipMapLevel||0)}},this.readRenderTargetPixels=function(renderTarget,x,y,width,height,buffer){if(renderTarget&&renderTarget.isWebGLRenderTarget){var framebuffer=properties.get(renderTarget).__webglFramebuffer;if(framebuffer){var restore=!1;framebuffer!==_currentFramebuffer&&(_gl.bindFramebuffer(36160,framebuffer),restore=!0);try{var texture=renderTarget.texture,textureFormat=texture.format,textureType=texture.type;if(textureFormat!==RGBAFormat&&utils.convert(textureFormat)!==_gl.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(textureType===UnsignedByteType||utils.convert(textureType)===_gl.getParameter(35738)||textureType===FloatType&&(capabilities.isWebGL2||extensions.get("OES_texture_float")||extensions.get("WEBGL_color_buffer_float"))||textureType===HalfFloatType&&(capabilities.isWebGL2?extensions.get("EXT_color_buffer_float"):extensions.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===_gl.checkFramebufferStatus(36160)?0<=x&&x<=renderTarget.width-width&&0<=y&&y<=renderTarget.height-height&&_gl.readPixels(x,y,width,height,utils.convert(textureFormat),utils.convert(textureType),buffer):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{restore&&_gl.bindFramebuffer(36160,_currentFramebuffer)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(position,texture,level){var width=texture.image.width,height=texture.image.height,glFormat=utils.convert(texture.format);textures.setTexture2D(texture,0),_gl.copyTexImage2D(3553,level||0,glFormat,position.x,position.y,width,height,0)},this.copyTextureToTexture=function(position,srcTexture,dstTexture,level){var width=srcTexture.image.width,height=srcTexture.image.height,glFormat=utils.convert(dstTexture.format),glType=utils.convert(dstTexture.type);textures.setTexture2D(dstTexture,0),srcTexture.isDataTexture?_gl.texSubImage2D(3553,level||0,position.x,position.y,width,height,glFormat,glType,srcTexture.image.data):_gl.texSubImage2D(3553,level||0,position.x,position.y,glFormat,glType,srcTexture.image)}}function FogExp2(color,density){this.name="",this.color=new Color(color),this.density=void 0!==density?density:25e-5}function Fog(color,near,far){this.name="",this.color=new Color(color),this.near=void 0!==near?near:1,this.far=void 0!==far?far:1e3}function Scene(){Object3D.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function InterleavedBuffer(array,stride){this.array=array,this.stride=stride,this.count=void 0!==array?array.length/stride:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function InterleavedBufferAttribute(interleavedBuffer,itemSize,offset,normalized){this.data=interleavedBuffer,this.itemSize=itemSize,this.offset=offset,this.normalized=!0===normalized}function SpriteMaterial(parameters){Material.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(parameters)}function Sprite(material){if(Object3D.call(this),this.type="Sprite",void 0===geometry){geometry=new BufferGeometry;var interleavedBuffer=new InterleavedBuffer(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);geometry.setIndex([0,1,2,0,2,3]),geometry.addAttribute("position",new InterleavedBufferAttribute(interleavedBuffer,3,0,!1)),geometry.addAttribute("uv",new InterleavedBufferAttribute(interleavedBuffer,2,3,!1))}this.geometry=geometry,this.material=void 0!==material?material:new SpriteMaterial,this.center=new Vector2(.5,.5)}function transformVertex(vertexPosition,mvPosition,center,scale,sin,cos){alignedPosition.subVectors(vertexPosition,center).addScalar(.5).multiply(scale),void 0!==sin?(rotatedPosition.x=cos*alignedPosition.x-sin*alignedPosition.y,rotatedPosition.y=sin*alignedPosition.x+cos*alignedPosition.y):rotatedPosition.copy(alignedPosition),vertexPosition.copy(mvPosition),vertexPosition.x+=rotatedPosition.x,vertexPosition.y+=rotatedPosition.y,vertexPosition.applyMatrix4(viewWorldMatrix)}function LOD(){Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function SkinnedMesh(geometry,material){geometry&&geometry.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Mesh.call(this,geometry,material),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}function Skeleton(bones,boneInverses){if(bones=bones||[],this.bones=bones.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===boneInverses)this.calculateInverses();else if(this.bones.length===boneInverses.length)this.boneInverses=boneInverses.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,il=this.bones.length;i<il;i++)this.boneInverses.push(new Matrix4)}}function Bone(){Object3D.call(this),this.type="Bone"}function LineBasicMaterial(parameters){Material.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(parameters)}function Line(geometry,material,mode){1===mode&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Object3D.call(this),this.type="Line",this.geometry=void 0!==geometry?geometry:new BufferGeometry,this.material=void 0!==material?material:new LineBasicMaterial({color:16777215*Math.random()})}function LineSegments(geometry,material){Line.call(this,geometry,material),this.type="LineSegments"}function LineLoop(geometry,material){Line.call(this,geometry,material),this.type="LineLoop"}function PointsMaterial(parameters){Material.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(parameters)}function Points(geometry,material){Object3D.call(this),this.type="Points",this.geometry=void 0!==geometry?geometry:new BufferGeometry,this.material=void 0!==material?material:new PointsMaterial({color:16777215*Math.random()})}function VideoTexture(video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){Texture.call(this,video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy),this.format=void 0!==format?format:RGBFormat,this.minFilter=void 0!==minFilter?minFilter:LinearFilter,this.magFilter=void 0!==magFilter?magFilter:LinearFilter,this.generateMipmaps=!1}function CompressedTexture(mipmaps,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,encoding){Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding),this.image={width:width,height:height},this.mipmaps=mipmaps,this.flipY=!1,this.generateMipmaps=!1}function CanvasTexture(canvas,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){Texture.call(this,canvas,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy),this.needsUpdate=!0}function DepthTexture(width,height,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,format){if((format=void 0!==format?format:DepthFormat)!==DepthFormat&&format!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===type&&format===DepthFormat&&(type=UnsignedShortType),void 0===type&&format===DepthStencilFormat&&(type=UnsignedInt248Type),Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy),this.image={width:width,height:height},this.magFilter=void 0!==magFilter?magFilter:NearestFilter,this.minFilter=void 0!==minFilter?minFilter:NearestFilter,this.flipY=!1,this.generateMipmaps=!1}function WireframeGeometry(geometry){BufferGeometry.call(this),this.type="WireframeGeometry";var i,j,l,o,ol,e,edge1,edge2,key,vertex,vertices=[],edge=[0,0],edges={},keys=["a","b","c"];if(geometry&&geometry.isGeometry){var faces=geometry.faces;for(i=0,l=faces.length;i<l;i++){var face=faces[i];for(j=0;j<3;j++)edge1=face[keys[j]],edge2=face[keys[(j+1)%3]],edge[0]=Math.min(edge1,edge2),edge[1]=Math.max(edge1,edge2),void 0===edges[key=edge[0]+","+edge[1]]&&(edges[key]={index1:edge[0],index2:edge[1]})}for(key in edges)e=edges[key],vertex=geometry.vertices[e.index1],vertices.push(vertex.x,vertex.y,vertex.z),vertex=geometry.vertices[e.index2],vertices.push(vertex.x,vertex.y,vertex.z)}else if(geometry&&geometry.isBufferGeometry){var position,indices,groups,group,index1,index2;if(vertex=new Vector3,null!==geometry.index){for(position=geometry.attributes.position,indices=geometry.index,0===(groups=geometry.groups).length&&(groups=[{start:0,count:indices.count,materialIndex:0}]),o=0,ol=groups.length;o<ol;++o)for(l=(i=(group=groups[o]).start)+group.count;i<l;i+=3)for(j=0;j<3;j++)edge1=indices.getX(i+j),edge2=indices.getX(i+(j+1)%3),edge[0]=Math.min(edge1,edge2),edge[1]=Math.max(edge1,edge2),void 0===edges[key=edge[0]+","+edge[1]]&&(edges[key]={index1:edge[0],index2:edge[1]});for(key in edges)e=edges[key],vertex.fromBufferAttribute(position,e.index1),vertices.push(vertex.x,vertex.y,vertex.z),vertex.fromBufferAttribute(position,e.index2),vertices.push(vertex.x,vertex.y,vertex.z)}else for(i=0,l=(position=geometry.attributes.position).count/3;i<l;i++)for(j=0;j<3;j++)index1=3*i+j,vertex.fromBufferAttribute(position,index1),vertices.push(vertex.x,vertex.y,vertex.z),index2=3*i+(j+1)%3,vertex.fromBufferAttribute(position,index2),vertices.push(vertex.x,vertex.y,vertex.z)}this.addAttribute("position",new Float32BufferAttribute(vertices,3))}function ParametricGeometry(func,slices,stacks){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:func,slices:slices,stacks:stacks},this.fromBufferGeometry(new ParametricBufferGeometry(func,slices,stacks)),this.mergeVertices()}function ParametricBufferGeometry(func,slices,stacks){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:func,slices:slices,stacks:stacks};var i,j,indices=[],vertices=[],normals=[],uvs=[],normal=new Vector3,p0=new Vector3,p1=new Vector3,pu=new Vector3,pv=new Vector3;func.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var sliceCount=slices+1;for(i=0;i<=stacks;i++){var v=i/stacks;for(j=0;j<=slices;j++){var u=j/slices;func(u,v,p0),vertices.push(p0.x,p0.y,p0.z),0<=u-1e-5?(func(u-1e-5,v,p1),pu.subVectors(p0,p1)):(func(1e-5+u,v,p1),pu.subVectors(p1,p0)),0<=v-1e-5?(func(u,v-1e-5,p1),pv.subVectors(p0,p1)):(func(u,1e-5+v,p1),pv.subVectors(p1,p0)),normal.crossVectors(pu,pv).normalize(),normals.push(normal.x,normal.y,normal.z),uvs.push(u,v)}}for(i=0;i<stacks;i++)for(j=0;j<slices;j++){var a=i*sliceCount+j,b=i*sliceCount+j+1,c=(i+1)*sliceCount+j+1,d=(i+1)*sliceCount+j;indices.push(a,b,d),indices.push(b,c,d)}this.setIndex(indices),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("normal",new Float32BufferAttribute(normals,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}function PolyhedronGeometry(vertices,indices,radius,detail){Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:vertices,indices:indices,radius:radius,detail:detail},this.fromBufferGeometry(new PolyhedronBufferGeometry(vertices,indices,radius,detail)),this.mergeVertices()}function PolyhedronBufferGeometry(vertices,indices,radius,detail){BufferGeometry.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:vertices,indices:indices,radius:radius,detail:detail},radius=radius||1;var vertexBuffer=[],uvBuffer=[];function subdivideFace(a,b,c,detail){var i,j,cols=Math.pow(2,detail),v=[];for(i=0;i<=cols;i++){v[i]=[];var aj=a.clone().lerp(c,i/cols),bj=b.clone().lerp(c,i/cols),rows=cols-i;for(j=0;j<=rows;j++)v[i][j]=0===j&&i===cols?aj:aj.clone().lerp(bj,j/rows)}for(i=0;i<cols;i++)for(j=0;j<2*(cols-i)-1;j++){var k=Math.floor(j/2);j%2==0?(pushVertex(v[i][k+1]),pushVertex(v[i+1][k]),pushVertex(v[i][k])):(pushVertex(v[i][k+1]),pushVertex(v[i+1][k+1]),pushVertex(v[i+1][k]))}}function pushVertex(vertex){vertexBuffer.push(vertex.x,vertex.y,vertex.z)}function getVertexByIndex(index,vertex){var stride=3*index;vertex.x=vertices[0+stride],vertex.y=vertices[1+stride],vertex.z=vertices[2+stride]}function correctUV(uv,stride,vector,azimuth){azimuth<0&&1===uv.x&&(uvBuffer[stride]=uv.x-1),0===vector.x&&0===vector.z&&(uvBuffer[stride]=azimuth/2/Math.PI+.5)}function azimuth(vector){return Math.atan2(vector.z,-vector.x)}!function(detail){for(var a=new Vector3,b=new Vector3,c=new Vector3,i=0;i<indices.length;i+=3)getVertexByIndex(indices[i+0],a),getVertexByIndex(indices[i+1],b),getVertexByIndex(indices[i+2],c),subdivideFace(a,b,c,detail)}(detail=detail||0),function(radius){for(var vertex=new Vector3,i=0;i<vertexBuffer.length;i+=3)vertex.x=vertexBuffer[i+0],vertex.y=vertexBuffer[i+1],vertex.z=vertexBuffer[i+2],vertex.normalize().multiplyScalar(radius),vertexBuffer[i+0]=vertex.x,vertexBuffer[i+1]=vertex.y,vertexBuffer[i+2]=vertex.z}(radius),function(){for(var vertex=new Vector3,i=0;i<vertexBuffer.length;i+=3){vertex.x=vertexBuffer[i+0],vertex.y=vertexBuffer[i+1],vertex.z=vertexBuffer[i+2];var u=azimuth(vertex)/2/Math.PI+.5,v=(vector=vertex,Math.atan2(-vector.y,Math.sqrt(vector.x*vector.x+vector.z*vector.z))/Math.PI+.5);uvBuffer.push(u,1-v)}var vector;(function(){for(var a=new Vector3,b=new Vector3,c=new Vector3,centroid=new Vector3,uvA=new Vector2,uvB=new Vector2,uvC=new Vector2,i=0,j=0;i<vertexBuffer.length;i+=9,j+=6){a.set(vertexBuffer[i+0],vertexBuffer[i+1],vertexBuffer[i+2]),b.set(vertexBuffer[i+3],vertexBuffer[i+4],vertexBuffer[i+5]),c.set(vertexBuffer[i+6],vertexBuffer[i+7],vertexBuffer[i+8]),uvA.set(uvBuffer[j+0],uvBuffer[j+1]),uvB.set(uvBuffer[j+2],uvBuffer[j+3]),uvC.set(uvBuffer[j+4],uvBuffer[j+5]),centroid.copy(a).add(b).add(c).divideScalar(3);var azi=azimuth(centroid);correctUV(uvA,j+0,a,azi),correctUV(uvB,j+2,b,azi),correctUV(uvC,j+4,c,azi)}})(),function(){for(var i=0;i<uvBuffer.length;i+=6){var x0=uvBuffer[i+0],x1=uvBuffer[i+2],x2=uvBuffer[i+4],max=Math.max(x0,x1,x2),min=Math.min(x0,x1,x2);.9<max&&min<.1&&(x0<.2&&(uvBuffer[i+0]+=1),x1<.2&&(uvBuffer[i+2]+=1),x2<.2&&(uvBuffer[i+4]+=1))}}()}(),this.addAttribute("position",new Float32BufferAttribute(vertexBuffer,3)),this.addAttribute("normal",new Float32BufferAttribute(vertexBuffer.slice(),3)),this.addAttribute("uv",new Float32BufferAttribute(uvBuffer,2)),0===detail?this.computeVertexNormals():this.normalizeNormals()}function TetrahedronGeometry(radius,detail){Geometry.call(this),this.type="TetrahedronGeometry",this.parameters={radius:radius,detail:detail},this.fromBufferGeometry(new TetrahedronBufferGeometry(radius,detail)),this.mergeVertices()}function TetrahedronBufferGeometry(radius,detail){PolyhedronBufferGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],radius,detail),this.type="TetrahedronBufferGeometry",this.parameters={radius:radius,detail:detail}}function OctahedronGeometry(radius,detail){Geometry.call(this),this.type="OctahedronGeometry",this.parameters={radius:radius,detail:detail},this.fromBufferGeometry(new OctahedronBufferGeometry(radius,detail)),this.mergeVertices()}function OctahedronBufferGeometry(radius,detail){PolyhedronBufferGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],radius,detail),this.type="OctahedronBufferGeometry",this.parameters={radius:radius,detail:detail}}function IcosahedronGeometry(radius,detail){Geometry.call(this),this.type="IcosahedronGeometry",this.parameters={radius:radius,detail:detail},this.fromBufferGeometry(new IcosahedronBufferGeometry(radius,detail)),this.mergeVertices()}function IcosahedronBufferGeometry(radius,detail){var t=(1+Math.sqrt(5))/2;PolyhedronBufferGeometry.call(this,[-1,t,0,1,t,0,-1,-t,0,1,-t,0,0,-1,t,0,1,t,0,-1,-t,0,1,-t,t,0,-1,t,0,1,-t,0,-1,-t,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],radius,detail),this.type="IcosahedronBufferGeometry",this.parameters={radius:radius,detail:detail}}function DodecahedronGeometry(radius,detail){Geometry.call(this),this.type="DodecahedronGeometry",this.parameters={radius:radius,detail:detail},this.fromBufferGeometry(new DodecahedronBufferGeometry(radius,detail)),this.mergeVertices()}function DodecahedronBufferGeometry(radius,detail){var t=(1+Math.sqrt(5))/2,r=1/t;PolyhedronBufferGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-t,0,-r,t,0,r,-t,0,r,t,-r,-t,0,-r,t,0,r,-t,0,r,t,0,-t,0,-r,t,0,-r,-t,0,r,t,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],radius,detail),this.type="DodecahedronBufferGeometry",this.parameters={radius:radius,detail:detail}}function TubeGeometry(path,tubularSegments,radius,radialSegments,closed,taper){Geometry.call(this),this.type="TubeGeometry",this.parameters={path:path,tubularSegments:tubularSegments,radius:radius,radialSegments:radialSegments,closed:closed},void 0!==taper&&console.warn("THREE.TubeGeometry: taper has been removed.");var bufferGeometry=new TubeBufferGeometry(path,tubularSegments,radius,radialSegments,closed);this.tangents=bufferGeometry.tangents,this.normals=bufferGeometry.normals,this.binormals=bufferGeometry.binormals,this.fromBufferGeometry(bufferGeometry),this.mergeVertices()}function TubeBufferGeometry(path,tubularSegments,radius,radialSegments,closed){BufferGeometry.call(this),this.type="TubeBufferGeometry",this.parameters={path:path,tubularSegments:tubularSegments,radius:radius,radialSegments:radialSegments,closed:closed},tubularSegments=tubularSegments||64,radius=radius||1,radialSegments=radialSegments||8,closed=closed||!1;var frames=path.computeFrenetFrames(tubularSegments,closed);this.tangents=frames.tangents,this.normals=frames.normals,this.binormals=frames.binormals;var i,j,vertex=new Vector3,normal=new Vector3,uv=new Vector2,P=new Vector3,vertices=[],normals=[],uvs=[],indices=[];function generateSegment(i){P=path.getPointAt(i/tubularSegments,P);var N=frames.normals[i],B=frames.binormals[i];for(j=0;j<=radialSegments;j++){var v=j/radialSegments*Math.PI*2,sin=Math.sin(v),cos=-Math.cos(v);normal.x=cos*N.x+sin*B.x,normal.y=cos*N.y+sin*B.y,normal.z=cos*N.z+sin*B.z,normal.normalize(),normals.push(normal.x,normal.y,normal.z),vertex.x=P.x+radius*normal.x,vertex.y=P.y+radius*normal.y,vertex.z=P.z+radius*normal.z,vertices.push(vertex.x,vertex.y,vertex.z)}}!function(){for(i=0;i<tubularSegments;i++)generateSegment(i);generateSegment(!1===closed?tubularSegments:0),function(){for(i=0;i<=tubularSegments;i++)for(j=0;j<=radialSegments;j++)uv.x=i/tubularSegments,uv.y=j/radialSegments,uvs.push(uv.x,uv.y)}(),function(){for(j=1;j<=tubularSegments;j++)for(i=1;i<=radialSegments;i++){var a=(radialSegments+1)*(j-1)+(i-1),b=(radialSegments+1)*j+(i-1),c=(radialSegments+1)*j+i,d=(radialSegments+1)*(j-1)+i;indices.push(a,b,d),indices.push(b,c,d)}}()}(),this.setIndex(indices),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("normal",new Float32BufferAttribute(normals,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}function TorusKnotGeometry(radius,tube,tubularSegments,radialSegments,p,q,heightScale){Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:radius,tube:tube,tubularSegments:tubularSegments,radialSegments:radialSegments,p:p,q:q},void 0!==heightScale&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(radius,tube,tubularSegments,radialSegments,p,q)),this.mergeVertices()}function TorusKnotBufferGeometry(radius,tube,tubularSegments,radialSegments,p,q){BufferGeometry.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:radius,tube:tube,tubularSegments:tubularSegments,radialSegments:radialSegments,p:p,q:q},radius=radius||1,tube=tube||.4,tubularSegments=Math.floor(tubularSegments)||64,radialSegments=Math.floor(radialSegments)||8,p=p||2,q=q||3;var i,j,indices=[],vertices=[],normals=[],uvs=[],vertex=new Vector3,normal=new Vector3,P1=new Vector3,P2=new Vector3,B=new Vector3,T=new Vector3,N=new Vector3;for(i=0;i<=tubularSegments;++i){var u=i/tubularSegments*p*Math.PI*2;for(calculatePositionOnCurve(u,p,q,radius,P1),calculatePositionOnCurve(.01+u,p,q,radius,P2),T.subVectors(P2,P1),N.addVectors(P2,P1),B.crossVectors(T,N),N.crossVectors(B,T),B.normalize(),N.normalize(),j=0;j<=radialSegments;++j){var v=j/radialSegments*Math.PI*2,cx=-tube*Math.cos(v),cy=tube*Math.sin(v);vertex.x=P1.x+(cx*N.x+cy*B.x),vertex.y=P1.y+(cx*N.y+cy*B.y),vertex.z=P1.z+(cx*N.z+cy*B.z),vertices.push(vertex.x,vertex.y,vertex.z),normal.subVectors(vertex,P1).normalize(),normals.push(normal.x,normal.y,normal.z),uvs.push(i/tubularSegments),uvs.push(j/radialSegments)}}for(j=1;j<=tubularSegments;j++)for(i=1;i<=radialSegments;i++){var a=(radialSegments+1)*(j-1)+(i-1),b=(radialSegments+1)*j+(i-1),c=(radialSegments+1)*j+i,d=(radialSegments+1)*(j-1)+i;indices.push(a,b,d),indices.push(b,c,d)}function calculatePositionOnCurve(u,p,q,radius,position){var cu=Math.cos(u),su=Math.sin(u),quOverP=q/p*u,cs=Math.cos(quOverP);position.x=radius*(2+cs)*.5*cu,position.y=radius*(2+cs)*su*.5,position.z=radius*Math.sin(quOverP)*.5}this.setIndex(indices),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("normal",new Float32BufferAttribute(normals,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}function TorusGeometry(radius,tube,radialSegments,tubularSegments,arc){Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,arc:arc},this.fromBufferGeometry(new TorusBufferGeometry(radius,tube,radialSegments,tubularSegments,arc)),this.mergeVertices()}function TorusBufferGeometry(radius,tube,radialSegments,tubularSegments,arc){BufferGeometry.call(this),this.type="TorusBufferGeometry",this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,arc:arc},radius=radius||1,tube=tube||.4,radialSegments=Math.floor(radialSegments)||8,tubularSegments=Math.floor(tubularSegments)||6,arc=arc||2*Math.PI;var j,i,indices=[],vertices=[],normals=[],uvs=[],center=new Vector3,vertex=new Vector3,normal=new Vector3;for(j=0;j<=radialSegments;j++)for(i=0;i<=tubularSegments;i++){var u=i/tubularSegments*arc,v=j/radialSegments*Math.PI*2;vertex.x=(radius+tube*Math.cos(v))*Math.cos(u),vertex.y=(radius+tube*Math.cos(v))*Math.sin(u),vertex.z=tube*Math.sin(v),vertices.push(vertex.x,vertex.y,vertex.z),center.x=radius*Math.cos(u),center.y=radius*Math.sin(u),normal.subVectors(vertex,center).normalize(),normals.push(normal.x,normal.y,normal.z),uvs.push(i/tubularSegments),uvs.push(j/radialSegments)}for(j=1;j<=radialSegments;j++)for(i=1;i<=tubularSegments;i++){var a=(tubularSegments+1)*j+i-1,b=(tubularSegments+1)*(j-1)+i-1,c=(tubularSegments+1)*(j-1)+i,d=(tubularSegments+1)*j+i;indices.push(a,b,d),indices.push(b,c,d)}this.setIndex(indices),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("normal",new Float32BufferAttribute(normals,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}Object.assign(FogExp2.prototype,{isFogExp2:!0,clone:function(){return new FogExp2(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Fog.prototype,{isFog:!0,clone:function(){return new Fog(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Scene.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Scene,isScene:!0,copy:function(source,recursive){return Object3D.prototype.copy.call(this,source,recursive),null!==source.background&&(this.background=source.background.clone()),null!==source.fog&&(this.fog=source.fog.clone()),null!==source.overrideMaterial&&(this.overrideMaterial=source.overrideMaterial.clone()),this.autoUpdate=source.autoUpdate,this.matrixAutoUpdate=source.matrixAutoUpdate,this},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);return null!==this.background&&(data.object.background=this.background.toJSON(meta)),null!==this.fog&&(data.object.fog=this.fog.toJSON()),data},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(value){!0===value&&this.version++}}),Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(array){if(Array.isArray(array))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==array?array.length/this.stride:0,this.array=array,this},setDynamic:function(value){return this.dynamic=value,this},copy:function(source){return this.array=new source.array.constructor(source.array),this.count=source.count,this.stride=source.stride,this.dynamic=source.dynamic,this},copyAt:function(index1,attribute,index2){index1*=this.stride,index2*=attribute.stride;for(var i=0,l=this.stride;i<l;i++)this.array[index1+i]=attribute.array[index2+i];return this},set:function(value,offset){return void 0===offset&&(offset=0),this.array.set(value,offset),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(callback){return this.onUploadCallback=callback,this}}),Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,setX:function(index,x){return this.data.array[index*this.data.stride+this.offset]=x,this},setY:function(index,y){return this.data.array[index*this.data.stride+this.offset+1]=y,this},setZ:function(index,z){return this.data.array[index*this.data.stride+this.offset+2]=z,this},setW:function(index,w){return this.data.array[index*this.data.stride+this.offset+3]=w,this},getX:function(index){return this.data.array[index*this.data.stride+this.offset]},getY:function(index){return this.data.array[index*this.data.stride+this.offset+1]},getZ:function(index){return this.data.array[index*this.data.stride+this.offset+2]},getW:function(index){return this.data.array[index*this.data.stride+this.offset+3]},setXY:function(index,x,y){return index=index*this.data.stride+this.offset,this.data.array[index+0]=x,this.data.array[index+1]=y,this},setXYZ:function(index,x,y,z){return index=index*this.data.stride+this.offset,this.data.array[index+0]=x,this.data.array[index+1]=y,this.data.array[index+2]=z,this},setXYZW:function(index,x,y,z,w){return index=index*this.data.stride+this.offset,this.data.array[index+0]=x,this.data.array[index+1]=y,this.data.array[index+2]=z,this.data.array[index+3]=w,this}}),((SpriteMaterial.prototype=Object.create(Material.prototype)).constructor=SpriteMaterial).prototype.isSpriteMaterial=!0,SpriteMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.rotation=source.rotation,this.sizeAttenuation=source.sizeAttenuation,this},Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:(intersectPoint=new Vector3,worldScale=new Vector3,mvPosition=new Vector3,alignedPosition=new Vector2,rotatedPosition=new Vector2,viewWorldMatrix=new Matrix4,vA=new Vector3,vB=new Vector3,vC=new Vector3,uvA=new Vector2,uvB=new Vector2,uvC=new Vector2,function(raycaster,intersects){worldScale.setFromMatrixScale(this.matrixWorld),viewWorldMatrix.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),mvPosition.setFromMatrixPosition(this.modelViewMatrix);var sin,cos,rotation=this.material.rotation;0!==rotation&&(cos=Math.cos(rotation),sin=Math.sin(rotation));var center=this.center;transformVertex(vA.set(-.5,-.5,0),mvPosition,center,worldScale,sin,cos),transformVertex(vB.set(.5,-.5,0),mvPosition,center,worldScale,sin,cos),transformVertex(vC.set(.5,.5,0),mvPosition,center,worldScale,sin,cos),uvA.set(0,0),uvB.set(1,0),uvC.set(1,1);var intersect=raycaster.ray.intersectTriangle(vA,vB,vC,!1,intersectPoint);if(null!==intersect||(transformVertex(vB.set(-.5,.5,0),mvPosition,center,worldScale,sin,cos),uvB.set(0,1),null!==(intersect=raycaster.ray.intersectTriangle(vA,vC,vB,!1,intersectPoint)))){var distance=raycaster.ray.origin.distanceTo(intersectPoint);distance<raycaster.near||distance>raycaster.far||intersects.push({distance:distance,point:intersectPoint.clone(),uv:Triangle.getUV(intersectPoint,vA,vB,vC,uvA,uvB,uvC,new Vector2),face:null,object:this})}}),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(source){return Object3D.prototype.copy.call(this,source),void 0!==source.center&&this.center.copy(source.center),this}}),LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,isLOD:!0,copy:function(source){Object3D.prototype.copy.call(this,source,!1);for(var levels=source.levels,i=0,l=levels.length;i<l;i++){var level=levels[i];this.addLevel(level.object.clone(),level.distance)}return this},addLevel:function(object,distance){void 0===distance&&(distance=0),distance=Math.abs(distance);for(var levels=this.levels,l=0;l<levels.length&&!(distance<levels[l].distance);l++);return levels.splice(l,0,{distance:distance,object:object}),this.add(object),this},getObjectForDistance:function(distance){for(var levels=this.levels,i=1,l=levels.length;i<l&&!(distance<levels[i].distance);i++);return levels[i-1].object},raycast:(matrixPosition=new Vector3,function(raycaster,intersects){matrixPosition.setFromMatrixPosition(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(matrixPosition);this.getObjectForDistance(distance).raycast(raycaster,intersects)}),update:function(){var v1=new Vector3,v2=new Vector3;return function(camera){var levels=this.levels;if(1<levels.length){v1.setFromMatrixPosition(camera.matrixWorld),v2.setFromMatrixPosition(this.matrixWorld);var distance=v1.distanceTo(v2);levels[0].object.visible=!0;for(var i=1,l=levels.length;i<l&&distance>=levels[i].distance;i++)levels[i-1].object.visible=!1,levels[i].object.visible=!0;for(;i<l;i++)levels[i].object.visible=!1}}}(),toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);data.object.levels=[];for(var levels=this.levels,i=0,l=levels.length;i<l;i++){var level=levels[i];data.object.levels.push({object:level.object.uuid,distance:level.distance})}return data}}),SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,bind:function(skeleton,bindMatrix){this.skeleton=skeleton,void 0===bindMatrix&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),bindMatrix=this.matrixWorld),this.bindMatrix.copy(bindMatrix),this.bindMatrixInverse.getInverse(bindMatrix)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var vector=new Vector4,skinWeight=this.geometry.attributes.skinWeight,i=0,l=skinWeight.count;i<l;i++){vector.x=skinWeight.getX(i),vector.y=skinWeight.getY(i),vector.z=skinWeight.getZ(i),vector.w=skinWeight.getW(i);var scale=1/vector.manhattanLength();scale!=1/0?vector.multiplyScalar(scale):vector.set(1,0,0,0),skinWeight.setXYZW(i,vector.x,vector.y,vector.z,vector.w)}},updateMatrixWorld:function(force){Mesh.prototype.updateMatrixWorld.call(this,force),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var i=0,il=this.bones.length;i<il;i++){var inverse=new Matrix4;this.bones[i]&&inverse.getInverse(this.bones[i].matrixWorld),this.boneInverses.push(inverse)}},pose:function(){var bone,i,il;for(i=0,il=this.bones.length;i<il;i++)(bone=this.bones[i])&&bone.matrixWorld.getInverse(this.boneInverses[i]);for(i=0,il=this.bones.length;i<il;i++)(bone=this.bones[i])&&(bone.parent&&bone.parent.isBone?(bone.matrix.getInverse(bone.parent.matrixWorld),bone.matrix.multiply(bone.matrixWorld)):bone.matrix.copy(bone.matrixWorld),bone.matrix.decompose(bone.position,bone.quaternion,bone.scale))},update:(offsetMatrix=new Matrix4,identityMatrix=new Matrix4,function(){for(var bones=this.bones,boneInverses=this.boneInverses,boneMatrices=this.boneMatrices,boneTexture=this.boneTexture,i=0,il=bones.length;i<il;i++){var matrix=bones[i]?bones[i].matrixWorld:identityMatrix;offsetMatrix.multiplyMatrices(matrix,boneInverses[i]),offsetMatrix.toArray(boneMatrices,16*i)}void 0!==boneTexture&&(boneTexture.needsUpdate=!0)}),clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(name){for(var i=0,il=this.bones.length;i<il;i++){var bone=this.bones[i];if(bone.name===name)return bone}}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0}),((LineBasicMaterial.prototype=Object.create(Material.prototype)).constructor=LineBasicMaterial).prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.linewidth=source.linewidth,this.linecap=source.linecap,this.linejoin=source.linejoin,this},Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,computeLineDistances:(start=new Vector3,end=new Vector3,function(){var geometry=this.geometry;if(geometry.isBufferGeometry)if(null===geometry.index){for(var positionAttribute=geometry.attributes.position,lineDistances=[0],i=1,l=positionAttribute.count;i<l;i++)start.fromBufferAttribute(positionAttribute,i-1),end.fromBufferAttribute(positionAttribute,i),lineDistances[i]=lineDistances[i-1],lineDistances[i]+=start.distanceTo(end);geometry.addAttribute("lineDistance",new Float32BufferAttribute(lineDistances,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(geometry.isGeometry){var vertices=geometry.vertices;for((lineDistances=geometry.lineDistances)[0]=0,i=1,l=vertices.length;i<l;i++)lineDistances[i]=lineDistances[i-1],lineDistances[i]+=vertices[i-1].distanceTo(vertices[i])}return this}),raycast:function(){var inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere;return function(raycaster,intersects){var precision=raycaster.linePrecision,geometry=this.geometry,matrixWorld=this.matrixWorld;if(null===geometry.boundingSphere&&geometry.computeBoundingSphere(),sphere.copy(geometry.boundingSphere),sphere.applyMatrix4(matrixWorld),sphere.radius+=precision,!1!==raycaster.ray.intersectsSphere(sphere)){inverseMatrix.getInverse(matrixWorld),ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);var localPrecision=precision/((this.scale.x+this.scale.y+this.scale.z)/3),localPrecisionSq=localPrecision*localPrecision,vStart=new Vector3,vEnd=new Vector3,interSegment=new Vector3,interRay=new Vector3,step=this&&this.isLineSegments?2:1;if(geometry.isBufferGeometry){var index=geometry.index,positions=geometry.attributes.position.array;if(null!==index)for(var indices=index.array,i=0,l=indices.length-1;i<l;i+=step){var a=indices[i],b=indices[i+1];if(vStart.fromArray(positions,3*a),vEnd.fromArray(positions,3*b),!(localPrecisionSq<ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment)))interRay.applyMatrix4(this.matrixWorld),(distance=raycaster.ray.origin.distanceTo(interRay))<raycaster.near||distance>raycaster.far||intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}else for(i=0,l=positions.length/3-1;i<l;i+=step){if(vStart.fromArray(positions,3*i),vEnd.fromArray(positions,3*i+3),!(localPrecisionSq<ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment)))interRay.applyMatrix4(this.matrixWorld),(distance=raycaster.ray.origin.distanceTo(interRay))<raycaster.near||distance>raycaster.far||intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else if(geometry.isGeometry){var vertices=geometry.vertices,nbVertices=vertices.length;for(i=0;i<nbVertices-1;i+=step){var distance;if(!(localPrecisionSq<ray.distanceSqToSegment(vertices[i],vertices[i+1],interRay,interSegment)))interRay.applyMatrix4(this.matrixWorld),(distance=raycaster.ray.origin.distanceTo(interRay))<raycaster.near||distance>raycaster.far||intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){var start=new Vector3,end=new Vector3;return function(){var geometry=this.geometry;if(geometry.isBufferGeometry)if(null===geometry.index){for(var positionAttribute=geometry.attributes.position,lineDistances=[],i=0,l=positionAttribute.count;i<l;i+=2)start.fromBufferAttribute(positionAttribute,i),end.fromBufferAttribute(positionAttribute,i+1),lineDistances[i]=0===i?0:lineDistances[i-1],lineDistances[i+1]=lineDistances[i]+start.distanceTo(end);geometry.addAttribute("lineDistance",new Float32BufferAttribute(lineDistances,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(geometry.isGeometry){var vertices=geometry.vertices;for(lineDistances=geometry.lineDistances,i=0,l=vertices.length;i<l;i+=2)start.copy(vertices[i]),end.copy(vertices[i+1]),lineDistances[i]=0===i?0:lineDistances[i-1],lineDistances[i+1]=lineDistances[i]+start.distanceTo(end)}return this}}()}),LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0}),((PointsMaterial.prototype=Object.create(Material.prototype)).constructor=PointsMaterial).prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.size=source.size,this.sizeAttenuation=source.sizeAttenuation,this.morphTargets=source.morphTargets,this},Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,raycast:function(){var inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere;return function(raycaster,intersects){var object=this,geometry=this.geometry,matrixWorld=this.matrixWorld,threshold=raycaster.params.Points.threshold;if(null===geometry.boundingSphere&&geometry.computeBoundingSphere(),sphere.copy(geometry.boundingSphere),sphere.applyMatrix4(matrixWorld),sphere.radius+=threshold,!1!==raycaster.ray.intersectsSphere(sphere)){inverseMatrix.getInverse(matrixWorld),ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);var localThreshold=threshold/((this.scale.x+this.scale.y+this.scale.z)/3),localThresholdSq=localThreshold*localThreshold,position=new Vector3,intersectPoint=new Vector3;if(geometry.isBufferGeometry){var index=geometry.index,positions=geometry.attributes.position.array;if(null!==index)for(var indices=index.array,i=0,il=indices.length;i<il;i++){var a=indices[i];position.fromArray(positions,3*a),testPoint(position,a)}else{i=0;for(var l=positions.length/3;i<l;i++)position.fromArray(positions,3*i),testPoint(position,i)}}else{var vertices=geometry.vertices;for(i=0,l=vertices.length;i<l;i++)testPoint(vertices[i],i)}}function testPoint(point,index){var rayPointDistanceSq=ray.distanceSqToPoint(point);if(rayPointDistanceSq<localThresholdSq){ray.closestPointToPoint(point,intersectPoint),intersectPoint.applyMatrix4(matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectPoint);if(distance<raycaster.near||distance>raycaster.far)return;intersects.push({distance:distance,distanceToRay:Math.sqrt(rayPointDistanceSq),point:intersectPoint.clone(),index:index,face:null,object:object})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,isVideoTexture:!0,update:function(){var video=this.image;video.readyState>=video.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),((CompressedTexture.prototype=Object.create(Texture.prototype)).constructor=CompressedTexture).prototype.isCompressedTexture=!0,((CanvasTexture.prototype=Object.create(Texture.prototype)).constructor=CanvasTexture).prototype.isCanvasTexture=!0,((DepthTexture.prototype=Object.create(Texture.prototype)).constructor=DepthTexture).prototype.isDepthTexture=!0,(WireframeGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=WireframeGeometry,(ParametricGeometry.prototype=Object.create(Geometry.prototype)).constructor=ParametricGeometry,(ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=ParametricBufferGeometry,(PolyhedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=PolyhedronGeometry,(PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=PolyhedronBufferGeometry,(TetrahedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=TetrahedronGeometry,(TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype)).constructor=TetrahedronBufferGeometry,(OctahedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=OctahedronGeometry,(OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype)).constructor=OctahedronBufferGeometry,(IcosahedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=IcosahedronGeometry,(IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype)).constructor=IcosahedronBufferGeometry,(DodecahedronGeometry.prototype=Object.create(Geometry.prototype)).constructor=DodecahedronGeometry,(DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype)).constructor=DodecahedronBufferGeometry,(TubeGeometry.prototype=Object.create(Geometry.prototype)).constructor=TubeGeometry,((TubeBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=TubeBufferGeometry).prototype.toJSON=function(){var data=BufferGeometry.prototype.toJSON.call(this);return data.path=this.parameters.path.toJSON(),data},(TorusKnotGeometry.prototype=Object.create(Geometry.prototype)).constructor=TorusKnotGeometry,(TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=TorusKnotBufferGeometry,(TorusGeometry.prototype=Object.create(Geometry.prototype)).constructor=TorusGeometry,(TorusBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=TorusBufferGeometry;var Earcut_triangulate=function(data,holeIndices,dim){dim=dim||2;var minX,minY,maxX,maxY,x,y,invSize,hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode)return triangles;if(hasHoles&&(outerNode=function(data,holeIndices,outerNode,dim){var i,len,start,end,list,queue=[];for(i=0,len=holeIndices.length;i<len;i++)start=holeIndices[i]*dim,end=i<len-1?holeIndices[i+1]*dim:data.length,(list=linkedList(data,start,end,dim,!1))===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i<queue.length;i++)eliminateHole(queue[i],outerNode),outerNode=filterPoints(outerNode,outerNode.next);return outerNode}(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim)(x=data[i])<minX&&(minX=x),(y=data[i+1])<minY&&(minY=y),maxX<x&&(maxX=x),maxY<y&&(maxY=y);invSize=0!==(invSize=Math.max(maxX-minX,maxY-minY))?1/invSize:0}return earcutLinked(outerNode,triangles,dim,minX,minY,invSize),triangles};function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===0<function(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum}(data,start,end,dim))for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;start<=i;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last&&equals(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start,end){if(!start)return start;end||(end=start);var again,p=start;do{if(again=!1,p.steiner||!equals(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),(p=end=p.prev)===p.next)break;again=!0}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(ear){!pass&&invSize&&function(start,minX,minY,invSize){var p=start;for(;null===p.z&&(p.z=zOrder(p.x,p.y,minX,minY,invSize)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next,p!==start;);p.prevZ.nextZ=null,p.prevZ=null,function(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,tail=list=null,numMerges=0;p;){for(numMerges++,q=p,i=pSize=0;i<inSize&&(pSize++,q=q.nextZ);i++);for(qSize=inSize;0<pSize||0<qSize&&q;)0!==pSize&&(0===qSize||!q||p.z<=q.z)?(p=(e=p).nextZ,pSize--):(q=(e=q).nextZ,qSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(1<numMerges)}(p)}(ear,minX,minY,invSize);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear))triangles.push(prev.i/dim),triangles.push(ear.i/dim),triangles.push(next.i/dim),removeNode(ear),ear=next.next,stop=next.next;else if((ear=next)===stop){pass?1===pass?earcutLinked(ear=cureLocalIntersections(ear,triangles,dim),triangles,dim,minX,minY,invSize,2):2===pass&&splitEarcut(ear,triangles,dim,minX,minY,invSize):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(0<=area(a,b,c))return!1;for(var p=ear.next.next;p!==ear.prev;){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(0<=area(a,b,c))return!1;for(var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y,minZ=zOrder(minTX,minTY,minX,minY,invSize),maxZ=zOrder(maxTX,maxTY,minX,minY,invSize),p=ear.nextZ;p&&p.z<=maxZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.nextZ}for(p=ear.prevZ;p&&p.z>=minZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.prevZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim),triangles.push(p.i/dim),triangles.push(b.i/dim),removeNode(p),removeNode(p.next),p=start=b),p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,invSize){var a=start;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,invSize),void earcutLinked(c,triangles,dim,minX,minY,invSize)}b=b.next}a=a.next}while(a!==start)}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){if(outerNode=function(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&qx<x){if((qx=x)===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var tan,stop=m,mx=m.x,my=m.y,tanMin=1/0;p=m.next;for(;p!==stop;)hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&((tan=Math.abs(hy-p.y)/(hx-p.x))<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)&&(m=p,tanMin=tan),p=p.next;return m}(hole,outerNode)){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function zOrder(x,y,minX,minY,invSize){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=32767*(x-minX)*invSize)|x<<8))|x<<4))|x<<2))|x<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=32767*(y-minY)*invSize)|y<<8))|y<<4))|y<<2))|y<<1))<<1}function getLeftmost(start){for(var p=start,leftmost=start;p.x<leftmost.x&&(leftmost=p),(p=p.next)!==start;);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return 0<=(cx-px)*(ay-py)-(ax-px)*(cy-py)&&0<=(ax-px)*(by-py)-(bx-px)*(ay-py)&&0<=(bx-px)*(cy-py)-(cx-px)*(by-py)}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!function(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&function(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;for(;p.y>py!=p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),p=p.next,p!==a;);return inside}(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){return!!(equals(p1,q1)&&equals(p2,q2)||equals(p1,q2)&&equals(p2,q1))||0<area(p1,q1,p2)!=0<area(p1,q1,q2)&&0<area(p2,q2,p1)!=0<area(p2,q2,q1)}function locallyInside(a,b){return area(a.prev,a,a.next)<0?0<=area(a,b,a.next)&&0<=area(a,a.prev,b):area(a,b,a.prev)<0||area(a,a.next,b)<0}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return(a.next=b).prev=a,(a2.next=an).prev=a2,(b2.next=a2).prev=b2,(bp.next=b2).prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,(p.prev=last).next.prev=p,last.next=p):(p.prev=p).next=p,p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var ShapeUtils={area:function(contour){for(var n=contour.length,a=0,p=n-1,q=0;q<n;p=q++)a+=contour[p].x*contour[q].y-contour[q].x*contour[p].y;return.5*a},isClockWise:function(pts){return ShapeUtils.area(pts)<0},triangulateShape:function(contour,holes){var vertices=[],holeIndices=[],faces=[];removeDupEndPts(contour),addContour(vertices,contour);var holeIndex=contour.length;holes.forEach(removeDupEndPts);for(var i=0;i<holes.length;i++)holeIndices.push(holeIndex),holeIndex+=holes[i].length,addContour(vertices,holes[i]);var triangles=Earcut_triangulate(vertices,holeIndices);for(i=0;i<triangles.length;i+=3)faces.push(triangles.slice(i,i+3));return faces}};function removeDupEndPts(points){var l=points.length;2<l&&points[l-1].equals(points[0])&&points.pop()}function addContour(vertices,contour){for(var i=0;i<contour.length;i++)vertices.push(contour[i].x),vertices.push(contour[i].y)}function ExtrudeGeometry(shapes,options){Geometry.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:shapes,options:options},this.fromBufferGeometry(new ExtrudeBufferGeometry(shapes,options)),this.mergeVertices()}function ExtrudeBufferGeometry(shapes,options){BufferGeometry.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:shapes,options:options},shapes=Array.isArray(shapes)?shapes:[shapes];for(var scope=this,verticesArray=[],uvArray=[],i=0,l=shapes.length;i<l;i++){addShape(shapes[i])}function addShape(shape){var placeholder=[],curveSegments=void 0!==options.curveSegments?options.curveSegments:12,steps=void 0!==options.steps?options.steps:1,depth=void 0!==options.depth?options.depth:100,bevelEnabled=void 0===options.bevelEnabled||options.bevelEnabled,bevelThickness=void 0!==options.bevelThickness?options.bevelThickness:6,bevelSize=void 0!==options.bevelSize?options.bevelSize:bevelThickness-2,bevelOffset=void 0!==options.bevelOffset?options.bevelOffset:0,bevelSegments=void 0!==options.bevelSegments?options.bevelSegments:3,extrudePath=options.extrudePath,uvgen=void 0!==options.UVGenerator?options.UVGenerator:WorldUVGenerator;void 0!==options.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),depth=options.amount);var extrudePts,splineTube,binormal,normal,position2,ahole,h,hl,extrudeByPath=!1;extrudePath&&(extrudePts=extrudePath.getSpacedPoints(steps),bevelEnabled=!(extrudeByPath=!0),splineTube=extrudePath.computeFrenetFrames(steps,!1),binormal=new Vector3,normal=new Vector3,position2=new Vector3),bevelEnabled||(bevelOffset=bevelSize=bevelThickness=bevelSegments=0);var shapePoints=shape.extractPoints(curveSegments),vertices=shapePoints.shape,holes=shapePoints.holes;if(!ShapeUtils.isClockWise(vertices))for(vertices=vertices.reverse(),h=0,hl=holes.length;h<hl;h++)ahole=holes[h],ShapeUtils.isClockWise(ahole)&&(holes[h]=ahole.reverse());var faces=ShapeUtils.triangulateShape(vertices,holes),contour=vertices;for(h=0,hl=holes.length;h<hl;h++)ahole=holes[h],vertices=vertices.concat(ahole);function scalePt2(pt,vec,size){return vec||console.error("THREE.ExtrudeGeometry: vec does not exist"),vec.clone().multiplyScalar(size).add(pt)}var b,bs,t,z,vert,face,vlen=vertices.length,flen=faces.length;function getBevelVec(inPt,inPrev,inNext){var v_trans_x,v_trans_y,shrink_by,v_prev_x=inPt.x-inPrev.x,v_prev_y=inPt.y-inPrev.y,v_next_x=inNext.x-inPt.x,v_next_y=inNext.y-inPt.y,v_prev_lensq=v_prev_x*v_prev_x+v_prev_y*v_prev_y,collinear0=v_prev_x*v_next_y-v_prev_y*v_next_x;if(Math.abs(collinear0)>Number.EPSILON){var v_prev_len=Math.sqrt(v_prev_lensq),v_next_len=Math.sqrt(v_next_x*v_next_x+v_next_y*v_next_y),ptPrevShift_x=inPrev.x-v_prev_y/v_prev_len,ptPrevShift_y=inPrev.y+v_prev_x/v_prev_len,sf=((inNext.x-v_next_y/v_next_len-ptPrevShift_x)*v_next_y-(inNext.y+v_next_x/v_next_len-ptPrevShift_y)*v_next_x)/(v_prev_x*v_next_y-v_prev_y*v_next_x),v_trans_lensq=(v_trans_x=ptPrevShift_x+v_prev_x*sf-inPt.x)*v_trans_x+(v_trans_y=ptPrevShift_y+v_prev_y*sf-inPt.y)*v_trans_y;if(v_trans_lensq<=2)return new Vector2(v_trans_x,v_trans_y);shrink_by=Math.sqrt(v_trans_lensq/2)}else{var direction_eq=!1;v_prev_x>Number.EPSILON?v_next_x>Number.EPSILON&&(direction_eq=!0):v_prev_x<-Number.EPSILON?v_next_x<-Number.EPSILON&&(direction_eq=!0):Math.sign(v_prev_y)===Math.sign(v_next_y)&&(direction_eq=!0),shrink_by=direction_eq?(v_trans_x=-v_prev_y,v_trans_y=v_prev_x,Math.sqrt(v_prev_lensq)):(v_trans_x=v_prev_x,v_trans_y=v_prev_y,Math.sqrt(v_prev_lensq/2))}return new Vector2(v_trans_x/shrink_by,v_trans_y/shrink_by)}for(var contourMovements=[],i=0,il=contour.length,j=il-1,k=i+1;i<il;i++,j++,k++)j===il&&(j=0),k===il&&(k=0),contourMovements[i]=getBevelVec(contour[i],contour[j],contour[k]);var oneHoleMovements,s,holesMovements=[],verticesMovements=contourMovements.concat();for(h=0,hl=holes.length;h<hl;h++){for(ahole=holes[h],oneHoleMovements=[],i=0,j=(il=ahole.length)-1,k=i+1;i<il;i++,j++,k++)j===il&&(j=0),k===il&&(k=0),oneHoleMovements[i]=getBevelVec(ahole[i],ahole[j],ahole[k]);holesMovements.push(oneHoleMovements),verticesMovements=verticesMovements.concat(oneHoleMovements)}for(b=0;b<bevelSegments;b++){for(t=b/bevelSegments,z=bevelThickness*Math.cos(t*Math.PI/2),bs=bevelSize*Math.sin(t*Math.PI/2)+bevelOffset,i=0,il=contour.length;i<il;i++)v((vert=scalePt2(contour[i],contourMovements[i],bs)).x,vert.y,-z);for(h=0,hl=holes.length;h<hl;h++)for(ahole=holes[h],oneHoleMovements=holesMovements[h],i=0,il=ahole.length;i<il;i++)v((vert=scalePt2(ahole[i],oneHoleMovements[i],bs)).x,vert.y,-z)}for(bs=bevelSize+bevelOffset,i=0;i<vlen;i++)vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i],extrudeByPath?(normal.copy(splineTube.normals[0]).multiplyScalar(vert.x),binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y),position2.copy(extrudePts[0]).add(normal).add(binormal),v(position2.x,position2.y,position2.z)):v(vert.x,vert.y,0);for(s=1;s<=steps;s++)for(i=0;i<vlen;i++)vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i],extrudeByPath?(normal.copy(splineTube.normals[s]).multiplyScalar(vert.x),binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y),position2.copy(extrudePts[s]).add(normal).add(binormal),v(position2.x,position2.y,position2.z)):v(vert.x,vert.y,depth/steps*s);for(b=bevelSegments-1;0<=b;b--){for(t=b/bevelSegments,z=bevelThickness*Math.cos(t*Math.PI/2),bs=bevelSize*Math.sin(t*Math.PI/2)+bevelOffset,i=0,il=contour.length;i<il;i++)v((vert=scalePt2(contour[i],contourMovements[i],bs)).x,vert.y,depth+z);for(h=0,hl=holes.length;h<hl;h++)for(ahole=holes[h],oneHoleMovements=holesMovements[h],i=0,il=ahole.length;i<il;i++)vert=scalePt2(ahole[i],oneHoleMovements[i],bs),extrudeByPath?v(vert.x,vert.y+extrudePts[steps-1].y,extrudePts[steps-1].x+z):v(vert.x,vert.y,depth+z)}function sidewalls(contour,layeroffset){var j,k;for(i=contour.length;0<=--i;){(k=(j=i)-1)<0&&(k=contour.length-1);var s=0,sl=steps+2*bevelSegments;for(s=0;s<sl;s++){var slen1=vlen*s,slen2=vlen*(s+1);f4(layeroffset+j+slen1,layeroffset+k+slen1,layeroffset+k+slen2,layeroffset+j+slen2)}}}function v(x,y,z){placeholder.push(x),placeholder.push(y),placeholder.push(z)}function f3(a,b,c){addVertex(a),addVertex(b),addVertex(c);var nextIndex=verticesArray.length/3,uvs=uvgen.generateTopUV(scope,verticesArray,nextIndex-3,nextIndex-2,nextIndex-1);addUV(uvs[0]),addUV(uvs[1]),addUV(uvs[2])}function f4(a,b,c,d){addVertex(a),addVertex(b),addVertex(d),addVertex(b),addVertex(c),addVertex(d);var nextIndex=verticesArray.length/3,uvs=uvgen.generateSideWallUV(scope,verticesArray,nextIndex-6,nextIndex-3,nextIndex-2,nextIndex-1);addUV(uvs[0]),addUV(uvs[1]),addUV(uvs[3]),addUV(uvs[1]),addUV(uvs[2]),addUV(uvs[3])}function addVertex(index){verticesArray.push(placeholder[3*index+0]),verticesArray.push(placeholder[3*index+1]),verticesArray.push(placeholder[3*index+2])}function addUV(vector2){uvArray.push(vector2.x),uvArray.push(vector2.y)}!function(){var start=verticesArray.length/3;if(bevelEnabled){var layer=0,offset=vlen*layer;for(i=0;i<flen;i++)f3((face=faces[i])[2]+offset,face[1]+offset,face[0]+offset);for(offset=vlen*(layer=steps+2*bevelSegments),i=0;i<flen;i++)f3((face=faces[i])[0]+offset,face[1]+offset,face[2]+offset)}else{for(i=0;i<flen;i++)f3((face=faces[i])[2],face[1],face[0]);for(i=0;i<flen;i++)f3((face=faces[i])[0]+vlen*steps,face[1]+vlen*steps,face[2]+vlen*steps)}scope.addGroup(start,verticesArray.length/3-start,0)}(),function(){var start=verticesArray.length/3,layeroffset=0;for(sidewalls(contour,layeroffset),layeroffset+=contour.length,h=0,hl=holes.length;h<hl;h++)sidewalls(ahole=holes[h],layeroffset),layeroffset+=ahole.length;scope.addGroup(start,verticesArray.length/3-start,1)}()}this.addAttribute("position",new Float32BufferAttribute(verticesArray,3)),this.addAttribute("uv",new Float32BufferAttribute(uvArray,2)),this.computeVertexNormals()}((ExtrudeGeometry.prototype=Object.create(Geometry.prototype)).constructor=ExtrudeGeometry).prototype.toJSON=function(){var data=Geometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,this.parameters.options,data)},((ExtrudeBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=ExtrudeBufferGeometry).prototype.toJSON=function(){var data=BufferGeometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,this.parameters.options,data)};var WorldUVGenerator={generateTopUV:function(geometry,vertices,indexA,indexB,indexC){var a_x=vertices[3*indexA],a_y=vertices[3*indexA+1],b_x=vertices[3*indexB],b_y=vertices[3*indexB+1],c_x=vertices[3*indexC],c_y=vertices[3*indexC+1];return[new Vector2(a_x,a_y),new Vector2(b_x,b_y),new Vector2(c_x,c_y)]},generateSideWallUV:function(geometry,vertices,indexA,indexB,indexC,indexD){var a_x=vertices[3*indexA],a_y=vertices[3*indexA+1],a_z=vertices[3*indexA+2],b_x=vertices[3*indexB],b_y=vertices[3*indexB+1],b_z=vertices[3*indexB+2],c_x=vertices[3*indexC],c_y=vertices[3*indexC+1],c_z=vertices[3*indexC+2],d_x=vertices[3*indexD],d_y=vertices[3*indexD+1],d_z=vertices[3*indexD+2];return Math.abs(a_y-b_y)<.01?[new Vector2(a_x,1-a_z),new Vector2(b_x,1-b_z),new Vector2(c_x,1-c_z),new Vector2(d_x,1-d_z)]:[new Vector2(a_y,1-a_z),new Vector2(b_y,1-b_z),new Vector2(c_y,1-c_z),new Vector2(d_y,1-d_z)]}};function toJSON(shapes,options,data){if(data.shapes=[],Array.isArray(shapes))for(var i=0,l=shapes.length;i<l;i++){var shape=shapes[i];data.shapes.push(shape.uuid)}else data.shapes.push(shapes.uuid);return void 0!==options.extrudePath&&(data.options.extrudePath=options.extrudePath.toJSON()),data}function TextGeometry(text,parameters){Geometry.call(this),this.type="TextGeometry",this.parameters={text:text,parameters:parameters},this.fromBufferGeometry(new TextBufferGeometry(text,parameters)),this.mergeVertices()}function TextBufferGeometry(text,parameters){var font=(parameters=parameters||{}).font;if(!font||!font.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Geometry;var shapes=font.generateShapes(text,parameters.size);parameters.depth=void 0!==parameters.height?parameters.height:50,void 0===parameters.bevelThickness&&(parameters.bevelThickness=10),void 0===parameters.bevelSize&&(parameters.bevelSize=8),void 0===parameters.bevelEnabled&&(parameters.bevelEnabled=!1),ExtrudeBufferGeometry.call(this,shapes,parameters),this.type="TextBufferGeometry"}function SphereGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:radius,widthSegments:widthSegments,heightSegments:heightSegments,phiStart:phiStart,phiLength:phiLength,thetaStart:thetaStart,thetaLength:thetaLength},this.fromBufferGeometry(new SphereBufferGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength)),this.mergeVertices()}function SphereBufferGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:radius,widthSegments:widthSegments,heightSegments:heightSegments,phiStart:phiStart,phiLength:phiLength,thetaStart:thetaStart,thetaLength:thetaLength},radius=radius||1,widthSegments=Math.max(3,Math.floor(widthSegments)||8),heightSegments=Math.max(2,Math.floor(heightSegments)||6),phiStart=void 0!==phiStart?phiStart:0,phiLength=void 0!==phiLength?phiLength:2*Math.PI;var ix,iy,thetaEnd=(thetaStart=void 0!==thetaStart?thetaStart:0)+(thetaLength=void 0!==thetaLength?thetaLength:Math.PI),index=0,grid=[],vertex=new Vector3,normal=new Vector3,indices=[],vertices=[],normals=[],uvs=[];for(iy=0;iy<=heightSegments;iy++){var verticesRow=[],v=iy/heightSegments,uOffset=0==iy?.5/widthSegments:iy==heightSegments?-.5/widthSegments:0;for(ix=0;ix<=widthSegments;ix++){var u=ix/widthSegments;vertex.x=-radius*Math.cos(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength),vertex.y=radius*Math.cos(thetaStart+v*thetaLength),vertex.z=radius*Math.sin(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength),vertices.push(vertex.x,vertex.y,vertex.z),normal.copy(vertex).normalize(),normals.push(normal.x,normal.y,normal.z),uvs.push(u+uOffset,1-v),verticesRow.push(index++)}grid.push(verticesRow)}for(iy=0;iy<heightSegments;iy++)for(ix=0;ix<widthSegments;ix++){var a=grid[iy][ix+1],b=grid[iy][ix],c=grid[iy+1][ix],d=grid[iy+1][ix+1];(0!==iy||0<thetaStart)&&indices.push(a,b,d),(iy!==heightSegments-1||thetaEnd<Math.PI)&&indices.push(b,c,d)}this.setIndex(indices),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("normal",new Float32BufferAttribute(normals,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}function RingGeometry(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength){Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:innerRadius,outerRadius:outerRadius,thetaSegments:thetaSegments,phiSegments:phiSegments,thetaStart:thetaStart,thetaLength:thetaLength},this.fromBufferGeometry(new RingBufferGeometry(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength)),this.mergeVertices()}function RingBufferGeometry(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength){BufferGeometry.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:innerRadius,outerRadius:outerRadius,thetaSegments:thetaSegments,phiSegments:phiSegments,thetaStart:thetaStart,thetaLength:thetaLength},innerRadius=innerRadius||.5,outerRadius=outerRadius||1,thetaStart=void 0!==thetaStart?thetaStart:0,thetaLength=void 0!==thetaLength?thetaLength:2*Math.PI,thetaSegments=void 0!==thetaSegments?Math.max(3,thetaSegments):8;var segment,j,i,indices=[],vertices=[],normals=[],uvs=[],radius=innerRadius,radiusStep=(outerRadius-innerRadius)/(phiSegments=void 0!==phiSegments?Math.max(1,phiSegments):1),vertex=new Vector3,uv=new Vector2;for(j=0;j<=phiSegments;j++){for(i=0;i<=thetaSegments;i++)segment=thetaStart+i/thetaSegments*thetaLength,vertex.x=radius*Math.cos(segment),vertex.y=radius*Math.sin(segment),vertices.push(vertex.x,vertex.y,vertex.z),normals.push(0,0,1),uv.x=(vertex.x/outerRadius+1)/2,uv.y=(vertex.y/outerRadius+1)/2,uvs.push(uv.x,uv.y);radius+=radiusStep}for(j=0;j<phiSegments;j++){var thetaSegmentLevel=j*(thetaSegments+1);for(i=0;i<thetaSegments;i++){var a=segment=i+thetaSegmentLevel,b=segment+thetaSegments+1,c=segment+thetaSegments+2,d=segment+1;indices.push(a,b,d),indices.push(b,c,d)}}this.setIndex(indices),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("normal",new Float32BufferAttribute(normals,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}function LatheGeometry(points,segments,phiStart,phiLength){Geometry.call(this),this.type="LatheGeometry",this.parameters={points:points,segments:segments,phiStart:phiStart,phiLength:phiLength},this.fromBufferGeometry(new LatheBufferGeometry(points,segments,phiStart,phiLength)),this.mergeVertices()}function LatheBufferGeometry(points,segments,phiStart,phiLength){BufferGeometry.call(this),this.type="LatheBufferGeometry",this.parameters={points:points,segments:segments,phiStart:phiStart,phiLength:phiLength},segments=Math.floor(segments)||12,phiStart=phiStart||0,phiLength=phiLength||2*Math.PI,phiLength=_Math.clamp(phiLength,0,2*Math.PI);var base,i,j,indices=[],vertices=[],uvs=[],inverseSegments=1/segments,vertex=new Vector3,uv=new Vector2;for(i=0;i<=segments;i++){var phi=phiStart+i*inverseSegments*phiLength,sin=Math.sin(phi),cos=Math.cos(phi);for(j=0;j<=points.length-1;j++)vertex.x=points[j].x*sin,vertex.y=points[j].y,vertex.z=points[j].x*cos,vertices.push(vertex.x,vertex.y,vertex.z),uv.x=i/segments,uv.y=j/(points.length-1),uvs.push(uv.x,uv.y)}for(i=0;i<segments;i++)for(j=0;j<points.length-1;j++){var a=base=j+i*points.length,b=base+points.length,c=base+points.length+1,d=base+1;indices.push(a,b,d),indices.push(b,c,d)}if(this.setIndex(indices),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2)),this.computeVertexNormals(),phiLength===2*Math.PI){var normals=this.attributes.normal.array,n1=new Vector3,n2=new Vector3,n=new Vector3;for(base=segments*points.length*3,j=i=0;i<points.length;i++,j+=3)n1.x=normals[j+0],n1.y=normals[j+1],n1.z=normals[j+2],n2.x=normals[base+j+0],n2.y=normals[base+j+1],n2.z=normals[base+j+2],n.addVectors(n1,n2).normalize(),normals[j+0]=normals[base+j+0]=n.x,normals[j+1]=normals[base+j+1]=n.y,normals[j+2]=normals[base+j+2]=n.z}}function ShapeGeometry(shapes,curveSegments){Geometry.call(this),this.type="ShapeGeometry","object"==typeof curveSegments&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),curveSegments=curveSegments.curveSegments),this.parameters={shapes:shapes,curveSegments:curveSegments},this.fromBufferGeometry(new ShapeBufferGeometry(shapes,curveSegments)),this.mergeVertices()}function ShapeBufferGeometry(shapes,curveSegments){BufferGeometry.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:shapes,curveSegments:curveSegments},curveSegments=curveSegments||12;var indices=[],vertices=[],normals=[],uvs=[],groupStart=0,groupCount=0;if(!1===Array.isArray(shapes))addShape(shapes);else for(var i=0;i<shapes.length;i++)addShape(shapes[i]),this.addGroup(groupStart,groupCount,i),groupStart+=groupCount,groupCount=0;function addShape(shape){var i,l,shapeHole,indexOffset=vertices.length/3,points=shape.extractPoints(curveSegments),shapeVertices=points.shape,shapeHoles=points.holes;for(!1===ShapeUtils.isClockWise(shapeVertices)&&(shapeVertices=shapeVertices.reverse()),i=0,l=shapeHoles.length;i<l;i++)shapeHole=shapeHoles[i],!0===ShapeUtils.isClockWise(shapeHole)&&(shapeHoles[i]=shapeHole.reverse());var faces=ShapeUtils.triangulateShape(shapeVertices,shapeHoles);for(i=0,l=shapeHoles.length;i<l;i++)shapeHole=shapeHoles[i],shapeVertices=shapeVertices.concat(shapeHole);for(i=0,l=shapeVertices.length;i<l;i++){var vertex=shapeVertices[i];vertices.push(vertex.x,vertex.y,0),normals.push(0,0,1),uvs.push(vertex.x,vertex.y)}for(i=0,l=faces.length;i<l;i++){var face=faces[i],a=face[0]+indexOffset,b=face[1]+indexOffset,c=face[2]+indexOffset;indices.push(a,b,c),groupCount+=3}}this.setIndex(indices),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("normal",new Float32BufferAttribute(normals,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}function toJSON$1(shapes,data){if(data.shapes=[],Array.isArray(shapes))for(var i=0,l=shapes.length;i<l;i++){var shape=shapes[i];data.shapes.push(shape.uuid)}else data.shapes.push(shapes.uuid);return data}function EdgesGeometry(geometry,thresholdAngle){BufferGeometry.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:thresholdAngle},thresholdAngle=void 0!==thresholdAngle?thresholdAngle:1;var edge1,edge2,key,geometry2,vertices=[],thresholdDot=Math.cos(_Math.DEG2RAD*thresholdAngle),edge=[0,0],edges={},keys=["a","b","c"];geometry.isBufferGeometry?(geometry2=new Geometry).fromBufferGeometry(geometry):geometry2=geometry.clone(),geometry2.mergeVertices(),geometry2.computeFaceNormals();for(var sourceVertices=geometry2.vertices,faces=geometry2.faces,i=0,l=faces.length;i<l;i++)for(var face=faces[i],j=0;j<3;j++)edge1=face[keys[j]],edge2=face[keys[(j+1)%3]],edge[0]=Math.min(edge1,edge2),edge[1]=Math.max(edge1,edge2),void 0===edges[key=edge[0]+","+edge[1]]?edges[key]={index1:edge[0],index2:edge[1],face1:i,face2:void 0}:edges[key].face2=i;for(key in edges){var e=edges[key];if(void 0===e.face2||faces[e.face1].normal.dot(faces[e.face2].normal)<=thresholdDot){var vertex=sourceVertices[e.index1];vertices.push(vertex.x,vertex.y,vertex.z),vertex=sourceVertices[e.index2],vertices.push(vertex.x,vertex.y,vertex.z)}}this.addAttribute("position",new Float32BufferAttribute(vertices,3))}function CylinderGeometry(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:radiusTop,radiusBottom:radiusBottom,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength},this.fromBufferGeometry(new CylinderBufferGeometry(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength)),this.mergeVertices()}function CylinderBufferGeometry(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:radiusTop,radiusBottom:radiusBottom,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength};var scope=this;radiusTop=void 0!==radiusTop?radiusTop:1,radiusBottom=void 0!==radiusBottom?radiusBottom:1,height=height||1,radialSegments=Math.floor(radialSegments)||8,heightSegments=Math.floor(heightSegments)||1,openEnded=void 0!==openEnded&&openEnded,thetaStart=void 0!==thetaStart?thetaStart:0,thetaLength=void 0!==thetaLength?thetaLength:2*Math.PI;var indices=[],vertices=[],normals=[],uvs=[],index=0,indexArray=[],halfHeight=height/2,groupStart=0;function generateCap(top){var x,centerIndexStart,centerIndexEnd,uv=new Vector2,vertex=new Vector3,groupCount=0,radius=!0===top?radiusTop:radiusBottom,sign=!0===top?1:-1;for(centerIndexStart=index,x=1;x<=radialSegments;x++)vertices.push(0,halfHeight*sign,0),normals.push(0,sign,0),uvs.push(.5,.5),index++;for(centerIndexEnd=index,x=0;x<=radialSegments;x++){var theta=x/radialSegments*thetaLength+thetaStart,cosTheta=Math.cos(theta),sinTheta=Math.sin(theta);vertex.x=radius*sinTheta,vertex.y=halfHeight*sign,vertex.z=radius*cosTheta,vertices.push(vertex.x,vertex.y,vertex.z),normals.push(0,sign,0),uv.x=.5*cosTheta+.5,uv.y=.5*sinTheta*sign+.5,uvs.push(uv.x,uv.y),index++}for(x=0;x<radialSegments;x++){var c=centerIndexStart+x,i=centerIndexEnd+x;!0===top?indices.push(i,i+1,c):indices.push(i+1,i,c),groupCount+=3}scope.addGroup(groupStart,groupCount,!0===top?1:2),groupStart+=groupCount}!function(){var x,y,normal=new Vector3,vertex=new Vector3,groupCount=0,slope=(radiusBottom-radiusTop)/height;for(y=0;y<=heightSegments;y++){var indexRow=[],v=y/heightSegments,radius=v*(radiusBottom-radiusTop)+radiusTop;for(x=0;x<=radialSegments;x++){var u=x/radialSegments,theta=u*thetaLength+thetaStart,sinTheta=Math.sin(theta),cosTheta=Math.cos(theta);vertex.x=radius*sinTheta,vertex.y=-v*height+halfHeight,vertex.z=radius*cosTheta,vertices.push(vertex.x,vertex.y,vertex.z),normal.set(sinTheta,slope,cosTheta).normalize(),normals.push(normal.x,normal.y,normal.z),uvs.push(u,1-v),indexRow.push(index++)}indexArray.push(indexRow)}for(x=0;x<radialSegments;x++)for(y=0;y<heightSegments;y++){var a=indexArray[y][x],b=indexArray[y+1][x],c=indexArray[y+1][x+1],d=indexArray[y][x+1];indices.push(a,b,d),indices.push(b,c,d),groupCount+=6}scope.addGroup(groupStart,groupCount,0),groupStart+=groupCount}(),!1===openEnded&&(0<radiusTop&&generateCap(!0),0<radiusBottom&&generateCap(!1)),this.setIndex(indices),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("normal",new Float32BufferAttribute(normals,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}function ConeGeometry(radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){CylinderGeometry.call(this,0,radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength),this.type="ConeGeometry",this.parameters={radius:radius,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength}}function ConeBufferGeometry(radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){CylinderBufferGeometry.call(this,0,radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength),this.type="ConeBufferGeometry",this.parameters={radius:radius,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength}}function CircleGeometry(radius,segments,thetaStart,thetaLength){Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:radius,segments:segments,thetaStart:thetaStart,thetaLength:thetaLength},this.fromBufferGeometry(new CircleBufferGeometry(radius,segments,thetaStart,thetaLength)),this.mergeVertices()}function CircleBufferGeometry(radius,segments,thetaStart,thetaLength){BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:radius,segments:segments,thetaStart:thetaStart,thetaLength:thetaLength},radius=radius||1,segments=void 0!==segments?Math.max(3,segments):8,thetaStart=void 0!==thetaStart?thetaStart:0,thetaLength=void 0!==thetaLength?thetaLength:2*Math.PI;var i,s,indices=[],vertices=[],normals=[],uvs=[],vertex=new Vector3,uv=new Vector2;for(vertices.push(0,0,0),normals.push(0,0,1),uvs.push(.5,.5),s=0,i=3;s<=segments;s++,i+=3){var segment=thetaStart+s/segments*thetaLength;vertex.x=radius*Math.cos(segment),vertex.y=radius*Math.sin(segment),vertices.push(vertex.x,vertex.y,vertex.z),normals.push(0,0,1),uv.x=(vertices[i]/radius+1)/2,uv.y=(vertices[i+1]/radius+1)/2,uvs.push(uv.x,uv.y)}for(i=1;i<=segments;i++)indices.push(i,i+1,0);this.setIndex(indices),this.addAttribute("position",new Float32BufferAttribute(vertices,3)),this.addAttribute("normal",new Float32BufferAttribute(normals,3)),this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}(TextGeometry.prototype=Object.create(Geometry.prototype)).constructor=TextGeometry,(TextBufferGeometry.prototype=Object.create(ExtrudeBufferGeometry.prototype)).constructor=TextBufferGeometry,(SphereGeometry.prototype=Object.create(Geometry.prototype)).constructor=SphereGeometry,(SphereBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=SphereBufferGeometry,(RingGeometry.prototype=Object.create(Geometry.prototype)).constructor=RingGeometry,(RingBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=RingBufferGeometry,(LatheGeometry.prototype=Object.create(Geometry.prototype)).constructor=LatheGeometry,(LatheBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=LatheBufferGeometry,((ShapeGeometry.prototype=Object.create(Geometry.prototype)).constructor=ShapeGeometry).prototype.toJSON=function(){var data=Geometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,data)},((ShapeBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=ShapeBufferGeometry).prototype.toJSON=function(){var data=BufferGeometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,data)},(EdgesGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=EdgesGeometry,(CylinderGeometry.prototype=Object.create(Geometry.prototype)).constructor=CylinderGeometry,(CylinderBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=CylinderBufferGeometry,(ConeGeometry.prototype=Object.create(CylinderGeometry.prototype)).constructor=ConeGeometry,(ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype)).constructor=ConeBufferGeometry,(CircleGeometry.prototype=Object.create(Geometry.prototype)).constructor=CircleGeometry,(CircleBufferGeometry.prototype=Object.create(BufferGeometry.prototype)).constructor=CircleBufferGeometry;var Geometries=Object.freeze({WireframeGeometry:WireframeGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxBufferGeometry});function ShadowMaterial(parameters){Material.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(parameters)}function RawShaderMaterial(parameters){ShaderMaterial.call(this,parameters),this.type="RawShaderMaterial"}function MeshStandardMaterial(parameters){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(parameters)}function MeshPhysicalMaterial(parameters){MeshStandardMaterial.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(parameters)}function MeshPhongMaterial(parameters){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(parameters)}function MeshToonMaterial(parameters){MeshPhongMaterial.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(parameters)}function MeshNormalMaterial(parameters){Material.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(parameters)}function MeshLambertMaterial(parameters){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(parameters)}function MeshMatcapMaterial(parameters){Material.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(parameters)}function LineDashedMaterial(parameters){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(parameters)}((ShadowMaterial.prototype=Object.create(Material.prototype)).constructor=ShadowMaterial).prototype.isShadowMaterial=!0,ShadowMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this},((RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype)).constructor=RawShaderMaterial).prototype.isRawShaderMaterial=!0,((MeshStandardMaterial.prototype=Object.create(Material.prototype)).constructor=MeshStandardMaterial).prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.defines={STANDARD:""},this.color.copy(source.color),this.roughness=source.roughness,this.metalness=source.metalness,this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.roughnessMap=source.roughnessMap,this.metalnessMap=source.metalnessMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.envMapIntensity=source.envMapIntensity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},((MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype)).constructor=MeshPhysicalMaterial).prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(source){return MeshStandardMaterial.prototype.copy.call(this,source),this.defines={PHYSICAL:""},this.reflectivity=source.reflectivity,this.clearCoat=source.clearCoat,this.clearCoatRoughness=source.clearCoatRoughness,this},((MeshPhongMaterial.prototype=Object.create(Material.prototype)).constructor=MeshPhongMaterial).prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.specular.copy(source.specular),this.shininess=source.shininess,this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.specularMap=source.specularMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.combine=source.combine,this.reflectivity=source.reflectivity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},((MeshToonMaterial.prototype=Object.create(MeshPhongMaterial.prototype)).constructor=MeshToonMaterial).prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(source){return MeshPhongMaterial.prototype.copy.call(this,source),this.gradientMap=source.gradientMap,this},((MeshNormalMaterial.prototype=Object.create(Material.prototype)).constructor=MeshNormalMaterial).prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},((MeshLambertMaterial.prototype=Object.create(Material.prototype)).constructor=MeshLambertMaterial).prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.specularMap=source.specularMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.combine=source.combine,this.reflectivity=source.reflectivity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},((MeshMatcapMaterial.prototype=Object.create(Material.prototype)).constructor=MeshMatcapMaterial).prototype.isMeshMatcapMaterial=!0,MeshMatcapMaterial.prototype.copy=function(source){return Material.prototype.copy.call(this,source),this.defines={MATCAP:""},this.color.copy(source.color),this.matcap=source.matcap,this.map=source.map,this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.alphaMap=source.alphaMap,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},((LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype)).constructor=LineDashedMaterial).prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(source){return LineBasicMaterial.prototype.copy.call(this,source),this.scale=source.scale,this.dashSize=source.dashSize,this.gapSize=source.gapSize,this};var Materials=Object.freeze({ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material}),AnimationUtils={arraySlice:function(array,from,to){return AnimationUtils.isTypedArray(array)?new array.constructor(array.subarray(from,void 0!==to?to:array.length)):array.slice(from,to)},convertArray:function(array,type,forceClone){return!array||!forceClone&&array.constructor===type?array:"number"==typeof type.BYTES_PER_ELEMENT?new type(array):Array.prototype.slice.call(array)},isTypedArray:function(object){return ArrayBuffer.isView(object)&&!(object instanceof DataView)},getKeyframeOrder:function(times){for(var n=times.length,result=new Array(n),i=0;i!==n;++i)result[i]=i;return result.sort(function(i,j){return times[i]-times[j]}),result},sortedArray:function(values,stride,order){for(var nValues=values.length,result=new values.constructor(nValues),i=0,dstOffset=0;dstOffset!==nValues;++i)for(var srcOffset=order[i]*stride,j=0;j!==stride;++j)result[dstOffset++]=values[srcOffset+j];return result},flattenJSON:function(jsonKeys,times,values,valuePropertyName){for(var i=1,key=jsonKeys[0];void 0!==key&&void 0===key[valuePropertyName];)key=jsonKeys[i++];if(void 0!==key){var value=key[valuePropertyName];if(void 0!==value)if(Array.isArray(value))for(;void 0!==(value=key[valuePropertyName])&&(times.push(key.time),values.push.apply(values,value)),void 0!==(key=jsonKeys[i++]););else if(void 0!==value.toArray)for(;void 0!==(value=key[valuePropertyName])&&(times.push(key.time),value.toArray(values,values.length)),void 0!==(key=jsonKeys[i++]););else for(;void 0!==(value=key[valuePropertyName])&&(times.push(key.time),values.push(value)),void 0!==(key=jsonKeys[i++]););}}};function Interpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){this.parameterPositions=parameterPositions,this._cachedIndex=0,this.resultBuffer=void 0!==resultBuffer?resultBuffer:new sampleValues.constructor(sampleSize),this.sampleValues=sampleValues,this.valueSize=sampleSize}function CubicInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function LinearInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer)}function DiscreteInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer)}function KeyframeTrack(name,times,values,interpolation){if(void 0===name)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===times||0===times.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+name);this.name=name,this.times=AnimationUtils.convertArray(times,this.TimeBufferType),this.values=AnimationUtils.convertArray(values,this.ValueBufferType),this.setInterpolation(interpolation||this.DefaultInterpolation)}function BooleanKeyframeTrack(name,times,values){KeyframeTrack.call(this,name,times,values)}function ColorKeyframeTrack(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation)}function NumberKeyframeTrack(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation)}function QuaternionLinearInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer)}function QuaternionKeyframeTrack(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation)}function StringKeyframeTrack(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation)}function VectorKeyframeTrack(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation)}function AnimationClip(name,duration,tracks){this.name=name,this.tracks=tracks,this.duration=void 0!==duration?duration:-1,this.uuid=_Math.generateUUID(),this.duration<0&&this.resetDuration()}function parseKeyframeTrack(json){if(void 0===json.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var trackType=function(typeName){switch(typeName.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+typeName)}(json.type);if(void 0===json.times){var times=[],values=[];AnimationUtils.flattenJSON(json.keys,times,values,"value"),json.times=times,json.values=values}return void 0!==trackType.parse?trackType.parse(json):new trackType(json.name,json.times,json.values,json.interpolation)}Object.assign(Interpolant.prototype,{evaluate:function(t){var pp=this.parameterPositions,i1=this._cachedIndex,t1=pp[i1],t0=pp[i1-1];validate_interval:{seek:{var right;linear_scan:{forward_scan:if(!(t<t1)){for(var giveUpAt=i1+2;;){if(void 0===t1){if(t<t0)break forward_scan;return i1=pp.length,this._cachedIndex=i1,this.afterEnd_(i1-1,t,t0)}if(i1===giveUpAt)break;if(t0=t1,t<(t1=pp[++i1]))break seek}right=pp.length;break linear_scan}if(t0<=t)break validate_interval;var t1global=pp[1];t<t1global&&(i1=2,t0=t1global);for(giveUpAt=i1-2;;){if(void 0===t0)return this._cachedIndex=0,this.beforeStart_(0,t,t1);if(i1===giveUpAt)break;if(t1=t0,(t0=pp[--i1-1])<=t)break seek}right=i1,i1=0}for(;i1<right;){var mid=i1+right>>>1;t<pp[mid]?right=mid:i1=1+mid}if(t1=pp[i1],void 0===(t0=pp[i1-1]))return this._cachedIndex=0,this.beforeStart_(0,t,t1);if(void 0===t1)return i1=pp.length,this._cachedIndex=i1,this.afterEnd_(i1-1,t0,t)}this._cachedIndex=i1,this.intervalChanged_(i1,t0,t1)}return this.interpolate_(i1,t0,t,t1)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(index){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,offset=index*stride,i=0;i!==stride;++i)result[i]=values[offset+i];return result},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(i1,t0,t1){var pp=this.parameterPositions,iPrev=i1-2,iNext=i1+1,tPrev=pp[iPrev],tNext=pp[iNext];if(void 0===tPrev)switch(this.getSettings_().endingStart){case 2401:iPrev=i1,tPrev=2*t0-t1;break;case 2402:tPrev=t0+pp[iPrev=pp.length-2]-pp[iPrev+1];break;default:iPrev=i1,tPrev=t1}if(void 0===tNext)switch(this.getSettings_().endingEnd){case 2401:iNext=i1,tNext=2*t1-t0;break;case 2402:tNext=t1+pp[iNext=1]-pp[0];break;default:iNext=i1-1,tNext=t0}var halfDt=.5*(t1-t0),stride=this.valueSize;this._weightPrev=halfDt/(t0-tPrev),this._weightNext=halfDt/(tNext-t1),this._offsetPrev=iPrev*stride,this._offsetNext=iNext*stride},interpolate_:function(i1,t0,t,t1){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,o1=i1*stride,o0=o1-stride,oP=this._offsetPrev,oN=this._offsetNext,wP=this._weightPrev,wN=this._weightNext,p=(t-t0)/(t1-t0),pp=p*p,ppp=pp*p,sP=-wP*ppp+2*wP*pp-wP*p,s0=(1+wP)*ppp+(-1.5-2*wP)*pp+(-.5+wP)*p+1,s1=(-1-wN)*ppp+(1.5+wN)*pp+.5*p,sN=wN*ppp-wN*pp,i=0;i!==stride;++i)result[i]=sP*values[oP+i]+s0*values[o0+i]+s1*values[o1+i]+sN*values[oN+i];return result}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(i1,t0,t,t1){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,offset1=i1*stride,offset0=offset1-stride,weight1=(t-t0)/(t1-t0),weight0=1-weight1,i=0;i!==stride;++i)result[i]=values[offset0+i]*weight0+values[offset1+i]*weight1;return result}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(i1){return this.copySampleValue_(i1-1)}}),Object.assign(KeyframeTrack,{toJSON:function(track){var json,trackType=track.constructor;if(void 0!==trackType.toJSON)json=trackType.toJSON(track);else{json={name:track.name,times:AnimationUtils.convertArray(track.times,Array),values:AnimationUtils.convertArray(track.values,Array)};var interpolation=track.getInterpolation();interpolation!==track.DefaultInterpolation&&(json.interpolation=interpolation)}return json.type=track.ValueTypeName,json}}),Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(result){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),result)},InterpolantFactoryMethodLinear:function(result){return new LinearInterpolant(this.times,this.values,this.getValueSize(),result)},InterpolantFactoryMethodSmooth:function(result){return new CubicInterpolant(this.times,this.values,this.getValueSize(),result)},setInterpolation:function(interpolation){var factoryMethod;switch(interpolation){case 2300:factoryMethod=this.InterpolantFactoryMethodDiscrete;break;case 2301:factoryMethod=this.InterpolantFactoryMethodLinear;break;case 2302:factoryMethod=this.InterpolantFactoryMethodSmooth}if(void 0!==factoryMethod)return this.createInterpolant=factoryMethod,this;var message="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(interpolation===this.DefaultInterpolation)throw new Error(message);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",message),this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(timeOffset){if(0!==timeOffset)for(var times=this.times,i=0,n=times.length;i!==n;++i)times[i]+=timeOffset;return this},scale:function(timeScale){if(1!==timeScale)for(var times=this.times,i=0,n=times.length;i!==n;++i)times[i]*=timeScale;return this},trim:function(startTime,endTime){for(var times=this.times,nKeys=times.length,from=0,to=nKeys-1;from!==nKeys&&times[from]<startTime;)++from;for(;-1!==to&&times[to]>endTime;)--to;if(++to,0!==from||to!==nKeys){to<=from&&(from=(to=Math.max(to,1))-1);var stride=this.getValueSize();this.times=AnimationUtils.arraySlice(times,from,to),this.values=AnimationUtils.arraySlice(this.values,from*stride,to*stride)}return this},validate:function(){var valid=!0,valueSize=this.getValueSize();valueSize-Math.floor(valueSize)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),valid=!1);var times=this.times,values=this.values,nKeys=times.length;0===nKeys&&(console.error("THREE.KeyframeTrack: Track is empty.",this),valid=!1);for(var prevTime=null,i=0;i!==nKeys;i++){var currTime=times[i];if("number"==typeof currTime&&isNaN(currTime)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,i,currTime),valid=!1;break}if(null!==prevTime&&currTime<prevTime){console.error("THREE.KeyframeTrack: Out of order keys.",this,i,currTime,prevTime),valid=!1;break}prevTime=currTime}if(void 0!==values&&AnimationUtils.isTypedArray(values)){i=0;for(var n=values.length;i!==n;++i){var value=values[i];if(isNaN(value)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,i,value),valid=!1;break}}}return valid},optimize:function(){for(var times=this.times,values=this.values,stride=this.getValueSize(),smoothInterpolation=2302===this.getInterpolation(),writeIndex=1,lastIndex=times.length-1,i=1;i<lastIndex;++i){var keep=!1,time=times[i];if(time!==times[i+1]&&(1!==i||time!==time[0]))if(smoothInterpolation)keep=!0;else for(var offset=i*stride,offsetP=offset-stride,offsetN=offset+stride,j=0;j!==stride;++j){var value=values[offset+j];if(value!==values[offsetP+j]||value!==values[offsetN+j]){keep=!0;break}}if(keep){if(i!==writeIndex){times[writeIndex]=times[i];var readOffset=i*stride,writeOffset=writeIndex*stride;for(j=0;j!==stride;++j)values[writeOffset+j]=values[readOffset+j]}++writeIndex}}if(0<lastIndex){times[writeIndex]=times[lastIndex];for(readOffset=lastIndex*stride,writeOffset=writeIndex*stride,j=0;j!==stride;++j)values[writeOffset+j]=values[readOffset+j];++writeIndex}return writeIndex!==times.length&&(this.times=AnimationUtils.arraySlice(times,0,writeIndex),this.values=AnimationUtils.arraySlice(values,0,writeIndex*stride)),this},clone:function(){var times=AnimationUtils.arraySlice(this.times,0),values=AnimationUtils.arraySlice(this.values,0),track=new this.constructor(this.name,times,values);return track.createInterpolant=this.createInterpolant,track}}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(i1,t0,t,t1){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,offset=i1*stride,alpha=(t-t0)/(t1-t0),end=offset+stride;offset!==end;offset+=4)Quaternion.slerpFlat(result,0,values,offset-stride,values,offset,alpha);return result}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(result){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),result)},InterpolantFactoryMethodSmooth:void 0}),StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),Object.assign(AnimationClip,{parse:function(json){for(var tracks=[],jsonTracks=json.tracks,frameTime=1/(json.fps||1),i=0,n=jsonTracks.length;i!==n;++i)tracks.push(parseKeyframeTrack(jsonTracks[i]).scale(frameTime));return new AnimationClip(json.name,json.duration,tracks)},toJSON:function(clip){for(var tracks=[],clipTracks=clip.tracks,json={name:clip.name,duration:clip.duration,tracks:tracks,uuid:clip.uuid},i=0,n=clipTracks.length;i!==n;++i)tracks.push(KeyframeTrack.toJSON(clipTracks[i]));return json},CreateFromMorphTargetSequence:function(name,morphTargetSequence,fps,noLoop){for(var numMorphTargets=morphTargetSequence.length,tracks=[],i=0;i<numMorphTargets;i++){var times=[],values=[];times.push((i+numMorphTargets-1)%numMorphTargets,i,(i+1)%numMorphTargets),values.push(0,1,0);var order=AnimationUtils.getKeyframeOrder(times);times=AnimationUtils.sortedArray(times,1,order),values=AnimationUtils.sortedArray(values,1,order),noLoop||0!==times[0]||(times.push(numMorphTargets),values.push(values[0])),tracks.push(new NumberKeyframeTrack(".morphTargetInfluences["+morphTargetSequence[i].name+"]",times,values).scale(1/fps))}return new AnimationClip(name,-1,tracks)},findByName:function(objectOrClipArray,name){var clipArray=objectOrClipArray;if(!Array.isArray(objectOrClipArray)){var o=objectOrClipArray;clipArray=o.geometry&&o.geometry.animations||o.animations}for(var i=0;i<clipArray.length;i++)if(clipArray[i].name===name)return clipArray[i];return null},CreateClipsFromMorphTargetSequences:function(morphTargets,fps,noLoop){for(var animationToMorphTargets={},pattern=/^([\w-]*?)([\d]+)$/,i=0,il=morphTargets.length;i<il;i++){var morphTarget=morphTargets[i],parts=morphTarget.name.match(pattern);if(parts&&1<parts.length){var animationMorphTargets=animationToMorphTargets[name=parts[1]];animationMorphTargets||(animationToMorphTargets[name]=animationMorphTargets=[]),animationMorphTargets.push(morphTarget)}}var clips=[];for(var name in animationToMorphTargets)clips.push(AnimationClip.CreateFromMorphTargetSequence(name,animationToMorphTargets[name],fps,noLoop));return clips},parseAnimation:function(animation,bones){if(!animation)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var addNonemptyTrack=function(trackType,trackName,animationKeys,propertyName,destTracks){if(0!==animationKeys.length){var times=[],values=[];AnimationUtils.flattenJSON(animationKeys,times,values,propertyName),0!==times.length&&destTracks.push(new trackType(trackName,times,values))}},tracks=[],clipName=animation.name||"default",duration=animation.length||-1,fps=animation.fps||30,hierarchyTracks=animation.hierarchy||[],h=0;h<hierarchyTracks.length;h++){var animationKeys=hierarchyTracks[h].keys;if(animationKeys&&0!==animationKeys.length)if(animationKeys[0].morphTargets){for(var morphTargetNames={},k=0;k<animationKeys.length;k++)if(animationKeys[k].morphTargets)for(var m=0;m<animationKeys[k].morphTargets.length;m++)morphTargetNames[animationKeys[k].morphTargets[m]]=-1;for(var morphTargetName in morphTargetNames){var times=[],values=[];for(m=0;m!==animationKeys[k].morphTargets.length;++m){var animationKey=animationKeys[k];times.push(animationKey.time),values.push(animationKey.morphTarget===morphTargetName?1:0)}tracks.push(new NumberKeyframeTrack(".morphTargetInfluence["+morphTargetName+"]",times,values))}duration=morphTargetNames.length*(fps||1)}else{var boneName=".bones["+bones[h].name+"]";addNonemptyTrack(VectorKeyframeTrack,boneName+".position",animationKeys,"pos",tracks),addNonemptyTrack(QuaternionKeyframeTrack,boneName+".quaternion",animationKeys,"rot",tracks),addNonemptyTrack(VectorKeyframeTrack,boneName+".scale",animationKeys,"scl",tracks)}}return 0===tracks.length?null:new AnimationClip(clipName,duration,tracks)}}),Object.assign(AnimationClip.prototype,{resetDuration:function(){for(var duration=0,i=0,n=this.tracks.length;i!==n;++i){var track=this.tracks[i];duration=Math.max(duration,track.times[track.times.length-1])}return this.duration=duration,this},trim:function(){for(var i=0;i<this.tracks.length;i++)this.tracks[i].trim(0,this.duration);return this},validate:function(){for(var valid=!0,i=0;i<this.tracks.length;i++)valid=valid&&this.tracks[i].validate();return valid},optimize:function(){for(var i=0;i<this.tracks.length;i++)this.tracks[i].optimize();return this},clone:function(){for(var tracks=[],i=0;i<this.tracks.length;i++)tracks.push(this.tracks[i].clone());return new AnimationClip(this.name,this.duration,tracks)}});var Cache={enabled:!1,files:{},add:function(key,file){!1!==this.enabled&&(this.files[key]=file)},get:function(key){if(!1!==this.enabled)return this.files[key]},remove:function(key){delete this.files[key]},clear:function(){this.files={}}};function LoadingManager(onLoad,onProgress,onError){var scope=this,isLoading=!1,itemsLoaded=0,itemsTotal=0,urlModifier=void 0;this.onStart=void 0,this.onLoad=onLoad,this.onProgress=onProgress,this.onError=onError,this.itemStart=function(url){itemsTotal++,!1===isLoading&&void 0!==scope.onStart&&scope.onStart(url,itemsLoaded,itemsTotal),isLoading=!0},this.itemEnd=function(url){itemsLoaded++,void 0!==scope.onProgress&&scope.onProgress(url,itemsLoaded,itemsTotal),itemsLoaded===itemsTotal&&(isLoading=!1,void 0!==scope.onLoad&&scope.onLoad())},this.itemError=function(url){void 0!==scope.onError&&scope.onError(url)},this.resolveURL=function(url){return urlModifier?urlModifier(url):url},this.setURLModifier=function(transform){return urlModifier=transform,this}}var DefaultLoadingManager=new LoadingManager,loading={};function FileLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}function AnimationLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}function CompressedTextureLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager,this._parser=null}function DataTextureLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager,this._parser=null}function ImageLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}function CubeTextureLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}function TextureLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}function Curve(){this.type="Curve",this.arcLengthDivisions=200}function EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){Curve.call(this),this.type="EllipseCurve",this.aX=aX||0,this.aY=aY||0,this.xRadius=xRadius||1,this.yRadius=yRadius||1,this.aStartAngle=aStartAngle||0,this.aEndAngle=aEndAngle||2*Math.PI,this.aClockwise=aClockwise||!1,this.aRotation=aRotation||0}function ArcCurve(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){EllipseCurve.call(this,aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise),this.type="ArcCurve"}function CubicPoly(){var c0=0,c1=0,c2=0,c3=0;function init(x0,x1,t0,t1){c2=-3*(c0=x0)+3*x1-2*(c1=t0)-t1,c3=2*x0-2*x1+t0+t1}return{initCatmullRom:function(x0,x1,x2,x3,tension){init(x1,x2,tension*(x2-x0),tension*(x3-x1))},initNonuniformCatmullRom:function(x0,x1,x2,x3,dt0,dt1,dt2){var t1=(x1-x0)/dt0-(x2-x0)/(dt0+dt1)+(x2-x1)/dt1,t2=(x2-x1)/dt1-(x3-x1)/(dt1+dt2)+(x3-x2)/dt2;init(x1,x2,t1*=dt1,t2*=dt1)},calc:function(t){var t2=t*t;return c0+c1*t+c2*t2+c3*(t2*t)}}}Object.assign(FileLoader.prototype,{load:function(url,onLoad,onProgress,onError){void 0===url&&(url=""),void 0!==this.path&&(url=this.path+url),url=this.manager.resolveURL(url);var scope=this,cached=Cache.get(url);if(void 0!==cached)return scope.manager.itemStart(url),setTimeout(function(){onLoad&&onLoad(cached),scope.manager.itemEnd(url)},0),cached;if(void 0===loading[url]){var dataUriRegexResult=url.match(/^data:(.*?)(;base64)?,(.*)$/);if(dataUriRegexResult){var mimeType=dataUriRegexResult[1],isBase64=!!dataUriRegexResult[2],data=dataUriRegexResult[3];data=decodeURIComponent(data),isBase64&&(data=atob(data));try{var response,responseType=(this.responseType||"").toLowerCase();switch(responseType){case"arraybuffer":case"blob":for(var view=new Uint8Array(data.length),i=0;i<data.length;i++)view[i]=data.charCodeAt(i);response="blob"===responseType?new Blob([view.buffer],{type:mimeType}):view.buffer;break;case"document":var parser=new DOMParser;response=parser.parseFromString(data,mimeType);break;case"json":response=JSON.parse(data);break;default:response=data}setTimeout(function(){onLoad&&onLoad(response),scope.manager.itemEnd(url)},0)}catch(error){setTimeout(function(){onError&&onError(error),scope.manager.itemError(url),scope.manager.itemEnd(url)},0)}}else{loading[url]=[],loading[url].push({onLoad:onLoad,onProgress:onProgress,onError:onError});var request=new XMLHttpRequest;for(var header in request.open("GET",url,!0),request.addEventListener("load",function(event){var response=this.response;Cache.add(url,response);var callbacks=loading[url];if(delete loading[url],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var i=0,il=callbacks.length;i<il;i++){(callback=callbacks[i]).onLoad&&callback.onLoad(response)}scope.manager.itemEnd(url)}else{for(i=0,il=callbacks.length;i<il;i++){var callback;(callback=callbacks[i]).onError&&callback.onError(event)}scope.manager.itemError(url),scope.manager.itemEnd(url)}},!1),request.addEventListener("progress",function(event){for(var callbacks=loading[url],i=0,il=callbacks.length;i<il;i++){var callback=callbacks[i];callback.onProgress&&callback.onProgress(event)}},!1),request.addEventListener("error",function(event){var callbacks=loading[url];delete loading[url];for(var i=0,il=callbacks.length;i<il;i++){var callback=callbacks[i];callback.onError&&callback.onError(event)}scope.manager.itemError(url),scope.manager.itemEnd(url)},!1),request.addEventListener("abort",function(event){var callbacks=loading[url];delete loading[url];for(var i=0,il=callbacks.length;i<il;i++){var callback=callbacks[i];callback.onError&&callback.onError(event)}scope.manager.itemError(url),scope.manager.itemEnd(url)},!1),void 0!==this.responseType&&(request.responseType=this.responseType),void 0!==this.withCredentials&&(request.withCredentials=this.withCredentials),request.overrideMimeType&&request.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)request.setRequestHeader(header,this.requestHeader[header]);request.send(null)}return scope.manager.itemStart(url),request}loading[url].push({onLoad:onLoad,onProgress:onProgress,onError:onError})},setPath:function(value){return this.path=value,this},setResponseType:function(value){return this.responseType=value,this},setWithCredentials:function(value){return this.withCredentials=value,this},setMimeType:function(value){return this.mimeType=value,this},setRequestHeader:function(value){return this.requestHeader=value,this}}),Object.assign(AnimationLoader.prototype,{load:function(url,onLoad,onProgress,onError){var scope=this,loader=new FileLoader(scope.manager);loader.setPath(scope.path),loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},parse:function(json){for(var animations=[],i=0;i<json.length;i++){var clip=AnimationClip.parse(json[i]);animations.push(clip)}return animations},setPath:function(value){return this.path=value,this}}),Object.assign(CompressedTextureLoader.prototype,{load:function(url,onLoad,onProgress,onError){var scope=this,images=[],texture=new CompressedTexture;texture.image=images;var loader=new FileLoader(this.manager);function loadTexture(i){loader.load(url[i],function(buffer){var texDatas=scope._parser(buffer,!0);images[i]={width:texDatas.width,height:texDatas.height,format:texDatas.format,mipmaps:texDatas.mipmaps},6===(loaded+=1)&&(1===texDatas.mipmapCount&&(texture.minFilter=LinearFilter),texture.format=texDatas.format,texture.needsUpdate=!0,onLoad&&onLoad(texture))},onProgress,onError)}if(loader.setPath(this.path),loader.setResponseType("arraybuffer"),Array.isArray(url))for(var loaded=0,i=0,il=url.length;i<il;++i)loadTexture(i);else loader.load(url,function(buffer){var texDatas=scope._parser(buffer,!0);if(texDatas.isCubemap)for(var faces=texDatas.mipmaps.length/texDatas.mipmapCount,f=0;f<faces;f++){images[f]={mipmaps:[]};for(var i=0;i<texDatas.mipmapCount;i++)images[f].mipmaps.push(texDatas.mipmaps[f*texDatas.mipmapCount+i]),images[f].format=texDatas.format,images[f].width=texDatas.width,images[f].height=texDatas.height}else texture.image.width=texDatas.width,texture.image.height=texDatas.height,texture.mipmaps=texDatas.mipmaps;1===texDatas.mipmapCount&&(texture.minFilter=LinearFilter),texture.format=texDatas.format,texture.needsUpdate=!0,onLoad&&onLoad(texture)},onProgress,onError);return texture},setPath:function(value){return this.path=value,this}}),Object.assign(DataTextureLoader.prototype,{load:function(url,onLoad,onProgress,onError){var scope=this,texture=new DataTexture,loader=new FileLoader(this.manager);return loader.setResponseType("arraybuffer"),loader.setPath(this.path),loader.load(url,function(buffer){var texData=scope._parser(buffer);texData&&(void 0!==texData.image?texture.image=texData.image:void 0!==texData.data&&(texture.image.width=texData.width,texture.image.height=texData.height,texture.image.data=texData.data),texture.wrapS=void 0!==texData.wrapS?texData.wrapS:ClampToEdgeWrapping,texture.wrapT=void 0!==texData.wrapT?texData.wrapT:ClampToEdgeWrapping,texture.magFilter=void 0!==texData.magFilter?texData.magFilter:LinearFilter,texture.minFilter=void 0!==texData.minFilter?texData.minFilter:LinearMipMapLinearFilter,texture.anisotropy=void 0!==texData.anisotropy?texData.anisotropy:1,void 0!==texData.format&&(texture.format=texData.format),void 0!==texData.type&&(texture.type=texData.type),void 0!==texData.mipmaps&&(texture.mipmaps=texData.mipmaps),1===texData.mipmapCount&&(texture.minFilter=LinearFilter),texture.needsUpdate=!0,onLoad&&onLoad(texture,texData))},onProgress,onError),texture},setPath:function(value){return this.path=value,this}}),Object.assign(ImageLoader.prototype,{crossOrigin:"anonymous",load:function(url,onLoad,onProgress,onError){void 0===url&&(url=""),void 0!==this.path&&(url=this.path+url),url=this.manager.resolveURL(url);var scope=this,cached=Cache.get(url);if(void 0!==cached)return scope.manager.itemStart(url),setTimeout(function(){onLoad&&onLoad(cached),scope.manager.itemEnd(url)},0),cached;var image=document.createElementNS("http://www.w3.org/1999/xhtml","img");function onImageLoad(){image.removeEventListener("load",onImageLoad,!1),image.removeEventListener("error",onImageError,!1),Cache.add(url,this),onLoad&&onLoad(this),scope.manager.itemEnd(url)}function onImageError(event){image.removeEventListener("load",onImageLoad,!1),image.removeEventListener("error",onImageError,!1),onError&&onError(event),scope.manager.itemError(url),scope.manager.itemEnd(url)}return image.addEventListener("load",onImageLoad,!1),image.addEventListener("error",onImageError,!1),"data:"!==url.substr(0,5)&&void 0!==this.crossOrigin&&(image.crossOrigin=this.crossOrigin),scope.manager.itemStart(url),image.src=url,image},setCrossOrigin:function(value){return this.crossOrigin=value,this},setPath:function(value){return this.path=value,this}}),Object.assign(CubeTextureLoader.prototype,{crossOrigin:"anonymous",load:function(urls,onLoad,onProgress,onError){var texture=new CubeTexture,loader=new ImageLoader(this.manager);loader.setCrossOrigin(this.crossOrigin),loader.setPath(this.path);var loaded=0;function loadTexture(i){loader.load(urls[i],function(image){texture.images[i]=image,6===++loaded&&(texture.needsUpdate=!0,onLoad&&onLoad(texture))},void 0,onError)}for(var i=0;i<urls.length;++i)loadTexture(i);return texture},setCrossOrigin:function(value){return this.crossOrigin=value,this},setPath:function(value){return this.path=value,this}}),Object.assign(TextureLoader.prototype,{crossOrigin:"anonymous",load:function(url,onLoad,onProgress,onError){var texture=new Texture,loader=new ImageLoader(this.manager);return loader.setCrossOrigin(this.crossOrigin),loader.setPath(this.path),loader.load(url,function(image){texture.image=image;var isJPEG=0<url.search(/\.jpe?g($|\?)/i)||0===url.search(/^data\:image\/jpeg/);texture.format=isJPEG?RGBFormat:RGBAFormat,texture.needsUpdate=!0,void 0!==onLoad&&onLoad(texture)},onProgress,onError),texture},setCrossOrigin:function(value){return this.crossOrigin=value,this},setPath:function(value){return this.path=value,this}}),Object.assign(Curve.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(u,optionalTarget){var t=this.getUtoTmapping(u);return this.getPoint(t,optionalTarget)},getPoints:function(divisions){void 0===divisions&&(divisions=5);for(var points=[],d=0;d<=divisions;d++)points.push(this.getPoint(d/divisions));return points},getSpacedPoints:function(divisions){void 0===divisions&&(divisions=5);for(var points=[],d=0;d<=divisions;d++)points.push(this.getPointAt(d/divisions));return points},getLength:function(){var lengths=this.getLengths();return lengths[lengths.length-1]},getLengths:function(divisions){if(void 0===divisions&&(divisions=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===divisions+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var current,p,cache=[],last=this.getPoint(0),sum=0;for(cache.push(0),p=1;p<=divisions;p++)sum+=(current=this.getPoint(p/divisions)).distanceTo(last),cache.push(sum),last=current;return this.cacheArcLengths=cache},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(u,distance){var targetArcLength,arcLengths=this.getLengths(),i=0,il=arcLengths.length;targetArcLength=distance||u*arcLengths[il-1];for(var comparison,low=0,high=il-1;low<=high;)if((comparison=arcLengths[i=Math.floor(low+(high-low)/2)]-targetArcLength)<0)low=i+1;else{if(!(0<comparison)){high=i;break}high=i-1}if(arcLengths[i=high]===targetArcLength)return i/(il-1);var lengthBefore=arcLengths[i];return(i+(targetArcLength-lengthBefore)/(arcLengths[i+1]-lengthBefore))/(il-1)},getTangent:function(t){var t1=t-1e-4,t2=t+1e-4;t1<0&&(t1=0),1<t2&&(t2=1);var pt1=this.getPoint(t1);return this.getPoint(t2).clone().sub(pt1).normalize()},getTangentAt:function(u){var t=this.getUtoTmapping(u);return this.getTangent(t)},computeFrenetFrames:function(segments,closed){var i,u,theta,normal=new Vector3,tangents=[],normals=[],binormals=[],vec=new Vector3,mat=new Matrix4;for(i=0;i<=segments;i++)u=i/segments,tangents[i]=this.getTangentAt(u),tangents[i].normalize();normals[0]=new Vector3,binormals[0]=new Vector3;var min=Number.MAX_VALUE,tx=Math.abs(tangents[0].x),ty=Math.abs(tangents[0].y),tz=Math.abs(tangents[0].z);for(tx<=min&&(min=tx,normal.set(1,0,0)),ty<=min&&(min=ty,normal.set(0,1,0)),tz<=min&&normal.set(0,0,1),vec.crossVectors(tangents[0],normal).normalize(),normals[0].crossVectors(tangents[0],vec),binormals[0].crossVectors(tangents[0],normals[0]),i=1;i<=segments;i++)normals[i]=normals[i-1].clone(),binormals[i]=binormals[i-1].clone(),vec.crossVectors(tangents[i-1],tangents[i]),vec.length()>Number.EPSILON&&(vec.normalize(),theta=Math.acos(_Math.clamp(tangents[i-1].dot(tangents[i]),-1,1)),normals[i].applyMatrix4(mat.makeRotationAxis(vec,theta))),binormals[i].crossVectors(tangents[i],normals[i]);if(!0===closed)for(theta=Math.acos(_Math.clamp(normals[0].dot(normals[segments]),-1,1)),theta/=segments,0<tangents[0].dot(vec.crossVectors(normals[0],normals[segments]))&&(theta=-theta),i=1;i<=segments;i++)normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i],theta*i)),binormals[i].crossVectors(tangents[i],normals[i]);return{tangents:tangents,normals:normals,binormals:binormals}},clone:function(){return(new this.constructor).copy(this)},copy:function(source){return this.arcLengthDivisions=source.arcLengthDivisions,this},toJSON:function(){var data={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return data.arcLengthDivisions=this.arcLengthDivisions,data.type=this.type,data},fromJSON:function(json){return this.arcLengthDivisions=json.arcLengthDivisions,this}}),((EllipseCurve.prototype=Object.create(Curve.prototype)).constructor=EllipseCurve).prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(t,optionalTarget){for(var point=optionalTarget||new Vector2,twoPi=2*Math.PI,deltaAngle=this.aEndAngle-this.aStartAngle,samePoints=Math.abs(deltaAngle)<Number.EPSILON;deltaAngle<0;)deltaAngle+=twoPi;for(;twoPi<deltaAngle;)deltaAngle-=twoPi;deltaAngle<Number.EPSILON&&(deltaAngle=samePoints?0:twoPi),!0!==this.aClockwise||samePoints||(deltaAngle===twoPi?deltaAngle=-twoPi:deltaAngle-=twoPi);var angle=this.aStartAngle+t*deltaAngle,x=this.aX+this.xRadius*Math.cos(angle),y=this.aY+this.yRadius*Math.sin(angle);if(0!==this.aRotation){var cos=Math.cos(this.aRotation),sin=Math.sin(this.aRotation),tx=x-this.aX,ty=y-this.aY;x=tx*cos-ty*sin+this.aX,y=tx*sin+ty*cos+this.aY}return point.set(x,y)},EllipseCurve.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.aX=source.aX,this.aY=source.aY,this.xRadius=source.xRadius,this.yRadius=source.yRadius,this.aStartAngle=source.aStartAngle,this.aEndAngle=source.aEndAngle,this.aClockwise=source.aClockwise,this.aRotation=source.aRotation,this},EllipseCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.aX=this.aX,data.aY=this.aY,data.xRadius=this.xRadius,data.yRadius=this.yRadius,data.aStartAngle=this.aStartAngle,data.aEndAngle=this.aEndAngle,data.aClockwise=this.aClockwise,data.aRotation=this.aRotation,data},EllipseCurve.prototype.fromJSON=function(json){return Curve.prototype.fromJSON.call(this,json),this.aX=json.aX,this.aY=json.aY,this.xRadius=json.xRadius,this.yRadius=json.yRadius,this.aStartAngle=json.aStartAngle,this.aEndAngle=json.aEndAngle,this.aClockwise=json.aClockwise,this.aRotation=json.aRotation,this},((ArcCurve.prototype=Object.create(EllipseCurve.prototype)).constructor=ArcCurve).prototype.isArcCurve=!0;var tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;function CatmullRomCurve3(points,closed,curveType,tension){Curve.call(this),this.type="CatmullRomCurve3",this.points=points||[],this.closed=closed||!1,this.curveType=curveType||"centripetal",this.tension=tension||.5}function CatmullRom(t,p0,p1,p2,p3){var v0=.5*(p2-p0),v1=.5*(p3-p1),t2=t*t;return(2*p1-2*p2+v0+v1)*(t*t2)+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}function QuadraticBezier(t,p0,p1,p2){return function(t,p){var k=1-t;return k*k*p}(t,p0)+function(t,p){return 2*(1-t)*t*p}(t,p1)+function(t,p){return t*t*p}(t,p2)}function CubicBezier(t,p0,p1,p2,p3){return function(t,p){var k=1-t;return k*k*k*p}(t,p0)+function(t,p){var k=1-t;return 3*k*k*t*p}(t,p1)+function(t,p){return 3*(1-t)*t*t*p}(t,p2)+function(t,p){return t*t*t*p}(t,p3)}function CubicBezierCurve(v0,v1,v2,v3){Curve.call(this),this.type="CubicBezierCurve",this.v0=v0||new Vector2,this.v1=v1||new Vector2,this.v2=v2||new Vector2,this.v3=v3||new Vector2}function CubicBezierCurve3(v0,v1,v2,v3){Curve.call(this),this.type="CubicBezierCurve3",this.v0=v0||new Vector3,this.v1=v1||new Vector3,this.v2=v2||new Vector3,this.v3=v3||new Vector3}function LineCurve(v1,v2){Curve.call(this),this.type="LineCurve",this.v1=v1||new Vector2,this.v2=v2||new Vector2}function LineCurve3(v1,v2){Curve.call(this),this.type="LineCurve3",this.v1=v1||new Vector3,this.v2=v2||new Vector3}function QuadraticBezierCurve(v0,v1,v2){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=v0||new Vector2,this.v1=v1||new Vector2,this.v2=v2||new Vector2}function QuadraticBezierCurve3(v0,v1,v2){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=v0||new Vector3,this.v1=v1||new Vector3,this.v2=v2||new Vector3}function SplineCurve(points){Curve.call(this),this.type="SplineCurve",this.points=points||[]}((CatmullRomCurve3.prototype=Object.create(Curve.prototype)).constructor=CatmullRomCurve3).prototype.isCatmullRomCurve3=!0,CatmullRomCurve3.prototype.getPoint=function(t,optionalTarget){var p0,p1,p2,p3,point=optionalTarget||new Vector3,points=this.points,l=points.length,p=(l-(this.closed?0:1))*t,intPoint=Math.floor(p),weight=p-intPoint;if(this.closed?intPoint+=0<intPoint?0:(Math.floor(Math.abs(intPoint)/l)+1)*l:0===weight&&intPoint===l-1&&(intPoint=l-2,weight=1),p0=this.closed||0<intPoint?points[(intPoint-1)%l]:(tmp.subVectors(points[0],points[1]).add(points[0]),tmp),p1=points[intPoint%l],p2=points[(intPoint+1)%l],p3=this.closed||intPoint+2<l?points[(intPoint+2)%l]:(tmp.subVectors(points[l-1],points[l-2]).add(points[l-1]),tmp),"centripetal"===this.curveType||"chordal"===this.curveType){var pow="chordal"===this.curveType?.5:.25,dt0=Math.pow(p0.distanceToSquared(p1),pow),dt1=Math.pow(p1.distanceToSquared(p2),pow),dt2=Math.pow(p2.distanceToSquared(p3),pow);dt1<1e-4&&(dt1=1),dt0<1e-4&&(dt0=dt1),dt2<1e-4&&(dt2=dt1),px.initNonuniformCatmullRom(p0.x,p1.x,p2.x,p3.x,dt0,dt1,dt2),py.initNonuniformCatmullRom(p0.y,p1.y,p2.y,p3.y,dt0,dt1,dt2),pz.initNonuniformCatmullRom(p0.z,p1.z,p2.z,p3.z,dt0,dt1,dt2)}else"catmullrom"===this.curveType&&(px.initCatmullRom(p0.x,p1.x,p2.x,p3.x,this.tension),py.initCatmullRom(p0.y,p1.y,p2.y,p3.y,this.tension),pz.initCatmullRom(p0.z,p1.z,p2.z,p3.z,this.tension));return point.set(px.calc(weight),py.calc(weight),pz.calc(weight)),point},CatmullRomCurve3.prototype.copy=function(source){Curve.prototype.copy.call(this,source),this.points=[];for(var i=0,l=source.points.length;i<l;i++){var point=source.points[i];this.points.push(point.clone())}return this.closed=source.closed,this.curveType=source.curveType,this.tension=source.tension,this},CatmullRomCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.points=[];for(var i=0,l=this.points.length;i<l;i++){var point=this.points[i];data.points.push(point.toArray())}return data.closed=this.closed,data.curveType=this.curveType,data.tension=this.tension,data},CatmullRomCurve3.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json),this.points=[];for(var i=0,l=json.points.length;i<l;i++){var point=json.points[i];this.points.push((new Vector3).fromArray(point))}return this.closed=json.closed,this.curveType=json.curveType,this.tension=json.tension,this},((CubicBezierCurve.prototype=Object.create(Curve.prototype)).constructor=CubicBezierCurve).prototype.isCubicBezierCurve=!0,CubicBezierCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2,v0=this.v0,v1=this.v1,v2=this.v2,v3=this.v3;return point.set(CubicBezier(t,v0.x,v1.x,v2.x,v3.x),CubicBezier(t,v0.y,v1.y,v2.y,v3.y)),point},CubicBezierCurve.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this.v3.copy(source.v3),this},CubicBezierCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data.v3=this.v3.toArray(),data},CubicBezierCurve.prototype.fromJSON=function(json){return Curve.prototype.fromJSON.call(this,json),this.v0.fromArray(json.v0),this.v1.fromArray(json.v1),this.v2.fromArray(json.v2),this.v3.fromArray(json.v3),this},((CubicBezierCurve3.prototype=Object.create(Curve.prototype)).constructor=CubicBezierCurve3).prototype.isCubicBezierCurve3=!0,CubicBezierCurve3.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3,v0=this.v0,v1=this.v1,v2=this.v2,v3=this.v3;return point.set(CubicBezier(t,v0.x,v1.x,v2.x,v3.x),CubicBezier(t,v0.y,v1.y,v2.y,v3.y),CubicBezier(t,v0.z,v1.z,v2.z,v3.z)),point},CubicBezierCurve3.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this.v3.copy(source.v3),this},CubicBezierCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data.v3=this.v3.toArray(),data},CubicBezierCurve3.prototype.fromJSON=function(json){return Curve.prototype.fromJSON.call(this,json),this.v0.fromArray(json.v0),this.v1.fromArray(json.v1),this.v2.fromArray(json.v2),this.v3.fromArray(json.v3),this},((LineCurve.prototype=Object.create(Curve.prototype)).constructor=LineCurve).prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2;return 1===t?point.copy(this.v2):(point.copy(this.v2).sub(this.v1),point.multiplyScalar(t).add(this.v1)),point},LineCurve.prototype.getPointAt=function(u,optionalTarget){return this.getPoint(u,optionalTarget)},LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},LineCurve.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.v1.copy(source.v1),this.v2.copy(source.v2),this},LineCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data},LineCurve.prototype.fromJSON=function(json){return Curve.prototype.fromJSON.call(this,json),this.v1.fromArray(json.v1),this.v2.fromArray(json.v2),this},((LineCurve3.prototype=Object.create(Curve.prototype)).constructor=LineCurve3).prototype.isLineCurve3=!0,LineCurve3.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3;return 1===t?point.copy(this.v2):(point.copy(this.v2).sub(this.v1),point.multiplyScalar(t).add(this.v1)),point},LineCurve3.prototype.getPointAt=function(u,optionalTarget){return this.getPoint(u,optionalTarget)},LineCurve3.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.v1.copy(source.v1),this.v2.copy(source.v2),this},LineCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data},LineCurve3.prototype.fromJSON=function(json){return Curve.prototype.fromJSON.call(this,json),this.v1.fromArray(json.v1),this.v2.fromArray(json.v2),this},((QuadraticBezierCurve.prototype=Object.create(Curve.prototype)).constructor=QuadraticBezierCurve).prototype.isQuadraticBezierCurve=!0,QuadraticBezierCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2,v0=this.v0,v1=this.v1,v2=this.v2;return point.set(QuadraticBezier(t,v0.x,v1.x,v2.x),QuadraticBezier(t,v0.y,v1.y,v2.y)),point},QuadraticBezierCurve.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this},QuadraticBezierCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data},QuadraticBezierCurve.prototype.fromJSON=function(json){return Curve.prototype.fromJSON.call(this,json),this.v0.fromArray(json.v0),this.v1.fromArray(json.v1),this.v2.fromArray(json.v2),this},((QuadraticBezierCurve3.prototype=Object.create(Curve.prototype)).constructor=QuadraticBezierCurve3).prototype.isQuadraticBezierCurve3=!0,QuadraticBezierCurve3.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3,v0=this.v0,v1=this.v1,v2=this.v2;return point.set(QuadraticBezier(t,v0.x,v1.x,v2.x),QuadraticBezier(t,v0.y,v1.y,v2.y),QuadraticBezier(t,v0.z,v1.z,v2.z)),point},QuadraticBezierCurve3.prototype.copy=function(source){return Curve.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this},QuadraticBezierCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data},QuadraticBezierCurve3.prototype.fromJSON=function(json){return Curve.prototype.fromJSON.call(this,json),this.v0.fromArray(json.v0),this.v1.fromArray(json.v1),this.v2.fromArray(json.v2),this},((SplineCurve.prototype=Object.create(Curve.prototype)).constructor=SplineCurve).prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2,points=this.points,p=(points.length-1)*t,intPoint=Math.floor(p),weight=p-intPoint,p0=points[0===intPoint?intPoint:intPoint-1],p1=points[intPoint],p2=points[intPoint>points.length-2?points.length-1:intPoint+1],p3=points[intPoint>points.length-3?points.length-1:intPoint+2];return point.set(CatmullRom(weight,p0.x,p1.x,p2.x,p3.x),CatmullRom(weight,p0.y,p1.y,p2.y,p3.y)),point},SplineCurve.prototype.copy=function(source){Curve.prototype.copy.call(this,source),this.points=[];for(var i=0,l=source.points.length;i<l;i++){var point=source.points[i];this.points.push(point.clone())}return this},SplineCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.points=[];for(var i=0,l=this.points.length;i<l;i++){var point=this.points[i];data.points.push(point.toArray())}return data},SplineCurve.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json),this.points=[];for(var i=0,l=json.points.length;i<l;i++){var point=json.points[i];this.points.push((new Vector2).fromArray(point))}return this};var Curves=Object.freeze({ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Path(points){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2,points&&this.setFromPoints(points)}function Shape(points){Path.call(this,points),this.uuid=_Math.generateUUID(),this.type="Shape",this.holes=[]}function Light(color,intensity){Object3D.call(this),this.type="Light",this.color=new Color(color),this.intensity=void 0!==intensity?intensity:1,this.receiveShadow=void 0}function HemisphereLight(skyColor,groundColor,intensity){Light.call(this,skyColor,intensity),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(groundColor)}function LightShadow(camera){this.camera=camera,this.bias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.matrix=new Matrix4}function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}function SpotLight(color,intensity,distance,angle,penumbra,decay){Light.call(this,color,intensity),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(power){this.intensity=power/Math.PI}}),this.distance=void 0!==distance?distance:0,this.angle=void 0!==angle?angle:Math.PI/3,this.penumbra=void 0!==penumbra?penumbra:0,this.decay=void 0!==decay?decay:1,this.shadow=new SpotLightShadow}function PointLight(color,intensity,distance,decay){Light.call(this,color,intensity),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(power){this.intensity=power/(4*Math.PI)}}),this.distance=void 0!==distance?distance:0,this.decay=void 0!==decay?decay:1,this.shadow=new LightShadow(new PerspectiveCamera(90,1,.5,500))}function OrthographicCamera(left,right,top,bottom,near,far){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==left?left:-1,this.right=void 0!==right?right:1,this.top=void 0!==top?top:1,this.bottom=void 0!==bottom?bottom:-1,this.near=void 0!==near?near:.1,this.far=void 0!==far?far:2e3,this.updateProjectionMatrix()}function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}function DirectionalLight(color,intensity){Light.call(this,color,intensity),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}function AmbientLight(color,intensity){Light.call(this,color,intensity),this.type="AmbientLight",this.castShadow=void 0}function RectAreaLight(color,intensity,width,height){Light.call(this,color,intensity),this.type="RectAreaLight",this.width=void 0!==width?width:10,this.height=void 0!==height?height:10}function MaterialLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager,this.textures={}}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(curve){this.curves.push(curve)},closePath:function(){var startPoint=this.curves[0].getPoint(0),endPoint=this.curves[this.curves.length-1].getPoint(1);startPoint.equals(endPoint)||this.curves.push(new LineCurve(endPoint,startPoint))},getPoint:function(t){for(var d=t*this.getLength(),curveLengths=this.getCurveLengths(),i=0;i<curveLengths.length;){if(curveLengths[i]>=d){var diff=curveLengths[i]-d,curve=this.curves[i],segmentLength=curve.getLength(),u=0===segmentLength?0:1-diff/segmentLength;return curve.getPointAt(u)}i++}return null},getLength:function(){var lens=this.getCurveLengths();return lens[lens.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var lengths=[],sums=0,i=0,l=this.curves.length;i<l;i++)sums+=this.curves[i].getLength(),lengths.push(sums);return this.cacheLengths=lengths},getSpacedPoints:function(divisions){void 0===divisions&&(divisions=40);for(var points=[],i=0;i<=divisions;i++)points.push(this.getPoint(i/divisions));return this.autoClose&&points.push(points[0]),points},getPoints:function(divisions){divisions=divisions||12;for(var last,points=[],i=0,curves=this.curves;i<curves.length;i++)for(var curve=curves[i],resolution=curve&&curve.isEllipseCurve?2*divisions:curve&&(curve.isLineCurve||curve.isLineCurve3)?1:curve&&curve.isSplineCurve?divisions*curve.points.length:divisions,pts=curve.getPoints(resolution),j=0;j<pts.length;j++){var point=pts[j];last&&last.equals(point)||(points.push(point),last=point)}return this.autoClose&&1<points.length&&!points[points.length-1].equals(points[0])&&points.push(points[0]),points},copy:function(source){Curve.prototype.copy.call(this,source),this.curves=[];for(var i=0,l=source.curves.length;i<l;i++){var curve=source.curves[i];this.curves.push(curve.clone())}return this.autoClose=source.autoClose,this},toJSON:function(){var data=Curve.prototype.toJSON.call(this);data.autoClose=this.autoClose,data.curves=[];for(var i=0,l=this.curves.length;i<l;i++){var curve=this.curves[i];data.curves.push(curve.toJSON())}return data},fromJSON:function(json){Curve.prototype.fromJSON.call(this,json),this.autoClose=json.autoClose,this.curves=[];for(var i=0,l=json.curves.length;i<l;i++){var curve=json.curves[i];this.curves.push((new Curves[curve.type]).fromJSON(curve))}return this}}),Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(points){this.moveTo(points[0].x,points[0].y);for(var i=1,l=points.length;i<l;i++)this.lineTo(points[i].x,points[i].y)},moveTo:function(x,y){this.currentPoint.set(x,y)},lineTo:function(x,y){var curve=new LineCurve(this.currentPoint.clone(),new Vector2(x,y));this.curves.push(curve),this.currentPoint.set(x,y)},quadraticCurveTo:function(aCPx,aCPy,aX,aY){var curve=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(aCPx,aCPy),new Vector2(aX,aY));this.curves.push(curve),this.currentPoint.set(aX,aY)},bezierCurveTo:function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var curve=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(aCP1x,aCP1y),new Vector2(aCP2x,aCP2y),new Vector2(aX,aY));this.curves.push(curve),this.currentPoint.set(aX,aY)},splineThru:function(pts){var curve=new SplineCurve([this.currentPoint.clone()].concat(pts));this.curves.push(curve),this.currentPoint.copy(pts[pts.length-1])},arc:function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){var x0=this.currentPoint.x,y0=this.currentPoint.y;this.absarc(aX+x0,aY+y0,aRadius,aStartAngle,aEndAngle,aClockwise)},absarc:function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){this.absellipse(aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise)},ellipse:function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){var x0=this.currentPoint.x,y0=this.currentPoint.y;this.absellipse(aX+x0,aY+y0,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation)},absellipse:function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){var curve=new EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation);if(0<this.curves.length){var firstPoint=curve.getPoint(0);firstPoint.equals(this.currentPoint)||this.lineTo(firstPoint.x,firstPoint.y)}this.curves.push(curve);var lastPoint=curve.getPoint(1);this.currentPoint.copy(lastPoint)},copy:function(source){return CurvePath.prototype.copy.call(this,source),this.currentPoint.copy(source.currentPoint),this},toJSON:function(){var data=CurvePath.prototype.toJSON.call(this);return data.currentPoint=this.currentPoint.toArray(),data},fromJSON:function(json){return CurvePath.prototype.fromJSON.call(this,json),this.currentPoint.fromArray(json.currentPoint),this}}),Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(divisions){for(var holesPts=[],i=0,l=this.holes.length;i<l;i++)holesPts[i]=this.holes[i].getPoints(divisions);return holesPts},extractPoints:function(divisions){return{shape:this.getPoints(divisions),holes:this.getPointsHoles(divisions)}},copy:function(source){Path.prototype.copy.call(this,source),this.holes=[];for(var i=0,l=source.holes.length;i<l;i++){var hole=source.holes[i];this.holes.push(hole.clone())}return this},toJSON:function(){var data=Path.prototype.toJSON.call(this);data.uuid=this.uuid,data.holes=[];for(var i=0,l=this.holes.length;i<l;i++){var hole=this.holes[i];data.holes.push(hole.toJSON())}return data},fromJSON:function(json){Path.prototype.fromJSON.call(this,json),this.uuid=json.uuid,this.holes=[];for(var i=0,l=json.holes.length;i<l;i++){var hole=json.holes[i];this.holes.push((new Path).fromJSON(hole))}return this}}),Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(source){return Object3D.prototype.copy.call(this,source),this.color.copy(source.color),this.intensity=source.intensity,this},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);return data.object.color=this.color.getHex(),data.object.intensity=this.intensity,void 0!==this.groundColor&&(data.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(data.object.distance=this.distance),void 0!==this.angle&&(data.object.angle=this.angle),void 0!==this.decay&&(data.object.decay=this.decay),void 0!==this.penumbra&&(data.object.penumbra=this.penumbra),void 0!==this.shadow&&(data.object.shadow=this.shadow.toJSON()),data}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.groundColor.copy(source.groundColor),this}}),Object.assign(LightShadow.prototype,{copy:function(source){return this.camera=source.camera.clone(),this.bias=source.bias,this.radius=source.radius,this.mapSize.copy(source.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var object={};return 0!==this.bias&&(object.bias=this.bias),1!==this.radius&&(object.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(object.mapSize=this.mapSize.toArray()),object.camera=this.camera.toJSON(!1).object,delete object.camera.matrix,object}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,update:function(light){var camera=this.camera,fov=2*_Math.RAD2DEG*light.angle,aspect=this.mapSize.width/this.mapSize.height,far=light.distance||camera.far;fov===camera.fov&&aspect===camera.aspect&&far===camera.far||(camera.fov=fov,camera.aspect=aspect,camera.far=far,camera.updateProjectionMatrix())}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.distance=source.distance,this.angle=source.angle,this.penumbra=source.penumbra,this.decay=source.decay,this.target=source.target.clone(),this.shadow=source.shadow.clone(),this}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.distance=source.distance,this.decay=source.decay,this.shadow=source.shadow.clone(),this}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(source,recursive){return Camera.prototype.copy.call(this,source,recursive),this.left=source.left,this.right=source.right,this.top=source.top,this.bottom=source.bottom,this.near=source.near,this.far=source.far,this.zoom=source.zoom,this.view=null===source.view?null:Object.assign({},source.view),this},setViewOffset:function(fullWidth,fullHeight,x,y,width,height){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=fullWidth,this.view.fullHeight=fullHeight,this.view.offsetX=x,this.view.offsetY=y,this.view.width=width,this.view.height=height,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var dx=(this.right-this.left)/(2*this.zoom),dy=(this.top-this.bottom)/(2*this.zoom),cx=(this.right+this.left)/2,cy=(this.top+this.bottom)/2,left=cx-dx,right=cx+dx,top=cy+dy,bottom=cy-dy;if(null!==this.view&&this.view.enabled){var zoomW=this.zoom/(this.view.width/this.view.fullWidth),zoomH=this.zoom/(this.view.height/this.view.fullHeight),scaleW=(this.right-this.left)/this.view.width,scaleH=(this.top-this.bottom)/this.view.height;right=(left+=scaleW*(this.view.offsetX/zoomW))+scaleW*(this.view.width/zoomW),bottom=(top-=scaleH*(this.view.offsetY/zoomH))-scaleH*(this.view.height/zoomH)}this.projectionMatrix.makeOrthographic(left,right,top,bottom,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);return data.object.zoom=this.zoom,data.object.left=this.left,data.object.right=this.right,data.object.top=this.top,data.object.bottom=this.bottom,data.object.near=this.near,data.object.far=this.far,null!==this.view&&(data.object.view=Object.assign({},this.view)),data}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.target=source.target.clone(),this.shadow=source.shadow.clone(),this}}),AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0}),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.width=source.width,this.height=source.height,this},toJSON:function(meta){var data=Light.prototype.toJSON.call(this,meta);return data.object.width=this.width,data.object.height=this.height,data}}),Object.assign(MaterialLoader.prototype,{load:function(url,onLoad,onProgress,onError){var scope=this,loader=new FileLoader(scope.manager);loader.setPath(scope.path),loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},parse:function(json){var textures=this.textures;function getTexture(name){return void 0===textures[name]&&console.warn("THREE.MaterialLoader: Undefined texture",name),textures[name]}var material=new Materials[json.type];if(void 0!==json.uuid&&(material.uuid=json.uuid),void 0!==json.name&&(material.name=json.name),void 0!==json.color&&material.color.setHex(json.color),void 0!==json.roughness&&(material.roughness=json.roughness),void 0!==json.metalness&&(material.metalness=json.metalness),void 0!==json.emissive&&material.emissive.setHex(json.emissive),void 0!==json.specular&&material.specular.setHex(json.specular),void 0!==json.shininess&&(material.shininess=json.shininess),void 0!==json.clearCoat&&(material.clearCoat=json.clearCoat),void 0!==json.clearCoatRoughness&&(material.clearCoatRoughness=json.clearCoatRoughness),void 0!==json.vertexColors&&(material.vertexColors=json.vertexColors),void 0!==json.fog&&(material.fog=json.fog),void 0!==json.flatShading&&(material.flatShading=json.flatShading),void 0!==json.blending&&(material.blending=json.blending),void 0!==json.combine&&(material.combine=json.combine),void 0!==json.side&&(material.side=json.side),void 0!==json.opacity&&(material.opacity=json.opacity),void 0!==json.transparent&&(material.transparent=json.transparent),void 0!==json.alphaTest&&(material.alphaTest=json.alphaTest),void 0!==json.depthTest&&(material.depthTest=json.depthTest),void 0!==json.depthWrite&&(material.depthWrite=json.depthWrite),void 0!==json.colorWrite&&(material.colorWrite=json.colorWrite),void 0!==json.wireframe&&(material.wireframe=json.wireframe),void 0!==json.wireframeLinewidth&&(material.wireframeLinewidth=json.wireframeLinewidth),void 0!==json.wireframeLinecap&&(material.wireframeLinecap=json.wireframeLinecap),void 0!==json.wireframeLinejoin&&(material.wireframeLinejoin=json.wireframeLinejoin),void 0!==json.rotation&&(material.rotation=json.rotation),1!==json.linewidth&&(material.linewidth=json.linewidth),void 0!==json.dashSize&&(material.dashSize=json.dashSize),void 0!==json.gapSize&&(material.gapSize=json.gapSize),void 0!==json.scale&&(material.scale=json.scale),void 0!==json.polygonOffset&&(material.polygonOffset=json.polygonOffset),void 0!==json.polygonOffsetFactor&&(material.polygonOffsetFactor=json.polygonOffsetFactor),void 0!==json.polygonOffsetUnits&&(material.polygonOffsetUnits=json.polygonOffsetUnits),void 0!==json.skinning&&(material.skinning=json.skinning),void 0!==json.morphTargets&&(material.morphTargets=json.morphTargets),void 0!==json.dithering&&(material.dithering=json.dithering),void 0!==json.visible&&(material.visible=json.visible),void 0!==json.userData&&(material.userData=json.userData),void 0!==json.uniforms)for(var name in json.uniforms){var uniform=json.uniforms[name];switch(material.uniforms[name]={},uniform.type){case"t":material.uniforms[name].value=getTexture(uniform.value);break;case"c":material.uniforms[name].value=(new Color).setHex(uniform.value);break;case"v2":material.uniforms[name].value=(new Vector2).fromArray(uniform.value);break;case"v3":material.uniforms[name].value=(new Vector3).fromArray(uniform.value);break;case"v4":material.uniforms[name].value=(new Vector4).fromArray(uniform.value);break;case"m3":material.uniforms[name].value=(new Matrix3).fromArray(uniform.value);case"m4":material.uniforms[name].value=(new Matrix4).fromArray(uniform.value);break;default:material.uniforms[name].value=uniform.value}}if(void 0!==json.defines&&(material.defines=json.defines),void 0!==json.vertexShader&&(material.vertexShader=json.vertexShader),void 0!==json.fragmentShader&&(material.fragmentShader=json.fragmentShader),void 0!==json.extensions)for(var key in json.extensions)material.extensions[key]=json.extensions[key];if(void 0!==json.shading&&(material.flatShading=1===json.shading),void 0!==json.size&&(material.size=json.size),void 0!==json.sizeAttenuation&&(material.sizeAttenuation=json.sizeAttenuation),void 0!==json.map&&(material.map=getTexture(json.map)),void 0!==json.matcap&&(material.matcap=getTexture(json.matcap)),void 0!==json.alphaMap&&(material.alphaMap=getTexture(json.alphaMap),material.transparent=!0),void 0!==json.bumpMap&&(material.bumpMap=getTexture(json.bumpMap)),void 0!==json.bumpScale&&(material.bumpScale=json.bumpScale),void 0!==json.normalMap&&(material.normalMap=getTexture(json.normalMap)),void 0!==json.normalMapType&&(material.normalMapType=json.normalMapType),void 0!==json.normalScale){var normalScale=json.normalScale;!1===Array.isArray(normalScale)&&(normalScale=[normalScale,normalScale]),material.normalScale=(new Vector2).fromArray(normalScale)}return void 0!==json.displacementMap&&(material.displacementMap=getTexture(json.displacementMap)),void 0!==json.displacementScale&&(material.displacementScale=json.displacementScale),void 0!==json.displacementBias&&(material.displacementBias=json.displacementBias),void 0!==json.roughnessMap&&(material.roughnessMap=getTexture(json.roughnessMap)),void 0!==json.metalnessMap&&(material.metalnessMap=getTexture(json.metalnessMap)),void 0!==json.emissiveMap&&(material.emissiveMap=getTexture(json.emissiveMap)),void 0!==json.emissiveIntensity&&(material.emissiveIntensity=json.emissiveIntensity),void 0!==json.specularMap&&(material.specularMap=getTexture(json.specularMap)),void 0!==json.envMap&&(material.envMap=getTexture(json.envMap)),void 0!==json.envMapIntensity&&(material.envMapIntensity=json.envMapIntensity),void 0!==json.reflectivity&&(material.reflectivity=json.reflectivity),void 0!==json.lightMap&&(material.lightMap=getTexture(json.lightMap)),void 0!==json.lightMapIntensity&&(material.lightMapIntensity=json.lightMapIntensity),void 0!==json.aoMap&&(material.aoMap=getTexture(json.aoMap)),void 0!==json.aoMapIntensity&&(material.aoMapIntensity=json.aoMapIntensity),void 0!==json.gradientMap&&(material.gradientMap=getTexture(json.gradientMap)),material},setPath:function(value){return this.path=value,this},setTextures:function(value){return this.textures=value,this}});var LoaderUtils={decodeText:function(array){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(array);for(var s="",i=0,il=array.length;i<il;i++)s+=String.fromCharCode(array[i]);return decodeURIComponent(escape(s))},extractUrlBase:function(url){var index=url.lastIndexOf("/");return-1===index?"./":url.substr(0,index+1)}};function BufferGeometryLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}Object.assign(BufferGeometryLoader.prototype,{load:function(url,onLoad,onProgress,onError){var scope=this,loader=new FileLoader(scope.manager);loader.setPath(scope.path),loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},parse:function(json){var geometry=new BufferGeometry,index=json.data.index;if(void 0!==index){var typedArray=new TYPED_ARRAYS[index.type](index.array);geometry.setIndex(new BufferAttribute(typedArray,1))}var attributes=json.data.attributes;for(var key in attributes){var attribute=attributes[key],bufferAttribute=new BufferAttribute(typedArray=new TYPED_ARRAYS[attribute.type](attribute.array),attribute.itemSize,attribute.normalized);void 0!==attribute.name&&(bufferAttribute.name=attribute.name),geometry.addAttribute(key,bufferAttribute)}var morphAttributes=json.data.morphAttributes;if(morphAttributes)for(var key in morphAttributes){for(var attributeArray=morphAttributes[key],array=[],i=0,il=attributeArray.length;i<il;i++){attribute=attributeArray[i],bufferAttribute=new BufferAttribute(typedArray=new TYPED_ARRAYS[attribute.type](attribute.array),attribute.itemSize,attribute.normalized);void 0!==attribute.name&&(bufferAttribute.name=attribute.name),array.push(bufferAttribute)}geometry.morphAttributes[key]=array}var groups=json.data.groups||json.data.drawcalls||json.data.offsets;if(void 0!==groups){i=0;for(var n=groups.length;i!==n;++i){var group=groups[i];geometry.addGroup(group.start,group.count,group.materialIndex)}}var boundingSphere=json.data.boundingSphere;if(void 0!==boundingSphere){var center=new Vector3;void 0!==boundingSphere.center&&center.fromArray(boundingSphere.center),geometry.boundingSphere=new Sphere(center,boundingSphere.radius)}return json.name&&(geometry.name=json.name),json.userData&&(geometry.userData=json.userData),geometry},setPath:function(value){return this.path=value,this}});var TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ObjectLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager,this.resourcePath=""}Object.assign(ObjectLoader.prototype,{crossOrigin:"anonymous",load:function(url,onLoad,onProgress,onError){var scope=this,path=void 0===this.path?LoaderUtils.extractUrlBase(url):this.path;this.resourcePath=this.resourcePath||path;var loader=new FileLoader(scope.manager);loader.setPath(this.path),loader.load(url,function(text){var json=null;try{json=JSON.parse(text)}catch(error){return void 0!==onError&&onError(error),void console.error("THREE:ObjectLoader: Can't parse "+url+".",error.message)}var metadata=json.metadata;void 0!==metadata&&void 0!==metadata.type&&"geometry"!==metadata.type.toLowerCase()?scope.parse(json,onLoad):console.error("THREE.ObjectLoader: Can't load "+url)},onProgress,onError)},setPath:function(value){return this.path=value,this},setResourcePath:function(value){return this.resourcePath=value,this},setCrossOrigin:function(value){return this.crossOrigin=value,this},parse:function(json,onLoad){var shapes=this.parseShape(json.shapes),geometries=this.parseGeometries(json.geometries,shapes),images=this.parseImages(json.images,function(){void 0!==onLoad&&onLoad(object)}),textures=this.parseTextures(json.textures,images),materials=this.parseMaterials(json.materials,textures),object=this.parseObject(json.object,geometries,materials);return json.animations&&(object.animations=this.parseAnimations(json.animations)),void 0!==json.images&&0!==json.images.length||void 0!==onLoad&&onLoad(object),object},parseShape:function(json){var shapes={};if(void 0!==json)for(var i=0,l=json.length;i<l;i++){var shape=(new Shape).fromJSON(json[i]);shapes[shape.uuid]=shape}return shapes},parseGeometries:function(json,shapes){var geometries={};if(void 0!==json)for(var bufferGeometryLoader=new BufferGeometryLoader,i=0,l=json.length;i<l;i++){var geometry,data=json[i];switch(data.type){case"PlaneGeometry":case"PlaneBufferGeometry":geometry=new Geometries[data.type](data.width,data.height,data.widthSegments,data.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":geometry=new Geometries[data.type](data.width,data.height,data.depth,data.widthSegments,data.heightSegments,data.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":geometry=new Geometries[data.type](data.radius,data.segments,data.thetaStart,data.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":geometry=new Geometries[data.type](data.radiusTop,data.radiusBottom,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":geometry=new Geometries[data.type](data.radius,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":geometry=new Geometries[data.type](data.radius,data.widthSegments,data.heightSegments,data.phiStart,data.phiLength,data.thetaStart,data.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":geometry=new Geometries[data.type](data.radius,data.detail);break;case"RingGeometry":case"RingBufferGeometry":geometry=new Geometries[data.type](data.innerRadius,data.outerRadius,data.thetaSegments,data.phiSegments,data.thetaStart,data.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":geometry=new Geometries[data.type](data.radius,data.tube,data.radialSegments,data.tubularSegments,data.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":geometry=new Geometries[data.type](data.radius,data.tube,data.tubularSegments,data.radialSegments,data.p,data.q);break;case"TubeGeometry":case"TubeBufferGeometry":geometry=new Geometries[data.type]((new Curves[data.path.type]).fromJSON(data.path),data.tubularSegments,data.radius,data.radialSegments,data.closed);break;case"LatheGeometry":case"LatheBufferGeometry":geometry=new Geometries[data.type](data.points,data.segments,data.phiStart,data.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":geometry=new Geometries[data.type](data.vertices,data.indices,data.radius,data.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var geometryShapes=[],j=0,jl=data.shapes.length;j<jl;j++){var shape=shapes[data.shapes[j]];geometryShapes.push(shape)}geometry=new Geometries[data.type](geometryShapes,data.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(geometryShapes=[],j=0,jl=data.shapes.length;j<jl;j++){shape=shapes[data.shapes[j]];geometryShapes.push(shape)}var extrudePath=data.options.extrudePath;void 0!==extrudePath&&(data.options.extrudePath=(new Curves[extrudePath.type]).fromJSON(extrudePath)),geometry=new Geometries[data.type](geometryShapes,data.options);break;case"BufferGeometry":geometry=bufferGeometryLoader.parse(data);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)geometry=(new THREE.LegacyJSONLoader).parse(data,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+data.type+'"');continue}geometry.uuid=data.uuid,void 0!==data.name&&(geometry.name=data.name),!0===geometry.isBufferGeometry&&void 0!==data.userData&&(geometry.userData=data.userData),geometries[data.uuid]=geometry}return geometries},parseMaterials:function(json,textures){var cache={},materials={};if(void 0!==json){var loader=new MaterialLoader;loader.setTextures(textures);for(var i=0,l=json.length;i<l;i++){var data=json[i];if("MultiMaterial"===data.type){for(var array=[],j=0;j<data.materials.length;j++){var material=data.materials[j];void 0===cache[material.uuid]&&(cache[material.uuid]=loader.parse(material)),array.push(cache[material.uuid])}materials[data.uuid]=array}else void 0===cache[data.uuid]&&(cache[data.uuid]=loader.parse(data)),materials[data.uuid]=cache[data.uuid]}}return materials},parseAnimations:function(json){for(var animations=[],i=0;i<json.length;i++){var data=json[i],clip=AnimationClip.parse(data);void 0!==data.uuid&&(clip.uuid=data.uuid),animations.push(clip)}return animations},parseImages:function(json,onLoad){var scope=this,images={};function loadImage(url){return scope.manager.itemStart(url),loader.load(url,function(){scope.manager.itemEnd(url)},void 0,function(){scope.manager.itemError(url),scope.manager.itemEnd(url)})}if(void 0!==json&&0<json.length){var loader=new ImageLoader(new LoadingManager(onLoad));loader.setCrossOrigin(this.crossOrigin);for(var i=0,il=json.length;i<il;i++){var image=json[i],url=image.url;if(Array.isArray(url)){images[image.uuid]=[];for(var j=0,jl=url.length;j<jl;j++){var currentUrl=url[j],path=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(currentUrl)?currentUrl:scope.resourcePath+currentUrl;images[image.uuid].push(loadImage(path))}}else{path=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(image.url)?image.url:scope.resourcePath+image.url;images[image.uuid]=loadImage(path)}}}return images},parseTextures:function(json,images){function parseConstant(value,type){return"number"==typeof value?value:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",value),type[value])}var textures={};if(void 0!==json)for(var i=0,l=json.length;i<l;i++){var texture,data=json[i];void 0===data.image&&console.warn('THREE.ObjectLoader: No "image" specified for',data.uuid),void 0===images[data.image]&&console.warn("THREE.ObjectLoader: Undefined image",data.image),(texture=Array.isArray(images[data.image])?new CubeTexture(images[data.image]):new Texture(images[data.image])).needsUpdate=!0,texture.uuid=data.uuid,void 0!==data.name&&(texture.name=data.name),void 0!==data.mapping&&(texture.mapping=parseConstant(data.mapping,TEXTURE_MAPPING)),void 0!==data.offset&&texture.offset.fromArray(data.offset),void 0!==data.repeat&&texture.repeat.fromArray(data.repeat),void 0!==data.center&&texture.center.fromArray(data.center),void 0!==data.rotation&&(texture.rotation=data.rotation),void 0!==data.wrap&&(texture.wrapS=parseConstant(data.wrap[0],TEXTURE_WRAPPING),texture.wrapT=parseConstant(data.wrap[1],TEXTURE_WRAPPING)),void 0!==data.format&&(texture.format=data.format),void 0!==data.type&&(texture.type=data.type),void 0!==data.encoding&&(texture.encoding=data.encoding),void 0!==data.minFilter&&(texture.minFilter=parseConstant(data.minFilter,TEXTURE_FILTER)),void 0!==data.magFilter&&(texture.magFilter=parseConstant(data.magFilter,TEXTURE_FILTER)),void 0!==data.anisotropy&&(texture.anisotropy=data.anisotropy),void 0!==data.flipY&&(texture.flipY=data.flipY),void 0!==data.premultiplyAlpha&&(texture.premultiplyAlpha=data.premultiplyAlpha),void 0!==data.unpackAlignment&&(texture.unpackAlignment=data.unpackAlignment),textures[data.uuid]=texture}return textures},parseObject:function(data,geometries,materials){var object;function getGeometry(name){return void 0===geometries[name]&&console.warn("THREE.ObjectLoader: Undefined geometry",name),geometries[name]}function getMaterial(name){if(void 0!==name){if(Array.isArray(name)){for(var array=[],i=0,l=name.length;i<l;i++){var uuid=name[i];void 0===materials[uuid]&&console.warn("THREE.ObjectLoader: Undefined material",uuid),array.push(materials[uuid])}return array}return void 0===materials[name]&&console.warn("THREE.ObjectLoader: Undefined material",name),materials[name]}}switch(data.type){case"Scene":object=new Scene,void 0!==data.background&&Number.isInteger(data.background)&&(object.background=new Color(data.background)),void 0!==data.fog&&("Fog"===data.fog.type?object.fog=new Fog(data.fog.color,data.fog.near,data.fog.far):"FogExp2"===data.fog.type&&(object.fog=new FogExp2(data.fog.color,data.fog.density)));break;case"PerspectiveCamera":object=new PerspectiveCamera(data.fov,data.aspect,data.near,data.far),void 0!==data.focus&&(object.focus=data.focus),void 0!==data.zoom&&(object.zoom=data.zoom),void 0!==data.filmGauge&&(object.filmGauge=data.filmGauge),void 0!==data.filmOffset&&(object.filmOffset=data.filmOffset),void 0!==data.view&&(object.view=Object.assign({},data.view));break;case"OrthographicCamera":object=new OrthographicCamera(data.left,data.right,data.top,data.bottom,data.near,data.far),void 0!==data.zoom&&(object.zoom=data.zoom),void 0!==data.view&&(object.view=Object.assign({},data.view));break;case"AmbientLight":object=new AmbientLight(data.color,data.intensity);break;case"DirectionalLight":object=new DirectionalLight(data.color,data.intensity);break;case"PointLight":object=new PointLight(data.color,data.intensity,data.distance,data.decay);break;case"RectAreaLight":object=new RectAreaLight(data.color,data.intensity,data.width,data.height);break;case"SpotLight":object=new SpotLight(data.color,data.intensity,data.distance,data.angle,data.penumbra,data.decay);break;case"HemisphereLight":object=new HemisphereLight(data.color,data.groundColor,data.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var geometry=getGeometry(data.geometry),material=getMaterial(data.material);object=geometry.bones&&0<geometry.bones.length?new SkinnedMesh(geometry,material):new Mesh(geometry,material),void 0!==data.drawMode&&object.setDrawMode(data.drawMode);break;case"LOD":object=new LOD;break;case"Line":object=new Line(getGeometry(data.geometry),getMaterial(data.material),data.mode);break;case"LineLoop":object=new LineLoop(getGeometry(data.geometry),getMaterial(data.material));break;case"LineSegments":object=new LineSegments(getGeometry(data.geometry),getMaterial(data.material));break;case"PointCloud":case"Points":object=new Points(getGeometry(data.geometry),getMaterial(data.material));break;case"Sprite":object=new Sprite(getMaterial(data.material));break;case"Group":object=new Group;break;default:object=new Object3D}if(object.uuid=data.uuid,void 0!==data.name&&(object.name=data.name),void 0!==data.matrix?(object.matrix.fromArray(data.matrix),void 0!==data.matrixAutoUpdate&&(object.matrixAutoUpdate=data.matrixAutoUpdate),object.matrixAutoUpdate&&object.matrix.decompose(object.position,object.quaternion,object.scale)):(void 0!==data.position&&object.position.fromArray(data.position),void 0!==data.rotation&&object.rotation.fromArray(data.rotation),void 0!==data.quaternion&&object.quaternion.fromArray(data.quaternion),void 0!==data.scale&&object.scale.fromArray(data.scale)),void 0!==data.castShadow&&(object.castShadow=data.castShadow),void 0!==data.receiveShadow&&(object.receiveShadow=data.receiveShadow),data.shadow&&(void 0!==data.shadow.bias&&(object.shadow.bias=data.shadow.bias),void 0!==data.shadow.radius&&(object.shadow.radius=data.shadow.radius),void 0!==data.shadow.mapSize&&object.shadow.mapSize.fromArray(data.shadow.mapSize),void 0!==data.shadow.camera&&(object.shadow.camera=this.parseObject(data.shadow.camera))),void 0!==data.visible&&(object.visible=data.visible),void 0!==data.frustumCulled&&(object.frustumCulled=data.frustumCulled),void 0!==data.renderOrder&&(object.renderOrder=data.renderOrder),void 0!==data.userData&&(object.userData=data.userData),void 0!==data.layers&&(object.layers.mask=data.layers),void 0!==data.children)for(var children=data.children,i=0;i<children.length;i++)object.add(this.parseObject(children[i],geometries,materials));if("LOD"===data.type)for(var levels=data.levels,l=0;l<levels.length;l++){var level=levels[l],child=object.getObjectByProperty("uuid",level.object);void 0!==child&&object.addLevel(child,level.distance)}return object}});var BlendingMode,color,textureLoader,materialLoader,context,TEXTURE_MAPPING={UVMapping:300,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,SphericalReflectionMapping:SphericalReflectionMapping,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping},TEXTURE_WRAPPING={RepeatWrapping:RepeatWrapping,ClampToEdgeWrapping:ClampToEdgeWrapping,MirroredRepeatWrapping:MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter:NearestFilter,NearestMipMapNearestFilter:NearestMipMapNearestFilter,NearestMipMapLinearFilter:NearestMipMapLinearFilter,LinearFilter:LinearFilter,LinearMipMapNearestFilter:LinearMipMapNearestFilter,LinearMipMapLinearFilter:LinearMipMapLinearFilter};function ImageBitmapLoader(manager){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==manager?manager:DefaultLoadingManager,this.options=void 0}function ShapePath(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}function Font(data){this.type="Font",this.data=data}function createPath(char,scale,offsetX,offsetY,data){var glyph=data.glyphs[char]||data.glyphs["?"];if(glyph){var x,y,cpx,cpy,cpx1,cpy1,cpx2,cpy2,path=new ShapePath;if(glyph.o)for(var outline=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(" ")),i=0,l=outline.length;i<l;){switch(outline[i++]){case"m":x=outline[i++]*scale+offsetX,y=outline[i++]*scale+offsetY,path.moveTo(x,y);break;case"l":x=outline[i++]*scale+offsetX,y=outline[i++]*scale+offsetY,path.lineTo(x,y);break;case"q":cpx=outline[i++]*scale+offsetX,cpy=outline[i++]*scale+offsetY,cpx1=outline[i++]*scale+offsetX,cpy1=outline[i++]*scale+offsetY,path.quadraticCurveTo(cpx1,cpy1,cpx,cpy);break;case"b":cpx=outline[i++]*scale+offsetX,cpy=outline[i++]*scale+offsetY,cpx1=outline[i++]*scale+offsetX,cpy1=outline[i++]*scale+offsetY,cpx2=outline[i++]*scale+offsetX,cpy2=outline[i++]*scale+offsetY,path.bezierCurveTo(cpx1,cpy1,cpx2,cpy2,cpx,cpy)}}return{offsetX:glyph.ha*scale,path:path}}}function FontLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}function Loader(){}ImageBitmapLoader.prototype={constructor:ImageBitmapLoader,setOptions:function(options){return this.options=options,this},load:function(url,onLoad,onProgress,onError){void 0===url&&(url=""),void 0!==this.path&&(url=this.path+url),url=this.manager.resolveURL(url);var scope=this,cached=Cache.get(url);if(void 0!==cached)return scope.manager.itemStart(url),setTimeout(function(){onLoad&&onLoad(cached),scope.manager.itemEnd(url)},0),cached;fetch(url).then(function(res){return res.blob()}).then(function(blob){return void 0===scope.options?createImageBitmap(blob):createImageBitmap(blob,scope.options)}).then(function(imageBitmap){Cache.add(url,imageBitmap),onLoad&&onLoad(imageBitmap),scope.manager.itemEnd(url)}).catch(function(e){onError&&onError(e),scope.manager.itemError(url),scope.manager.itemEnd(url)}),scope.manager.itemStart(url)},setCrossOrigin:function(){return this},setPath:function(value){return this.path=value,this}},Object.assign(ShapePath.prototype,{moveTo:function(x,y){this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(x,y)},lineTo:function(x,y){this.currentPath.lineTo(x,y)},quadraticCurveTo:function(aCPx,aCPy,aX,aY){this.currentPath.quadraticCurveTo(aCPx,aCPy,aX,aY)},bezierCurveTo:function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){this.currentPath.bezierCurveTo(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY)},splineThru:function(pts){this.currentPath.splineThru(pts)},toShapes:function(isCCW,noHoles){function toShapesNoHoles(inSubpaths){for(var shapes=[],i=0,l=inSubpaths.length;i<l;i++){var tmpPath=inSubpaths[i],tmpShape=new Shape;tmpShape.curves=tmpPath.curves,shapes.push(tmpShape)}return shapes}function isPointInsidePolygon(inPt,inPolygon){for(var polyLen=inPolygon.length,inside=!1,p=polyLen-1,q=0;q<polyLen;p=q++){var edgeLowPt=inPolygon[p],edgeHighPt=inPolygon[q],edgeDx=edgeHighPt.x-edgeLowPt.x,edgeDy=edgeHighPt.y-edgeLowPt.y;if(Math.abs(edgeDy)>Number.EPSILON){if(edgeDy<0&&(edgeLowPt=inPolygon[q],edgeDx=-edgeDx,edgeHighPt=inPolygon[p],edgeDy=-edgeDy),inPt.y<edgeLowPt.y||inPt.y>edgeHighPt.y)continue;if(inPt.y===edgeLowPt.y){if(inPt.x===edgeLowPt.x)return!0}else{var perpEdge=edgeDy*(inPt.x-edgeLowPt.x)-edgeDx*(inPt.y-edgeLowPt.y);if(0==perpEdge)return!0;if(perpEdge<0)continue;inside=!inside}}else{if(inPt.y!==edgeLowPt.y)continue;if(edgeHighPt.x<=inPt.x&&inPt.x<=edgeLowPt.x||edgeLowPt.x<=inPt.x&&inPt.x<=edgeHighPt.x)return!0}}return inside}var isClockWise=ShapeUtils.isClockWise,subPaths=this.subPaths;if(0===subPaths.length)return[];if(!0===noHoles)return toShapesNoHoles(subPaths);var solid,tmpPath,tmpShape,shapes=[];if(1===subPaths.length)return tmpPath=subPaths[0],(tmpShape=new Shape).curves=tmpPath.curves,shapes.push(tmpShape),shapes;var holesFirst=!isClockWise(subPaths[0].getPoints());holesFirst=isCCW?!holesFirst:holesFirst;var tmpPoints,tmpHoles,betterShapeHoles=[],newShapes=[],newShapeHoles=[],mainIdx=0;newShapes[mainIdx]=void 0,newShapeHoles[mainIdx]=[];for(var i=0,l=subPaths.length;i<l;i++)solid=isClockWise(tmpPoints=(tmpPath=subPaths[i]).getPoints()),(solid=isCCW?!solid:solid)?(!holesFirst&&newShapes[mainIdx]&&mainIdx++,newShapes[mainIdx]={s:new Shape,p:tmpPoints},newShapes[mainIdx].s.curves=tmpPath.curves,holesFirst&&mainIdx++,newShapeHoles[mainIdx]=[]):newShapeHoles[mainIdx].push({h:tmpPath,p:tmpPoints[0]});if(!newShapes[0])return toShapesNoHoles(subPaths);if(1<newShapes.length){for(var ambiguous=!1,toChange=[],sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++)betterShapeHoles[sIdx]=[];for(sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++)for(var sho=newShapeHoles[sIdx],hIdx=0;hIdx<sho.length;hIdx++){for(var ho=sho[hIdx],hole_unassigned=!0,s2Idx=0;s2Idx<newShapes.length;s2Idx++)isPointInsidePolygon(ho.p,newShapes[s2Idx].p)&&(sIdx!==s2Idx&&toChange.push({froms:sIdx,tos:s2Idx,hole:hIdx}),hole_unassigned?(hole_unassigned=!1,betterShapeHoles[s2Idx].push(ho)):ambiguous=!0);hole_unassigned&&betterShapeHoles[sIdx].push(ho)}0<toChange.length&&(ambiguous||(newShapeHoles=betterShapeHoles))}i=0;for(var il=newShapes.length;i<il;i++){tmpShape=newShapes[i].s,shapes.push(tmpShape);for(var j=0,jl=(tmpHoles=newShapeHoles[i]).length;j<jl;j++)tmpShape.holes.push(tmpHoles[j].h)}return shapes}}),Object.assign(Font.prototype,{isFont:!0,generateShapes:function(text,size){void 0===size&&(size=100);for(var shapes=[],paths=function(text,size,data){for(var chars=Array.from?Array.from(text):String(text).split(""),scale=size/data.resolution,line_height=(data.boundingBox.yMax-data.boundingBox.yMin+data.underlineThickness)*scale,paths=[],offsetX=0,offsetY=0,i=0;i<chars.length;i++){var char=chars[i];if("\n"===char)offsetX=0,offsetY-=line_height;else{var ret=createPath(char,scale,offsetX,offsetY,data);offsetX+=ret.offsetX,paths.push(ret.path)}}return paths}(text,size,this.data),p=0,pl=paths.length;p<pl;p++)Array.prototype.push.apply(shapes,paths[p].toShapes());return shapes}}),Object.assign(FontLoader.prototype,{load:function(url,onLoad,onProgress,onError){var scope=this,loader=new FileLoader(this.manager);loader.setPath(this.path),loader.load(url,function(text){var json;try{json=JSON.parse(text)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),json=JSON.parse(text.substring(65,text.length-2))}var font=scope.parse(json);onLoad&&onLoad(font)},onProgress,onError)},parse:function(json){return new Font(json)},setPath:function(value){return this.path=value,this}}),Loader.Handlers={handlers:[],add:function(regex,loader){this.handlers.push(regex,loader)},get:function(file){for(var handlers=this.handlers,i=0,l=handlers.length;i<l;i+=2){var regex=handlers[i],loader=handlers[i+1];if(regex.test(file))return loader}return null}},Object.assign(Loader.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(materials,texturePath,crossOrigin){for(var array=[],i=0;i<materials.length;++i)array[i]=this.createMaterial(materials[i],texturePath,crossOrigin);return array},createMaterial:(BlendingMode={NoBlending:NoBlending,NormalBlending:NormalBlending,AdditiveBlending:AdditiveBlending,SubtractiveBlending:SubtractiveBlending,MultiplyBlending:MultiplyBlending,CustomBlending:CustomBlending},color=new Color,textureLoader=new TextureLoader,materialLoader=new MaterialLoader,function(m,texturePath,crossOrigin){var textures={};function loadTexture(path,repeat,offset,wrap,anisotropy){var texture,fullPath=texturePath+path,loader=Loader.Handlers.get(fullPath);texture=null!==loader?loader.load(fullPath):(textureLoader.setCrossOrigin(crossOrigin),textureLoader.load(fullPath)),void 0!==repeat&&(texture.repeat.fromArray(repeat),1!==repeat[0]&&(texture.wrapS=RepeatWrapping),1!==repeat[1]&&(texture.wrapT=RepeatWrapping)),void 0!==offset&&texture.offset.fromArray(offset),void 0!==wrap&&("repeat"===wrap[0]&&(texture.wrapS=RepeatWrapping),"mirror"===wrap[0]&&(texture.wrapS=MirroredRepeatWrapping),"repeat"===wrap[1]&&(texture.wrapT=RepeatWrapping),"mirror"===wrap[1]&&(texture.wrapT=MirroredRepeatWrapping)),void 0!==anisotropy&&(texture.anisotropy=anisotropy);var uuid=_Math.generateUUID();return textures[uuid]=texture,uuid}var json={uuid:_Math.generateUUID(),type:"MeshLambertMaterial"};for(var name in m){var value=m[name];switch(name){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":json.name=value;break;case"blending":json.blending=BlendingMode[value];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",name,"is no longer supported.");break;case"colorDiffuse":json.color=color.fromArray(value).getHex();break;case"colorSpecular":json.specular=color.fromArray(value).getHex();break;case"colorEmissive":json.emissive=color.fromArray(value).getHex();break;case"specularCoef":json.shininess=value;break;case"shading":"basic"===value.toLowerCase()&&(json.type="MeshBasicMaterial"),"phong"===value.toLowerCase()&&(json.type="MeshPhongMaterial"),"standard"===value.toLowerCase()&&(json.type="MeshStandardMaterial");break;case"mapDiffuse":json.map=loadTexture(value,m.mapDiffuseRepeat,m.mapDiffuseOffset,m.mapDiffuseWrap,m.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":json.emissiveMap=loadTexture(value,m.mapEmissiveRepeat,m.mapEmissiveOffset,m.mapEmissiveWrap,m.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":json.lightMap=loadTexture(value,m.mapLightRepeat,m.mapLightOffset,m.mapLightWrap,m.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":json.aoMap=loadTexture(value,m.mapAORepeat,m.mapAOOffset,m.mapAOWrap,m.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":json.bumpMap=loadTexture(value,m.mapBumpRepeat,m.mapBumpOffset,m.mapBumpWrap,m.mapBumpAnisotropy);break;case"mapBumpScale":json.bumpScale=value;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":json.normalMap=loadTexture(value,m.mapNormalRepeat,m.mapNormalOffset,m.mapNormalWrap,m.mapNormalAnisotropy);break;case"mapNormalFactor":json.normalScale=value;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":json.specularMap=loadTexture(value,m.mapSpecularRepeat,m.mapSpecularOffset,m.mapSpecularWrap,m.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":json.metalnessMap=loadTexture(value,m.mapMetalnessRepeat,m.mapMetalnessOffset,m.mapMetalnessWrap,m.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":json.roughnessMap=loadTexture(value,m.mapRoughnessRepeat,m.mapRoughnessOffset,m.mapRoughnessWrap,m.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":json.alphaMap=loadTexture(value,m.mapAlphaRepeat,m.mapAlphaOffset,m.mapAlphaWrap,m.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":json.side=BackSide;break;case"doubleSided":json.side=DoubleSide;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),json.opacity=value;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":json[name]=value;break;case"vertexColors":!0===value&&(json.vertexColors=VertexColors),"face"===value&&(json.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",name,value)}}return"MeshBasicMaterial"===json.type&&delete json.emissive,"MeshPhongMaterial"!==json.type&&delete json.specular,json.opacity<1&&(json.transparent=!0),materialLoader.setTextures(textures),materialLoader.parse(json)})});var AudioContext={getContext:function(){return void 0===context&&(context=new(window.AudioContext||window.webkitAudioContext)),context},setContext:function(value){context=value}};function AudioLoader(manager){this.manager=void 0!==manager?manager:DefaultLoadingManager}function SphericalHarmonics3(){this.coefficients=[];for(var i=0;i<9;i++)this.coefficients.push(new Vector3)}function LightProbe(sh,intensity){Light.call(this,void 0,intensity),this.sh=void 0!==sh?sh:new SphericalHarmonics3}function HemisphereLightProbe(skyColor,groundColor,intensity){LightProbe.call(this,void 0,intensity);var color1=(new Color).set(skyColor),color2=(new Color).set(groundColor),sky=new Vector3(color1.r,color1.g,color1.b),ground=new Vector3(color2.r,color2.g,color2.b),c0=Math.sqrt(Math.PI),c1=c0*Math.sqrt(.75);this.sh.coefficients[0].copy(sky).add(ground).multiplyScalar(c0),this.sh.coefficients[1].copy(sky).sub(ground).multiplyScalar(c1)}function AmbientLightProbe(color,intensity){LightProbe.call(this,void 0,intensity);var color1=(new Color).set(color);this.sh.coefficients[0].set(color1.r,color1.g,color1.b).multiplyScalar(2*Math.sqrt(Math.PI))}function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}Object.assign(AudioLoader.prototype,{load:function(url,onLoad,onProgress,onError){var loader=new FileLoader(this.manager);loader.setResponseType("arraybuffer"),loader.setPath(this.path),loader.load(url,function(buffer){var bufferCopy=buffer.slice(0);AudioContext.getContext().decodeAudioData(bufferCopy,function(audioBuffer){onLoad(audioBuffer)})},onProgress,onError)},setPath:function(value){return this.path=value,this}}),Object.assign(SphericalHarmonics3.prototype,{isSphericalHarmonics3:!0,set:function(coefficients){for(var i=0;i<9;i++)this.coefficients[i].copy(coefficients[i]);return this},zero:function(){for(var i=0;i<9;i++)this.coefficients[i].set(0,0,0);return this},getAt:function(normal,target){var x=normal.x,y=normal.y,z=normal.z,coeff=this.coefficients;return target=.282095*coeff[0],target+=.488603*coeff[1]*y,target+=.488603*coeff[2]*z,target+=.488603*coeff[3]*x,target+=1.092548*coeff[4]*(x*y),target+=1.092548*coeff[5]*(y*z),target+=.315392*coeff[6]*(3*z*z-1),target+=1.092548*coeff[7]*(x*z),target+=.546274*coeff[8]*(x*x-y*y)},getIrradianceAt:function(normal,target){var x=normal.x,y=normal.y,z=normal.z,coeff=this.coefficients;return target=.886227*coeff[0],target+=2*coeff[1]*.511664*y,target+=2*coeff[2]*.511664*z,target+=2*coeff[3]*.511664*x,target+=2*coeff[4]*.429043*x*y,target+=2*coeff[5]*.429043*y*z,target+=coeff[6]*(.743125*z*z-.247708),target+=2*coeff[7]*.429043*x*z,target+=.429043*coeff[8]*(x*x-y*y)},add:function(sh){for(var i=0;i<9;i++)this.coefficients[i].add(sh.coefficients[i]);return this},scale:function(s){for(var i=0;i<9;i++)this.coefficients[i].multiplyScalar(s);return this},lerp:function(sh,alpha){for(var i=0;i<9;i++)this.coefficients[i].lerp(sh.coefficients[i],alpha);return this},equals:function(sh){for(var i=0;i<9;i++)if(!this.coefficients[i].equals(sh.coefficients[i]))return!1;return!0},copy:function(sh){return this.set(sh.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(array){for(var coefficients=this.coefficients,i=0;i<9;i++)coefficients[i].fromArray(array,3*i);return this},toArray:function(){for(var array=[],coefficients=this.coefficients,i=0;i<9;i++)coefficients[i].toArray(array,3*i);return array}}),Object.assign(SphericalHarmonics3,{getBasisAt:function(normal,shBasis){var x=normal.x,y=normal.y,z=normal.z;shBasis[0]=.282095,shBasis[1]=.488603*y,shBasis[2]=.488603*z,shBasis[3]=.488603*x,shBasis[4]=1.092548*x*y,shBasis[5]=1.092548*y*z,shBasis[6]=.315392*(3*z*z-1),shBasis[7]=1.092548*x*z,shBasis[8]=.546274*(x*x-y*y)}}),LightProbe.prototype=Object.assign(Object.create(Light.prototype),{constructor:LightProbe,isLightProbe:!0,copy:function(source){return Light.prototype.copy.call(this,source),this.sh.copy(source.sh),this.intensity=source.intensity,this},toJSON:function(meta){return Light.prototype.toJSON.call(this,meta)}}),HemisphereLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:HemisphereLightProbe,isHemisphereLightProbe:!0,copy:function(source){return LightProbe.prototype.copy.call(this,source),this},toJSON:function(meta){return LightProbe.prototype.toJSON.call(this,meta)}}),AmbientLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:AmbientLightProbe,isAmbientLightProbe:!0,copy:function(source){return LightProbe.prototype.copy.call(this,source),this},toJSON:function(meta){return LightProbe.prototype.toJSON.call(this,meta)}}),Object.assign(StereoCamera.prototype,{update:function(){var instance,focus,fov,aspect,near,far,zoom,eyeSep,eyeRight=new Matrix4,eyeLeft=new Matrix4;return function(camera){if(instance!==this||focus!==camera.focus||fov!==camera.fov||aspect!==camera.aspect*this.aspect||near!==camera.near||far!==camera.far||zoom!==camera.zoom||eyeSep!==this.eyeSep){instance=this,focus=camera.focus,fov=camera.fov,aspect=camera.aspect*this.aspect,near=camera.near,far=camera.far,zoom=camera.zoom;var xmin,xmax,projectionMatrix=camera.projectionMatrix.clone(),eyeSepOnProjection=(eyeSep=this.eyeSep/2)*near/focus,ymax=near*Math.tan(_Math.DEG2RAD*fov*.5)/zoom;eyeLeft.elements[12]=-eyeSep,eyeRight.elements[12]=eyeSep,xmin=-ymax*aspect+eyeSepOnProjection,xmax=ymax*aspect+eyeSepOnProjection,projectionMatrix.elements[0]=2*near/(xmax-xmin),projectionMatrix.elements[8]=(xmax+xmin)/(xmax-xmin),this.cameraL.projectionMatrix.copy(projectionMatrix),xmin=-ymax*aspect-eyeSepOnProjection,xmax=ymax*aspect-eyeSepOnProjection,projectionMatrix.elements[0]=2*near/(xmax-xmin),projectionMatrix.elements[8]=(xmax+xmin)/(xmax-xmin),this.cameraR.projectionMatrix.copy(projectionMatrix)}this.cameraL.matrixWorld.copy(camera.matrixWorld).multiply(eyeLeft),this.cameraR.matrixWorld.copy(camera.matrixWorld).multiply(eyeRight)}}()});function CubeCamera(near,far,cubeResolution,options){Object3D.call(this),this.type="CubeCamera";var cameraPX=new PerspectiveCamera(90,1,near,far);cameraPX.up.set(0,-1,0),cameraPX.lookAt(new Vector3(1,0,0)),this.add(cameraPX);var cameraNX=new PerspectiveCamera(90,1,near,far);cameraNX.up.set(0,-1,0),cameraNX.lookAt(new Vector3(-1,0,0)),this.add(cameraNX);var cameraPY=new PerspectiveCamera(90,1,near,far);cameraPY.up.set(0,0,1),cameraPY.lookAt(new Vector3(0,1,0)),this.add(cameraPY);var cameraNY=new PerspectiveCamera(90,1,near,far);cameraNY.up.set(0,0,-1),cameraNY.lookAt(new Vector3(0,-1,0)),this.add(cameraNY);var cameraPZ=new PerspectiveCamera(90,1,near,far);cameraPZ.up.set(0,-1,0),cameraPZ.lookAt(new Vector3(0,0,1)),this.add(cameraPZ);var cameraNZ=new PerspectiveCamera(90,1,near,far);cameraNZ.up.set(0,-1,0),cameraNZ.lookAt(new Vector3(0,0,-1)),this.add(cameraNZ),options=options||{format:RGBFormat,magFilter:LinearFilter,minFilter:LinearFilter},this.renderTarget=new WebGLRenderTargetCube(cubeResolution,cubeResolution,options),this.renderTarget.texture.name="CubeCamera",this.update=function(renderer,scene){null===this.parent&&this.updateMatrixWorld();var currentRenderTarget=renderer.getRenderTarget(),renderTarget=this.renderTarget,generateMipmaps=renderTarget.texture.generateMipmaps;renderTarget.texture.generateMipmaps=!1,renderer.setRenderTarget(renderTarget,0),renderer.render(scene,cameraPX),renderer.setRenderTarget(renderTarget,1),renderer.render(scene,cameraNX),renderer.setRenderTarget(renderTarget,2),renderer.render(scene,cameraPY),renderer.setRenderTarget(renderTarget,3),renderer.render(scene,cameraNY),renderer.setRenderTarget(renderTarget,4),renderer.render(scene,cameraPZ),renderTarget.texture.generateMipmaps=generateMipmaps,renderer.setRenderTarget(renderTarget,5),renderer.render(scene,cameraNZ),renderer.setRenderTarget(currentRenderTarget)},this.clear=function(renderer,color,depth,stencil){for(var currentRenderTarget=renderer.getRenderTarget(),renderTarget=this.renderTarget,i=0;i<6;i++)renderer.setRenderTarget(renderTarget,i),renderer.clear(color,depth,stencil);renderer.setRenderTarget(currentRenderTarget)}}function Clock(autoStart){this.autoStart=void 0===autoStart||autoStart,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function AudioListener(){Object3D.call(this),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function Audio(listener){Object3D.call(this),this.type="Audio",this.listener=listener,this.context=listener.context,this.gain=this.context.createGain(),this.gain.connect(listener.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function PositionalAudio(listener){Audio.call(this,listener),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function AudioAnalyser(audio,fftSize){this.analyser=audio.context.createAnalyser(),this.analyser.fftSize=void 0!==fftSize?fftSize:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),audio.getOutput().connect(this.analyser)}function PropertyMixer(binding,typeName,valueSize){this.binding=binding,this.valueSize=valueSize;var mixFunction,bufferType=Float64Array;switch(typeName){case"quaternion":mixFunction=this._slerp;break;case"string":case"bool":bufferType=Array,mixFunction=this._select;break;default:mixFunction=this._lerp}this.buffer=new bufferType(4*valueSize),this._mixBufferRegion=mixFunction,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}(CubeCamera.prototype=Object.create(Object3D.prototype)).constructor=CubeCamera,Object.assign(Clock.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var diff=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var newTime=("undefined"==typeof performance?Date:performance).now();diff=(newTime-this.oldTime)/1e3,this.oldTime=newTime,this.elapsedTime+=diff}return diff}}),AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(value){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=value,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(value){return this.gain.gain.setTargetAtTime(value,this.context.currentTime,.01),this},updateMatrixWorld:function(){var position=new Vector3,quaternion=new Quaternion,scale=new Vector3,orientation=new Vector3,clock=new Clock;return function(force){Object3D.prototype.updateMatrixWorld.call(this,force);var listener=this.context.listener,up=this.up;if(this.timeDelta=clock.getDelta(),this.matrixWorld.decompose(position,quaternion,scale),orientation.set(0,0,-1).applyQuaternion(quaternion),listener.positionX){var endTime=this.context.currentTime+this.timeDelta;listener.positionX.linearRampToValueAtTime(position.x,endTime),listener.positionY.linearRampToValueAtTime(position.y,endTime),listener.positionZ.linearRampToValueAtTime(position.z,endTime),listener.forwardX.linearRampToValueAtTime(orientation.x,endTime),listener.forwardY.linearRampToValueAtTime(orientation.y,endTime),listener.forwardZ.linearRampToValueAtTime(orientation.z,endTime),listener.upX.linearRampToValueAtTime(up.x,endTime),listener.upY.linearRampToValueAtTime(up.y,endTime),listener.upZ.linearRampToValueAtTime(up.z,endTime)}else listener.setPosition(position.x,position.y,position.z),listener.setOrientation(orientation.x,orientation.y,orientation.z,up.x,up.y,up.z)}}()}),Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function(){return this.gain},setNodeSource:function(audioNode){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=audioNode,this.connect(),this},setMediaElementSource:function(mediaElement){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(mediaElement),this.connect(),this},setBuffer:function(audioBuffer){return this.buffer=audioBuffer,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var source=this.context.createBufferSource();return source.buffer=this.buffer,source.loop=this.loop,source.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,source.start(this.startTime,this.offset),this.isPlaying=!0,this.source=source,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var i=1,l=this.filters.length;i<l;i++)this.filters[i-1].connect(this.filters[i]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var i=1,l=this.filters.length;i<l;i++)this.filters[i-1].disconnect(this.filters[i]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(value){return value||(value=[]),!0===this.isPlaying?(this.disconnect(),this.filters=value,this.connect()):this.filters=value,this},setDetune:function(value){if(this.detune=value,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(filter){return this.setFilters(filter?[filter]:[])},setPlaybackRate:function(value){if(!1!==this.hasPlaybackControl)return this.playbackRate=value,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(value){if(!1!==this.hasPlaybackControl)return this.loop=value,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(value){return this.gain.gain.setTargetAtTime(value,this.context.currentTime,.01),this}}),PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(value){return this.panner.refDistance=value,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(value){return this.panner.rolloffFactor=value,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(value){return this.panner.distanceModel=value,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(value){return this.panner.maxDistance=value,this},setDirectionalCone:function(coneInnerAngle,coneOuterAngle,coneOuterGain){return this.panner.coneInnerAngle=coneInnerAngle,this.panner.coneOuterAngle=coneOuterAngle,this.panner.coneOuterGain=coneOuterGain,this},updateMatrixWorld:function(){var position=new Vector3,quaternion=new Quaternion,scale=new Vector3,orientation=new Vector3;return function(force){if(Object3D.prototype.updateMatrixWorld.call(this,force),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(position,quaternion,scale),orientation.set(0,0,1).applyQuaternion(quaternion);var panner=this.panner;if(panner.positionX){var endTime=this.context.currentTime+this.listener.timeDelta;panner.positionX.linearRampToValueAtTime(position.x,endTime),panner.positionY.linearRampToValueAtTime(position.y,endTime),panner.positionZ.linearRampToValueAtTime(position.z,endTime),panner.orientationX.linearRampToValueAtTime(orientation.x,endTime),panner.orientationY.linearRampToValueAtTime(orientation.y,endTime),panner.orientationZ.linearRampToValueAtTime(orientation.z,endTime)}else panner.setPosition(position.x,position.y,position.z),panner.setOrientation(orientation.x,orientation.y,orientation.z)}}}()}),Object.assign(AudioAnalyser.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var value=0,data=this.getFrequencyData(),i=0;i<data.length;i++)value+=data[i];return value/data.length}}),Object.assign(PropertyMixer.prototype,{accumulate:function(accuIndex,weight){var buffer=this.buffer,stride=this.valueSize,offset=accuIndex*stride+stride,currentWeight=this.cumulativeWeight;if(0===currentWeight){for(var i=0;i!==stride;++i)buffer[offset+i]=buffer[i];currentWeight=weight}else{var mix=weight/(currentWeight+=weight);this._mixBufferRegion(buffer,offset,0,mix,stride)}this.cumulativeWeight=currentWeight},apply:function(accuIndex){var stride=this.valueSize,buffer=this.buffer,offset=accuIndex*stride+stride,weight=this.cumulativeWeight,binding=this.binding;if(this.cumulativeWeight=0,weight<1){var originalValueOffset=3*stride;this._mixBufferRegion(buffer,offset,originalValueOffset,1-weight,stride)}for(var i=stride,e=stride+stride;i!==e;++i)if(buffer[i]!==buffer[i+stride]){binding.setValue(buffer,offset);break}},saveOriginalState:function(){var binding=this.binding,buffer=this.buffer,stride=this.valueSize,originalValueOffset=3*stride;binding.getValue(buffer,originalValueOffset);for(var i=stride,e=originalValueOffset;i!==e;++i)buffer[i]=buffer[originalValueOffset+i%stride];this.cumulativeWeight=0},restoreOriginalState:function(){var originalValueOffset=3*this.valueSize;this.binding.setValue(this.buffer,originalValueOffset)},_select:function(buffer,dstOffset,srcOffset,t,stride){if(.5<=t)for(var i=0;i!==stride;++i)buffer[dstOffset+i]=buffer[srcOffset+i]},_slerp:function(buffer,dstOffset,srcOffset,t){Quaternion.slerpFlat(buffer,dstOffset,buffer,dstOffset,buffer,srcOffset,t)},_lerp:function(buffer,dstOffset,srcOffset,t,stride){for(var s=1-t,i=0;i!==stride;++i){var j=dstOffset+i;buffer[j]=buffer[j]*s+buffer[srcOffset+i]*t}}});var wordChar,wordCharOrDot,directoryRe,nodeRe,objectRe,propertyRe,trackRe,supportedObjectNames,reservedRe,startP,startEnd,lineGeometry,coneGeometry,radians,axis;function Composite(targetGroup,path,optionalParsedPath){var parsedPath=optionalParsedPath||PropertyBinding.parseTrackName(path);this._targetGroup=targetGroup,this._bindings=targetGroup.subscribe_(path,parsedPath)}function PropertyBinding(rootNode,path,parsedPath){this.path=path,this.parsedPath=parsedPath||PropertyBinding.parseTrackName(path),this.node=PropertyBinding.findNode(rootNode,this.parsedPath.nodeName)||rootNode,this.rootNode=rootNode}function AnimationObjectGroup(){this.uuid=_Math.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var indices={};this._indicesByUUID=indices;for(var i=0,n=arguments.length;i!==n;++i)indices[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var scope=this;this.stats={objects:{get total(){return scope._objects.length},get inUse(){return this.total-scope.nCachedObjects_}},get bindingsPerObject(){return scope._bindings.length}}}function AnimationAction(mixer,clip,localRoot){this._mixer=mixer,this._clip=clip,this._localRoot=localRoot||null;for(var tracks=clip.tracks,nTracks=tracks.length,interpolants=new Array(nTracks),interpolantSettings={endingStart:2400,endingEnd:2400},i=0;i!==nTracks;++i){var interpolant=tracks[i].createInterpolant(null);(interpolants[i]=interpolant).settings=interpolantSettings}this._interpolantSettings=interpolantSettings,this._interpolants=interpolants,this._propertyBindings=new Array(nTracks),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function AnimationMixer(root){this._root=root,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Uniform(value){"string"==typeof value&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),value=arguments[1]),this.value=value}function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function InstancedInterleavedBuffer(array,stride,meshPerAttribute){InterleavedBuffer.call(this,array,stride),this.meshPerAttribute=meshPerAttribute||1}function InstancedBufferAttribute(array,itemSize,normalized,meshPerAttribute){"number"==typeof normalized&&(meshPerAttribute=normalized,normalized=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),BufferAttribute.call(this,array,itemSize,normalized),this.meshPerAttribute=meshPerAttribute||1}function Raycaster(origin,direction,near,far){this.ray=new Ray(origin,direction),this.near=near||0,this.far=far||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(a,b){return a.distance-b.distance}function intersectObject(object,raycaster,intersects,recursive){if(!1!==object.visible&&(object.raycast(raycaster,intersects),!0===recursive))for(var children=object.children,i=0,l=children.length;i<l;i++)intersectObject(children[i],raycaster,intersects,!0)}function Spherical(radius,phi,theta){return this.radius=void 0!==radius?radius:1,this.phi=void 0!==phi?phi:0,this.theta=void 0!==theta?theta:0,this}function Cylindrical(radius,theta,y){return this.radius=void 0!==radius?radius:1,this.theta=void 0!==theta?theta:0,this.y=void 0!==y?y:0,this}function Box2(min,max){this.min=void 0!==min?min:new Vector2(1/0,1/0),this.max=void 0!==max?max:new Vector2(-1/0,-1/0)}function Line3(start,end){this.start=void 0!==start?start:new Vector3,this.end=void 0!==end?end:new Vector3}function ImmediateRenderObject(material){Object3D.call(this),this.material=material,this.render=function(){}}function VertexNormalsHelper(object,size,hex,linewidth){this.object=object,this.size=void 0!==size?size:1;var color=void 0!==hex?hex:16711680,width=void 0!==linewidth?linewidth:1,nNormals=0,objGeometry=this.object.geometry;objGeometry&&objGeometry.isGeometry?nNormals=3*objGeometry.faces.length:objGeometry&&objGeometry.isBufferGeometry&&(nNormals=objGeometry.attributes.normal.count);var geometry=new BufferGeometry,positions=new Float32BufferAttribute(2*nNormals*3,3);geometry.addAttribute("position",positions),LineSegments.call(this,geometry,new LineBasicMaterial({color:color,linewidth:width})),this.matrixAutoUpdate=!1,this.update()}function SpotLightHelper(light,color){Object3D.call(this),this.light=light,this.light.updateMatrixWorld(),this.matrix=light.matrixWorld,this.matrixAutoUpdate=!1,this.color=color;for(var geometry=new BufferGeometry,positions=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,j=1;i<32;i++,j++){var p1=i/32*Math.PI*2,p2=j/32*Math.PI*2;positions.push(Math.cos(p1),Math.sin(p1),1,Math.cos(p2),Math.sin(p2),1)}geometry.addAttribute("position",new Float32BufferAttribute(positions,3));var material=new LineBasicMaterial({fog:!1});this.cone=new LineSegments(geometry,material),this.add(this.cone),this.update()}function SkeletonHelper(object){for(var bones=function getBoneList(object){var boneList=[];object&&object.isBone&&boneList.push(object);for(var i=0;i<object.children.length;i++)boneList.push.apply(boneList,getBoneList(object.children[i]));return boneList}(object),geometry=new BufferGeometry,vertices=[],colors=[],color1=new Color(0,0,1),color2=new Color(0,1,0),i=0;i<bones.length;i++){var bone=bones[i];bone.parent&&bone.parent.isBone&&(vertices.push(0,0,0),vertices.push(0,0,0),colors.push(color1.r,color1.g,color1.b),colors.push(color2.r,color2.g,color2.b))}geometry.addAttribute("position",new Float32BufferAttribute(vertices,3)),geometry.addAttribute("color",new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial({vertexColors:VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});LineSegments.call(this,geometry,material),this.root=object,this.bones=bones,this.matrix=object.matrixWorld,this.matrixAutoUpdate=!1}function PointLightHelper(light,sphereSize,color){this.light=light,this.light.updateMatrixWorld(),this.color=color;var geometry=new SphereBufferGeometry(sphereSize,4,2),material=new MeshBasicMaterial({wireframe:!0,fog:!1});Mesh.call(this,geometry,material),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function RectAreaLightHelper(light,color){this.type="RectAreaLightHelper",this.light=light,this.color=color;var geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),geometry.computeBoundingSphere();var material=new LineBasicMaterial({fog:!1});Line.call(this,geometry,material);var geometry2=new BufferGeometry;geometry2.addAttribute("position",new Float32BufferAttribute([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),geometry2.computeBoundingSphere(),this.add(new Mesh(geometry2,new MeshBasicMaterial({side:BackSide,fog:!1}))),this.update()}function HemisphereLightHelper(light,size,color){Object3D.call(this),this.light=light,this.light.updateMatrixWorld(),this.matrix=light.matrixWorld,this.matrixAutoUpdate=!1,this.color=color;var geometry=new OctahedronBufferGeometry(size);geometry.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=VertexColors);var position=geometry.getAttribute("position"),colors=new Float32Array(3*position.count);geometry.addAttribute("color",new BufferAttribute(colors,3)),this.add(new Mesh(geometry,this.material)),this.update()}function LightProbeHelper(lightProbe,size){this.lightProbe=lightProbe,this.size=size;var defines={GAMMA_OUTPUT:""},material=new ShaderMaterial({defines:defines,uniforms:{sh:{value:this.lightProbe.sh.coefficients},intensity:{value:this.lightProbe.intensity}},vertexShader:["varying vec3 vNormal;","void main() {","\tvNormal = normalize( normalMatrix * normal );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI 0.318309886","vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {","\t// matrix is assumed to be orthogonal","\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );","}","vec3 linearToOutput( in vec3 a ) {","\t#ifdef GAMMA_OUTPUT","\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );","\t#else","\t\treturn a;","\t#endif","}","// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf","vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {","\t// normal is assumed to have unit length","\tfloat x = normal.x, y = normal.y, z = normal.z;","\t// band 0","\tvec3 result = shCoefficients[ 0 ] * 0.886227;","\t// band 1","\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;","\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;","\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;","\t// band 2","\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;","\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;","\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );","\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;","\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );","\treturn result;","}","uniform vec3 sh[ 9 ]; // sh coefficients","uniform float intensity; // light probe intensity","varying vec3 vNormal;","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","\tvec3 irradiance = shGetIrradianceAt( worldNormal, sh );","\tvec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;","\toutgoingLight = linearToOutput( outgoingLight );","\tgl_FragColor = vec4( outgoingLight, 1.0 );","}"].join("\n")}),geometry=new SphereBufferGeometry(1,32,16);Mesh.call(this,geometry,material),this.onBeforeRender()}function GridHelper(size,divisions,color1,color2){size=size||10,divisions=divisions||10,color1=new Color(void 0!==color1?color1:4473924),color2=new Color(void 0!==color2?color2:8947848);for(var center=divisions/2,step=size/divisions,halfSize=size/2,vertices=[],colors=[],i=0,j=0,k=-halfSize;i<=divisions;i++,k+=step){vertices.push(-halfSize,0,k,halfSize,0,k),vertices.push(k,0,-halfSize,k,0,halfSize);var color=i===center?color1:color2;color.toArray(colors,j),j+=3,color.toArray(colors,j),j+=3,color.toArray(colors,j),j+=3,color.toArray(colors,j),j+=3}var geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute(vertices,3)),geometry.addAttribute("color",new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,geometry,material)}function PolarGridHelper(radius,radials,circles,divisions,color1,color2){radius=radius||10,radials=radials||16,circles=circles||8,divisions=divisions||64,color1=new Color(void 0!==color1?color1:4473924),color2=new Color(void 0!==color2?color2:8947848);var x,z,v,i,j,r,color,vertices=[],colors=[];for(i=0;i<=radials;i++)v=i/radials*(2*Math.PI),x=Math.sin(v)*radius,z=Math.cos(v)*radius,vertices.push(0,0,0),vertices.push(x,0,z),color=1&i?color1:color2,colors.push(color.r,color.g,color.b),colors.push(color.r,color.g,color.b);for(i=0;i<=circles;i++)for(color=1&i?color1:color2,r=radius-radius/circles*i,j=0;j<divisions;j++)v=j/divisions*(2*Math.PI),x=Math.sin(v)*r,z=Math.cos(v)*r,vertices.push(x,0,z),colors.push(color.r,color.g,color.b),v=(j+1)/divisions*(2*Math.PI),x=Math.sin(v)*r,z=Math.cos(v)*r,vertices.push(x,0,z),colors.push(color.r,color.g,color.b);var geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute(vertices,3)),geometry.addAttribute("color",new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,geometry,material)}function PositionalAudioHelper(audio,range,divisionsInnerAngle,divisionsOuterAngle){this.audio=audio,this.range=range||1,this.divisionsInnerAngle=divisionsInnerAngle||16,this.divisionsOuterAngle=divisionsOuterAngle||2;var geometry=new BufferGeometry,divisions=this.divisionsInnerAngle+2*this.divisionsOuterAngle,positions=new Float32Array(3*(3*divisions+3));geometry.addAttribute("position",new BufferAttribute(positions,3));var materialInnerAngle=new LineBasicMaterial({color:65280}),materialOuterAngle=new LineBasicMaterial({color:16776960});Line.call(this,geometry,[materialOuterAngle,materialInnerAngle]),this.update()}function FaceNormalsHelper(object,size,hex,linewidth){this.object=object,this.size=void 0!==size?size:1;var color=void 0!==hex?hex:16776960,width=void 0!==linewidth?linewidth:1,nNormals=0,objGeometry=this.object.geometry;objGeometry&&objGeometry.isGeometry?nNormals=objGeometry.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var geometry=new BufferGeometry,positions=new Float32BufferAttribute(2*nNormals*3,3);geometry.addAttribute("position",positions),LineSegments.call(this,geometry,new LineBasicMaterial({color:color,linewidth:width})),this.matrixAutoUpdate=!1,this.update()}function DirectionalLightHelper(light,size,color){Object3D.call(this),this.light=light,this.light.updateMatrixWorld(),this.matrix=light.matrixWorld,this.matrixAutoUpdate=!1,this.color=color,void 0===size&&(size=1);var geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute([-size,size,0,size,size,0,size,-size,0,-size,-size,0,-size,size,0],3));var material=new LineBasicMaterial({fog:!1});this.lightPlane=new Line(geometry,material),this.add(this.lightPlane),(geometry=new BufferGeometry).addAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(geometry,material),this.add(this.targetLine),this.update()}function CameraHelper(camera){var geometry=new BufferGeometry,material=new LineBasicMaterial({color:16777215,vertexColors:1}),vertices=[],colors=[],pointMap={},colorFrustum=new Color(16755200),colorCone=new Color(16711680),colorUp=new Color(43775),colorTarget=new Color(16777215),colorCross=new Color(3355443);function addLine(a,b,color){addPoint(a,color),addPoint(b,color)}function addPoint(id,color){vertices.push(0,0,0),colors.push(color.r,color.g,color.b),void 0===pointMap[id]&&(pointMap[id]=[]),pointMap[id].push(vertices.length/3-1)}addLine("n1","n2",colorFrustum),addLine("n2","n4",colorFrustum),addLine("n4","n3",colorFrustum),addLine("n3","n1",colorFrustum),addLine("f1","f2",colorFrustum),addLine("f2","f4",colorFrustum),addLine("f4","f3",colorFrustum),addLine("f3","f1",colorFrustum),addLine("n1","f1",colorFrustum),addLine("n2","f2",colorFrustum),addLine("n3","f3",colorFrustum),addLine("n4","f4",colorFrustum),addLine("p","n1",colorCone),addLine("p","n2",colorCone),addLine("p","n3",colorCone),addLine("p","n4",colorCone),addLine("u1","u2",colorUp),addLine("u2","u3",colorUp),addLine("u3","u1",colorUp),addLine("c","t",colorTarget),addLine("p","c",colorCross),addLine("cn1","cn2",colorCross),addLine("cn3","cn4",colorCross),addLine("cf1","cf2",colorCross),addLine("cf3","cf4",colorCross),geometry.addAttribute("position",new Float32BufferAttribute(vertices,3)),geometry.addAttribute("color",new Float32BufferAttribute(colors,3)),LineSegments.call(this,geometry,material),this.camera=camera,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=camera.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=pointMap,this.update()}function BoxHelper(object,color){this.object=object,void 0===color&&(color=16776960);var indices=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),positions=new Float32Array(24),geometry=new BufferGeometry;geometry.setIndex(new BufferAttribute(indices,1)),geometry.addAttribute("position",new BufferAttribute(positions,3)),LineSegments.call(this,geometry,new LineBasicMaterial({color:color})),this.matrixAutoUpdate=!1,this.update()}function Box3Helper(box,hex){this.type="Box3Helper",this.box=box;var color=void 0!==hex?hex:16776960,indices=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),geometry=new BufferGeometry;geometry.setIndex(new BufferAttribute(indices,1)),geometry.addAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),LineSegments.call(this,geometry,new LineBasicMaterial({color:color})),this.geometry.computeBoundingSphere()}function PlaneHelper(plane,size,hex){this.type="PlaneHelper",this.plane=plane,this.size=void 0===size?1:size;var color=void 0!==hex?hex:16776960,geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),geometry.computeBoundingSphere(),Line.call(this,geometry,new LineBasicMaterial({color:color}));var geometry2=new BufferGeometry;geometry2.addAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),geometry2.computeBoundingSphere(),this.add(new Mesh(geometry2,new MeshBasicMaterial({color:color,opacity:.2,transparent:!0,depthWrite:!1})))}function ArrowHelper(dir,origin,length,color,headLength,headWidth){Object3D.call(this),void 0===dir&&(dir=new Vector3(0,0,1)),void 0===origin&&(origin=new Vector3(0,0,0)),void 0===length&&(length=1),void 0===color&&(color=16776960),void 0===headLength&&(headLength=.2*length),void 0===headWidth&&(headWidth=.2*headLength),void 0===lineGeometry&&((lineGeometry=new BufferGeometry).addAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),(coneGeometry=new CylinderBufferGeometry(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(origin),this.line=new Line(lineGeometry,new LineBasicMaterial({color:color})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(coneGeometry,new MeshBasicMaterial({color:color})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(dir),this.setLength(length,headLength,headWidth)}function AxesHelper(size){var vertices=[0,0,0,size=size||1,0,0,0,0,0,0,size,0,0,0,0,0,0,size],geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute(vertices,3)),geometry.addAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var material=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,geometry,material)}Object.assign(Composite.prototype,{getValue:function(array,offset){this.bind();var firstValidIndex=this._targetGroup.nCachedObjects_,binding=this._bindings[firstValidIndex];void 0!==binding&&binding.getValue(array,offset)},setValue:function(array,offset){for(var bindings=this._bindings,i=this._targetGroup.nCachedObjects_,n=bindings.length;i!==n;++i)bindings[i].setValue(array,offset)},bind:function(){for(var bindings=this._bindings,i=this._targetGroup.nCachedObjects_,n=bindings.length;i!==n;++i)bindings[i].bind()},unbind:function(){for(var bindings=this._bindings,i=this._targetGroup.nCachedObjects_,n=bindings.length;i!==n;++i)bindings[i].unbind()}}),Object.assign(PropertyBinding,{Composite:Composite,create:function(root,path,parsedPath){return root&&root.isAnimationObjectGroup?new PropertyBinding.Composite(root,path,parsedPath):new PropertyBinding(root,path,parsedPath)},sanitizeNodeName:(reservedRe=new RegExp("[\\[\\]\\.:\\/]","g"),function(name){return name.replace(/\s/g,"_").replace(reservedRe,"")}),parseTrackName:(wordChar="[^\\[\\]\\.:\\/]",wordCharOrDot="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",wordChar),nodeRe=/(WCOD+)?/.source.replace("WCOD",wordCharOrDot),objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",wordChar),propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",wordChar),trackRe=new RegExp("^"+directoryRe+nodeRe+objectRe+propertyRe+"$"),supportedObjectNames=["material","materials","bones"],function(trackName){var matches=trackRe.exec(trackName);if(!matches)throw new Error("PropertyBinding: Cannot parse trackName: "+trackName);var results={nodeName:matches[2],objectName:matches[3],objectIndex:matches[4],propertyName:matches[5],propertyIndex:matches[6]},lastDot=results.nodeName&&results.nodeName.lastIndexOf(".");if(void 0!==lastDot&&-1!==lastDot){var objectName=results.nodeName.substring(lastDot+1);-1!==supportedObjectNames.indexOf(objectName)&&(results.nodeName=results.nodeName.substring(0,lastDot),results.objectName=objectName)}if(null===results.propertyName||0===results.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+trackName);return results}),findNode:function(root,nodeName){if(!nodeName||""===nodeName||"root"===nodeName||"."===nodeName||-1===nodeName||nodeName===root.name||nodeName===root.uuid)return root;if(root.skeleton){var bone=root.skeleton.getBoneByName(nodeName);if(void 0!==bone)return bone}if(root.children){var searchNodeSubtree=function(children){for(var i=0;i<children.length;i++){var childNode=children[i];if(childNode.name===nodeName||childNode.uuid===nodeName)return childNode;var result=searchNodeSubtree(childNode.children);if(result)return result}return null},subTreeNode=searchNodeSubtree(root.children);if(subTreeNode)return subTreeNode}return null}}),Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(buffer,offset){buffer[offset]=this.node[this.propertyName]},function(buffer,offset){for(var source=this.resolvedProperty,i=0,n=source.length;i!==n;++i)buffer[offset++]=source[i]},function(buffer,offset){buffer[offset]=this.resolvedProperty[this.propertyIndex]},function(buffer,offset){this.resolvedProperty.toArray(buffer,offset)}],SetterByBindingTypeAndVersioning:[[function(buffer,offset){this.targetObject[this.propertyName]=buffer[offset]},function(buffer,offset){this.targetObject[this.propertyName]=buffer[offset],this.targetObject.needsUpdate=!0},function(buffer,offset){this.targetObject[this.propertyName]=buffer[offset],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(buffer,offset){for(var dest=this.resolvedProperty,i=0,n=dest.length;i!==n;++i)dest[i]=buffer[offset++]},function(buffer,offset){for(var dest=this.resolvedProperty,i=0,n=dest.length;i!==n;++i)dest[i]=buffer[offset++];this.targetObject.needsUpdate=!0},function(buffer,offset){for(var dest=this.resolvedProperty,i=0,n=dest.length;i!==n;++i)dest[i]=buffer[offset++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(buffer,offset){this.resolvedProperty[this.propertyIndex]=buffer[offset]},function(buffer,offset){this.resolvedProperty[this.propertyIndex]=buffer[offset],this.targetObject.needsUpdate=!0},function(buffer,offset){this.resolvedProperty[this.propertyIndex]=buffer[offset],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(buffer,offset){this.resolvedProperty.fromArray(buffer,offset)},function(buffer,offset){this.resolvedProperty.fromArray(buffer,offset),this.targetObject.needsUpdate=!0},function(buffer,offset){this.resolvedProperty.fromArray(buffer,offset),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(targetArray,offset){this.bind(),this.getValue(targetArray,offset)},setValue:function(sourceArray,offset){this.bind(),this.setValue(sourceArray,offset)},bind:function(){var targetObject=this.node,parsedPath=this.parsedPath,objectName=parsedPath.objectName,propertyName=parsedPath.propertyName,propertyIndex=parsedPath.propertyIndex;if(targetObject||(targetObject=PropertyBinding.findNode(this.rootNode,parsedPath.nodeName)||this.rootNode,this.node=targetObject),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,targetObject){if(objectName){var objectIndex=parsedPath.objectIndex;switch(objectName){case"materials":if(!targetObject.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!targetObject.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);targetObject=targetObject.material.materials;break;case"bones":if(!targetObject.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);targetObject=targetObject.skeleton.bones;for(var i=0;i<targetObject.length;i++)if(targetObject[i].name===objectIndex){objectIndex=i;break}break;default:if(void 0===targetObject[objectName])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);targetObject=targetObject[objectName]}if(void 0!==objectIndex){if(void 0===targetObject[objectIndex])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,targetObject);targetObject=targetObject[objectIndex]}}var nodeProperty=targetObject[propertyName];if(void 0!==nodeProperty){var versioning=this.Versioning.None;void 0!==(this.targetObject=targetObject).needsUpdate?versioning=this.Versioning.NeedsUpdate:void 0!==targetObject.matrixWorldNeedsUpdate&&(versioning=this.Versioning.MatrixWorldNeedsUpdate);var bindingType=this.BindingType.Direct;if(void 0!==propertyIndex){if("morphTargetInfluences"===propertyName){if(!targetObject.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(targetObject.geometry.isBufferGeometry){if(!targetObject.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(i=0;i<this.node.geometry.morphAttributes.position.length;i++)if(targetObject.geometry.morphAttributes.position[i].name===propertyIndex){propertyIndex=i;break}}else{if(!targetObject.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(i=0;i<this.node.geometry.morphTargets.length;i++)if(targetObject.geometry.morphTargets[i].name===propertyIndex){propertyIndex=i;break}}}bindingType=this.BindingType.ArrayElement,this.resolvedProperty=nodeProperty,this.propertyIndex=propertyIndex}else void 0!==nodeProperty.fromArray&&void 0!==nodeProperty.toArray?(bindingType=this.BindingType.HasFromToArray,this.resolvedProperty=nodeProperty):Array.isArray(nodeProperty)?(bindingType=this.BindingType.EntireArray,this.resolvedProperty=nodeProperty):this.propertyName=propertyName;this.getValue=this.GetterByBindingType[bindingType],this.setValue=this.SetterByBindingTypeAndVersioning[bindingType][versioning]}else{var nodeName=parsedPath.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+nodeName+"."+propertyName+" but it wasn't found.",targetObject)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue}),Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:!0,add:function(){for(var objects=this._objects,nObjects=objects.length,nCachedObjects=this.nCachedObjects_,indicesByUUID=this._indicesByUUID,paths=this._paths,parsedPaths=this._parsedPaths,bindings=this._bindings,nBindings=bindings.length,knownObject=void 0,i=0,n=arguments.length;i!==n;++i){var object=arguments[i],uuid=object.uuid,index=indicesByUUID[uuid];if(void 0===index){index=nObjects++,indicesByUUID[uuid]=index,objects.push(object);for(var j=0,m=nBindings;j!==m;++j)bindings[j].push(new PropertyBinding(object,paths[j],parsedPaths[j]))}else if(index<nCachedObjects){knownObject=objects[index];var firstActiveIndex=--nCachedObjects,lastCachedObject=objects[firstActiveIndex];objects[indicesByUUID[lastCachedObject.uuid]=index]=lastCachedObject,objects[indicesByUUID[uuid]=firstActiveIndex]=object;for(j=0,m=nBindings;j!==m;++j){var bindingsForPath=bindings[j],lastCached=bindingsForPath[firstActiveIndex],binding=bindingsForPath[index];bindingsForPath[index]=lastCached,void 0===binding&&(binding=new PropertyBinding(object,paths[j],parsedPaths[j])),bindingsForPath[firstActiveIndex]=binding}}else objects[index]!==knownObject&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=nCachedObjects},remove:function(){for(var objects=this._objects,nCachedObjects=this.nCachedObjects_,indicesByUUID=this._indicesByUUID,bindings=this._bindings,nBindings=bindings.length,i=0,n=arguments.length;i!==n;++i){var object=arguments[i],uuid=object.uuid,index=indicesByUUID[uuid];if(void 0!==index&&nCachedObjects<=index){var lastCachedIndex=nCachedObjects++,firstActiveObject=objects[lastCachedIndex];objects[indicesByUUID[firstActiveObject.uuid]=index]=firstActiveObject,objects[indicesByUUID[uuid]=lastCachedIndex]=object;for(var j=0,m=nBindings;j!==m;++j){var bindingsForPath=bindings[j],firstActive=bindingsForPath[lastCachedIndex],binding=bindingsForPath[index];bindingsForPath[index]=firstActive,bindingsForPath[lastCachedIndex]=binding}}}this.nCachedObjects_=nCachedObjects},uncache:function(){for(var objects=this._objects,nObjects=objects.length,nCachedObjects=this.nCachedObjects_,indicesByUUID=this._indicesByUUID,bindings=this._bindings,nBindings=bindings.length,i=0,n=arguments.length;i!==n;++i){var uuid=arguments[i].uuid,index=indicesByUUID[uuid];if(void 0!==index)if(delete indicesByUUID[uuid],index<nCachedObjects){var firstActiveIndex=--nCachedObjects,lastCachedObject=objects[firstActiveIndex],lastObject=objects[lastIndex=--nObjects];objects[indicesByUUID[lastCachedObject.uuid]=index]=lastCachedObject,objects[indicesByUUID[lastObject.uuid]=firstActiveIndex]=lastObject,objects.pop();for(var j=0,m=nBindings;j!==m;++j){var lastCached=(bindingsForPath=bindings[j])[firstActiveIndex],last=bindingsForPath[lastIndex];bindingsForPath[index]=lastCached,bindingsForPath[firstActiveIndex]=last,bindingsForPath.pop()}}else{var lastIndex;objects[indicesByUUID[(lastObject=objects[lastIndex=--nObjects]).uuid]=index]=lastObject,objects.pop();for(j=0,m=nBindings;j!==m;++j){var bindingsForPath;(bindingsForPath=bindings[j])[index]=bindingsForPath[lastIndex],bindingsForPath.pop()}}}this.nCachedObjects_=nCachedObjects},subscribe_:function(path,parsedPath){var indicesByPath=this._bindingsIndicesByPath,index=indicesByPath[path],bindings=this._bindings;if(void 0!==index)return bindings[index];var paths=this._paths,parsedPaths=this._parsedPaths,objects=this._objects,nObjects=objects.length,nCachedObjects=this.nCachedObjects_,bindingsForPath=new Array(nObjects);index=bindings.length,indicesByPath[path]=index,paths.push(path),parsedPaths.push(parsedPath),bindings.push(bindingsForPath);for(var i=nCachedObjects,n=objects.length;i!==n;++i){var object=objects[i];bindingsForPath[i]=new PropertyBinding(object,path,parsedPath)}return bindingsForPath},unsubscribe_:function(path){var indicesByPath=this._bindingsIndicesByPath,index=indicesByPath[path];if(void 0!==index){var paths=this._paths,parsedPaths=this._parsedPaths,bindings=this._bindings,lastBindingsIndex=bindings.length-1,lastBindings=bindings[lastBindingsIndex];bindings[indicesByPath[path[lastBindingsIndex]]=index]=lastBindings,bindings.pop(),parsedPaths[index]=parsedPaths[lastBindingsIndex],parsedPaths.pop(),paths[index]=paths[lastBindingsIndex],paths.pop()}}}),Object.assign(AnimationAction.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(time){return this._startTime=time,this},setLoop:function(mode,repetitions){return this.loop=mode,this.repetitions=repetitions,this},setEffectiveWeight:function(weight){return this.weight=weight,this._effectiveWeight=this.enabled?weight:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(duration){return this._scheduleFading(duration,0,1)},fadeOut:function(duration){return this._scheduleFading(duration,1,0)},crossFadeFrom:function(fadeOutAction,duration,warp){if(fadeOutAction.fadeOut(duration),this.fadeIn(duration),warp){var fadeInDuration=this._clip.duration,fadeOutDuration=fadeOutAction._clip.duration,startEndRatio=fadeOutDuration/fadeInDuration,endStartRatio=fadeInDuration/fadeOutDuration;fadeOutAction.warp(1,startEndRatio,duration),this.warp(endStartRatio,1,duration)}return this},crossFadeTo:function(fadeInAction,duration,warp){return fadeInAction.crossFadeFrom(this,duration,warp)},stopFading:function(){var weightInterpolant=this._weightInterpolant;return null!==weightInterpolant&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(weightInterpolant)),this},setEffectiveTimeScale:function(timeScale){return this.timeScale=timeScale,this._effectiveTimeScale=this.paused?0:timeScale,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(duration){return this.timeScale=this._clip.duration/duration,this.stopWarping()},syncWith:function(action){return this.time=action.time,this.timeScale=action.timeScale,this.stopWarping()},halt:function(duration){return this.warp(this._effectiveTimeScale,0,duration)},warp:function(startTimeScale,endTimeScale,duration){var mixer=this._mixer,now=mixer.time,interpolant=this._timeScaleInterpolant,timeScale=this.timeScale;null===interpolant&&(interpolant=mixer._lendControlInterpolant(),this._timeScaleInterpolant=interpolant);var times=interpolant.parameterPositions,values=interpolant.sampleValues;return times[0]=now,times[1]=now+duration,values[0]=startTimeScale/timeScale,values[1]=endTimeScale/timeScale,this},stopWarping:function(){var timeScaleInterpolant=this._timeScaleInterpolant;return null!==timeScaleInterpolant&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(timeScaleInterpolant)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(time,deltaTime,timeDirection,accuIndex){if(this.enabled){var startTime=this._startTime;if(null!==startTime){var timeRunning=(time-startTime)*timeDirection;if(timeRunning<0||0===timeDirection)return;this._startTime=null,deltaTime=timeDirection*timeRunning}deltaTime*=this._updateTimeScale(time);var clipTime=this._updateTime(deltaTime),weight=this._updateWeight(time);if(0<weight)for(var interpolants=this._interpolants,propertyMixers=this._propertyBindings,j=0,m=interpolants.length;j!==m;++j)interpolants[j].evaluate(clipTime),propertyMixers[j].accumulate(accuIndex,weight)}else this._updateWeight(time)},_updateWeight:function(time){var weight=0;if(this.enabled){weight=this.weight;var interpolant=this._weightInterpolant;if(null!==interpolant){var interpolantValue=interpolant.evaluate(time)[0];weight*=interpolantValue,time>interpolant.parameterPositions[1]&&(this.stopFading(),0===interpolantValue&&(this.enabled=!1))}}return this._effectiveWeight=weight},_updateTimeScale:function(time){var timeScale=0;if(!this.paused){timeScale=this.timeScale;var interpolant=this._timeScaleInterpolant;if(null!==interpolant)timeScale*=interpolant.evaluate(time)[0],time>interpolant.parameterPositions[1]&&(this.stopWarping(),0===timeScale?this.paused=!0:this.timeScale=timeScale)}return this._effectiveTimeScale=timeScale},_updateTime:function(deltaTime){var time=this.time+deltaTime,duration=this._clip.duration,loop=this.loop,loopCount=this._loopCount,pingPong=2202===loop;if(0===deltaTime)return-1===loopCount?time:pingPong&&1==(1&loopCount)?duration-time:time;if(2200===loop){-1===loopCount&&(this._loopCount=0,this._setEndings(!0,!0,!1));handle_stop:{if(duration<=time)time=duration;else{if(!(time<0))break handle_stop;time=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:deltaTime<0?-1:1})}}else{if(-1===loopCount&&(0<=deltaTime?(loopCount=0,this._setEndings(!0,0===this.repetitions,pingPong)):this._setEndings(0===this.repetitions,!0,pingPong)),duration<=time||time<0){var loopDelta=Math.floor(time/duration);time-=duration*loopDelta,loopCount+=Math.abs(loopDelta);var pending=this.repetitions-loopCount;if(pending<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,time=0<deltaTime?duration:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<deltaTime?1:-1});else{if(1==pending){var atStart=deltaTime<0;this._setEndings(atStart,!atStart,pingPong)}else this._setEndings(!1,!1,pingPong);this._loopCount=loopCount,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:loopDelta})}}if(pingPong&&1==(1&loopCount))return duration-(this.time=time)}return this.time=time},_setEndings:function(atStart,atEnd,pingPong){var settings=this._interpolantSettings;pingPong?(settings.endingStart=2401,settings.endingEnd=2401):(settings.endingStart=atStart?this.zeroSlopeAtStart?2401:2400:2402,settings.endingEnd=atEnd?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(duration,weightNow,weightThen){var mixer=this._mixer,now=mixer.time,interpolant=this._weightInterpolant;null===interpolant&&(interpolant=mixer._lendControlInterpolant(),this._weightInterpolant=interpolant);var times=interpolant.parameterPositions,values=interpolant.sampleValues;return times[0]=now,values[0]=weightNow,times[1]=now+duration,values[1]=weightThen,this}}),AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(action,prototypeAction){var root=action._localRoot||this._root,tracks=action._clip.tracks,nTracks=tracks.length,bindings=action._propertyBindings,interpolants=action._interpolants,rootUuid=root.uuid,bindingsByRoot=this._bindingsByRootAndName,bindingsByName=bindingsByRoot[rootUuid];void 0===bindingsByName&&(bindingsByName={},bindingsByRoot[rootUuid]=bindingsByName);for(var i=0;i!==nTracks;++i){var track=tracks[i],trackName=track.name,binding=bindingsByName[trackName];if(void 0!==binding)bindings[i]=binding;else{if(void 0!==(binding=bindings[i])){null===binding._cacheIndex&&(++binding.referenceCount,this._addInactiveBinding(binding,rootUuid,trackName));continue}var path=prototypeAction&&prototypeAction._propertyBindings[i].binding.parsedPath;++(binding=new PropertyMixer(PropertyBinding.create(root,trackName,path),track.ValueTypeName,track.getValueSize())).referenceCount,this._addInactiveBinding(binding,rootUuid,trackName),bindings[i]=binding}interpolants[i].resultBuffer=binding.buffer}},_activateAction:function(action){if(!this._isActiveAction(action)){if(null===action._cacheIndex){var rootUuid=(action._localRoot||this._root).uuid,clipUuid=action._clip.uuid,actionsForClip=this._actionsByClip[clipUuid];this._bindAction(action,actionsForClip&&actionsForClip.knownActions[0]),this._addInactiveAction(action,clipUuid,rootUuid)}for(var bindings=action._propertyBindings,i=0,n=bindings.length;i!==n;++i){var binding=bindings[i];0==binding.useCount++&&(this._lendBinding(binding),binding.saveOriginalState())}this._lendAction(action)}},_deactivateAction:function(action){if(this._isActiveAction(action)){for(var bindings=action._propertyBindings,i=0,n=bindings.length;i!==n;++i){var binding=bindings[i];0==--binding.useCount&&(binding.restoreOriginalState(),this._takeBackBinding(binding))}this._takeBackAction(action)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var scope=this;this.stats={actions:{get total(){return scope._actions.length},get inUse(){return scope._nActiveActions}},bindings:{get total(){return scope._bindings.length},get inUse(){return scope._nActiveBindings}},controlInterpolants:{get total(){return scope._controlInterpolants.length},get inUse(){return scope._nActiveControlInterpolants}}}},_isActiveAction:function(action){var index=action._cacheIndex;return null!==index&&index<this._nActiveActions},_addInactiveAction:function(action,clipUuid,rootUuid){var actions=this._actions,actionsByClip=this._actionsByClip,actionsForClip=actionsByClip[clipUuid];if(void 0===actionsForClip)actionsForClip={knownActions:[action],actionByRoot:{}},action._byClipCacheIndex=0,actionsByClip[clipUuid]=actionsForClip;else{var knownActions=actionsForClip.knownActions;action._byClipCacheIndex=knownActions.length,knownActions.push(action)}action._cacheIndex=actions.length,actions.push(action),actionsForClip.actionByRoot[rootUuid]=action},_removeInactiveAction:function(action){var actions=this._actions,lastInactiveAction=actions[actions.length-1],cacheIndex=action._cacheIndex;actions[lastInactiveAction._cacheIndex=cacheIndex]=lastInactiveAction,actions.pop(),action._cacheIndex=null;var clipUuid=action._clip.uuid,actionsByClip=this._actionsByClip,actionsForClip=actionsByClip[clipUuid],knownActionsForClip=actionsForClip.knownActions,lastKnownAction=knownActionsForClip[knownActionsForClip.length-1],byClipCacheIndex=action._byClipCacheIndex;knownActionsForClip[lastKnownAction._byClipCacheIndex=byClipCacheIndex]=lastKnownAction,knownActionsForClip.pop(),action._byClipCacheIndex=null,delete actionsForClip.actionByRoot[(action._localRoot||this._root).uuid],0===knownActionsForClip.length&&delete actionsByClip[clipUuid],this._removeInactiveBindingsForAction(action)},_removeInactiveBindingsForAction:function(action){for(var bindings=action._propertyBindings,i=0,n=bindings.length;i!==n;++i){var binding=bindings[i];0==--binding.referenceCount&&this._removeInactiveBinding(binding)}},_lendAction:function(action){var actions=this._actions,prevIndex=action._cacheIndex,lastActiveIndex=this._nActiveActions++,firstInactiveAction=actions[lastActiveIndex];actions[action._cacheIndex=lastActiveIndex]=action,actions[firstInactiveAction._cacheIndex=prevIndex]=firstInactiveAction},_takeBackAction:function(action){var actions=this._actions,prevIndex=action._cacheIndex,firstInactiveIndex=--this._nActiveActions,lastActiveAction=actions[firstInactiveIndex];actions[action._cacheIndex=firstInactiveIndex]=action,actions[lastActiveAction._cacheIndex=prevIndex]=lastActiveAction},_addInactiveBinding:function(binding,rootUuid,trackName){var bindingsByRoot=this._bindingsByRootAndName,bindingByName=bindingsByRoot[rootUuid],bindings=this._bindings;void 0===bindingByName&&(bindingByName={},bindingsByRoot[rootUuid]=bindingByName),(bindingByName[trackName]=binding)._cacheIndex=bindings.length,bindings.push(binding)},_removeInactiveBinding:function(binding){var bindings=this._bindings,propBinding=binding.binding,rootUuid=propBinding.rootNode.uuid,trackName=propBinding.path,bindingsByRoot=this._bindingsByRootAndName,bindingByName=bindingsByRoot[rootUuid],lastInactiveBinding=bindings[bindings.length-1],cacheIndex=binding._cacheIndex;bindings[lastInactiveBinding._cacheIndex=cacheIndex]=lastInactiveBinding,bindings.pop(),delete bindingByName[trackName];remove_empty_map:{for(var _ in bindingByName)break remove_empty_map;delete bindingsByRoot[rootUuid]}},_lendBinding:function(binding){var bindings=this._bindings,prevIndex=binding._cacheIndex,lastActiveIndex=this._nActiveBindings++,firstInactiveBinding=bindings[lastActiveIndex];bindings[binding._cacheIndex=lastActiveIndex]=binding,bindings[firstInactiveBinding._cacheIndex=prevIndex]=firstInactiveBinding},_takeBackBinding:function(binding){var bindings=this._bindings,prevIndex=binding._cacheIndex,firstInactiveIndex=--this._nActiveBindings,lastActiveBinding=bindings[firstInactiveIndex];bindings[binding._cacheIndex=firstInactiveIndex]=binding,bindings[lastActiveBinding._cacheIndex=prevIndex]=lastActiveBinding},_lendControlInterpolant:function(){var interpolants=this._controlInterpolants,lastActiveIndex=this._nActiveControlInterpolants++,interpolant=interpolants[lastActiveIndex];return void 0===interpolant&&(interpolants[(interpolant=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=lastActiveIndex]=interpolant),interpolant},_takeBackControlInterpolant:function(interpolant){var interpolants=this._controlInterpolants,prevIndex=interpolant.__cacheIndex,firstInactiveIndex=--this._nActiveControlInterpolants,lastActiveInterpolant=interpolants[firstInactiveIndex];interpolants[interpolant.__cacheIndex=firstInactiveIndex]=interpolant,interpolants[lastActiveInterpolant.__cacheIndex=prevIndex]=lastActiveInterpolant},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(clip,optionalRoot){var root=optionalRoot||this._root,rootUuid=root.uuid,clipObject="string"==typeof clip?AnimationClip.findByName(root,clip):clip,clipUuid=null!==clipObject?clipObject.uuid:clip,actionsForClip=this._actionsByClip[clipUuid],prototypeAction=null;if(void 0!==actionsForClip){var existingAction=actionsForClip.actionByRoot[rootUuid];if(void 0!==existingAction)return existingAction;prototypeAction=actionsForClip.knownActions[0],null===clipObject&&(clipObject=prototypeAction._clip)}if(null===clipObject)return null;var newAction=new AnimationAction(this,clipObject,optionalRoot);return this._bindAction(newAction,prototypeAction),this._addInactiveAction(newAction,clipUuid,rootUuid),newAction},existingAction:function(clip,optionalRoot){var root=optionalRoot||this._root,rootUuid=root.uuid,clipObject="string"==typeof clip?AnimationClip.findByName(root,clip):clip,clipUuid=clipObject?clipObject.uuid:clip,actionsForClip=this._actionsByClip[clipUuid];return void 0!==actionsForClip&&actionsForClip.actionByRoot[rootUuid]||null},stopAllAction:function(){var actions=this._actions,nActions=this._nActiveActions,bindings=this._bindings,nBindings=this._nActiveBindings;this._nActiveActions=0;for(var i=this._nActiveBindings=0;i!==nActions;++i)actions[i].reset();for(i=0;i!==nBindings;++i)bindings[i].useCount=0;return this},update:function(deltaTime){deltaTime*=this.timeScale;for(var actions=this._actions,nActions=this._nActiveActions,time=this.time+=deltaTime,timeDirection=Math.sign(deltaTime),accuIndex=this._accuIndex^=1,i=0;i!==nActions;++i){actions[i]._update(time,deltaTime,timeDirection,accuIndex)}var bindings=this._bindings,nBindings=this._nActiveBindings;for(i=0;i!==nBindings;++i)bindings[i].apply(accuIndex);return this},getRoot:function(){return this._root},uncacheClip:function(clip){var actions=this._actions,clipUuid=clip.uuid,actionsByClip=this._actionsByClip,actionsForClip=actionsByClip[clipUuid];if(void 0!==actionsForClip){for(var actionsToRemove=actionsForClip.knownActions,i=0,n=actionsToRemove.length;i!==n;++i){var action=actionsToRemove[i];this._deactivateAction(action);var cacheIndex=action._cacheIndex,lastInactiveAction=actions[actions.length-1];action._cacheIndex=null,action._byClipCacheIndex=null,actions[lastInactiveAction._cacheIndex=cacheIndex]=lastInactiveAction,actions.pop(),this._removeInactiveBindingsForAction(action)}delete actionsByClip[clipUuid]}},uncacheRoot:function(root){var rootUuid=root.uuid,actionsByClip=this._actionsByClip;for(var clipUuid in actionsByClip){var action=actionsByClip[clipUuid].actionByRoot[rootUuid];void 0!==action&&(this._deactivateAction(action),this._removeInactiveAction(action))}var bindingByName=this._bindingsByRootAndName[rootUuid];if(void 0!==bindingByName)for(var trackName in bindingByName){var binding=bindingByName[trackName];binding.restoreOriginalState(),this._removeInactiveBinding(binding)}},uncacheAction:function(clip,optionalRoot){var action=this.existingAction(clip,optionalRoot);null!==action&&(this._deactivateAction(action),this._removeInactiveAction(action))}}),Uniform.prototype.clone=function(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())},InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(source){return BufferGeometry.prototype.copy.call(this,source),this.maxInstancedCount=source.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(source){return InterleavedBuffer.prototype.copy.call(this,source),this.meshPerAttribute=source.meshPerAttribute,this}}),InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(source){return BufferAttribute.prototype.copy.call(this,source),this.meshPerAttribute=source.meshPerAttribute,this}}),Object.assign(Raycaster.prototype,{linePrecision:1,set:function(origin,direction){this.ray.set(origin,direction)},setFromCamera:function(coords,camera){camera&&camera.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(camera.matrixWorld),this.ray.direction.set(coords.x,coords.y,.5).unproject(camera).sub(this.ray.origin).normalize()):camera&&camera.isOrthographicCamera?(this.ray.origin.set(coords.x,coords.y,(camera.near+camera.far)/(camera.near-camera.far)).unproject(camera),this.ray.direction.set(0,0,-1).transformDirection(camera.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(object,recursive,optionalTarget){var intersects=optionalTarget||[];return intersectObject(object,this,intersects,recursive),intersects.sort(ascSort),intersects},intersectObjects:function(objects,recursive,optionalTarget){var intersects=optionalTarget||[];if(!1===Array.isArray(objects))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),intersects;for(var i=0,l=objects.length;i<l;i++)intersectObject(objects[i],this,intersects,recursive);return intersects.sort(ascSort),intersects}}),Object.assign(Spherical.prototype,{set:function(radius,phi,theta){return this.radius=radius,this.phi=phi,this.theta=theta,this},clone:function(){return(new this.constructor).copy(this)},copy:function(other){return this.radius=other.radius,this.phi=other.phi,this.theta=other.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(v){return this.setFromCartesianCoords(v.x,v.y,v.z)},setFromCartesianCoords:function(x,y,z){return this.radius=Math.sqrt(x*x+y*y+z*z),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(x,z),this.phi=Math.acos(_Math.clamp(y/this.radius,-1,1))),this}}),Object.assign(Cylindrical.prototype,{set:function(radius,theta,y){return this.radius=radius,this.theta=theta,this.y=y,this},clone:function(){return(new this.constructor).copy(this)},copy:function(other){return this.radius=other.radius,this.theta=other.theta,this.y=other.y,this},setFromVector3:function(v){return this.setFromCartesianCoords(v.x,v.y,v.z)},setFromCartesianCoords:function(x,y,z){return this.radius=Math.sqrt(x*x+z*z),this.theta=Math.atan2(x,z),this.y=y,this}}),Object.assign(Box2.prototype,{set:function(min,max){return this.min.copy(min),this.max.copy(max),this},setFromPoints:function(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++)this.expandByPoint(points[i]);return this},setFromCenterAndSize:function(){var v1=new Vector2;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);return this.min.copy(center).sub(halfSize),this.max.copy(center).add(halfSize),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(box){return this.min.copy(box.min),this.max.copy(box.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(target){return void 0===target&&(console.warn("THREE.Box2: .getCenter() target is now required"),target=new Vector2),this.isEmpty()?target.set(0,0):target.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(target){return void 0===target&&(console.warn("THREE.Box2: .getSize() target is now required"),target=new Vector2),this.isEmpty()?target.set(0,0):target.subVectors(this.max,this.min)},expandByPoint:function(point){return this.min.min(point),this.max.max(point),this},expandByVector:function(vector){return this.min.sub(vector),this.max.add(vector),this},expandByScalar:function(scalar){return this.min.addScalar(-scalar),this.max.addScalar(scalar),this},containsPoint:function(point){return!(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y)},containsBox:function(box){return this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y},getParameter:function(point,target){return void 0===target&&(console.warn("THREE.Box2: .getParameter() target is now required"),target=new Vector2),target.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(box){return!(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y)},clampPoint:function(point,target){return void 0===target&&(console.warn("THREE.Box2: .clampPoint() target is now required"),target=new Vector2),target.copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new Vector2;return function(point){return v1.copy(point).clamp(this.min,this.max).sub(point).length()}}(),intersect:function(box){return this.min.max(box.min),this.max.min(box.max),this},union:function(box){return this.min.min(box.min),this.max.max(box.max),this},translate:function(offset){return this.min.add(offset),this.max.add(offset),this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)}}),Object.assign(Line3.prototype,{set:function(start,end){return this.start.copy(start),this.end.copy(end),this},clone:function(){return(new this.constructor).copy(this)},copy:function(line){return this.start.copy(line.start),this.end.copy(line.end),this},getCenter:function(target){return void 0===target&&(console.warn("THREE.Line3: .getCenter() target is now required"),target=new Vector3),target.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(target){return void 0===target&&(console.warn("THREE.Line3: .delta() target is now required"),target=new Vector3),target.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,target){return void 0===target&&(console.warn("THREE.Line3: .at() target is now required"),target=new Vector3),this.delta(target).multiplyScalar(t).add(this.start)},closestPointToPointParameter:(startP=new Vector3,startEnd=new Vector3,function(point,clampToLine){startP.subVectors(point,this.start),startEnd.subVectors(this.end,this.start);var startEnd2=startEnd.dot(startEnd),t=startEnd.dot(startP)/startEnd2;return clampToLine&&(t=_Math.clamp(t,0,1)),t}),closestPointToPoint:function(point,clampToLine,target){var t=this.closestPointToPointParameter(point,clampToLine);return void 0===target&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),target=new Vector3),this.delta(target).multiplyScalar(t).add(this.start)},applyMatrix4:function(matrix){return this.start.applyMatrix4(matrix),this.end.applyMatrix4(matrix),this},equals:function(line){return line.start.equals(this.start)&&line.end.equals(this.end)}}),((ImmediateRenderObject.prototype=Object.create(Object3D.prototype)).constructor=ImmediateRenderObject).prototype.isImmediateRenderObject=!0,((VertexNormalsHelper.prototype=Object.create(LineSegments.prototype)).constructor=VertexNormalsHelper).prototype.update=function(){var v1=new Vector3,v2=new Vector3,normalMatrix=new Matrix3;return function(){var keys=["a","b","c"];this.object.updateMatrixWorld(!0),normalMatrix.getNormalMatrix(this.object.matrixWorld);var matrixWorld=this.object.matrixWorld,position=this.geometry.attributes.position,objGeometry=this.object.geometry;if(objGeometry&&objGeometry.isGeometry)for(var vertices=objGeometry.vertices,faces=objGeometry.faces,idx=0,i=0,l=faces.length;i<l;i++)for(var face=faces[i],j=0,jl=face.vertexNormals.length;j<jl;j++){var vertex=vertices[face[keys[j]]],normal=face.vertexNormals[j];v1.copy(vertex).applyMatrix4(matrixWorld),v2.copy(normal).applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1),position.setXYZ(idx,v1.x,v1.y,v1.z),idx+=1,position.setXYZ(idx,v2.x,v2.y,v2.z),idx+=1}else if(objGeometry&&objGeometry.isBufferGeometry){var objPos=objGeometry.attributes.position,objNorm=objGeometry.attributes.normal;for(idx=0,j=0,jl=objPos.count;j<jl;j++)v1.set(objPos.getX(j),objPos.getY(j),objPos.getZ(j)).applyMatrix4(matrixWorld),v2.set(objNorm.getX(j),objNorm.getY(j),objNorm.getZ(j)),v2.applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1),position.setXYZ(idx,v1.x,v1.y,v1.z),idx+=1,position.setXYZ(idx,v2.x,v2.y,v2.z),idx+=1}position.needsUpdate=!0}}(),((SpotLightHelper.prototype=Object.create(Object3D.prototype)).constructor=SpotLightHelper).prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},SpotLightHelper.prototype.update=function(){var vector=new Vector3;return function(){this.light.updateMatrixWorld();var coneLength=this.light.distance?this.light.distance:1e3,coneWidth=coneLength*Math.tan(this.light.angle);this.cone.scale.set(coneWidth,coneWidth,coneLength),vector.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(vector),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),((SkeletonHelper.prototype=Object.create(LineSegments.prototype)).constructor=SkeletonHelper).prototype.updateMatrixWorld=function(){var vector=new Vector3,boneMatrix=new Matrix4,matrixWorldInv=new Matrix4;return function(force){var bones=this.bones,geometry=this.geometry,position=geometry.getAttribute("position");matrixWorldInv.getInverse(this.root.matrixWorld);for(var i=0,j=0;i<bones.length;i++){var bone=bones[i];bone.parent&&bone.parent.isBone&&(boneMatrix.multiplyMatrices(matrixWorldInv,bone.matrixWorld),vector.setFromMatrixPosition(boneMatrix),position.setXYZ(j,vector.x,vector.y,vector.z),boneMatrix.multiplyMatrices(matrixWorldInv,bone.parent.matrixWorld),vector.setFromMatrixPosition(boneMatrix),position.setXYZ(j+1,vector.x,vector.y,vector.z),j+=2)}geometry.getAttribute("position").needsUpdate=!0,Object3D.prototype.updateMatrixWorld.call(this,force)}}(),((PointLightHelper.prototype=Object.create(Mesh.prototype)).constructor=PointLightHelper).prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},PointLightHelper.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},((RectAreaLightHelper.prototype=Object.create(Line.prototype)).constructor=RectAreaLightHelper).prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var c=this.material.color,max=Math.max(c.r,c.g,c.b);1<max&&c.multiplyScalar(1/max),this.children[0].material.color.copy(this.material.color)}},RectAreaLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()},((HemisphereLightHelper.prototype=Object.create(Object3D.prototype)).constructor=HemisphereLightHelper).prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},HemisphereLightHelper.prototype.update=function(){var vector=new Vector3,color1=new Color,color2=new Color;return function(){var mesh=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var colors=mesh.geometry.getAttribute("color");color1.copy(this.light.color),color2.copy(this.light.groundColor);for(var i=0,l=colors.count;i<l;i++){var color=i<l/2?color1:color2;colors.setXYZ(i,color.r,color.g,color.b)}colors.needsUpdate=!0}mesh.lookAt(vector.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),((LightProbeHelper.prototype=Object.create(Mesh.prototype)).constructor=LightProbeHelper).prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},LightProbeHelper.prototype.onBeforeRender=function(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity},GridHelper.prototype=Object.assign(Object.create(LineSegments.prototype),{constructor:GridHelper,copy:function(source){return LineSegments.prototype.copy.call(this,source),this.geometry.copy(source.geometry),this.material.copy(source.material),this},clone:function(){return(new this.constructor).copy(this)}}),(PolarGridHelper.prototype=Object.create(LineSegments.prototype)).constructor=PolarGridHelper,((PositionalAudioHelper.prototype=Object.create(Line.prototype)).constructor=PositionalAudioHelper).prototype.update=function(){var i,stride,audio=this.audio,range=this.range,divisionsInnerAngle=this.divisionsInnerAngle,divisionsOuterAngle=this.divisionsOuterAngle,coneInnerAngle=_Math.degToRad(audio.panner.coneInnerAngle),coneOuterAngle=_Math.degToRad(audio.panner.coneOuterAngle),halfConeInnerAngle=coneInnerAngle/2,halfConeOuterAngle=coneOuterAngle/2,start=0,count=0,geometry=this.geometry,positionAttribute=geometry.attributes.position;function generateSegment(from,to,divisions,materialIndex){var step=(to-from)/divisions;for(positionAttribute.setXYZ(start,0,0,0),count++,i=from;i<to;i+=step)stride=start+count,positionAttribute.setXYZ(stride,Math.sin(i)*range,0,Math.cos(i)*range),positionAttribute.setXYZ(stride+1,Math.sin(Math.min(i+step,to))*range,0,Math.cos(Math.min(i+step,to))*range),positionAttribute.setXYZ(stride+2,0,0,0),count+=3;geometry.addGroup(start,count,materialIndex),start+=count,count=0}geometry.clearGroups(),generateSegment(-halfConeOuterAngle,-halfConeInnerAngle,divisionsOuterAngle,0),generateSegment(-halfConeInnerAngle,halfConeInnerAngle,divisionsInnerAngle,1),generateSegment(halfConeInnerAngle,halfConeOuterAngle,divisionsOuterAngle,0),positionAttribute.needsUpdate=!0,coneInnerAngle===coneOuterAngle&&(this.material[0].visible=!1)},PositionalAudioHelper.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()},((FaceNormalsHelper.prototype=Object.create(LineSegments.prototype)).constructor=FaceNormalsHelper).prototype.update=function(){var v1=new Vector3,v2=new Vector3,normalMatrix=new Matrix3;return function(){this.object.updateMatrixWorld(!0),normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var matrixWorld=this.object.matrixWorld,position=this.geometry.attributes.position,objGeometry=this.object.geometry,vertices=objGeometry.vertices,faces=objGeometry.faces,idx=0,i=0,l=faces.length;i<l;i++){var face=faces[i],normal=face.normal;v1.copy(vertices[face.a]).add(vertices[face.b]).add(vertices[face.c]).divideScalar(3).applyMatrix4(matrixWorld),v2.copy(normal).applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1),position.setXYZ(idx,v1.x,v1.y,v1.z),idx+=1,position.setXYZ(idx,v2.x,v2.y,v2.z),idx+=1}position.needsUpdate=!0}}(),((DirectionalLightHelper.prototype=Object.create(Object3D.prototype)).constructor=DirectionalLightHelper).prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},DirectionalLightHelper.prototype.update=function(){var v1=new Vector3,v2=new Vector3,v3=new Vector3;return function(){v1.setFromMatrixPosition(this.light.matrixWorld),v2.setFromMatrixPosition(this.light.target.matrixWorld),v3.subVectors(v2,v1),this.lightPlane.lookAt(v2),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(v2),this.targetLine.scale.z=v3.length()}}(),((CameraHelper.prototype=Object.create(LineSegments.prototype)).constructor=CameraHelper).prototype.update=function(){var geometry,pointMap,vector=new Vector3,camera=new Camera;function setPoint(point,x,y,z){vector.set(x,y,z).unproject(camera);var points=pointMap[point];if(void 0!==points)for(var position=geometry.getAttribute("position"),i=0,l=points.length;i<l;i++)position.setXYZ(points[i],vector.x,vector.y,vector.z)}return function(){geometry=this.geometry,pointMap=this.pointMap;camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",0,0,-1),setPoint("t",0,0,1),setPoint("n1",-1,-1,-1),setPoint("n2",1,-1,-1),setPoint("n3",-1,1,-1),setPoint("n4",1,1,-1),setPoint("f1",-1,-1,1),setPoint("f2",1,-1,1),setPoint("f3",-1,1,1),setPoint("f4",1,1,1),setPoint("u1",.7,1.1,-1),setPoint("u2",-.7,1.1,-1),setPoint("u3",0,2,-1),setPoint("cf1",-1,0,1),setPoint("cf2",1,0,1),setPoint("cf3",0,-1,1),setPoint("cf4",0,1,1),setPoint("cn1",-1,0,-1),setPoint("cn2",1,0,-1),setPoint("cn3",0,-1,-1),setPoint("cn4",0,1,-1),geometry.getAttribute("position").needsUpdate=!0}}(),((BoxHelper.prototype=Object.create(LineSegments.prototype)).constructor=BoxHelper).prototype.update=function(){var box=new Box3;return function(object){if(void 0!==object&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&box.setFromObject(this.object),!box.isEmpty()){var min=box.min,max=box.max,position=this.geometry.attributes.position,array=position.array;array[0]=max.x,array[1]=max.y,array[2]=max.z,array[3]=min.x,array[4]=max.y,array[5]=max.z,array[6]=min.x,array[7]=min.y,array[8]=max.z,array[9]=max.x,array[10]=min.y,array[11]=max.z,array[12]=max.x,array[13]=max.y,array[14]=min.z,array[15]=min.x,array[16]=max.y,array[17]=min.z,array[18]=min.x,array[19]=min.y,array[20]=min.z,array[21]=max.x,array[22]=min.y,array[23]=min.z,position.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),BoxHelper.prototype.setFromObject=function(object){return this.object=object,this.update(),this},BoxHelper.prototype.copy=function(source){return LineSegments.prototype.copy.call(this,source),this.object=source.object,this},BoxHelper.prototype.clone=function(){return(new this.constructor).copy(this)},((Box3Helper.prototype=Object.create(LineSegments.prototype)).constructor=Box3Helper).prototype.updateMatrixWorld=function(force){var box=this.box;box.isEmpty()||(box.getCenter(this.position),box.getSize(this.scale),this.scale.multiplyScalar(.5),Object3D.prototype.updateMatrixWorld.call(this,force))},((PlaneHelper.prototype=Object.create(Line.prototype)).constructor=PlaneHelper).prototype.updateMatrixWorld=function(force){var scale=-this.plane.constant;Math.abs(scale)<1e-8&&(scale=1e-8),this.scale.set(.5*this.size,.5*this.size,scale),this.children[0].material.side=scale<0?BackSide:FrontSide,this.lookAt(this.plane.normal),Object3D.prototype.updateMatrixWorld.call(this,force)},((ArrowHelper.prototype=Object.create(Object3D.prototype)).constructor=ArrowHelper).prototype.setDirection=(axis=new Vector3,function(dir){.99999<dir.y?this.quaternion.set(0,0,0,1):dir.y<-.99999?this.quaternion.set(1,0,0,0):(axis.set(dir.z,0,-dir.x).normalize(),radians=Math.acos(dir.y),this.quaternion.setFromAxisAngle(axis,radians))}),ArrowHelper.prototype.setLength=function(length,headLength,headWidth){void 0===headLength&&(headLength=.2*length),void 0===headWidth&&(headWidth=.2*headLength),this.line.scale.set(1,Math.max(0,length-headLength),1),this.line.updateMatrix(),this.cone.scale.set(headWidth,headLength,headWidth),this.cone.position.y=length,this.cone.updateMatrix()},ArrowHelper.prototype.setColor=function(color){this.line.material.color.copy(color),this.cone.material.color.copy(color)},ArrowHelper.prototype.copy=function(source){return Object3D.prototype.copy.call(this,source,!1),this.line.copy(source.line),this.cone.copy(source.cone),this},ArrowHelper.prototype.clone=function(){return(new this.constructor).copy(this)},(AxesHelper.prototype=Object.create(LineSegments.prototype)).constructor=AxesHelper;function ClosedSplineCurve3(points){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,points),this.type="catmullrom",this.closed=!0}function SplineCurve3(points){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,points),this.type="catmullrom"}function Spline(points){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,points),this.type="catmullrom"}Curve.create=function(construct,getPoint){return console.log("THREE.Curve.create() has been deprecated"),construct.prototype=Object.create(Curve.prototype),(construct.prototype.constructor=construct).prototype.getPoint=getPoint,construct},Object.assign(CurvePath.prototype,{createPointsGeometry:function(divisions){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var pts=this.getPoints(divisions);return this.createGeometry(pts)},createSpacedPointsGeometry:function(divisions){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var pts=this.getSpacedPoints(divisions);return this.createGeometry(pts)},createGeometry:function(points){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var geometry=new Geometry,i=0,l=points.length;i<l;i++){var point=points[i];geometry.vertices.push(new Vector3(point.x,point.y,point.z||0))}return geometry}}),Object.assign(Path.prototype,{fromPoints:function(points){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(points)}}),ClosedSplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),SplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),Spline.prototype=Object.create(CatmullRomCurve3.prototype),Object.assign(Spline.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Loader.prototype,{extractUrlBase:function(url){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),LoaderUtils.extractUrlBase(url)}}),Object.assign(ObjectLoader.prototype,{setTexturePath:function(value){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(value)}}),Object.assign(Box2.prototype,{center:function(optionalTarget){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(optionalTarget)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(box){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(box)},size:function(optionalTarget){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(optionalTarget)}}),Object.assign(Box3.prototype,{center:function(optionalTarget){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(optionalTarget)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(box){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(box)},isIntersectionSphere:function(sphere){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(sphere)},size:function(optionalTarget){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(optionalTarget)}}),Line3.prototype.center=function(optionalTarget){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(optionalTarget)},Object.assign(_Math,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(value){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),_Math.floorPowerOfTwo(value)},nextPowerOfTwo:function(value){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),_Math.ceilPowerOfTwo(value)}}),Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(array,offset){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(array,offset)},multiplyVector3:function(vector){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),vector.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(buffer){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(buffer)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Matrix4.prototype,{extractPosition:function(m){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(m)},flattenToArrayOffset:function(array,offset){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(array,offset)},getPosition:function(){var v1;return function(){return void 0===v1&&(v1=new Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),v1.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(q){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(q)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(vector){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),vector.applyMatrix4(this)},multiplyVector4:function(vector){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),vector.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(v){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),v.transformDirection(this)},crossVector:function(vector){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),vector.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(buffer){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(buffer)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(left,right,bottom,top,near,far){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(left,right,top,bottom,near,far)}}),Plane.prototype.isIntersectionLine=function(line){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(line)},Quaternion.prototype.multiplyVector3=function(vector){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),vector.applyQuaternion(this)},Object.assign(Ray.prototype,{isIntersectionBox:function(box){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(box)},isIntersectionPlane:function(plane){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(plane)},isIntersectionSphere:function(sphere){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(sphere)}}),Object.assign(Triangle.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(point,target){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(point,target)},midpoint:function(target){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(target)},normal:function(target){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(target)},plane:function(target){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(target)}}),Object.assign(Triangle,{barycoordFromPoint:function(point,a,b,c,target){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(point,a,b,c,target)},normal:function(a,b,c,target){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(a,b,c,target)}}),Object.assign(Shape.prototype,{extractAllPoints:function(divisions){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(divisions)},extrude:function(options){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,options)},makeGeometry:function(options){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,options)}}),Object.assign(Vector2.prototype,{fromAttribute:function(attribute,index,offset){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(attribute,index,offset)},distanceToManhattan:function(v){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(v)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(m){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(m)},getScaleFromMatrix:function(m){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(m)},getColumnFromMatrix:function(index,matrix){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(matrix,index)},applyProjection:function(m){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(m)},fromAttribute:function(attribute,index,offset){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(attribute,index,offset)},distanceToManhattan:function(v){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(v)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector4.prototype,{fromAttribute:function(attribute,index,offset){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(attribute,index,offset)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Geometry.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(Object3D.prototype,{getChildByName:function(name){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(name)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(distance,axis){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(axis,distance)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(value){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=value}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(value){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=value}}),PerspectiveCamera.prototype.setLens=function(focalLength,filmGauge){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==filmGauge&&(this.filmGauge=filmGauge),this.setFocalLength(focalLength)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(value){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=value}},shadowCameraLeft:{set:function(value){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=value}},shadowCameraRight:{set:function(value){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=value}},shadowCameraTop:{set:function(value){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=value}},shadowCameraBottom:{set:function(value){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=value}},shadowCameraNear:{set:function(value){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=value}},shadowCameraFar:{set:function(value){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=value}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(value){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=value}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(value){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=value}},shadowMapHeight:{set:function(value){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=value}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(BufferGeometry.prototype,{addIndex:function(index){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(index)},addDrawCall:function(start,count,indexOffset){void 0!==indexOffset&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(start,count)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(ExtrudeBufferGeometry.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Uniform.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(value){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===value}}}),Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(value){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=value}}}),Object.assign(WebGLRenderer.prototype,{clearTarget:function(renderTarget,color,depth,stencil){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(renderTarget),this.clear(color,depth,stencil)},animate:function(callback){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(callback)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(boolean){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(boolean)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")}}),Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(value){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=value}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(value){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=value}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLRenderTargetCube.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(value){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=value}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(value){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=value}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(value){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=value}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(value){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=value}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(value){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=value}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(value){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=value}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(value){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=value}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(value){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=value}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(value){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=value}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(value){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=value}}}),Object.defineProperties(WebVRManager.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),Audio.prototype.load=function(file){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var scope=this;return(new AudioLoader).load(file,function(buffer){scope.setBuffer(buffer)}),this},AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},CubeCamera.prototype.updateCubeMap=function(renderer,scene){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(renderer,scene)};var GeometryUtils={merge:function(geometry1,geometry2,materialIndexOffset){var matrix;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),geometry2.isMesh&&(geometry2.matrixAutoUpdate&&geometry2.updateMatrix(),matrix=geometry2.matrix,geometry2=geometry2.geometry),geometry1.merge(geometry2,matrix,materialIndexOffset)},center:function(geometry){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),geometry.center()}};ImageUtils.crossOrigin=void 0,ImageUtils.loadTexture=function(url,mapping,onLoad,onError){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var loader=new TextureLoader;loader.setCrossOrigin(this.crossOrigin);var texture=loader.load(url,onLoad,void 0,onError);return mapping&&(texture.mapping=mapping),texture},ImageUtils.loadTextureCube=function(urls,mapping,onLoad,onError){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var loader=new CubeTextureLoader;loader.setCrossOrigin(this.crossOrigin);var texture=loader.load(urls,onLoad,void 0,onError);return mapping&&(texture.mapping=mapping),texture},ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};exports.WebGLMultisampleRenderTarget=WebGLMultisampleRenderTarget,exports.WebGLRenderTargetCube=WebGLRenderTargetCube,exports.WebGLRenderTarget=WebGLRenderTarget,exports.WebGLRenderer=WebGLRenderer,exports.ShaderLib=ShaderLib,exports.UniformsLib=UniformsLib,exports.UniformsUtils=UniformsUtils,exports.ShaderChunk=ShaderChunk,exports.FogExp2=FogExp2,exports.Fog=Fog,exports.Scene=Scene,exports.Sprite=Sprite,exports.LOD=LOD,exports.SkinnedMesh=SkinnedMesh,exports.Skeleton=Skeleton,exports.Bone=Bone,exports.Mesh=Mesh,exports.LineSegments=LineSegments,exports.LineLoop=LineLoop,exports.Line=Line,exports.Points=Points,exports.Group=Group,exports.VideoTexture=VideoTexture,exports.DataTexture=DataTexture,exports.DataTexture2DArray=DataTexture2DArray,exports.DataTexture3D=DataTexture3D,exports.CompressedTexture=CompressedTexture,exports.CubeTexture=CubeTexture,exports.CanvasTexture=CanvasTexture,exports.DepthTexture=DepthTexture,exports.Texture=Texture,exports.AnimationLoader=AnimationLoader,exports.CompressedTextureLoader=CompressedTextureLoader,exports.DataTextureLoader=DataTextureLoader,exports.CubeTextureLoader=CubeTextureLoader,exports.TextureLoader=TextureLoader,exports.ObjectLoader=ObjectLoader,exports.MaterialLoader=MaterialLoader,exports.BufferGeometryLoader=BufferGeometryLoader,exports.DefaultLoadingManager=DefaultLoadingManager,exports.LoadingManager=LoadingManager,exports.ImageLoader=ImageLoader,exports.ImageBitmapLoader=ImageBitmapLoader,exports.FontLoader=FontLoader,exports.FileLoader=FileLoader,exports.Loader=Loader,exports.LoaderUtils=LoaderUtils,exports.Cache=Cache,exports.AudioLoader=AudioLoader,exports.SpotLightShadow=SpotLightShadow,exports.SpotLight=SpotLight,exports.PointLight=PointLight,exports.RectAreaLight=RectAreaLight,exports.HemisphereLight=HemisphereLight,exports.HemisphereLightProbe=HemisphereLightProbe,exports.DirectionalLightShadow=DirectionalLightShadow,exports.DirectionalLight=DirectionalLight,exports.AmbientLight=AmbientLight,exports.AmbientLightProbe=AmbientLightProbe,exports.LightShadow=LightShadow,exports.Light=Light,exports.LightProbe=LightProbe,exports.StereoCamera=StereoCamera,exports.PerspectiveCamera=PerspectiveCamera,exports.OrthographicCamera=OrthographicCamera,exports.CubeCamera=CubeCamera,exports.ArrayCamera=ArrayCamera,exports.Camera=Camera,exports.AudioListener=AudioListener,exports.PositionalAudio=PositionalAudio,exports.AudioContext=AudioContext,exports.AudioAnalyser=AudioAnalyser,exports.Audio=Audio,exports.VectorKeyframeTrack=VectorKeyframeTrack,exports.StringKeyframeTrack=StringKeyframeTrack,exports.QuaternionKeyframeTrack=QuaternionKeyframeTrack,exports.NumberKeyframeTrack=NumberKeyframeTrack,exports.ColorKeyframeTrack=ColorKeyframeTrack,exports.BooleanKeyframeTrack=BooleanKeyframeTrack,exports.PropertyMixer=PropertyMixer,exports.PropertyBinding=PropertyBinding,exports.KeyframeTrack=KeyframeTrack,exports.AnimationUtils=AnimationUtils,exports.AnimationObjectGroup=AnimationObjectGroup,exports.AnimationMixer=AnimationMixer,exports.AnimationClip=AnimationClip,exports.Uniform=Uniform,exports.InstancedBufferGeometry=InstancedBufferGeometry,exports.BufferGeometry=BufferGeometry,exports.Geometry=Geometry,exports.InterleavedBufferAttribute=InterleavedBufferAttribute,exports.InstancedInterleavedBuffer=InstancedInterleavedBuffer,exports.InterleavedBuffer=InterleavedBuffer,exports.InstancedBufferAttribute=InstancedBufferAttribute,exports.Face3=Face3,exports.Object3D=Object3D,exports.Raycaster=Raycaster,exports.Layers=Layers,exports.EventDispatcher=EventDispatcher,exports.Clock=Clock,exports.QuaternionLinearInterpolant=QuaternionLinearInterpolant,exports.LinearInterpolant=LinearInterpolant,exports.DiscreteInterpolant=DiscreteInterpolant,exports.CubicInterpolant=CubicInterpolant,exports.Interpolant=Interpolant,exports.Triangle=Triangle,exports.Math=_Math,exports.Spherical=Spherical,exports.Cylindrical=Cylindrical,exports.Plane=Plane,exports.Frustum=Frustum,exports.Sphere=Sphere,exports.Ray=Ray,exports.Matrix4=Matrix4,exports.Matrix3=Matrix3,exports.Box3=Box3,exports.Box2=Box2,exports.Line3=Line3,exports.Euler=Euler,exports.Vector4=Vector4,exports.Vector3=Vector3,exports.Vector2=Vector2,exports.Quaternion=Quaternion,exports.Color=Color,exports.SphericalHarmonics3=SphericalHarmonics3,exports.ImmediateRenderObject=ImmediateRenderObject,exports.VertexNormalsHelper=VertexNormalsHelper,exports.SpotLightHelper=SpotLightHelper,exports.SkeletonHelper=SkeletonHelper,exports.PointLightHelper=PointLightHelper,exports.RectAreaLightHelper=RectAreaLightHelper,exports.HemisphereLightHelper=HemisphereLightHelper,exports.LightProbeHelper=LightProbeHelper,exports.GridHelper=GridHelper,exports.PolarGridHelper=PolarGridHelper,exports.PositionalAudioHelper=PositionalAudioHelper,exports.FaceNormalsHelper=FaceNormalsHelper,exports.DirectionalLightHelper=DirectionalLightHelper,exports.CameraHelper=CameraHelper,exports.BoxHelper=BoxHelper,exports.Box3Helper=Box3Helper,exports.PlaneHelper=PlaneHelper,exports.ArrowHelper=ArrowHelper,exports.AxesHelper=AxesHelper,exports.Shape=Shape,exports.Path=Path,exports.ShapePath=ShapePath,exports.Font=Font,exports.CurvePath=CurvePath,exports.Curve=Curve,exports.ImageUtils=ImageUtils,exports.ShapeUtils=ShapeUtils,exports.WebGLUtils=WebGLUtils,exports.WireframeGeometry=WireframeGeometry,exports.ParametricGeometry=ParametricGeometry,exports.ParametricBufferGeometry=ParametricBufferGeometry,exports.TetrahedronGeometry=TetrahedronGeometry,exports.TetrahedronBufferGeometry=TetrahedronBufferGeometry,exports.OctahedronGeometry=OctahedronGeometry,exports.OctahedronBufferGeometry=OctahedronBufferGeometry,exports.IcosahedronGeometry=IcosahedronGeometry,exports.IcosahedronBufferGeometry=IcosahedronBufferGeometry,exports.DodecahedronGeometry=DodecahedronGeometry,exports.DodecahedronBufferGeometry=DodecahedronBufferGeometry,exports.PolyhedronGeometry=PolyhedronGeometry,exports.PolyhedronBufferGeometry=PolyhedronBufferGeometry,exports.TubeGeometry=TubeGeometry,exports.TubeBufferGeometry=TubeBufferGeometry,exports.TorusKnotGeometry=TorusKnotGeometry,exports.TorusKnotBufferGeometry=TorusKnotBufferGeometry,exports.TorusGeometry=TorusGeometry,exports.TorusBufferGeometry=TorusBufferGeometry,exports.TextGeometry=TextGeometry,exports.TextBufferGeometry=TextBufferGeometry,exports.SphereGeometry=SphereGeometry,exports.SphereBufferGeometry=SphereBufferGeometry,exports.RingGeometry=RingGeometry,exports.RingBufferGeometry=RingBufferGeometry,exports.PlaneGeometry=PlaneGeometry,exports.PlaneBufferGeometry=PlaneBufferGeometry,exports.LatheGeometry=LatheGeometry,exports.LatheBufferGeometry=LatheBufferGeometry,exports.ShapeGeometry=ShapeGeometry,exports.ShapeBufferGeometry=ShapeBufferGeometry,exports.ExtrudeGeometry=ExtrudeGeometry,exports.ExtrudeBufferGeometry=ExtrudeBufferGeometry,exports.EdgesGeometry=EdgesGeometry,exports.ConeGeometry=ConeGeometry,exports.ConeBufferGeometry=ConeBufferGeometry,exports.CylinderGeometry=CylinderGeometry,exports.CylinderBufferGeometry=CylinderBufferGeometry,exports.CircleGeometry=CircleGeometry,exports.CircleBufferGeometry=CircleBufferGeometry,exports.BoxGeometry=BoxGeometry,exports.CubeGeometry=BoxGeometry,exports.BoxBufferGeometry=BoxBufferGeometry,exports.ShadowMaterial=ShadowMaterial,exports.SpriteMaterial=SpriteMaterial,exports.RawShaderMaterial=RawShaderMaterial,exports.ShaderMaterial=ShaderMaterial,exports.PointsMaterial=PointsMaterial,exports.MeshPhysicalMaterial=MeshPhysicalMaterial,exports.MeshStandardMaterial=MeshStandardMaterial,exports.MeshPhongMaterial=MeshPhongMaterial,exports.MeshToonMaterial=MeshToonMaterial,exports.MeshNormalMaterial=MeshNormalMaterial,exports.MeshLambertMaterial=MeshLambertMaterial,exports.MeshDepthMaterial=MeshDepthMaterial,exports.MeshDistanceMaterial=MeshDistanceMaterial,exports.MeshBasicMaterial=MeshBasicMaterial,exports.MeshMatcapMaterial=MeshMatcapMaterial,exports.LineDashedMaterial=LineDashedMaterial,exports.LineBasicMaterial=LineBasicMaterial,exports.Material=Material,exports.Float64BufferAttribute=Float64BufferAttribute,exports.Float32BufferAttribute=Float32BufferAttribute,exports.Uint32BufferAttribute=Uint32BufferAttribute,exports.Int32BufferAttribute=Int32BufferAttribute,exports.Uint16BufferAttribute=Uint16BufferAttribute,exports.Int16BufferAttribute=Int16BufferAttribute,exports.Uint8ClampedBufferAttribute=Uint8ClampedBufferAttribute,exports.Uint8BufferAttribute=Uint8BufferAttribute,exports.Int8BufferAttribute=Int8BufferAttribute,exports.BufferAttribute=BufferAttribute,exports.ArcCurve=ArcCurve,exports.CatmullRomCurve3=CatmullRomCurve3,exports.CubicBezierCurve=CubicBezierCurve,exports.CubicBezierCurve3=CubicBezierCurve3,exports.EllipseCurve=EllipseCurve,exports.LineCurve=LineCurve,exports.LineCurve3=LineCurve3,exports.QuadraticBezierCurve=QuadraticBezierCurve,exports.QuadraticBezierCurve3=QuadraticBezierCurve3,exports.SplineCurve=SplineCurve,exports.REVISION="104",exports.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},exports.CullFaceNone=CullFaceNone,exports.CullFaceBack=CullFaceBack,exports.CullFaceFront=CullFaceFront,exports.CullFaceFrontBack=3,exports.FrontFaceDirectionCW=0,exports.FrontFaceDirectionCCW=1,exports.BasicShadowMap=0,exports.PCFShadowMap=PCFShadowMap,exports.PCFSoftShadowMap=PCFSoftShadowMap,exports.FrontSide=FrontSide,exports.BackSide=BackSide,exports.DoubleSide=DoubleSide,exports.FlatShading=1,exports.SmoothShading=2,exports.NoColors=NoColors,exports.FaceColors=1,exports.VertexColors=VertexColors,exports.NoBlending=NoBlending,exports.NormalBlending=NormalBlending,exports.AdditiveBlending=AdditiveBlending,exports.SubtractiveBlending=SubtractiveBlending,exports.MultiplyBlending=MultiplyBlending,exports.CustomBlending=CustomBlending,exports.AddEquation=AddEquation,exports.SubtractEquation=SubtractEquation,exports.ReverseSubtractEquation=ReverseSubtractEquation,exports.MinEquation=MinEquation,exports.MaxEquation=MaxEquation,exports.ZeroFactor=ZeroFactor,exports.OneFactor=OneFactor,exports.SrcColorFactor=SrcColorFactor,exports.OneMinusSrcColorFactor=OneMinusSrcColorFactor,exports.SrcAlphaFactor=SrcAlphaFactor,exports.OneMinusSrcAlphaFactor=OneMinusSrcAlphaFactor,exports.DstAlphaFactor=DstAlphaFactor,exports.OneMinusDstAlphaFactor=OneMinusDstAlphaFactor,exports.DstColorFactor=DstColorFactor,exports.OneMinusDstColorFactor=OneMinusDstColorFactor,exports.SrcAlphaSaturateFactor=SrcAlphaSaturateFactor,exports.NeverDepth=NeverDepth,exports.AlwaysDepth=AlwaysDepth,exports.LessDepth=LessDepth,exports.LessEqualDepth=LessEqualDepth,exports.EqualDepth=EqualDepth,exports.GreaterEqualDepth=GreaterEqualDepth,exports.GreaterDepth=GreaterDepth,exports.NotEqualDepth=NotEqualDepth,exports.MultiplyOperation=MultiplyOperation,exports.MixOperation=MixOperation,exports.AddOperation=AddOperation,exports.NoToneMapping=NoToneMapping,exports.LinearToneMapping=LinearToneMapping,exports.ReinhardToneMapping=ReinhardToneMapping,exports.Uncharted2ToneMapping=Uncharted2ToneMapping,exports.CineonToneMapping=CineonToneMapping,exports.ACESFilmicToneMapping=ACESFilmicToneMapping,exports.UVMapping=300,exports.CubeReflectionMapping=CubeReflectionMapping,exports.CubeRefractionMapping=CubeRefractionMapping,exports.EquirectangularReflectionMapping=EquirectangularReflectionMapping,exports.EquirectangularRefractionMapping=EquirectangularRefractionMapping,exports.SphericalReflectionMapping=SphericalReflectionMapping,exports.CubeUVReflectionMapping=CubeUVReflectionMapping,exports.CubeUVRefractionMapping=CubeUVRefractionMapping,exports.RepeatWrapping=RepeatWrapping,exports.ClampToEdgeWrapping=ClampToEdgeWrapping,exports.MirroredRepeatWrapping=MirroredRepeatWrapping,exports.NearestFilter=NearestFilter,exports.NearestMipMapNearestFilter=NearestMipMapNearestFilter,exports.NearestMipMapLinearFilter=NearestMipMapLinearFilter,exports.LinearFilter=LinearFilter,exports.LinearMipMapNearestFilter=LinearMipMapNearestFilter,exports.LinearMipMapLinearFilter=LinearMipMapLinearFilter,exports.UnsignedByteType=UnsignedByteType,exports.ByteType=ByteType,exports.ShortType=ShortType,exports.UnsignedShortType=UnsignedShortType,exports.IntType=IntType,exports.UnsignedIntType=UnsignedIntType,exports.FloatType=FloatType,exports.HalfFloatType=HalfFloatType,exports.UnsignedShort4444Type=UnsignedShort4444Type,exports.UnsignedShort5551Type=UnsignedShort5551Type,exports.UnsignedShort565Type=UnsignedShort565Type,exports.UnsignedInt248Type=UnsignedInt248Type,exports.AlphaFormat=AlphaFormat,exports.RGBFormat=RGBFormat,exports.RGBAFormat=RGBAFormat,exports.LuminanceFormat=LuminanceFormat,exports.LuminanceAlphaFormat=LuminanceAlphaFormat,exports.RGBEFormat=RGBEFormat,exports.DepthFormat=DepthFormat,exports.DepthStencilFormat=DepthStencilFormat,exports.RedFormat=RedFormat,exports.RGB_S3TC_DXT1_Format=RGB_S3TC_DXT1_Format,exports.RGBA_S3TC_DXT1_Format=RGBA_S3TC_DXT1_Format,exports.RGBA_S3TC_DXT3_Format=RGBA_S3TC_DXT3_Format,exports.RGBA_S3TC_DXT5_Format=RGBA_S3TC_DXT5_Format,exports.RGB_PVRTC_4BPPV1_Format=RGB_PVRTC_4BPPV1_Format,exports.RGB_PVRTC_2BPPV1_Format=RGB_PVRTC_2BPPV1_Format,exports.RGBA_PVRTC_4BPPV1_Format=RGBA_PVRTC_4BPPV1_Format,exports.RGBA_PVRTC_2BPPV1_Format=RGBA_PVRTC_2BPPV1_Format,exports.RGB_ETC1_Format=RGB_ETC1_Format,exports.RGBA_ASTC_4x4_Format=RGBA_ASTC_4x4_Format,exports.RGBA_ASTC_5x4_Format=RGBA_ASTC_5x4_Format,exports.RGBA_ASTC_5x5_Format=RGBA_ASTC_5x5_Format,exports.RGBA_ASTC_6x5_Format=RGBA_ASTC_6x5_Format,exports.RGBA_ASTC_6x6_Format=RGBA_ASTC_6x6_Format,exports.RGBA_ASTC_8x5_Format=RGBA_ASTC_8x5_Format,exports.RGBA_ASTC_8x6_Format=RGBA_ASTC_8x6_Format,exports.RGBA_ASTC_8x8_Format=RGBA_ASTC_8x8_Format,exports.RGBA_ASTC_10x5_Format=RGBA_ASTC_10x5_Format,exports.RGBA_ASTC_10x6_Format=RGBA_ASTC_10x6_Format,exports.RGBA_ASTC_10x8_Format=RGBA_ASTC_10x8_Format,exports.RGBA_ASTC_10x10_Format=RGBA_ASTC_10x10_Format,exports.RGBA_ASTC_12x10_Format=RGBA_ASTC_12x10_Format,exports.RGBA_ASTC_12x12_Format=RGBA_ASTC_12x12_Format,exports.LoopOnce=2200,exports.LoopRepeat=2201,exports.LoopPingPong=2202,exports.InterpolateDiscrete=2300,exports.InterpolateLinear=2301,exports.InterpolateSmooth=2302,exports.ZeroCurvatureEnding=2400,exports.ZeroSlopeEnding=2401,exports.WrapAroundEnding=2402,exports.TrianglesDrawMode=TrianglesDrawMode,exports.TriangleStripDrawMode=1,exports.TriangleFanDrawMode=2,exports.LinearEncoding=LinearEncoding,exports.sRGBEncoding=sRGBEncoding,exports.GammaEncoding=GammaEncoding,exports.RGBEEncoding=RGBEEncoding,exports.LogLuvEncoding=3003,exports.RGBM7Encoding=RGBM7Encoding,exports.RGBM16Encoding=RGBM16Encoding,exports.RGBDEncoding=RGBDEncoding,exports.BasicDepthPacking=BasicDepthPacking,exports.RGBADepthPacking=RGBADepthPacking,exports.TangentSpaceNormalMap=TangentSpaceNormalMap,exports.ObjectSpaceNormalMap=ObjectSpaceNormalMap,exports.Face4=function(a,b,c,d,normal,color,materialIndex){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Face3(a,b,c,normal,color,materialIndex)},exports.LineStrip=0,exports.LinePieces=1,exports.MeshFaceMaterial=function(materials){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),materials},exports.MultiMaterial=function(materials){return void 0===materials&&(materials=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),materials.isMultiMaterial=!0,(materials.materials=materials).clone=function(){return materials.slice()},materials},exports.PointCloud=function(geometry,material){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(geometry,material)},exports.Particle=function(material){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(material)},exports.ParticleSystem=function(geometry,material){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(geometry,material)},exports.PointCloudMaterial=function(parameters){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(parameters)},exports.ParticleBasicMaterial=function(parameters){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(parameters)},exports.ParticleSystemMaterial=function(parameters){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(parameters)},exports.Vertex=function(x,y,z){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3(x,y,z)},exports.DynamicBufferAttribute=function(array,itemSize){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new BufferAttribute(array,itemSize).setDynamic(!0)},exports.Int8Attribute=function(array,itemSize){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(array,itemSize)},exports.Uint8Attribute=function(array,itemSize){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(array,itemSize)},exports.Uint8ClampedAttribute=function(array,itemSize){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(array,itemSize)},exports.Int16Attribute=function(array,itemSize){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(array,itemSize)},exports.Uint16Attribute=function(array,itemSize){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(array,itemSize)},exports.Int32Attribute=function(array,itemSize){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(array,itemSize)},exports.Uint32Attribute=function(array,itemSize){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(array,itemSize)},exports.Float32Attribute=function(array,itemSize){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(array,itemSize)},exports.Float64Attribute=function(array,itemSize){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(array,itemSize)},exports.ClosedSplineCurve3=ClosedSplineCurve3,exports.SplineCurve3=SplineCurve3,exports.Spline=Spline,exports.AxisHelper=function(size){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AxesHelper(size)},exports.BoundingBoxHelper=function(object,color){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(object,color)},exports.EdgesHelper=function(object,hex){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(object.geometry),new LineBasicMaterial({color:void 0!==hex?hex:16777215}))},exports.WireframeHelper=function(object,hex){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(object.geometry),new LineBasicMaterial({color:void 0!==hex?hex:16777215}))},exports.XHRLoader=function(manager){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(manager)},exports.BinaryTextureLoader=function(manager){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new DataTextureLoader(manager)},exports.GeometryUtils=GeometryUtils,exports.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(vector,camera){console.warn("THREE.Projector: .projectVector() is now vector.project()."),vector.project(camera)},this.unprojectVector=function(vector,camera){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),vector.unproject(camera)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},exports.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},exports.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},exports.SceneUtils=SceneUtils,exports.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},Object.defineProperty(exports,"__esModule",{value:!0})},"object"==typeof exports&&void 0!==module?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory((global=global||self).THREE={})},{}],4:[function(require,module,exports){},{}],5:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Strings=require("./Strings"),Platform_1=require("./common/Platform"),RenderDebouncer_1=require("./ui/RenderDebouncer"),Lifecycle_1=require("./ui/Lifecycle"),Lifecycle_2=require("./common/Lifecycle"),AccessibilityManager=function(_super){function AccessibilityManager(_terminal){var _this=_super.call(this)||this;_this._terminal=_terminal,_this._liveRegionLineCount=0,_this._charsToConsume=[],_this._accessibilityTreeRoot=document.createElement("div"),_this._accessibilityTreeRoot.classList.add("xterm-accessibility"),_this._rowContainer=document.createElement("div"),_this._rowContainer.classList.add("xterm-accessibility-tree"),_this._rowElements=[];for(var i=0;i<_this._terminal.rows;i++)_this._rowElements[i]=_this._createAccessibilityTreeNode(),_this._rowContainer.appendChild(_this._rowElements[i]);return _this._topBoundaryFocusListener=function(e){return _this._onBoundaryFocus(e,0)},_this._bottomBoundaryFocusListener=function(e){return _this._onBoundaryFocus(e,1)},_this._rowElements[0].addEventListener("focus",_this._topBoundaryFocusListener),_this._rowElements[_this._rowElements.length-1].addEventListener("focus",_this._bottomBoundaryFocusListener),_this._refreshRowsDimensions(),_this._accessibilityTreeRoot.appendChild(_this._rowContainer),_this._renderRowsDebouncer=new RenderDebouncer_1.RenderDebouncer(_this._renderRows.bind(_this)),_this._refreshRows(),_this._liveRegion=document.createElement("div"),_this._liveRegion.classList.add("live-region"),_this._liveRegion.setAttribute("aria-live","assertive"),_this._accessibilityTreeRoot.appendChild(_this._liveRegion),_this._terminal.element.insertAdjacentElement("afterbegin",_this._accessibilityTreeRoot),_this.register(_this._renderRowsDebouncer),_this.register(_this._terminal.onResize(function(e){return _this._onResize(e.rows)})),_this.register(_this._terminal.onRender(function(e){return _this._refreshRows(e.start,e.end)})),_this.register(_this._terminal.onScroll(function(){return _this._refreshRows()})),_this.register(_this._terminal.addDisposableListener("a11y.char",function(char){return _this._onChar(char)})),_this.register(_this._terminal.onLineFeed(function(){return _this._onChar("\n")})),_this.register(_this._terminal.addDisposableListener("a11y.tab",function(spaceCount){return _this._onTab(spaceCount)})),_this.register(_this._terminal.onKey(function(e){return _this._onKey(e.key)})),_this.register(_this._terminal.addDisposableListener("blur",function(){return _this._clearLiveRegion()})),_this.register(_this._terminal.addDisposableListener("dprchange",function(){return _this._refreshRowsDimensions()})),_this.register(_this._terminal.renderer.onCanvasResize(function(){return _this._refreshRowsDimensions()})),_this.register(Lifecycle_1.addDisposableDomListener(window,"resize",function(){return _this._refreshRowsDimensions()})),_this}return __extends(AccessibilityManager,_super),AccessibilityManager.prototype.dispose=function(){_super.prototype.dispose.call(this),this._terminal.element.removeChild(this._accessibilityTreeRoot),this._rowElements.length=0},AccessibilityManager.prototype._onBoundaryFocus=function(e,position){var boundaryElement=e.target,beforeBoundaryElement=this._rowElements[0===position?1:this._rowElements.length-2];if(boundaryElement.getAttribute("aria-posinset")!==(0===position?"1":""+this._terminal.buffer.lines.length)&&e.relatedTarget===beforeBoundaryElement){var topBoundaryElement,bottomBoundaryElement;if(0===position?(topBoundaryElement=boundaryElement,bottomBoundaryElement=this._rowElements.pop(),this._rowContainer.removeChild(bottomBoundaryElement)):(topBoundaryElement=this._rowElements.shift(),bottomBoundaryElement=boundaryElement,this._rowContainer.removeChild(topBoundaryElement)),topBoundaryElement.removeEventListener("focus",this._topBoundaryFocusListener),bottomBoundaryElement.removeEventListener("focus",this._bottomBoundaryFocusListener),0===position){var newElement=this._createAccessibilityTreeNode();this._rowElements.unshift(newElement),this._rowContainer.insertAdjacentElement("afterbegin",newElement)}else{newElement=this._createAccessibilityTreeNode();this._rowElements.push(newElement),this._rowContainer.appendChild(newElement)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(0===position?-1:1),this._rowElements[0===position?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}},AccessibilityManager.prototype._onResize=function(rows){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(var i=this._rowContainer.children.length;i<this._terminal.rows;i++)this._rowElements[i]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[i]);for(;this._rowElements.length>rows;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()},AccessibilityManager.prototype._createAccessibilityTreeNode=function(){var element=document.createElement("div");return element.setAttribute("role","listitem"),element.tabIndex=-1,this._refreshRowDimensions(element),element},AccessibilityManager.prototype._onTab=function(spaceCount){for(var i=0;i<spaceCount;i++)this._onChar(" ")},AccessibilityManager.prototype._onChar=function(char){var _this=this;if(this._liveRegionLineCount<21){if(0<this._charsToConsume.length)this._charsToConsume.shift()!==char&&this._announceCharacter(char);else this._announceCharacter(char);"\n"===char&&(this._liveRegionLineCount++,21===this._liveRegionLineCount&&(this._liveRegion.textContent+=Strings.tooMuchOutput)),Platform_1.isMac&&this._liveRegion.textContent&&0<this._liveRegion.textContent.length&&!this._liveRegion.parentNode&&setTimeout(function(){_this._accessibilityTreeRoot.appendChild(_this._liveRegion)},0)}},AccessibilityManager.prototype._clearLiveRegion=function(){this._liveRegion.textContent="",this._liveRegionLineCount=0,Platform_1.isMac&&this._liveRegion.parentNode&&this._accessibilityTreeRoot.removeChild(this._liveRegion)},AccessibilityManager.prototype._onKey=function(keyChar){this._clearLiveRegion(),this._charsToConsume.push(keyChar)},AccessibilityManager.prototype._refreshRows=function(start,end){this._renderRowsDebouncer.refresh(start,end,this._terminal.rows)},AccessibilityManager.prototype._renderRows=function(start,end){for(var buffer=this._terminal.buffer,setSize=buffer.lines.length.toString(),i=start;i<=end;i++){var lineData=buffer.translateBufferLineToString(buffer.ydisp+i,!0),posInSet=(buffer.ydisp+i+1).toString(),element=this._rowElements[i];element&&(element.textContent=0===lineData.length?Strings.blankLine:lineData,element.setAttribute("aria-posinset",posInSet),element.setAttribute("aria-setsize",setSize))}},AccessibilityManager.prototype._refreshRowsDimensions=function(){if(this._terminal.renderer.dimensions.actualCellHeight){this._rowElements.length!==this._terminal.rows&&this._onResize(this._terminal.rows);for(var i=0;i<this._terminal.rows;i++)this._refreshRowDimensions(this._rowElements[i])}},AccessibilityManager.prototype._refreshRowDimensions=function(element){element.style.height=this._terminal.renderer.dimensions.actualCellHeight+"px"},AccessibilityManager.prototype._announceCharacter=function(char){" "===char?this._liveRegion.innerHTML+="&nbsp;":this._liveRegion.textContent+=char},AccessibilityManager}(Lifecycle_2.Disposable);exports.AccessibilityManager=AccessibilityManager},{"./Strings":22,"./common/Lifecycle":30,"./common/Platform":31,"./ui/Lifecycle":59,"./ui/RenderDebouncer":60}],6:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var CircularList_1=require("./common/CircularList"),BufferLine_1=require("./BufferLine"),BufferReflow_1=require("./BufferReflow"),Types_1=require("./renderer/atlas/Types"),EventEmitter2_1=require("./common/EventEmitter2"),Lifecycle_1=require("../lib/common/Lifecycle");exports.DEFAULT_ATTR=256|Types_1.DEFAULT_COLOR<<9,exports.DEFAULT_ATTR_DATA=new BufferLine_1.AttributeData,exports.CHAR_DATA_ATTR_INDEX=0,exports.CHAR_DATA_CHAR_INDEX=1,exports.CHAR_DATA_WIDTH_INDEX=2,exports.CHAR_DATA_CODE_INDEX=3,exports.MAX_BUFFER_SIZE=4294967295,exports.NULL_CELL_CHAR="",exports.NULL_CELL_WIDTH=1,exports.NULL_CELL_CODE=0,exports.WHITESPACE_CELL_CHAR=" ",exports.WHITESPACE_CELL_WIDTH=1,exports.WHITESPACE_CELL_CODE=32;var Buffer=function(){function Buffer(_terminal,_hasScrollback){this._terminal=_terminal,this._hasScrollback=_hasScrollback,this.savedCurAttrData=exports.DEFAULT_ATTR_DATA.clone(),this.markers=[],this._nullCell=BufferLine_1.CellData.fromCharData([0,exports.NULL_CELL_CHAR,exports.NULL_CELL_WIDTH,exports.NULL_CELL_CODE]),this._whitespaceCell=BufferLine_1.CellData.fromCharData([0,exports.WHITESPACE_CELL_CHAR,exports.WHITESPACE_CELL_WIDTH,exports.WHITESPACE_CELL_CODE]),this._cols=this._terminal.cols,this._rows=this._terminal.rows,this.clear()}return Buffer.prototype.getNullCell=function(attr){return attr?(this._nullCell.fg=attr.fg,this._nullCell.bg=attr.bg):(this._nullCell.fg=0,this._nullCell.bg=0),this._nullCell},Buffer.prototype.getWhitespaceCell=function(attr){return attr?(this._whitespaceCell.fg=attr.fg,this._whitespaceCell.bg=attr.bg):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0),this._whitespaceCell},Buffer.prototype.getBlankLine=function(attr,isWrapped){return new BufferLine_1.BufferLine(this._terminal.cols,this.getNullCell(attr),isWrapped)},Object.defineProperty(Buffer.prototype,"hasScrollback",{get:function(){return this._hasScrollback&&this.lines.maxLength>this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(Buffer.prototype,"isCursorInViewport",{get:function(){var relativeY=this.ybase+this.y-this.ydisp;return 0<=relativeY&&relativeY<this._rows},enumerable:!0,configurable:!0}),Buffer.prototype._getCorrectBufferLength=function(rows){if(!this._hasScrollback)return rows;var correctBufferLength=rows+this._terminal.options.scrollback;return correctBufferLength>exports.MAX_BUFFER_SIZE?exports.MAX_BUFFER_SIZE:correctBufferLength},Buffer.prototype.fillViewportRows=function(fillAttr){if(0===this.lines.length){void 0===fillAttr&&(fillAttr=exports.DEFAULT_ATTR_DATA);for(var i=this._rows;i--;)this.lines.push(this.getBlankLine(fillAttr))}},Buffer.prototype.clear=function(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new CircularList_1.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()},Buffer.prototype.resize=function(newCols,newRows){var nullCell=this.getNullCell(exports.DEFAULT_ATTR_DATA),newMaxLength=this._getCorrectBufferLength(newRows);if(newMaxLength>this.lines.maxLength&&(this.lines.maxLength=newMaxLength),0<this.lines.length){if(this._cols<newCols)for(var i=0;i<this.lines.length;i++)this.lines.get(i).resize(newCols,nullCell);var addToY=0;if(this._rows<newRows)for(var y=this._rows;y<newRows;y++)this.lines.length<newRows+this.ybase&&(0<this.ybase&&this.lines.length<=this.ybase+this.y+addToY+1?(this.ybase--,addToY++,0<this.ydisp&&this.ydisp--):this.lines.push(new BufferLine_1.BufferLine(newCols,nullCell)));else for(y=this._rows;newRows<y;y--)this.lines.length>newRows+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(newMaxLength<this.lines.maxLength){var amountToTrim=this.lines.length-newMaxLength;0<amountToTrim&&(this.lines.trimStart(amountToTrim),this.ybase=Math.max(this.ybase-amountToTrim,0),this.ydisp=Math.max(this.ydisp-amountToTrim,0)),this.lines.maxLength=newMaxLength}this.x=Math.min(this.x,newCols-1),this.y=Math.min(this.y,newRows-1),addToY&&(this.y+=addToY),this.savedY=Math.min(this.savedY,newRows-1),this.savedX=Math.min(this.savedX,newCols-1),this.scrollTop=0}if(this.scrollBottom=newRows-1,this._isReflowEnabled&&(this._reflow(newCols,newRows),this._cols>newCols))for(i=0;i<this.lines.length;i++)this.lines.get(i).resize(newCols,nullCell);this._cols=newCols,this._rows=newRows},Object.defineProperty(Buffer.prototype,"_isReflowEnabled",{get:function(){return this._hasScrollback&&!this._terminal.options.windowsMode},enumerable:!0,configurable:!0}),Buffer.prototype._reflow=function(newCols,newRows){this._cols!==newCols&&(newCols>this._cols?this._reflowLarger(newCols,newRows):this._reflowSmaller(newCols,newRows))},Buffer.prototype._reflowLarger=function(newCols,newRows){var toRemove=BufferReflow_1.reflowLargerGetLinesToRemove(this.lines,this._cols,newCols,this.ybase+this.y,this.getNullCell(exports.DEFAULT_ATTR_DATA));if(0<toRemove.length){var newLayoutResult=BufferReflow_1.reflowLargerCreateNewLayout(this.lines,toRemove);BufferReflow_1.reflowLargerApplyNewLayout(this.lines,newLayoutResult.layout),this._reflowLargerAdjustViewport(newCols,newRows,newLayoutResult.countRemoved)}},Buffer.prototype._reflowLargerAdjustViewport=function(newCols,newRows,countRemoved){for(var nullCell=this.getNullCell(exports.DEFAULT_ATTR_DATA),viewportAdjustments=countRemoved;0<viewportAdjustments--;)0===this.ybase?(0<this.y&&this.y--,this.lines.length<newRows&&this.lines.push(new BufferLine_1.BufferLine(newCols,nullCell))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--)},Buffer.prototype._reflowSmaller=function(newCols,newRows){for(var nullCell=this.getNullCell(exports.DEFAULT_ATTR_DATA),toInsert=[],countToInsert=0,y=this.lines.length-1;0<=y;y--){var nextLine=this.lines.get(y);if(nextLine.isWrapped||!(nextLine.getTrimmedLength()<=newCols)){for(var wrappedLines=[nextLine];nextLine.isWrapped&&0<y;)nextLine=this.lines.get(--y),wrappedLines.unshift(nextLine);var absoluteY=this.ybase+this.y;if(!(y<=absoluteY&&absoluteY<y+wrappedLines.length)){var lastLineLength=wrappedLines[wrappedLines.length-1].getTrimmedLength(),destLineLengths=BufferReflow_1.reflowSmallerGetNewLineLengths(wrappedLines,this._cols,newCols),linesToAdd=destLineLengths.length-wrappedLines.length,trimmedLines=void 0;trimmedLines=0===this.ybase&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+linesToAdd):Math.max(0,this.lines.length-this.lines.maxLength+linesToAdd);for(var newLines=[],i=0;i<linesToAdd;i++){var newLine=this.getBlankLine(exports.DEFAULT_ATTR_DATA,!0);newLines.push(newLine)}0<newLines.length&&(toInsert.push({start:y+wrappedLines.length+countToInsert,newLines:newLines}),countToInsert+=newLines.length),wrappedLines.push.apply(wrappedLines,newLines);var destLineIndex=destLineLengths.length-1,destCol=destLineLengths[destLineIndex];0===destCol&&(destCol=destLineLengths[--destLineIndex]);for(var srcLineIndex=wrappedLines.length-linesToAdd-1,srcCol=lastLineLength;0<=srcLineIndex;){var cellsToCopy=Math.min(srcCol,destCol);if(wrappedLines[destLineIndex].copyCellsFrom(wrappedLines[srcLineIndex],srcCol-cellsToCopy,destCol-cellsToCopy,cellsToCopy,!0),0===(destCol-=cellsToCopy)&&(destCol=destLineLengths[--destLineIndex]),0===(srcCol-=cellsToCopy)){srcLineIndex--;var wrappedLinesIndex=Math.max(srcLineIndex,0);srcCol=BufferReflow_1.getWrappedLineTrimmedLength(wrappedLines,wrappedLinesIndex,this._cols)}}for(i=0;i<wrappedLines.length;i++)destLineLengths[i]<newCols&&wrappedLines[i].setCell(destLineLengths[i],nullCell);for(var viewportAdjustments=linesToAdd-trimmedLines;0<viewportAdjustments--;)0===this.ybase?this.y<newRows-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+countToInsert)-newRows&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++)}}}if(0<toInsert.length){var insertEvents=[],originalLines=[];for(i=0;i<this.lines.length;i++)originalLines.push(this.lines.get(i));var originalLinesLength=this.lines.length,originalLineIndex=originalLinesLength-1,nextToInsertIndex=0,nextToInsert=toInsert[nextToInsertIndex];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+countToInsert);var countInsertedSoFar=0;for(i=Math.min(this.lines.maxLength-1,originalLinesLength+countToInsert-1);0<=i;i--)if(nextToInsert&&nextToInsert.start>originalLineIndex+countInsertedSoFar){for(var nextI=nextToInsert.newLines.length-1;0<=nextI;nextI--)this.lines.set(i--,nextToInsert.newLines[nextI]);i++,insertEvents.push({index:originalLineIndex+1,amount:nextToInsert.newLines.length}),countInsertedSoFar+=nextToInsert.newLines.length,nextToInsert=toInsert[++nextToInsertIndex]}else this.lines.set(i,originalLines[originalLineIndex--]);var insertCountEmitted=0;for(i=insertEvents.length-1;0<=i;i--)insertEvents[i].index+=insertCountEmitted,this.lines.onInsertEmitter.fire(insertEvents[i]),insertCountEmitted+=insertEvents[i].amount;var amountToTrim=Math.max(0,originalLinesLength+countToInsert-this.lines.maxLength);0<amountToTrim&&this.lines.onTrimEmitter.fire(amountToTrim)}},Buffer.prototype.stringIndexToBufferIndex=function(lineIndex,stringIndex,trimRight){for(void 0===trimRight&&(trimRight=!1);stringIndex;){var line=this.lines.get(lineIndex);if(!line)return[-1,-1];for(var length_1=trimRight?line.getTrimmedLength():line.length,i=0;i<length_1;++i)if(line.get(i)[exports.CHAR_DATA_WIDTH_INDEX]&&(stringIndex-=line.get(i)[exports.CHAR_DATA_CHAR_INDEX].length||1),stringIndex<0)return[lineIndex,i];lineIndex++}return[lineIndex,0]},Buffer.prototype.translateBufferLineToString=function(lineIndex,trimRight,startCol,endCol){void 0===startCol&&(startCol=0);var line=this.lines.get(lineIndex);return line?line.translateToString(trimRight,startCol,endCol):""},Buffer.prototype.getWrappedRangeForLine=function(y){for(var first=y,last=y;0<first&&this.lines.get(first).isWrapped;)first--;for(;last+1<this.lines.length&&this.lines.get(last+1).isWrapped;)last++;return{first:first,last:last}},Buffer.prototype.setupTabStops=function(i){for(null!=i?this.tabs[i]||(i=this.prevStop(i)):(this.tabs={},i=0);i<this._cols;i+=this._terminal.options.tabStopWidth)this.tabs[i]=!0},Buffer.prototype.prevStop=function(x){for(null==x&&(x=this.x);!this.tabs[--x]&&0<x;);return x>=this._cols?this._cols-1:x<0?0:x},Buffer.prototype.nextStop=function(x){for(null==x&&(x=this.x);!this.tabs[++x]&&x<this._cols;);return x>=this._cols?this._cols-1:x<0?0:x},Buffer.prototype.addMarker=function(y){var _this=this,marker=new Marker(y);return this.markers.push(marker),marker.register(this.lines.onTrim(function(amount){marker.line-=amount,marker.line<0&&marker.dispose()})),marker.register(this.lines.onInsert(function(event){marker.line>=event.index&&(marker.line+=event.amount)})),marker.register(this.lines.onDelete(function(event){marker.line>=event.index&&marker.line<event.index+event.amount&&marker.dispose(),marker.line>event.index&&(marker.line-=event.amount)})),marker.register(marker.onDispose(function(){return _this._removeMarker(marker)})),marker},Buffer.prototype._removeMarker=function(marker){this.markers.splice(this.markers.indexOf(marker),1)},Buffer.prototype.iterator=function(trimRight,startIndex,endIndex,startOverscan,endOverscan){return new BufferStringIterator(this,trimRight,startIndex,endIndex,startOverscan,endOverscan)},Buffer}();exports.Buffer=Buffer;var Marker=function(_super){function Marker(line){var _this=_super.call(this)||this;return _this.line=line,_this._id=Marker._nextId++,_this.isDisposed=!1,_this._onDispose=new EventEmitter2_1.EventEmitter2,_this}return __extends(Marker,_super),Object.defineProperty(Marker.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(Marker.prototype,"onDispose",{get:function(){return this._onDispose.event},enumerable:!0,configurable:!0}),Marker.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._onDispose.fire())},Marker._nextId=1,Marker}(Lifecycle_1.Disposable);exports.Marker=Marker;var BufferStringIterator=function(){function BufferStringIterator(_buffer,_trimRight,_startIndex,_endIndex,_startOverscan,_endOverscan){void 0===_startIndex&&(_startIndex=0),void 0===_endIndex&&(_endIndex=_buffer.lines.length),void 0===_startOverscan&&(_startOverscan=0),void 0===_endOverscan&&(_endOverscan=0),this._buffer=_buffer,this._trimRight=_trimRight,this._startIndex=_startIndex,this._endIndex=_endIndex,this._startOverscan=_startOverscan,this._endOverscan=_endOverscan,this._startIndex<0&&(this._startIndex=0),this._endIndex>this._buffer.lines.length&&(this._endIndex=this._buffer.lines.length),this._current=this._startIndex}return BufferStringIterator.prototype.hasNext=function(){return this._current<this._endIndex},BufferStringIterator.prototype.next=function(){var range=this._buffer.getWrappedRangeForLine(this._current);range.first<this._startIndex-this._startOverscan&&(range.first=this._startIndex-this._startOverscan),range.last>this._endIndex+this._endOverscan&&(range.last=this._endIndex+this._endOverscan),range.first=Math.max(range.first,0),range.last=Math.min(range.last,this._buffer.lines.length);for(var result="",i=range.first;i<=range.last;++i)result+=this._buffer.translateBufferLineToString(i,this._trimRight);return this._current=range.last+1,{range:range,content:result}},BufferStringIterator}();exports.BufferStringIterator=BufferStringIterator},{"../lib/common/Lifecycle":30,"./BufferLine":7,"./BufferReflow":8,"./common/CircularList":26,"./common/EventEmitter2":29,"./renderer/atlas/Types":56}],7:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Buffer_1=require("./Buffer"),TextDecoder_1=require("./core/input/TextDecoder"),AttributeData=function(){function AttributeData(){this.fg=0,this.bg=0}return AttributeData.toColorRGB=function(value){return[value>>>16&255,value>>>8&255,255&value]},AttributeData.fromColorRGB=function(value){return(255&value[0])<<16|(255&value[1])<<8|255&value[2]},AttributeData.prototype.clone=function(){var newObj=new AttributeData;return newObj.fg=this.fg,newObj.bg=this.bg,newObj},AttributeData.prototype.isInverse=function(){return 67108864&this.fg},AttributeData.prototype.isBold=function(){return 134217728&this.fg},AttributeData.prototype.isUnderline=function(){return 268435456&this.fg},AttributeData.prototype.isBlink=function(){return 536870912&this.fg},AttributeData.prototype.isInvisible=function(){return 1073741824&this.fg},AttributeData.prototype.isItalic=function(){return 67108864&this.bg},AttributeData.prototype.isDim=function(){return 134217728&this.bg},AttributeData.prototype.getFgColorMode=function(){return 50331648&this.fg},AttributeData.prototype.getBgColorMode=function(){return 50331648&this.bg},AttributeData.prototype.isFgRGB=function(){return 50331648==(50331648&this.fg)},AttributeData.prototype.isBgRGB=function(){return 50331648==(50331648&this.bg)},AttributeData.prototype.isFgPalette=function(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)},AttributeData.prototype.isBgPalette=function(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)},AttributeData.prototype.isFgDefault=function(){return 0==(50331648&this.fg)},AttributeData.prototype.isBgDefault=function(){return 0==(50331648&this.bg)},AttributeData.prototype.getFgColor=function(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}},AttributeData.prototype.getBgColor=function(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}},AttributeData}(),CellData=function(_super){function CellData(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.content=0,_this.fg=0,_this.bg=0,_this.combinedData="",_this}return __extends(CellData,_super),CellData.fromCharData=function(value){var obj=new CellData;return obj.setFromCharData(value),obj},CellData.prototype.isCombined=function(){return 2097152&this.content},CellData.prototype.getWidth=function(){return this.content>>22},CellData.prototype.getChars=function(){return 2097152&this.content?this.combinedData:2097151&this.content?TextDecoder_1.stringFromCodePoint(2097151&this.content):""},CellData.prototype.getCode=function(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content},CellData.prototype.setFromCharData=function(value){this.fg=value[Buffer_1.CHAR_DATA_ATTR_INDEX],this.bg=0;var combined=!1;if(2<value[Buffer_1.CHAR_DATA_CHAR_INDEX].length)combined=!0;else if(2===value[Buffer_1.CHAR_DATA_CHAR_INDEX].length){var code=value[Buffer_1.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=code&&code<=56319){var second=value[Buffer_1.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=second&&second<=57343?this.content=1024*(code-55296)+second-56320+65536|value[Buffer_1.CHAR_DATA_WIDTH_INDEX]<<22:combined=!0}else combined=!0}else this.content=value[Buffer_1.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|value[Buffer_1.CHAR_DATA_WIDTH_INDEX]<<22;combined&&(this.combinedData=value[Buffer_1.CHAR_DATA_CHAR_INDEX],this.content=2097152|value[Buffer_1.CHAR_DATA_WIDTH_INDEX]<<22)},CellData.prototype.getAsCharData=function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]},CellData}(exports.AttributeData=AttributeData);exports.CellData=CellData;var BufferLine=function(){function BufferLine(cols,fillCellData,isWrapped){if(void 0===isWrapped&&(isWrapped=!1),this.isWrapped=isWrapped,this._data=null,this._combined={},cols){this._data=new Uint32Array(3*cols);for(var cell=fillCellData||CellData.fromCharData([0,Buffer_1.NULL_CELL_CHAR,Buffer_1.NULL_CELL_WIDTH,Buffer_1.NULL_CELL_CODE]),i=0;i<cols;++i)this.setCell(i,cell)}this.length=cols}return BufferLine.prototype.get=function(index){var content=this._data[3*index+0],cp=2097151&content;return[this._data[3*index+1],2097152&content?this._combined[index]:cp?TextDecoder_1.stringFromCodePoint(cp):"",content>>22,2097152&content?this._combined[index].charCodeAt(this._combined[index].length-1):cp]},BufferLine.prototype.set=function(index,value){this._data[3*index+1]=value[Buffer_1.CHAR_DATA_ATTR_INDEX],1<value[Buffer_1.CHAR_DATA_CHAR_INDEX].length?(this._combined[index]=value[1],this._data[3*index+0]=2097152|index|value[Buffer_1.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*index+0]=value[Buffer_1.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|value[Buffer_1.CHAR_DATA_WIDTH_INDEX]<<22},BufferLine.prototype.getWidth=function(index){return this._data[3*index+0]>>22},BufferLine.prototype.hasWidth=function(index){return 12582912&this._data[3*index+0]},BufferLine.prototype.getFg=function(index){return this._data[3*index+1]},BufferLine.prototype.getBg=function(index){return this._data[3*index+2]},BufferLine.prototype.hasContent=function(index){return 4194303&this._data[3*index+0]},BufferLine.prototype.getCodePoint=function(index){var content=this._data[3*index+0];return 2097152&content?this._combined[index].charCodeAt(this._combined[index].length-1):2097151&content},BufferLine.prototype.isCombined=function(index){return 2097152&this._data[3*index+0]},BufferLine.prototype.getString=function(index){var content=this._data[3*index+0];return 2097152&content?this._combined[index]:2097151&content?TextDecoder_1.stringFromCodePoint(2097151&content):""},BufferLine.prototype.loadCell=function(index,cell){var startIndex=3*index;return cell.content=this._data[0+startIndex],cell.fg=this._data[1+startIndex],cell.bg=this._data[2+startIndex],2097152&cell.content&&(cell.combinedData=this._combined[index]),cell},BufferLine.prototype.setCell=function(index,cell){2097152&cell.content&&(this._combined[index]=cell.combinedData),this._data[3*index+0]=cell.content,this._data[3*index+1]=cell.fg,this._data[3*index+2]=cell.bg},BufferLine.prototype.setCellFromCodePoint=function(index,codePoint,width,fg,bg){this._data[3*index+0]=codePoint|width<<22,this._data[3*index+1]=fg,this._data[3*index+2]=bg},BufferLine.prototype.addCodepointToCell=function(index,codePoint){var content=this._data[3*index+0];2097152&content?this._combined[index]+=TextDecoder_1.stringFromCodePoint(codePoint):(2097151&content?(this._combined[index]=TextDecoder_1.stringFromCodePoint(2097151&content)+TextDecoder_1.stringFromCodePoint(codePoint),content&=-2097152,content|=2097152):content=codePoint|1<<22,this._data[3*index+0]=content)},BufferLine.prototype.insertCells=function(pos,n,fillCellData){if(pos%=this.length,n<this.length-pos){for(var cell=new CellData,i=this.length-pos-n-1;0<=i;--i)this.setCell(pos+n+i,this.loadCell(pos+i,cell));for(i=0;i<n;++i)this.setCell(pos+i,fillCellData)}else for(i=pos;i<this.length;++i)this.setCell(i,fillCellData)},BufferLine.prototype.deleteCells=function(pos,n,fillCellData){if(pos%=this.length,n<this.length-pos){for(var cell=new CellData,i=0;i<this.length-pos-n;++i)this.setCell(pos+i,this.loadCell(pos+n+i,cell));for(i=this.length-n;i<this.length;++i)this.setCell(i,fillCellData)}else for(i=pos;i<this.length;++i)this.setCell(i,fillCellData)},BufferLine.prototype.replaceCells=function(start,end,fillCellData){for(;start<end&&start<this.length;)this.setCell(start++,fillCellData)},BufferLine.prototype.resize=function(cols,fillCellData){if(cols!==this.length){if(cols>this.length){var data=new Uint32Array(3*cols);this.length&&(3*cols<this._data.length?data.set(this._data.subarray(0,3*cols)):data.set(this._data)),this._data=data;for(var i=this.length;i<cols;++i)this.setCell(i,fillCellData)}else if(cols){(data=new Uint32Array(3*cols)).set(this._data.subarray(0,3*cols)),this._data=data;var keys=Object.keys(this._combined);for(i=0;i<keys.length;i++){var key=parseInt(keys[i],10);cols<=key&&delete this._combined[key]}}else this._data=null,this._combined={};this.length=cols}},BufferLine.prototype.fill=function(fillCellData){this._combined={};for(var i=0;i<this.length;++i)this.setCell(i,fillCellData)},BufferLine.prototype.copyFrom=function(line){for(var el in this.length!==line.length?this._data=new Uint32Array(line._data):this._data.set(line._data),this.length=line.length,this._combined={},line._combined)this._combined[el]=line._combined[el];this.isWrapped=line.isWrapped},BufferLine.prototype.clone=function(){var newLine=new BufferLine(0);for(var el in newLine._data=new Uint32Array(this._data),newLine.length=this.length,this._combined)newLine._combined[el]=this._combined[el];return newLine.isWrapped=this.isWrapped,newLine},BufferLine.prototype.getTrimmedLength=function(){for(var i=this.length-1;0<=i;--i)if(4194303&this._data[3*i+0])return i+(this._data[3*i+0]>>22);return 0},BufferLine.prototype.copyCellsFrom=function(src,srcCol,destCol,length,applyInReverse){var srcData=src._data;if(applyInReverse)for(var cell=length-1;0<=cell;cell--)for(var i=0;i<3;i++)this._data[3*(destCol+cell)+i]=srcData[3*(srcCol+cell)+i];else for(cell=0;cell<length;cell++)for(i=0;i<3;i++)this._data[3*(destCol+cell)+i]=srcData[3*(srcCol+cell)+i];var srcCombinedKeys=Object.keys(src._combined);for(i=0;i<srcCombinedKeys.length;i++){var key=parseInt(srcCombinedKeys[i],10);srcCol<=key&&(this._combined[key-srcCol+destCol]=src._combined[key])}},BufferLine.prototype.translateToString=function(trimRight,startCol,endCol){void 0===trimRight&&(trimRight=!1),void 0===startCol&&(startCol=0),void 0===endCol&&(endCol=this.length),trimRight&&(endCol=Math.min(endCol,this.getTrimmedLength()));for(var result="";startCol<endCol;){var content=this._data[3*startCol+0],cp=2097151&content;result+=2097152&content?this._combined[startCol]:cp?TextDecoder_1.stringFromCodePoint(cp):Buffer_1.WHITESPACE_CELL_CHAR,startCol+=content>>22||1}return result},BufferLine}();exports.BufferLine=BufferLine},{"./Buffer":6,"./core/input/TextDecoder":36}],8:[function(require,module,exports){"use strict";function getWrappedLineTrimmedLength(lines,i,cols){if(i===lines.length-1)return lines[i].getTrimmedLength();var endsInNull=!lines[i].hasContent(cols-1)&&1===lines[i].getWidth(cols-1),followingLineStartsWithWide=2===lines[i+1].getWidth(0);return endsInNull&&followingLineStartsWithWide?cols-1:cols}Object.defineProperty(exports,"__esModule",{value:!0}),exports.reflowLargerGetLinesToRemove=function(lines,oldCols,newCols,bufferAbsoluteY,nullCell){for(var toRemove=[],y=0;y<lines.length-1;y++){var i=y,nextLine=lines.get(++i);if(nextLine.isWrapped){for(var wrappedLines=[lines.get(y)];i<lines.length&&nextLine.isWrapped;)wrappedLines.push(nextLine),nextLine=lines.get(++i);if(y<=bufferAbsoluteY&&bufferAbsoluteY<i)y+=wrappedLines.length-1;else{for(var destLineIndex=0,destCol=getWrappedLineTrimmedLength(wrappedLines,destLineIndex,oldCols),srcLineIndex=1,srcCol=0;srcLineIndex<wrappedLines.length;){var srcTrimmedTineLength=getWrappedLineTrimmedLength(wrappedLines,srcLineIndex,oldCols),srcRemainingCells=srcTrimmedTineLength-srcCol,destRemainingCells=newCols-destCol,cellsToCopy=Math.min(srcRemainingCells,destRemainingCells);wrappedLines[destLineIndex].copyCellsFrom(wrappedLines[srcLineIndex],srcCol,destCol,cellsToCopy,!1),(destCol+=cellsToCopy)===newCols&&(destLineIndex++,destCol=0),(srcCol+=cellsToCopy)===srcTrimmedTineLength&&(srcLineIndex++,srcCol=0),0===destCol&&0!==destLineIndex&&2===wrappedLines[destLineIndex-1].getWidth(newCols-1)&&(wrappedLines[destLineIndex].copyCellsFrom(wrappedLines[destLineIndex-1],newCols-1,destCol++,1,!1),wrappedLines[destLineIndex-1].setCell(newCols-1,nullCell))}wrappedLines[destLineIndex].replaceCells(destCol,newCols,nullCell);for(var countToRemove=0,i_1=wrappedLines.length-1;0<i_1&&(destLineIndex<i_1||0===wrappedLines[i_1].getTrimmedLength());i_1--)countToRemove++;0<countToRemove&&(toRemove.push(y+wrappedLines.length-countToRemove),toRemove.push(countToRemove)),y+=wrappedLines.length-1}}}return toRemove},exports.reflowLargerCreateNewLayout=function(lines,toRemove){for(var layout=[],nextToRemoveIndex=0,nextToRemoveStart=toRemove[nextToRemoveIndex],countRemovedSoFar=0,i=0;i<lines.length;i++)if(nextToRemoveStart===i){var countToRemove=toRemove[++nextToRemoveIndex];lines.onDeleteEmitter.fire({index:i-countRemovedSoFar,amount:countToRemove}),i+=countToRemove-1,countRemovedSoFar+=countToRemove,nextToRemoveStart=toRemove[++nextToRemoveIndex]}else layout.push(i);return{layout:layout,countRemoved:countRemovedSoFar}},exports.reflowLargerApplyNewLayout=function(lines,newLayout){for(var newLayoutLines=[],i=0;i<newLayout.length;i++)newLayoutLines.push(lines.get(newLayout[i]));for(i=0;i<newLayoutLines.length;i++)lines.set(i,newLayoutLines[i]);lines.length=newLayout.length},exports.reflowSmallerGetNewLineLengths=function(wrappedLines,oldCols,newCols){for(var newLineLengths=[],cellsNeeded=wrappedLines.map(function(l,i){return getWrappedLineTrimmedLength(wrappedLines,i,oldCols)}).reduce(function(p,c){return p+c}),srcCol=0,srcLine=0,cellsAvailable=0;cellsAvailable<cellsNeeded;){if(cellsNeeded-cellsAvailable<newCols){newLineLengths.push(cellsNeeded-cellsAvailable);break}srcCol+=newCols;var oldTrimmedLength=getWrappedLineTrimmedLength(wrappedLines,srcLine,oldCols);oldTrimmedLength<srcCol&&(srcCol-=oldTrimmedLength,srcLine++);var endsWithWide=2===wrappedLines[srcLine].getWidth(srcCol-1);endsWithWide&&srcCol--;var lineLength=endsWithWide?newCols-1:newCols;newLineLengths.push(lineLength),cellsAvailable+=lineLength}return newLineLengths},exports.getWrappedLineTrimmedLength=getWrappedLineTrimmedLength},{}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Buffer_1=require("./Buffer"),EventEmitter2_1=require("./common/EventEmitter2"),BufferSet=function(){function BufferSet(_terminal){this._terminal=_terminal,this._onBufferActivate=new EventEmitter2_1.EventEmitter2,this._normal=new Buffer_1.Buffer(this._terminal,!0),this._normal.fillViewportRows(),this._alt=new Buffer_1.Buffer(this._terminal,!1),this._activeBuffer=this._normal,this.setupTabStops()}return Object.defineProperty(BufferSet.prototype,"onBufferActivate",{get:function(){return this._onBufferActivate.event},enumerable:!0,configurable:!0}),Object.defineProperty(BufferSet.prototype,"alt",{get:function(){return this._alt},enumerable:!0,configurable:!0}),Object.defineProperty(BufferSet.prototype,"active",{get:function(){return this._activeBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(BufferSet.prototype,"normal",{get:function(){return this._normal},enumerable:!0,configurable:!0}),BufferSet.prototype.activateNormalBuffer=function(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))},BufferSet.prototype.activateAltBuffer=function(fillAttr){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(fillAttr),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))},BufferSet.prototype.resize=function(newCols,newRows){this._normal.resize(newCols,newRows),this._alt.resize(newCols,newRows)},BufferSet.prototype.setupTabStops=function(i){this._normal.setupTabStops(i),this._alt.setupTabStops(i)},BufferSet}();exports.BufferSet=BufferSet},{"./Buffer":6,"./common/EventEmitter2":29}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var EventEmitter2_1=require("./common/EventEmitter2"),CharMeasure=function(){function CharMeasure(document,parentElement){this._onCharSizeChanged=new EventEmitter2_1.EventEmitter2,this._document=document,this._parentElement=parentElement,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W",this._measureElement.setAttribute("aria-hidden","true"),this._parentElement.appendChild(this._measureElement)}return Object.defineProperty(CharMeasure.prototype,"onCharSizeChanged",{get:function(){return this._onCharSizeChanged.event},enumerable:!0,configurable:!0}),Object.defineProperty(CharMeasure.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(CharMeasure.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),CharMeasure.prototype.measure=function(options){this._measureElement.style.fontFamily=options.fontFamily,this._measureElement.style.fontSize=options.fontSize+"px";var geometry=this._measureElement.getBoundingClientRect();if(0!==geometry.width&&0!==geometry.height){var adjustedHeight=Math.ceil(geometry.height);this._width===geometry.width&&this._height===adjustedHeight||(this._width=geometry.width,this._height=adjustedHeight,this._onCharSizeChanged.fire())}},CharMeasure}();exports.CharMeasure=CharMeasure},{"./common/EventEmitter2":29}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var TypedArrayUtils_1=require("./common/TypedArrayUtils");exports.wcwidth=function(opts){var COMBINING_BMP=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],COMBINING_HIGH=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];var control=0|opts.control,table=new Uint8Array(65536);TypedArrayUtils_1.fill(table,1),table[0]=opts.nul,TypedArrayUtils_1.fill(table,opts.control,1,32),TypedArrayUtils_1.fill(table,opts.control,127,160),TypedArrayUtils_1.fill(table,2,4352,4448),table[9001]=2,table[9002]=2,TypedArrayUtils_1.fill(table,2,11904,42192),table[12351]=1,TypedArrayUtils_1.fill(table,2,44032,55204),TypedArrayUtils_1.fill(table,2,63744,64256),TypedArrayUtils_1.fill(table,2,65040,65050),TypedArrayUtils_1.fill(table,2,65072,65136),TypedArrayUtils_1.fill(table,2,65280,65377),TypedArrayUtils_1.fill(table,2,65504,65511);for(var r=0;r<COMBINING_BMP.length;++r)TypedArrayUtils_1.fill(table,0,COMBINING_BMP[r][0],COMBINING_BMP[r][1]+1);return function(num){return num<32?0|control:num<127?1:num<65536?table[num]:function(ucs){return function(ucs,data){var mid,min=0,max=data.length-1;if(ucs<data[0][0]||ucs>data[max][1])return!1;for(;min<=max;)if(ucs>data[mid=min+max>>1][1])min=1+mid;else{if(!(ucs<data[mid][0]))return!0;max=mid-1}return!1}(ucs,COMBINING_HIGH)?0:131072<=ucs&&ucs<=196605||196608<=ucs&&ucs<=262141?2:1}(num)}}({nul:0,control:0}),exports.getStringCellWidth=function(s){for(var result=0,length=s.length,i=0;i<length;++i){var code=s.charCodeAt(i);if(55296<=code&&code<=56319){if(++i>=length)return result+exports.wcwidth(code);var second=s.charCodeAt(i);56320<=second&&second<=57343?code=1024*(code-55296)+second-56320+65536:result+=exports.wcwidth(second)}result+=exports.wcwidth(code)}return result}},{"./common/TypedArrayUtils":32}],12:[function(require,module,exports){"use strict";function prepareTextForTerminal(text){return text.replace(/\r?\n/g,"\r")}function bracketTextForPaste(text,bracketedPasteMode){return bracketedPasteMode?"[200~"+text+"[201~":text}function moveTextAreaUnderMouseCursor(ev,term){var pos=term.screenElement.getBoundingClientRect(),left=ev.clientX-pos.left-10,top=ev.clientY-pos.top-10;term.textarea.style.position="absolute",term.textarea.style.width="20px",term.textarea.style.height="20px",term.textarea.style.left=left+"px",term.textarea.style.top=top+"px",term.textarea.style.zIndex="1000",term.textarea.focus(),setTimeout(function(){term.textarea.style.position=null,term.textarea.style.width=null,term.textarea.style.height=null,term.textarea.style.left=null,term.textarea.style.top=null,term.textarea.style.zIndex=null},200)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.prepareTextForTerminal=prepareTextForTerminal,exports.bracketTextForPaste=bracketTextForPaste,exports.copyHandler=function(ev,term,selectionManager){term.browser.isMSIE?window.clipboardData.setData("Text",selectionManager.selectionText):ev.clipboardData.setData("text/plain",selectionManager.selectionText),ev.preventDefault()},exports.pasteHandler=function(ev,term){function dispatchPaste(text){text=bracketTextForPaste(text=prepareTextForTerminal(text),term.bracketedPasteMode),term.handler(text),term.textarea.value="",term.emit("paste",text),term.cancel(ev)}ev.stopPropagation(),term.browser.isMSIE?window.clipboardData&&dispatchPaste(window.clipboardData.getData("Text")):ev.clipboardData&&dispatchPaste(ev.clipboardData.getData("text/plain"))},exports.moveTextAreaUnderMouseCursor=moveTextAreaUnderMouseCursor,exports.rightClickHandler=function(ev,term,selectionManager,shouldSelectWord){moveTextAreaUnderMouseCursor(ev,term),shouldSelectWord&&!selectionManager.isClickInSelection(ev)&&selectionManager.selectWordAtCursor(ev),term.textarea.value=selectionManager.selectionText,term.textarea.select()}},{}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var CompositionHelper=function(){function CompositionHelper(_textarea,_compositionView,_terminal){this._textarea=_textarea,this._compositionView=_compositionView,this._terminal=_terminal,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:null,end:null}}return CompositionHelper.prototype.compositionstart=function(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._compositionView.classList.add("active")},CompositionHelper.prototype.compositionupdate=function(ev){var _this=this;this._compositionView.textContent=ev.data,this.updateCompositionElements(),setTimeout(function(){_this._compositionPosition.end=_this._textarea.value.length},0)},CompositionHelper.prototype.compositionend=function(){this._finalizeComposition(!0)},CompositionHelper.prototype.keydown=function(ev){if(this._isComposing||this._isSendingComposition){if(229===ev.keyCode)return!1;if(16===ev.keyCode||17===ev.keyCode||18===ev.keyCode)return!1;this._finalizeComposition(!1)}return 229!==ev.keyCode||(this._handleAnyTextareaChanges(),!1)},CompositionHelper.prototype._finalizeComposition=function(waitForPropagation){var _this=this;if(this._compositionView.classList.remove("active"),this._isComposing=!1,this._clearTextareaPosition(),waitForPropagation){var currentCompositionPosition_1={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(function(){if(_this._isSendingComposition){_this._isSendingComposition=!1;var input=void 0;input=_this._isComposing?_this._textarea.value.substring(currentCompositionPosition_1.start,currentCompositionPosition_1.end):_this._textarea.value.substring(currentCompositionPosition_1.start),_this._terminal.handler(input)}},0)}else{this._isSendingComposition=!1;var input=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._terminal.handler(input)}},CompositionHelper.prototype._handleAnyTextareaChanges=function(){var _this=this,oldValue=this._textarea.value;setTimeout(function(){if(!_this._isComposing){var diff=_this._textarea.value.replace(oldValue,"");0<diff.length&&_this._terminal.handler(diff)}},0)},CompositionHelper.prototype.updateCompositionElements=function(dontRecurse){var _this=this;if(this._isComposing){if(this._terminal.buffer.isCursorInViewport){var cellHeight=Math.ceil(this._terminal.charMeasure.height*this._terminal.options.lineHeight),cursorTop=this._terminal.buffer.y*cellHeight,cursorLeft=this._terminal.buffer.x*this._terminal.charMeasure.width;this._compositionView.style.left=cursorLeft+"px",this._compositionView.style.top=cursorTop+"px",this._compositionView.style.height=cellHeight+"px",this._compositionView.style.lineHeight=cellHeight+"px",this._compositionView.style.fontFamily=this._terminal.options.fontFamily,this._compositionView.style.fontSize=this._terminal.options.fontSize+"px";var compositionViewBounds=this._compositionView.getBoundingClientRect();this._textarea.style.left=cursorLeft+"px",this._textarea.style.top=cursorTop+"px",this._textarea.style.width=compositionViewBounds.width+"px",this._textarea.style.height=compositionViewBounds.height+"px",this._textarea.style.lineHeight=compositionViewBounds.height+"px"}dontRecurse||setTimeout(function(){return _this.updateCompositionElements(!0)},0)}},CompositionHelper.prototype._clearTextareaPosition=function(){this._textarea.style.left="",this._textarea.style.top=""},CompositionHelper}();exports.CompositionHelper=CompositionHelper},{}],14:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Lifecycle_1=require("./common/Lifecycle"),TextDecoder_1=require("./core/input/TextDecoder");function r(low,high){for(var c=high-low,arr=new Array(c);c--;)arr[c]=--high;return arr}var TransitionTable=function(){function TransitionTable(length){this.table="undefined"==typeof Uint8Array?new Array(length):new Uint8Array(length)}return TransitionTable.prototype.add=function(code,state,action,next){this.table[state<<8|code]=(0|action)<<4|(void 0===next?state:next)},TransitionTable.prototype.addMany=function(codes,state,action,next){for(var i=0;i<codes.length;i++)this.add(codes[i],state,action,next)},TransitionTable}();exports.TransitionTable=TransitionTable;var PRINTABLES=r(32,127),EXECUTABLES=r(0,24);EXECUTABLES.push(25),EXECUTABLES.push.apply(EXECUTABLES,r(28,32));exports.VT500_TRANSITION_TABLE=function(){var state,table=new TransitionTable(4095),states=r(0,14);for(state in states)for(var code=0;code<=160;++code)table.add(code,state,1,0);for(state in table.addMany(PRINTABLES,0,2,0),states)table.addMany([24,26,153,154],state,3,0),table.addMany(r(128,144),state,3,0),table.addMany(r(144,152),state,3,0),table.add(156,state,0,0),table.add(27,state,11,1),table.add(157,state,4,8),table.addMany([152,158,159],state,0,7),table.add(155,state,11,3),table.add(144,state,11,9);return table.addMany(EXECUTABLES,0,3,0),table.addMany(EXECUTABLES,1,3,1),table.add(127,1,0,1),table.addMany(EXECUTABLES,8,0,8),table.addMany(EXECUTABLES,3,3,3),table.add(127,3,0,3),table.addMany(EXECUTABLES,4,3,4),table.add(127,4,0,4),table.addMany(EXECUTABLES,6,3,6),table.addMany(EXECUTABLES,5,3,5),table.add(127,5,0,5),table.addMany(EXECUTABLES,2,3,2),table.add(127,2,0,2),table.add(93,1,4,8),table.addMany(PRINTABLES,8,5,8),table.add(127,8,5,8),table.addMany([156,27,24,26,7],8,6,0),table.addMany(r(28,32),8,0,8),table.addMany([88,94,95],1,0,7),table.addMany(PRINTABLES,7,0,7),table.addMany(EXECUTABLES,7,0,7),table.add(156,7,0,0),table.add(127,7,0,7),table.add(91,1,11,3),table.addMany(r(64,127),3,7,0),table.addMany(r(48,58),3,8,4),table.add(59,3,8,4),table.addMany([60,61,62,63],3,9,4),table.addMany(r(48,58),4,8,4),table.add(59,4,8,4),table.addMany(r(64,127),4,7,0),table.addMany([58,60,61,62,63],4,0,6),table.addMany(r(32,64),6,0,6),table.add(127,6,0,6),table.addMany(r(64,127),6,0,0),table.add(58,3,0,6),table.addMany(r(32,48),3,9,5),table.addMany(r(32,48),5,9,5),table.addMany(r(48,64),5,0,6),table.addMany(r(64,127),5,7,0),table.addMany(r(32,48),4,9,5),table.addMany(r(32,48),1,9,2),table.addMany(r(32,48),2,9,2),table.addMany(r(48,127),2,10,0),table.addMany(r(48,80),1,10,0),table.addMany(r(81,88),1,10,0),table.addMany([89,90,92],1,10,0),table.addMany(r(96,127),1,10,0),table.add(80,1,11,9),table.addMany(EXECUTABLES,9,0,9),table.add(127,9,0,9),table.addMany(r(28,32),9,0,9),table.addMany(r(32,48),9,9,12),table.add(58,9,0,11),table.addMany(r(48,58),9,8,10),table.add(59,9,8,10),table.addMany([60,61,62,63],9,9,10),table.addMany(EXECUTABLES,11,0,11),table.addMany(r(32,128),11,0,11),table.addMany(r(28,32),11,0,11),table.addMany(EXECUTABLES,10,0,10),table.add(127,10,0,10),table.addMany(r(28,32),10,0,10),table.addMany(r(48,58),10,8,10),table.add(59,10,8,10),table.addMany([58,60,61,62,63],10,0,11),table.addMany(r(32,48),10,9,12),table.addMany(EXECUTABLES,12,0,12),table.add(127,12,0,12),table.addMany(r(28,32),12,0,12),table.addMany(r(32,48),12,9,12),table.addMany(r(48,64),12,0,11),table.addMany(r(64,127),12,12,13),table.addMany(r(64,127),10,12,13),table.addMany(r(64,127),9,12,13),table.addMany(EXECUTABLES,13,13,13),table.addMany(PRINTABLES,13,13,13),table.add(127,13,0,13),table.addMany([27,156],13,14,0),table.add(160,8,5,8),table}();var DcsDummy=function(){function DcsDummy(){}return DcsDummy.prototype.hook=function(collect,params,flag){},DcsDummy.prototype.put=function(data,start,end){},DcsDummy.prototype.unhook=function(){},DcsDummy}(),EscapeSequenceParser=function(_super){function EscapeSequenceParser(TRANSITIONS){void 0===TRANSITIONS&&(TRANSITIONS=exports.VT500_TRANSITION_TABLE);var _this=_super.call(this)||this;return _this.TRANSITIONS=TRANSITIONS,_this.initialState=0,_this.currentState=_this.initialState,_this._osc="",_this._params=[0],_this._collect="",_this._printHandlerFb=function(data,start,end){},_this._executeHandlerFb=function(code){},_this._csiHandlerFb=function(collect,params,flag){},_this._escHandlerFb=function(collect,flag){},_this._oscHandlerFb=function(identifier,data){},_this._dcsHandlerFb=new DcsDummy,_this._errorHandlerFb=function(state){return state},_this._printHandler=_this._printHandlerFb,_this._executeHandlers=Object.create(null),_this._csiHandlers=Object.create(null),_this._escHandlers=Object.create(null),_this._oscHandlers=Object.create(null),_this._dcsHandlers=Object.create(null),_this._activeDcsHandler=null,_this._errorHandler=_this._errorHandlerFb,_this.setEscHandler("\\",function(){}),_this}return __extends(EscapeSequenceParser,_super),EscapeSequenceParser.prototype.dispose=function(){this._printHandlerFb=null,this._executeHandlerFb=null,this._csiHandlerFb=null,this._escHandlerFb=null,this._oscHandlerFb=null,this._dcsHandlerFb=null,this._errorHandlerFb=null,this._printHandler=null,this._executeHandlers=null,this._escHandlers=null,this._csiHandlers=null,this._oscHandlers=null,this._dcsHandlers=null,this._activeDcsHandler=null,this._errorHandler=null},EscapeSequenceParser.prototype.setPrintHandler=function(callback){this._printHandler=callback},EscapeSequenceParser.prototype.clearPrintHandler=function(){this._printHandler=this._printHandlerFb},EscapeSequenceParser.prototype.setExecuteHandler=function(flag,callback){this._executeHandlers[flag.charCodeAt(0)]=callback},EscapeSequenceParser.prototype.clearExecuteHandler=function(flag){this._executeHandlers[flag.charCodeAt(0)]&&delete this._executeHandlers[flag.charCodeAt(0)]},EscapeSequenceParser.prototype.setExecuteHandlerFallback=function(callback){this._executeHandlerFb=callback},EscapeSequenceParser.prototype.addCsiHandler=function(flag,callback){var index=flag.charCodeAt(0);void 0===this._csiHandlers[index]&&(this._csiHandlers[index]=[]);var handlerList=this._csiHandlers[index];return handlerList.push(callback),{dispose:function(){var handlerIndex=handlerList.indexOf(callback);-1!==handlerIndex&&handlerList.splice(handlerIndex,1)}}},EscapeSequenceParser.prototype.setCsiHandler=function(flag,callback){this._csiHandlers[flag.charCodeAt(0)]=[callback]},EscapeSequenceParser.prototype.clearCsiHandler=function(flag){this._csiHandlers[flag.charCodeAt(0)]&&delete this._csiHandlers[flag.charCodeAt(0)]},EscapeSequenceParser.prototype.setCsiHandlerFallback=function(callback){this._csiHandlerFb=callback},EscapeSequenceParser.prototype.setEscHandler=function(collectAndFlag,callback){this._escHandlers[collectAndFlag]=callback},EscapeSequenceParser.prototype.clearEscHandler=function(collectAndFlag){this._escHandlers[collectAndFlag]&&delete this._escHandlers[collectAndFlag]},EscapeSequenceParser.prototype.setEscHandlerFallback=function(callback){this._escHandlerFb=callback},EscapeSequenceParser.prototype.addOscHandler=function(ident,callback){void 0===this._oscHandlers[ident]&&(this._oscHandlers[ident]=[]);var handlerList=this._oscHandlers[ident];return handlerList.push(callback),{dispose:function(){var handlerIndex=handlerList.indexOf(callback);-1!==handlerIndex&&handlerList.splice(handlerIndex,1)}}},EscapeSequenceParser.prototype.setOscHandler=function(ident,callback){this._oscHandlers[ident]=[callback]},EscapeSequenceParser.prototype.clearOscHandler=function(ident){this._oscHandlers[ident]&&delete this._oscHandlers[ident]},EscapeSequenceParser.prototype.setOscHandlerFallback=function(callback){this._oscHandlerFb=callback},EscapeSequenceParser.prototype.setDcsHandler=function(collectAndFlag,handler){this._dcsHandlers[collectAndFlag]=handler},EscapeSequenceParser.prototype.clearDcsHandler=function(collectAndFlag){this._dcsHandlers[collectAndFlag]&&delete this._dcsHandlers[collectAndFlag]},EscapeSequenceParser.prototype.setDcsHandlerFallback=function(handler){this._dcsHandlerFb=handler},EscapeSequenceParser.prototype.setErrorHandler=function(callback){this._errorHandler=callback},EscapeSequenceParser.prototype.clearErrorHandler=function(){this._errorHandler=this._errorHandlerFb},EscapeSequenceParser.prototype.reset=function(){this.currentState=this.initialState,this._osc="",this._params=[0],this._collect="",this._activeDcsHandler=null},EscapeSequenceParser.prototype.parse=function(data,length){for(var code=0,transition=0,error=!1,currentState=this.currentState,print=-1,dcs=-1,osc=this._osc,collect=this._collect,params=this._params,table=this.TRANSITIONS.table,dcsHandler=this._activeDcsHandler,callback=null,i=0;i<length;++i)if(code=data[i],0===currentState&&31<code&&code<128){for(print=~print?print:i;++i<length&&31<data[i]&&data[i]<128;);i--}else if(4===currentState&&47<code&&code<57)params[params.length-1]=10*params[params.length-1]+code-48;else{switch((transition=table[currentState<<8|(code<160?code:160)])>>4){case 2:print=~print?print:i;break;case 3:~print&&(this._printHandler(data,print,i),print=-1),(callback=this._executeHandlers[code])?callback():this._executeHandlerFb(code);break;case 0:~print?(this._printHandler(data,print,i),print=-1):~dcs&&(dcsHandler.put(data,dcs,i),dcs=-1);break;case 1:if(159<code)switch(currentState){case 0:print=~print?print:i;break;case 6:transition|=6;break;case 11:transition|=11;break;case 13:dcs=~dcs?dcs:i,transition|=13;break;default:error=!0}else error=!0;if(error){if(this._errorHandler({position:i,code:code,currentState:currentState,print:print,dcs:dcs,osc:osc,collect:collect,params:params,abort:!1}).abort)return;error=!1}break;case 7:for(var handlers=this._csiHandlers[code],j=handlers?handlers.length-1:-1;0<=j&&!1===handlers[j](params,collect);j--);j<0&&this._csiHandlerFb(collect,params,code);break;case 8:59===code?params.push(0):params[params.length-1]=10*params[params.length-1]+code-48;break;case 9:collect+=String.fromCharCode(code);break;case 10:(callback=this._escHandlers[collect+String.fromCharCode(code)])?callback(collect,code):this._escHandlerFb(collect,code);break;case 11:~print&&(this._printHandler(data,print,i),print=-1),params=[0],collect=osc="",dcs=-1;break;case 12:(dcsHandler=this._dcsHandlers[collect+String.fromCharCode(code)])||(dcsHandler=this._dcsHandlerFb),dcsHandler.hook(collect,params,code);break;case 13:dcs=~dcs?dcs:i;break;case 14:dcsHandler&&(~dcs&&dcsHandler.put(data,dcs,i),dcsHandler.unhook(),dcsHandler=null),27===code&&(transition|=1),params=[0],collect=osc="",dcs=-1;break;case 4:~print&&(this._printHandler(data,print,i),print=-1),osc="";break;case 5:for(var j_1=i+1;;j_1++)if(length<=j_1||(code=data[j_1])<32||127<code&&code<=159){osc+=TextDecoder_1.utf32ToString(data,i,j_1),i=j_1-1;break}break;case 6:if(osc&&24!==code&&26!==code){var idx=osc.indexOf(";");if(-1===idx)this._oscHandlerFb(-1,osc);else{for(var identifier=parseInt(osc.substring(0,idx)),content=osc.substring(idx+1),handlers_1=this._oscHandlers[identifier],j_2=handlers_1?handlers_1.length-1:-1;0<=j_2&&!1===handlers_1[j_2](content);j_2--);j_2<0&&this._oscHandlerFb(identifier,content)}}27===code&&(transition|=1),params=[0],collect=osc="",dcs=-1}currentState=15&transition}0===currentState&&~print?this._printHandler(data,print,length):13===currentState&&~dcs&&dcsHandler&&dcsHandler.put(data,dcs,length),this._osc=osc,this._collect=collect,this._params=params,this._activeDcsHandler=dcsHandler,this.currentState=currentState},EscapeSequenceParser}(Lifecycle_1.Disposable);exports.EscapeSequenceParser=EscapeSequenceParser},{"./common/Lifecycle":30,"./core/input/TextDecoder":36}],15:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var EscapeSequences_1=require("./common/data/EscapeSequences"),Charsets_1=require("./core/data/Charsets"),Buffer_1=require("./Buffer"),CharWidth_1=require("./CharWidth"),EscapeSequenceParser_1=require("./EscapeSequenceParser"),Lifecycle_1=require("./common/Lifecycle"),TypedArrayUtils_1=require("./common/TypedArrayUtils"),TextDecoder_1=require("./core/input/TextDecoder"),BufferLine_1=require("./BufferLine"),EventEmitter2_1=require("./common/EventEmitter2"),GLEVEL={"(":0,")":1,"*":2,"+":3,"-":1,".":2},DECRQSS=function(){function DECRQSS(_terminal){this._terminal=_terminal,this._data=new Uint32Array(0)}return DECRQSS.prototype.hook=function(collect,params,flag){this._data=new Uint32Array(0)},DECRQSS.prototype.put=function(data,start,end){this._data=TypedArrayUtils_1.concat(this._data,data.subarray(start,end))},DECRQSS.prototype.unhook=function(){var data=TextDecoder_1.utf32ToString(this._data);switch(this._data=new Uint32Array(0),data){case'"q':return this._terminal.handler(EscapeSequences_1.C0.ESC+'P1$r0"q'+EscapeSequences_1.C0.ESC+"\\");case'"p':return this._terminal.handler(EscapeSequences_1.C0.ESC+'P1$r61"p'+EscapeSequences_1.C0.ESC+"\\");case"r":var pt=this._terminal.buffer.scrollTop+1+";"+(this._terminal.buffer.scrollBottom+1)+"r";return this._terminal.handler(EscapeSequences_1.C0.ESC+"P1$r"+pt+EscapeSequences_1.C0.ESC+"\\");case"m":return this._terminal.handler(EscapeSequences_1.C0.ESC+"P1$r0m"+EscapeSequences_1.C0.ESC+"\\");case" q":var style={block:2,underline:4,bar:6}[this._terminal.getOption("cursorStyle")];return style-=this._terminal.getOption("cursorBlink"),this._terminal.handler(EscapeSequences_1.C0.ESC+"P1$r"+style+" q"+EscapeSequences_1.C0.ESC+"\\");default:this._terminal.error("Unknown DCS $q %s",data),this._terminal.handler(EscapeSequences_1.C0.ESC+"P0$r"+EscapeSequences_1.C0.ESC+"\\")}},DECRQSS}(),InputHandler=function(_super){function InputHandler(_terminal,_parser){void 0===_parser&&(_parser=new EscapeSequenceParser_1.EscapeSequenceParser);var _this=_super.call(this)||this;_this._terminal=_terminal,_this._parser=_parser,_this._parseBuffer=new Uint32Array(4096),_this._stringDecoder=new TextDecoder_1.StringToUtf32,_this._workCell=new BufferLine_1.CellData,_this._onCursorMove=new EventEmitter2_1.EventEmitter2,_this._onData=new EventEmitter2_1.EventEmitter2,_this._onLineFeed=new EventEmitter2_1.EventEmitter2,_this._onScroll=new EventEmitter2_1.EventEmitter2,_this.register(_this._parser),_this._parser.setCsiHandlerFallback(function(collect,params,flag){_this._terminal.error("Unknown CSI code: ",{collect:collect,params:params,flag:String.fromCharCode(flag)})}),_this._parser.setEscHandlerFallback(function(collect,flag){_this._terminal.error("Unknown ESC code: ",{collect:collect,flag:String.fromCharCode(flag)})}),_this._parser.setExecuteHandlerFallback(function(code){_this._terminal.error("Unknown EXECUTE code: ",{code:code})}),_this._parser.setOscHandlerFallback(function(identifier,data){_this._terminal.error("Unknown OSC code: ",{identifier:identifier,data:data})}),_this._parser.setPrintHandler(function(data,start,end){return _this.print(data,start,end)}),_this._parser.setCsiHandler("@",function(params,collect){return _this.insertChars(params)}),_this._parser.setCsiHandler("A",function(params,collect){return _this.cursorUp(params)}),_this._parser.setCsiHandler("B",function(params,collect){return _this.cursorDown(params)}),_this._parser.setCsiHandler("C",function(params,collect){return _this.cursorForward(params)}),_this._parser.setCsiHandler("D",function(params,collect){return _this.cursorBackward(params)}),_this._parser.setCsiHandler("E",function(params,collect){return _this.cursorNextLine(params)}),_this._parser.setCsiHandler("F",function(params,collect){return _this.cursorPrecedingLine(params)}),_this._parser.setCsiHandler("G",function(params,collect){return _this.cursorCharAbsolute(params)}),_this._parser.setCsiHandler("H",function(params,collect){return _this.cursorPosition(params)}),_this._parser.setCsiHandler("I",function(params,collect){return _this.cursorForwardTab(params)}),_this._parser.setCsiHandler("J",function(params,collect){return _this.eraseInDisplay(params)}),_this._parser.setCsiHandler("K",function(params,collect){return _this.eraseInLine(params)}),_this._parser.setCsiHandler("L",function(params,collect){return _this.insertLines(params)}),_this._parser.setCsiHandler("M",function(params,collect){return _this.deleteLines(params)}),_this._parser.setCsiHandler("P",function(params,collect){return _this.deleteChars(params)}),_this._parser.setCsiHandler("S",function(params,collect){return _this.scrollUp(params)}),_this._parser.setCsiHandler("T",function(params,collect){return _this.scrollDown(params,collect)}),_this._parser.setCsiHandler("X",function(params,collect){return _this.eraseChars(params)}),_this._parser.setCsiHandler("Z",function(params,collect){return _this.cursorBackwardTab(params)}),_this._parser.setCsiHandler("`",function(params,collect){return _this.charPosAbsolute(params)}),_this._parser.setCsiHandler("a",function(params,collect){return _this.hPositionRelative(params)}),_this._parser.setCsiHandler("b",function(params,collect){return _this.repeatPrecedingCharacter(params)}),_this._parser.setCsiHandler("c",function(params,collect){return _this.sendDeviceAttributes(params,collect)}),_this._parser.setCsiHandler("d",function(params,collect){return _this.linePosAbsolute(params)}),_this._parser.setCsiHandler("e",function(params,collect){return _this.vPositionRelative(params)}),_this._parser.setCsiHandler("f",function(params,collect){return _this.hVPosition(params)}),_this._parser.setCsiHandler("g",function(params,collect){return _this.tabClear(params)}),_this._parser.setCsiHandler("h",function(params,collect){return _this.setMode(params,collect)}),_this._parser.setCsiHandler("l",function(params,collect){return _this.resetMode(params,collect)}),_this._parser.setCsiHandler("m",function(params,collect){return _this.charAttributes(params)}),_this._parser.setCsiHandler("n",function(params,collect){return _this.deviceStatus(params,collect)}),_this._parser.setCsiHandler("p",function(params,collect){return _this.softReset(params,collect)}),_this._parser.setCsiHandler("q",function(params,collect){return _this.setCursorStyle(params,collect)}),_this._parser.setCsiHandler("r",function(params,collect){return _this.setScrollRegion(params,collect)}),_this._parser.setCsiHandler("s",function(params,collect){return _this.saveCursor(params)}),_this._parser.setCsiHandler("u",function(params,collect){return _this.restoreCursor(params)}),_this._parser.setExecuteHandler(EscapeSequences_1.C0.BEL,function(){return _this.bell()}),_this._parser.setExecuteHandler(EscapeSequences_1.C0.LF,function(){return _this.lineFeed()}),_this._parser.setExecuteHandler(EscapeSequences_1.C0.VT,function(){return _this.lineFeed()}),_this._parser.setExecuteHandler(EscapeSequences_1.C0.FF,function(){return _this.lineFeed()}),_this._parser.setExecuteHandler(EscapeSequences_1.C0.CR,function(){return _this.carriageReturn()}),_this._parser.setExecuteHandler(EscapeSequences_1.C0.BS,function(){return _this.backspace()}),_this._parser.setExecuteHandler(EscapeSequences_1.C0.HT,function(){return _this.tab()}),_this._parser.setExecuteHandler(EscapeSequences_1.C0.SO,function(){return _this.shiftOut()}),_this._parser.setExecuteHandler(EscapeSequences_1.C0.SI,function(){return _this.shiftIn()}),_this._parser.setExecuteHandler(EscapeSequences_1.C1.IND,function(){return _this.index()}),_this._parser.setExecuteHandler(EscapeSequences_1.C1.NEL,function(){return _this.nextLine()}),_this._parser.setExecuteHandler(EscapeSequences_1.C1.HTS,function(){return _this.tabSet()}),_this._parser.setOscHandler(0,function(data){return _this.setTitle(data)}),_this._parser.setOscHandler(2,function(data){return _this.setTitle(data)}),_this._parser.setEscHandler("7",function(){return _this.saveCursor([])}),_this._parser.setEscHandler("8",function(){return _this.restoreCursor([])}),_this._parser.setEscHandler("D",function(){return _this.index()}),_this._parser.setEscHandler("E",function(){return _this.nextLine()}),_this._parser.setEscHandler("H",function(){return _this.tabSet()}),_this._parser.setEscHandler("M",function(){return _this.reverseIndex()}),_this._parser.setEscHandler("=",function(){return _this.keypadApplicationMode()}),_this._parser.setEscHandler(">",function(){return _this.keypadNumericMode()}),_this._parser.setEscHandler("c",function(){return _this.reset()}),_this._parser.setEscHandler("n",function(){return _this.setgLevel(2)}),_this._parser.setEscHandler("o",function(){return _this.setgLevel(3)}),_this._parser.setEscHandler("|",function(){return _this.setgLevel(3)}),_this._parser.setEscHandler("}",function(){return _this.setgLevel(2)}),_this._parser.setEscHandler("~",function(){return _this.setgLevel(1)}),_this._parser.setEscHandler("%@",function(){return _this.selectDefaultCharset()}),_this._parser.setEscHandler("%G",function(){return _this.selectDefaultCharset()});function _loop_1(flag){this_1._parser.setEscHandler("("+flag,function(){return _this.selectCharset("("+flag)}),this_1._parser.setEscHandler(")"+flag,function(){return _this.selectCharset(")"+flag)}),this_1._parser.setEscHandler("*"+flag,function(){return _this.selectCharset("*"+flag)}),this_1._parser.setEscHandler("+"+flag,function(){return _this.selectCharset("+"+flag)}),this_1._parser.setEscHandler("-"+flag,function(){return _this.selectCharset("-"+flag)}),this_1._parser.setEscHandler("."+flag,function(){return _this.selectCharset("."+flag)}),this_1._parser.setEscHandler("/"+flag,function(){return _this.selectCharset("/"+flag)})}var this_1=this;for(var flag in Charsets_1.CHARSETS)_loop_1(flag);return _this._parser.setErrorHandler(function(state){return _this._terminal.error("Parsing error: ",state),state}),_this._parser.setDcsHandler("$q",new DECRQSS(_this._terminal)),_this}return __extends(InputHandler,_super),Object.defineProperty(InputHandler.prototype,"onCursorMove",{get:function(){return this._onCursorMove.event},enumerable:!0,configurable:!0}),Object.defineProperty(InputHandler.prototype,"onData",{get:function(){return this._onData.event},enumerable:!0,configurable:!0}),Object.defineProperty(InputHandler.prototype,"onLineFeed",{get:function(){return this._onLineFeed.event},enumerable:!0,configurable:!0}),Object.defineProperty(InputHandler.prototype,"onScroll",{get:function(){return this._onScroll.event},enumerable:!0,configurable:!0}),InputHandler.prototype.dispose=function(){_super.prototype.dispose.call(this),this._terminal=null},InputHandler.prototype.parse=function(data){if(this._terminal){var buffer=this._terminal.buffer,cursorStartX=buffer.x,cursorStartY=buffer.y;this._terminal.debug&&this._terminal.log("data: "+data),this._parseBuffer.length<data.length&&(this._parseBuffer=new Uint32Array(data.length)),this._parser.parse(this._parseBuffer,this._stringDecoder.decode(data,this._parseBuffer)),(buffer=this._terminal.buffer).x===cursorStartX&&buffer.y===cursorStartY||this._onCursorMove.fire()}},InputHandler.prototype.print=function(data,start,end){var code,chWidth,buffer=this._terminal.buffer,charset=this._terminal.charset,screenReaderMode=this._terminal.options.screenReaderMode,cols=this._terminal.cols,wraparoundMode=this._terminal.wraparoundMode,insertMode=this._terminal.insertMode,curAttr=this._terminal.curAttrData,bufferRow=buffer.lines.get(buffer.y+buffer.ybase);this._terminal.updateRange(buffer.y);for(var pos=start;pos<end;++pos){if(code=data[pos],chWidth=CharWidth_1.wcwidth(code),code<127&&charset){var ch=charset[String.fromCharCode(code)];ch&&(code=ch.charCodeAt(0))}if(screenReaderMode&&this._terminal.emit("a11y.char",TextDecoder_1.stringFromCodePoint(code)),chWidth||!buffer.x){if(buffer.x+chWidth-1>=cols)if(wraparoundMode)buffer.x=0,buffer.y++,buffer.y>buffer.scrollBottom?(buffer.y--,this._terminal.scroll(!0)):buffer.lines.get(buffer.y).isWrapped=!0,bufferRow=buffer.lines.get(buffer.y+buffer.ybase);else if(2===chWidth)continue;if(insertMode&&(bufferRow.insertCells(buffer.x,chWidth,buffer.getNullCell(curAttr)),2===bufferRow.getWidth(cols-1)&&bufferRow.setCellFromCodePoint(cols-1,Buffer_1.NULL_CELL_CODE,Buffer_1.NULL_CELL_WIDTH,curAttr.fg,curAttr.bg)),bufferRow.setCellFromCodePoint(buffer.x++,code,chWidth,curAttr.fg,curAttr.bg),0<chWidth)for(;--chWidth;)bufferRow.setCellFromCodePoint(buffer.x++,0,0,curAttr.fg,curAttr.bg)}else bufferRow.getWidth(buffer.x-1)?bufferRow.addCodepointToCell(buffer.x-1,code):bufferRow.addCodepointToCell(buffer.x-2,code)}this._terminal.updateRange(buffer.y)},InputHandler.prototype.addCsiHandler=function(flag,callback){return this._parser.addCsiHandler(flag,callback)},InputHandler.prototype.addOscHandler=function(ident,callback){return this._parser.addOscHandler(ident,callback)},InputHandler.prototype.bell=function(){this._terminal.bell()},InputHandler.prototype.lineFeed=function(){var buffer=this._terminal.buffer;this._terminal.options.convertEol&&(buffer.x=0),buffer.y++,buffer.y>buffer.scrollBottom&&(buffer.y--,this._terminal.scroll()),buffer.x>=this._terminal.cols&&buffer.x--,this._onLineFeed.fire()},InputHandler.prototype.carriageReturn=function(){this._terminal.buffer.x=0},InputHandler.prototype.backspace=function(){0<this._terminal.buffer.x&&this._terminal.buffer.x--},InputHandler.prototype.tab=function(){var originalX=this._terminal.buffer.x;this._terminal.buffer.x=this._terminal.buffer.nextStop(),this._terminal.options.screenReaderMode&&this._terminal.emit("a11y.tab",this._terminal.buffer.x-originalX)},InputHandler.prototype.shiftOut=function(){this._terminal.setgLevel(1)},InputHandler.prototype.shiftIn=function(){this._terminal.setgLevel(0)},InputHandler.prototype.insertChars=function(params){this._terminal.buffer.lines.get(this._terminal.buffer.y+this._terminal.buffer.ybase).insertCells(this._terminal.buffer.x,params[0]||1,this._terminal.buffer.getNullCell(this._terminal.eraseAttrData())),this._terminal.updateRange(this._terminal.buffer.y)},InputHandler.prototype.cursorUp=function(params){var param=params[0];param<1&&(param=1),this._terminal.buffer.y-=param,this._terminal.buffer.y<0&&(this._terminal.buffer.y=0)},InputHandler.prototype.cursorDown=function(params){var param=params[0];param<1&&(param=1),this._terminal.buffer.y+=param,this._terminal.buffer.y>=this._terminal.rows&&(this._terminal.buffer.y=this._terminal.rows-1),this._terminal.buffer.x>=this._terminal.cols&&this._terminal.buffer.x--},InputHandler.prototype.cursorForward=function(params){var param=params[0];param<1&&(param=1),this._terminal.buffer.x+=param,this._terminal.buffer.x>=this._terminal.cols&&(this._terminal.buffer.x=this._terminal.cols-1)},InputHandler.prototype.cursorBackward=function(params){var param=params[0];param<1&&(param=1),this._terminal.buffer.x>=this._terminal.cols&&this._terminal.buffer.x--,this._terminal.buffer.x-=param,this._terminal.buffer.x<0&&(this._terminal.buffer.x=0)},InputHandler.prototype.cursorNextLine=function(params){var param=params[0];param<1&&(param=1),this._terminal.buffer.y+=param,this._terminal.buffer.y>=this._terminal.rows&&(this._terminal.buffer.y=this._terminal.rows-1),this._terminal.buffer.x=0},InputHandler.prototype.cursorPrecedingLine=function(params){var param=params[0];param<1&&(param=1),this._terminal.buffer.y-=param,this._terminal.buffer.y<0&&(this._terminal.buffer.y=0),this._terminal.buffer.x=0},InputHandler.prototype.cursorCharAbsolute=function(params){var param=params[0];param<1&&(param=1),this._terminal.buffer.x=param-1},InputHandler.prototype.cursorPosition=function(params){var col,row=params[0]-1;col=2<=params.length?params[1]-1:0,row<0?row=0:row>=this._terminal.rows&&(row=this._terminal.rows-1),col<0?col=0:col>=this._terminal.cols&&(col=this._terminal.cols-1),this._terminal.buffer.x=col,this._terminal.buffer.y=row},InputHandler.prototype.cursorForwardTab=function(params){for(var param=params[0]||1;param--;)this._terminal.buffer.x=this._terminal.buffer.nextStop()},InputHandler.prototype._eraseInBufferLine=function(y,start,end,clearWrap){void 0===clearWrap&&(clearWrap=!1);var line=this._terminal.buffer.lines.get(this._terminal.buffer.ybase+y);line.replaceCells(start,end,this._terminal.buffer.getNullCell(this._terminal.eraseAttrData())),clearWrap&&(line.isWrapped=!1)},InputHandler.prototype._resetBufferLine=function(y){this._eraseInBufferLine(y,0,this._terminal.cols,!0)},InputHandler.prototype.eraseInDisplay=function(params){var j;switch(params[0]){case 0:for(j=this._terminal.buffer.y,this._terminal.updateRange(j),this._eraseInBufferLine(j++,this._terminal.buffer.x,this._terminal.cols,0===this._terminal.buffer.x);j<this._terminal.rows;j++)this._resetBufferLine(j);this._terminal.updateRange(j);break;case 1:for(j=this._terminal.buffer.y,this._terminal.updateRange(j),this._eraseInBufferLine(j,0,this._terminal.buffer.x+1,!0),this._terminal.buffer.x+1>=this._terminal.cols&&(this._terminal.buffer.lines.get(j+1).isWrapped=!1);j--;)this._resetBufferLine(j);this._terminal.updateRange(0);break;case 2:for(j=this._terminal.rows,this._terminal.updateRange(j-1);j--;)this._resetBufferLine(j);this._terminal.updateRange(0);break;case 3:var scrollBackSize=this._terminal.buffer.lines.length-this._terminal.rows;0<scrollBackSize&&(this._terminal.buffer.lines.trimStart(scrollBackSize),this._terminal.buffer.ybase=Math.max(this._terminal.buffer.ybase-scrollBackSize,0),this._terminal.buffer.ydisp=Math.max(this._terminal.buffer.ydisp-scrollBackSize,0),this._onScroll.fire(0))}},InputHandler.prototype.eraseInLine=function(params){switch(params[0]){case 0:this._eraseInBufferLine(this._terminal.buffer.y,this._terminal.buffer.x,this._terminal.cols);break;case 1:this._eraseInBufferLine(this._terminal.buffer.y,0,this._terminal.buffer.x+1);break;case 2:this._eraseInBufferLine(this._terminal.buffer.y,0,this._terminal.cols)}this._terminal.updateRange(this._terminal.buffer.y)},InputHandler.prototype.insertLines=function(params){var param=params[0];param<1&&(param=1);for(var buffer=this._terminal.buffer,row=buffer.y+buffer.ybase,scrollBottomRowsOffset=this._terminal.rows-1-buffer.scrollBottom,scrollBottomAbsolute=this._terminal.rows-1+buffer.ybase-scrollBottomRowsOffset+1;param--;)buffer.lines.splice(scrollBottomAbsolute-1,1),buffer.lines.splice(row,0,buffer.getBlankLine(this._terminal.eraseAttrData()));this._terminal.updateRange(buffer.y),this._terminal.updateRange(buffer.scrollBottom)},InputHandler.prototype.deleteLines=function(params){var param=params[0];param<1&&(param=1);var j,buffer=this._terminal.buffer,row=buffer.y+buffer.ybase;for(j=this._terminal.rows-1-buffer.scrollBottom,j=this._terminal.rows-1+buffer.ybase-j;param--;)buffer.lines.splice(row,1),buffer.lines.splice(j,0,buffer.getBlankLine(this._terminal.eraseAttrData()));this._terminal.updateRange(buffer.y),this._terminal.updateRange(buffer.scrollBottom)},InputHandler.prototype.deleteChars=function(params){this._terminal.buffer.lines.get(this._terminal.buffer.y+this._terminal.buffer.ybase).deleteCells(this._terminal.buffer.x,params[0]||1,this._terminal.buffer.getNullCell(this._terminal.eraseAttrData())),this._terminal.updateRange(this._terminal.buffer.y)},InputHandler.prototype.scrollUp=function(params){for(var param=params[0]||1,buffer=this._terminal.buffer;param--;)buffer.lines.splice(buffer.ybase+buffer.scrollTop,1),buffer.lines.splice(buffer.ybase+buffer.scrollBottom,0,buffer.getBlankLine(Buffer_1.DEFAULT_ATTR_DATA));this._terminal.updateRange(buffer.scrollTop),this._terminal.updateRange(buffer.scrollBottom)},InputHandler.prototype.scrollDown=function(params,collect){if(params.length<2&&!collect){for(var param=params[0]||1,buffer=this._terminal.buffer;param--;)buffer.lines.splice(buffer.ybase+buffer.scrollBottom,1),buffer.lines.splice(buffer.ybase+buffer.scrollTop,0,buffer.getBlankLine(Buffer_1.DEFAULT_ATTR_DATA));this._terminal.updateRange(buffer.scrollTop),this._terminal.updateRange(buffer.scrollBottom)}},InputHandler.prototype.eraseChars=function(params){this._terminal.buffer.lines.get(this._terminal.buffer.y+this._terminal.buffer.ybase).replaceCells(this._terminal.buffer.x,this._terminal.buffer.x+(params[0]||1),this._terminal.buffer.getNullCell(this._terminal.eraseAttrData()))},InputHandler.prototype.cursorBackwardTab=function(params){for(var param=params[0]||1,buffer=this._terminal.buffer;param--;)buffer.x=buffer.prevStop()},InputHandler.prototype.charPosAbsolute=function(params){var param=params[0];param<1&&(param=1),this._terminal.buffer.x=param-1,this._terminal.buffer.x>=this._terminal.cols&&(this._terminal.buffer.x=this._terminal.cols-1)},InputHandler.prototype.hPositionRelative=function(params){var param=params[0];param<1&&(param=1),this._terminal.buffer.x+=param,this._terminal.buffer.x>=this._terminal.cols&&(this._terminal.buffer.x=this._terminal.cols-1)},InputHandler.prototype.repeatPrecedingCharacter=function(params){var buffer=this._terminal.buffer,line=buffer.lines.get(buffer.ybase+buffer.y);line.loadCell(buffer.x-1,this._workCell),line.replaceCells(buffer.x,buffer.x+(params[0]||1),void 0!==this._workCell.content?this._workCell:buffer.getNullCell(Buffer_1.DEFAULT_ATTR_DATA))},InputHandler.prototype.sendDeviceAttributes=function(params,collect){0<params[0]||(collect?">"===collect&&(this._terminal.is("xterm")?this._terminal.handler(EscapeSequences_1.C0.ESC+"[>0;276;0c"):this._terminal.is("rxvt-unicode")?this._terminal.handler(EscapeSequences_1.C0.ESC+"[>85;95;0c"):this._terminal.is("linux")?this._terminal.handler(params[0]+"c"):this._terminal.is("screen")&&this._terminal.handler(EscapeSequences_1.C0.ESC+"[>83;40003;0c")):this._terminal.is("xterm")||this._terminal.is("rxvt-unicode")||this._terminal.is("screen")?this._terminal.handler(EscapeSequences_1.C0.ESC+"[?1;2c"):this._terminal.is("linux")&&this._terminal.handler(EscapeSequences_1.C0.ESC+"[?6c"))},InputHandler.prototype.linePosAbsolute=function(params){var param=params[0];param<1&&(param=1),this._terminal.buffer.y=param-1,this._terminal.buffer.y>=this._terminal.rows&&(this._terminal.buffer.y=this._terminal.rows-1)},InputHandler.prototype.vPositionRelative=function(params){var param=params[0];param<1&&(param=1),this._terminal.buffer.y+=param,this._terminal.buffer.y>=this._terminal.rows&&(this._terminal.buffer.y=this._terminal.rows-1),this._terminal.buffer.x>=this._terminal.cols&&this._terminal.buffer.x--},InputHandler.prototype.hVPosition=function(params){params[0]<1&&(params[0]=1),params[1]<1&&(params[1]=1),this._terminal.buffer.y=params[0]-1,this._terminal.buffer.y>=this._terminal.rows&&(this._terminal.buffer.y=this._terminal.rows-1),this._terminal.buffer.x=params[1]-1,this._terminal.buffer.x>=this._terminal.cols&&(this._terminal.buffer.x=this._terminal.cols-1)},InputHandler.prototype.tabClear=function(params){var param=params[0];param<=0?delete this._terminal.buffer.tabs[this._terminal.buffer.x]:3===param&&(this._terminal.buffer.tabs={})},InputHandler.prototype.setMode=function(params,collect){if(1<params.length)for(var i=0;i<params.length;i++)this.setMode([params[i]]);else if(collect){if("?"===collect)switch(params[0]){case 1:this._terminal.applicationCursor=!0;break;case 2:this._terminal.setgCharset(0,Charsets_1.DEFAULT_CHARSET),this._terminal.setgCharset(1,Charsets_1.DEFAULT_CHARSET),this._terminal.setgCharset(2,Charsets_1.DEFAULT_CHARSET),this._terminal.setgCharset(3,Charsets_1.DEFAULT_CHARSET);break;case 3:this._terminal.savedCols=this._terminal.cols,this._terminal.resize(132,this._terminal.rows);break;case 6:this._terminal.originMode=!0;break;case 7:this._terminal.wraparoundMode=!0;break;case 12:break;case 66:this._terminal.log("Serial port requested application keypad."),this._terminal.applicationKeypad=!0,this._terminal.viewport&&this._terminal.viewport.syncScrollArea();break;case 9:case 1e3:case 1002:case 1003:this._terminal.x10Mouse=9===params[0],this._terminal.vt200Mouse=1e3===params[0],this._terminal.normalMouse=1e3<params[0],this._terminal.mouseEvents=!0,this._terminal.element&&this._terminal.element.classList.add("enable-mouse-events"),this._terminal.selectionManager&&this._terminal.selectionManager.disable(),this._terminal.log("Binding to mouse events.");break;case 1004:this._terminal.sendFocus=!0;break;case 1005:this._terminal.utfMouse=!0;break;case 1006:this._terminal.sgrMouse=!0;break;case 1015:this._terminal.urxvtMouse=!0;break;case 25:this._terminal.cursorHidden=!1;break;case 1048:this.saveCursor(params);break;case 1049:this.saveCursor(params);case 47:case 1047:this._terminal.buffers.activateAltBuffer(this._terminal.eraseAttrData()),this._terminal.refresh(0,this._terminal.rows-1),this._terminal.viewport&&this._terminal.viewport.syncScrollArea(),this._terminal.showCursor();break;case 2004:this._terminal.bracketedPasteMode=!0}}else switch(params[0]){case 4:this._terminal.insertMode=!0}},InputHandler.prototype.resetMode=function(params,collect){if(1<params.length)for(var i=0;i<params.length;i++)this.resetMode([params[i]]);else if(collect){if("?"===collect)switch(params[0]){case 1:this._terminal.applicationCursor=!1;break;case 3:132===this._terminal.cols&&this._terminal.savedCols&&this._terminal.resize(this._terminal.savedCols,this._terminal.rows),delete this._terminal.savedCols;break;case 6:this._terminal.originMode=!1;break;case 7:this._terminal.wraparoundMode=!1;break;case 12:break;case 66:this._terminal.log("Switching back to normal keypad."),this._terminal.applicationKeypad=!1,this._terminal.viewport&&this._terminal.viewport.syncScrollArea();break;case 9:case 1e3:case 1002:case 1003:this._terminal.x10Mouse=!1,this._terminal.vt200Mouse=!1,this._terminal.normalMouse=!1,this._terminal.mouseEvents=!1,this._terminal.element&&this._terminal.element.classList.remove("enable-mouse-events"),this._terminal.selectionManager&&this._terminal.selectionManager.enable();break;case 1004:this._terminal.sendFocus=!1;break;case 1005:this._terminal.utfMouse=!1;break;case 1006:this._terminal.sgrMouse=!1;break;case 1015:this._terminal.urxvtMouse=!1;break;case 25:this._terminal.cursorHidden=!0;break;case 1048:this.restoreCursor(params);break;case 1049:case 47:case 1047:this._terminal.buffers.activateNormalBuffer(),1049===params[0]&&this.restoreCursor(params),this._terminal.refresh(0,this._terminal.rows-1),this._terminal.viewport&&this._terminal.viewport.syncScrollArea(),this._terminal.showCursor();break;case 2004:this._terminal.bracketedPasteMode=!1}}else switch(params[0]){case 4:this._terminal.insertMode=!1}},InputHandler.prototype.charAttributes=function(params){if(1===params.length&&0===params[0])return this._terminal.curAttrData.fg=Buffer_1.DEFAULT_ATTR_DATA.fg,void(this._terminal.curAttrData.bg=Buffer_1.DEFAULT_ATTR_DATA.bg);for(var p,l=params.length,attr=this._terminal.curAttrData,i=0;i<l;i++)30<=(p=params[i])&&p<=37?(attr.fg&=-50331904,attr.fg|=16777216|p-30):40<=p&&p<=47?(attr.bg&=-50331904,attr.bg|=16777216|p-40):90<=p&&p<=97?(attr.fg&=-50331904,attr.fg|=16777224|p-90):100<=p&&p<=107?(attr.bg&=-50331904,attr.bg|=16777224|p-100):0===p?(attr.fg=Buffer_1.DEFAULT_ATTR_DATA.fg,attr.bg=Buffer_1.DEFAULT_ATTR_DATA.bg):1===p?attr.fg|=134217728:3===p?attr.bg|=67108864:4===p?attr.fg|=268435456:5===p?attr.fg|=536870912:7===p?attr.fg|=67108864:8===p?attr.fg|=1073741824:2===p?attr.bg|=134217728:22===p?(attr.fg&=-134217729,attr.bg&=-134217729):23===p?attr.bg&=-67108865:24===p?attr.fg&=-268435457:25===p?attr.fg&=-536870913:27===p?attr.fg&=-67108865:28===p?attr.fg&=-1073741825:39===p?(attr.fg&=-67108864,attr.fg|=16777215&Buffer_1.DEFAULT_ATTR_DATA.fg):49===p?(attr.bg&=-67108864,attr.bg|=16777215&Buffer_1.DEFAULT_ATTR_DATA.bg):38===p?2===params[i+1]?(i+=2,attr.fg|=50331648,attr.fg&=-16777216,attr.fg|=BufferLine_1.AttributeData.fromColorRGB([params[i],params[i+1],params[i+2]]),i+=2):5===params[i+1]&&(p=255&params[i+=2],attr.fg&=-256,attr.fg|=33554432|p):48===p?2===params[i+1]?(i+=2,attr.bg|=50331648,attr.bg&=-16777216,attr.bg|=BufferLine_1.AttributeData.fromColorRGB([params[i],params[i+1],params[i+2]]),i+=2):5===params[i+1]&&(p=255&params[i+=2],attr.bg&=-256,attr.bg|=33554432|p):100===p?(attr.fg&=-67108864,attr.fg|=16777215&Buffer_1.DEFAULT_ATTR_DATA.fg,attr.bg&=-67108864,attr.bg|=16777215&Buffer_1.DEFAULT_ATTR_DATA.bg):this._terminal.error("Unknown SGR attribute: %d.",p)},InputHandler.prototype.deviceStatus=function(params,collect){if(collect){if("?"===collect)switch(params[0]){case 6:y=this._terminal.buffer.y+1,x=this._terminal.buffer.x+1;this._onData.fire(EscapeSequences_1.C0.ESC+"[?"+y+";"+x+"R")}}else switch(params[0]){case 5:this._onData.fire(EscapeSequences_1.C0.ESC+"[0n");break;case 6:var y=this._terminal.buffer.y+1,x=this._terminal.buffer.x+1;this._onData.fire(EscapeSequences_1.C0.ESC+"["+y+";"+x+"R")}},InputHandler.prototype.softReset=function(params,collect){"!"===collect&&(this._terminal.cursorHidden=!1,this._terminal.insertMode=!1,this._terminal.originMode=!1,this._terminal.wraparoundMode=!0,this._terminal.applicationKeypad=!1,this._terminal.viewport&&this._terminal.viewport.syncScrollArea(),this._terminal.applicationCursor=!1,this._terminal.buffer.scrollTop=0,this._terminal.buffer.scrollBottom=this._terminal.rows-1,this._terminal.curAttrData=Buffer_1.DEFAULT_ATTR_DATA,this._terminal.buffer.x=this._terminal.buffer.y=0,this._terminal.charset=null,this._terminal.glevel=0,this._terminal.charsets=[null])},InputHandler.prototype.setCursorStyle=function(params,collect){if(" "===collect){var param=params[0]<1?1:params[0];switch(param){case 1:case 2:this._terminal.setOption("cursorStyle","block");break;case 3:case 4:this._terminal.setOption("cursorStyle","underline");break;case 5:case 6:this._terminal.setOption("cursorStyle","bar")}var isBlinking=param%2==1;this._terminal.setOption("cursorBlink",isBlinking)}},InputHandler.prototype.setScrollRegion=function(params,collect){collect||(this._terminal.buffer.scrollTop=(params[0]||1)-1,this._terminal.buffer.scrollBottom=(params[1]&&params[1]<=this._terminal.rows?params[1]:this._terminal.rows)-1,this._terminal.buffer.x=0,this._terminal.buffer.y=0)},InputHandler.prototype.saveCursor=function(params){this._terminal.buffer.savedX=this._terminal.buffer.x,this._terminal.buffer.savedY=this._terminal.buffer.y,this._terminal.buffer.savedCurAttrData.fg=this._terminal.curAttrData.fg,this._terminal.buffer.savedCurAttrData.bg=this._terminal.curAttrData.bg},InputHandler.prototype.restoreCursor=function(params){this._terminal.buffer.x=this._terminal.buffer.savedX||0,this._terminal.buffer.y=this._terminal.buffer.savedY||0,this._terminal.curAttrData.fg=this._terminal.buffer.savedCurAttrData.fg,this._terminal.curAttrData.bg=this._terminal.buffer.savedCurAttrData.bg},InputHandler.prototype.setTitle=function(data){this._terminal.handleTitle(data)},InputHandler.prototype.nextLine=function(){this._terminal.buffer.x=0,this.index()},InputHandler.prototype.keypadApplicationMode=function(){this._terminal.log("Serial port requested application keypad."),this._terminal.applicationKeypad=!0,this._terminal.viewport&&this._terminal.viewport.syncScrollArea()},InputHandler.prototype.keypadNumericMode=function(){this._terminal.log("Switching back to normal keypad."),this._terminal.applicationKeypad=!1,this._terminal.viewport&&this._terminal.viewport.syncScrollArea()},InputHandler.prototype.selectDefaultCharset=function(){this._terminal.setgLevel(0),this._terminal.setgCharset(0,Charsets_1.DEFAULT_CHARSET)},InputHandler.prototype.selectCharset=function(collectAndFlag){2===collectAndFlag.length?"/"!==collectAndFlag[0]&&this._terminal.setgCharset(GLEVEL[collectAndFlag[0]],Charsets_1.CHARSETS[collectAndFlag[1]]||Charsets_1.DEFAULT_CHARSET):this.selectDefaultCharset()},InputHandler.prototype.index=function(){this._terminal.index()},InputHandler.prototype.tabSet=function(){this._terminal.tabSet()},InputHandler.prototype.reverseIndex=function(){this._terminal.reverseIndex()},InputHandler.prototype.reset=function(){this._parser.reset(),this._terminal.reset()},InputHandler.prototype.setgLevel=function(level){this._terminal.setgLevel(level)},InputHandler}(Lifecycle_1.Disposable);exports.InputHandler=InputHandler},{"./Buffer":6,"./BufferLine":7,"./CharWidth":11,"./EscapeSequenceParser":14,"./common/EventEmitter2":29,"./common/Lifecycle":30,"./common/TypedArrayUtils":32,"./common/data/EscapeSequences":33,"./core/data/Charsets":34,"./core/input/TextDecoder":36}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MouseZoneManager_1=require("./MouseZoneManager"),CharWidth_1=require("./CharWidth"),EventEmitter2_1=require("./common/EventEmitter2"),Linkifier=function(){function Linkifier(_terminal){this._terminal=_terminal,this._linkMatchers=[],this._nextLinkMatcherId=0,this._onLinkHover=new EventEmitter2_1.EventEmitter2,this._onLinkLeave=new EventEmitter2_1.EventEmitter2,this._onLinkTooltip=new EventEmitter2_1.EventEmitter2,this._rowsToLinkify={start:null,end:null}}return Object.defineProperty(Linkifier.prototype,"onLinkHover",{get:function(){return this._onLinkHover.event},enumerable:!0,configurable:!0}),Object.defineProperty(Linkifier.prototype,"onLinkLeave",{get:function(){return this._onLinkLeave.event},enumerable:!0,configurable:!0}),Object.defineProperty(Linkifier.prototype,"onLinkTooltip",{get:function(){return this._onLinkTooltip.event},enumerable:!0,configurable:!0}),Linkifier.prototype.attachToDom=function(mouseZoneManager){this._mouseZoneManager=mouseZoneManager},Linkifier.prototype.linkifyRows=function(start,end){var _this=this;this._mouseZoneManager&&(null===this._rowsToLinkify.start?(this._rowsToLinkify.start=start,this._rowsToLinkify.end=end):(this._rowsToLinkify.start=Math.min(this._rowsToLinkify.start,start),this._rowsToLinkify.end=Math.max(this._rowsToLinkify.end,end)),this._mouseZoneManager.clearAll(start,end),this._rowsTimeoutId&&clearTimeout(this._rowsTimeoutId),this._rowsTimeoutId=setTimeout(function(){return _this._linkifyRows()},Linkifier.TIME_BEFORE_LINKIFY))},Linkifier.prototype._linkifyRows=function(){this._rowsTimeoutId=null;var buffer=this._terminal.buffer,absoluteRowIndexStart=buffer.ydisp+this._rowsToLinkify.start;if(!(absoluteRowIndexStart>=buffer.lines.length)){for(var absoluteRowIndexEnd=buffer.ydisp+Math.min(this._rowsToLinkify.end,this._terminal.rows)+1,overscanLineLimit=Math.ceil(Linkifier.OVERSCAN_CHAR_LIMIT/this._terminal.cols),iterator=this._terminal.buffer.iterator(!1,absoluteRowIndexStart,absoluteRowIndexEnd,overscanLineLimit,overscanLineLimit);iterator.hasNext();)for(var lineData=iterator.next(),i=0;i<this._linkMatchers.length;i++)this._doLinkifyRow(lineData.range.first,lineData.content,this._linkMatchers[i]);this._rowsToLinkify.start=null,this._rowsToLinkify.end=null}},Linkifier.prototype.registerLinkMatcher=function(regex,handler,options){if(void 0===options&&(options={}),!handler)throw new Error("handler must be defined");var matcher={id:this._nextLinkMatcherId++,regex:regex,handler:handler,matchIndex:options.matchIndex,validationCallback:options.validationCallback,hoverTooltipCallback:options.tooltipCallback,hoverLeaveCallback:options.leaveCallback,willLinkActivate:options.willLinkActivate,priority:options.priority||0};return this._addLinkMatcherToList(matcher),matcher.id},Linkifier.prototype._addLinkMatcherToList=function(matcher){if(0!==this._linkMatchers.length){for(var i=this._linkMatchers.length-1;0<=i;i--)if(matcher.priority<=this._linkMatchers[i].priority)return void this._linkMatchers.splice(i+1,0,matcher);this._linkMatchers.splice(0,0,matcher)}else this._linkMatchers.push(matcher)},Linkifier.prototype.deregisterLinkMatcher=function(matcherId){for(var i=0;i<this._linkMatchers.length;i++)if(this._linkMatchers[i].id===matcherId)return this._linkMatchers.splice(i,1),!0;return!1},Linkifier.prototype._doLinkifyRow=function(rowIndex,text,matcher){for(var match,_this=this,rex=new RegExp(matcher.regex.source,matcher.regex.flags+"g"),stringIndex=-1,_loop_1=function(){var uri=match["number"!=typeof matcher.matchIndex?0:matcher.matchIndex];if(!uri){if(this_1._terminal.debug)throw console.log({match:match,matcher:matcher}),new Error("match found without corresponding matchIndex");return"break"}if(stringIndex=text.indexOf(uri,stringIndex+1),rex.lastIndex=stringIndex+uri.length,stringIndex<0)return"break";var bufferIndex=this_1._terminal.buffer.stringIndexToBufferIndex(rowIndex,stringIndex);if(bufferIndex[0]<0)return"break";var fg,attr=this_1._terminal.buffer.lines.get(bufferIndex[0]).getFg(bufferIndex[1]);attr&&(fg=attr>>9&511),matcher.validationCallback?matcher.validationCallback(uri,function(isValid){_this._rowsTimeoutId||isValid&&_this._addLink(bufferIndex[1],bufferIndex[0]-_this._terminal.buffer.ydisp,uri,matcher,fg)}):this_1._addLink(bufferIndex[1],bufferIndex[0]-this_1._terminal.buffer.ydisp,uri,matcher,fg)},this_1=this;null!==(match=rex.exec(text));){if("break"===_loop_1())break}},Linkifier.prototype._addLink=function(x,y,uri,matcher,fg){var _this=this,width=CharWidth_1.getStringCellWidth(uri),x1=x%this._terminal.cols,y1=y+Math.floor(x/this._terminal.cols),x2=(x1+width)%this._terminal.cols,y2=y1+Math.floor((x1+width)/this._terminal.cols);0===x2&&(x2=this._terminal.cols,y2--),this._mouseZoneManager.add(new MouseZoneManager_1.MouseZone(1+x1,y1+1,x2+1,y2+1,function(e){if(matcher.handler)return matcher.handler(e,uri);window.open(uri,"_blank")},function(){_this._onLinkHover.fire(_this._createLinkHoverEvent(x1,y1,x2,y2,fg)),_this._terminal.element.classList.add("xterm-cursor-pointer")},function(e){_this._onLinkTooltip.fire(_this._createLinkHoverEvent(x1,y1,x2,y2,fg)),matcher.hoverTooltipCallback&&matcher.hoverTooltipCallback(e,uri)},function(){_this._onLinkLeave.fire(_this._createLinkHoverEvent(x1,y1,x2,y2,fg)),_this._terminal.element.classList.remove("xterm-cursor-pointer"),matcher.hoverLeaveCallback&&matcher.hoverLeaveCallback()},function(e){return!matcher.willLinkActivate||matcher.willLinkActivate(e,uri)}))},Linkifier.prototype._createLinkHoverEvent=function(x1,y1,x2,y2,fg){return{x1:x1,y1:y1,x2:x2,y2:y2,cols:this._terminal.cols,fg:fg}},Linkifier.TIME_BEFORE_LINKIFY=200,Linkifier.OVERSCAN_CHAR_LIMIT=2e3,Linkifier}();exports.Linkifier=Linkifier},{"./CharWidth":11,"./MouseZoneManager":18,"./common/EventEmitter2":29}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MouseHelper=function(){function MouseHelper(_renderer){this._renderer=_renderer}return MouseHelper.prototype.setRenderer=function(renderer){this._renderer=renderer},MouseHelper.getCoordsRelativeToElement=function(event,element){var rect=element.getBoundingClientRect();return[event.clientX-rect.left,event.clientY-rect.top]},MouseHelper.prototype.getCoords=function(event,element,charMeasure,colCount,rowCount,isSelection){if(!charMeasure.width||!charMeasure.height)return null;var coords=MouseHelper.getCoordsRelativeToElement(event,element);return coords?(coords[0]=Math.ceil((coords[0]+(isSelection?this._renderer.dimensions.actualCellWidth/2:0))/this._renderer.dimensions.actualCellWidth),coords[1]=Math.ceil(coords[1]/this._renderer.dimensions.actualCellHeight),coords[0]=Math.min(Math.max(coords[0],1),colCount+(isSelection?1:0)),coords[1]=Math.min(Math.max(coords[1],1),rowCount),coords):null},MouseHelper.prototype.getRawByteCoords=function(event,element,charMeasure,colCount,rowCount){var coords=this.getCoords(event,element,charMeasure,colCount,rowCount),x=coords[0],y=coords[1];return{x:x+=32,y:y+=32}},MouseHelper}();exports.MouseHelper=MouseHelper},{}],18:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Lifecycle_1=require("./common/Lifecycle"),Lifecycle_2=require("./ui/Lifecycle"),MouseZoneManager=function(_super){function MouseZoneManager(_terminal){var _this=_super.call(this)||this;return _this._terminal=_terminal,_this._zones=[],_this._areZonesActive=!1,_this._tooltipTimeout=null,_this._currentZone=null,_this._lastHoverCoords=[null,null],_this.register(Lifecycle_2.addDisposableDomListener(_this._terminal.element,"mousedown",function(e){return _this._onMouseDown(e)})),_this._mouseMoveListener=function(e){return _this._onMouseMove(e)},_this._mouseLeaveListener=function(e){return _this._onMouseLeave(e)},_this._clickListener=function(e){return _this._onClick(e)},_this}return __extends(MouseZoneManager,_super),MouseZoneManager.prototype.dispose=function(){_super.prototype.dispose.call(this),this._deactivate()},MouseZoneManager.prototype.add=function(zone){this._zones.push(zone),1===this._zones.length&&this._activate()},MouseZoneManager.prototype.clearAll=function(start,end){if(0!==this._zones.length){end||(start=0,end=this._terminal.rows-1);for(var i=0;i<this._zones.length;i++){var zone=this._zones[i];(zone.y1>start&&zone.y1<=end+1||zone.y2>start&&zone.y2<=end+1||zone.y1<start&&zone.y2>end+1)&&(this._currentZone&&this._currentZone===zone&&(this._currentZone.leaveCallback(),this._currentZone=null),this._zones.splice(i--,1))}0===this._zones.length&&this._deactivate()}},MouseZoneManager.prototype._activate=function(){this._areZonesActive||(this._areZonesActive=!0,this._terminal.element.addEventListener("mousemove",this._mouseMoveListener),this._terminal.element.addEventListener("mouseleave",this._mouseLeaveListener),this._terminal.element.addEventListener("click",this._clickListener))},MouseZoneManager.prototype._deactivate=function(){this._areZonesActive&&(this._areZonesActive=!1,this._terminal.element.removeEventListener("mousemove",this._mouseMoveListener),this._terminal.element.removeEventListener("mouseleave",this._mouseLeaveListener),this._terminal.element.removeEventListener("click",this._clickListener))},MouseZoneManager.prototype._onMouseMove=function(e){this._lastHoverCoords[0]===e.pageX&&this._lastHoverCoords[1]===e.pageY||(this._onHover(e),this._lastHoverCoords=[e.pageX,e.pageY])},MouseZoneManager.prototype._onHover=function(e){var _this=this,zone=this._findZoneEventAt(e);zone!==this._currentZone&&(this._currentZone&&(this._currentZone.leaveCallback(),this._currentZone=null,this._tooltipTimeout&&clearTimeout(this._tooltipTimeout)),zone&&((this._currentZone=zone).hoverCallback&&zone.hoverCallback(e),this._tooltipTimeout=setTimeout(function(){return _this._onTooltip(e)},500)))},MouseZoneManager.prototype._onTooltip=function(e){this._tooltipTimeout=null;var zone=this._findZoneEventAt(e);zone&&zone.tooltipCallback&&zone.tooltipCallback(e)},MouseZoneManager.prototype._onMouseDown=function(e){if(this._initialSelectionLength=this._terminal.getSelection().length,this._areZonesActive){var zone=this._findZoneEventAt(e);zone&&zone.willLinkActivate(e)&&(e.preventDefault(),e.stopImmediatePropagation())}},MouseZoneManager.prototype._onMouseLeave=function(e){this._currentZone&&(this._currentZone.leaveCallback(),this._currentZone=null,this._tooltipTimeout&&clearTimeout(this._tooltipTimeout))},MouseZoneManager.prototype._onClick=function(e){var zone=this._findZoneEventAt(e),currentSelectionLength=this._terminal.getSelection().length;zone&&currentSelectionLength===this._initialSelectionLength&&(zone.clickCallback(e),e.preventDefault(),e.stopImmediatePropagation())},MouseZoneManager.prototype._findZoneEventAt=function(e){var coords=this._terminal.mouseHelper.getCoords(e,this._terminal.screenElement,this._terminal.charMeasure,this._terminal.cols,this._terminal.rows);if(!coords)return null;for(var x=coords[0],y=coords[1],i=0;i<this._zones.length;i++){var zone=this._zones[i];if(zone.y1===zone.y2){if(y===zone.y1&&x>=zone.x1&&x<zone.x2)return zone}else if(y===zone.y1&&x>=zone.x1||y===zone.y2&&x<zone.x2||y>zone.y1&&y<zone.y2)return zone}return null},MouseZoneManager}(Lifecycle_1.Disposable);exports.MouseZoneManager=MouseZoneManager;function MouseZone(x1,y1,x2,y2,clickCallback,hoverCallback,tooltipCallback,leaveCallback,willLinkActivate){this.x1=x1,this.y1=y1,this.x2=x2,this.y2=y2,this.clickCallback=clickCallback,this.hoverCallback=hoverCallback,this.tooltipCallback=tooltipCallback,this.leaveCallback=leaveCallback,this.willLinkActivate=willLinkActivate}exports.MouseZone=MouseZone},{"./common/Lifecycle":30,"./ui/Lifecycle":59}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MouseHelper_1=require("./MouseHelper"),Browser=require("./common/Platform"),SelectionModel_1=require("./SelectionModel"),AltClickHandler_1=require("./handlers/AltClickHandler"),BufferLine_1=require("./BufferLine"),EventEmitter2_1=require("./common/EventEmitter2"),NON_BREAKING_SPACE_CHAR=String.fromCharCode(160),ALL_NON_BREAKING_SPACE_REGEX=new RegExp(NON_BREAKING_SPACE_CHAR,"g"),SelectionManager=function(){function SelectionManager(_terminal,_charMeasure){this._terminal=_terminal,this._charMeasure=_charMeasure,this._enabled=!0,this._workCell=new BufferLine_1.CellData,this._onLinuxMouseSelection=new EventEmitter2_1.EventEmitter2,this._onRedrawRequest=new EventEmitter2_1.EventEmitter2,this._onSelectionChange=new EventEmitter2_1.EventEmitter2,this._initListeners(),this.enable(),this._model=new SelectionModel_1.SelectionModel(_terminal),this._activeSelectionMode=0}return Object.defineProperty(SelectionManager.prototype,"onLinuxMouseSelection",{get:function(){return this._onLinuxMouseSelection.event},enumerable:!0,configurable:!0}),Object.defineProperty(SelectionManager.prototype,"onRedrawRequest",{get:function(){return this._onRedrawRequest.event},enumerable:!0,configurable:!0}),Object.defineProperty(SelectionManager.prototype,"onSelectionChange",{get:function(){return this._onSelectionChange.event},enumerable:!0,configurable:!0}),SelectionManager.prototype.dispose=function(){this._removeMouseDownListeners()},Object.defineProperty(SelectionManager.prototype,"_buffer",{get:function(){return this._terminal.buffers.active},enumerable:!0,configurable:!0}),SelectionManager.prototype._initListeners=function(){var _this=this;this._mouseMoveListener=function(event){return _this._onMouseMove(event)},this._mouseUpListener=function(event){return _this._onMouseUp(event)},this.initBuffersListeners()},SelectionManager.prototype.initBuffersListeners=function(){var _this=this;this._trimListener=this._terminal.buffer.lines.onTrim(function(amount){return _this._onTrim(amount)}),this._terminal.buffers.onBufferActivate(function(e){return _this._onBufferActivate(e)})},SelectionManager.prototype.disable=function(){this.clearSelection(),this._enabled=!1},SelectionManager.prototype.enable=function(){this._enabled=!0},Object.defineProperty(SelectionManager.prototype,"selectionStart",{get:function(){return this._model.finalSelectionStart},enumerable:!0,configurable:!0}),Object.defineProperty(SelectionManager.prototype,"selectionEnd",{get:function(){return this._model.finalSelectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(SelectionManager.prototype,"hasSelection",{get:function(){var start=this._model.finalSelectionStart,end=this._model.finalSelectionEnd;return!(!start||!end)&&(start[0]!==end[0]||start[1]!==end[1])},enumerable:!0,configurable:!0}),Object.defineProperty(SelectionManager.prototype,"selectionText",{get:function(){var start=this._model.finalSelectionStart,end=this._model.finalSelectionEnd;if(!start||!end)return"";var result=[];if(3===this._activeSelectionMode){if(start[0]===end[0])return"";for(var i=start[1];i<=end[1];i++){var lineText=this._buffer.translateBufferLineToString(i,!0,start[0],end[0]);result.push(lineText)}}else{var startRowEndCol=start[1]===end[1]?end[0]:void 0;result.push(this._buffer.translateBufferLineToString(start[1],!0,start[0],startRowEndCol));for(i=start[1]+1;i<=end[1]-1;i++){var bufferLine=this._buffer.lines.get(i);lineText=this._buffer.translateBufferLineToString(i,!0);bufferLine.isWrapped?result[result.length-1]+=lineText:result.push(lineText)}if(start[1]!==end[1]){bufferLine=this._buffer.lines.get(end[1]),lineText=this._buffer.translateBufferLineToString(end[1],!0,0,end[0]);bufferLine.isWrapped?result[result.length-1]+=lineText:result.push(lineText)}}return result.map(function(line){return line.replace(ALL_NON_BREAKING_SPACE_REGEX," ")}).join(Browser.isMSWindows?"\r\n":"\n")},enumerable:!0,configurable:!0}),SelectionManager.prototype.clearSelection=function(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh()},SelectionManager.prototype.refresh=function(isLinuxMouseSelection){var _this=this;this._refreshAnimationFrame||(this._refreshAnimationFrame=window.requestAnimationFrame(function(){return _this._refresh()})),Browser.isLinux&&isLinuxMouseSelection&&(this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText))},SelectionManager.prototype._refresh=function(){this._refreshAnimationFrame=null,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:3===this._activeSelectionMode})},SelectionManager.prototype.isClickInSelection=function(event){var coords=this._getMouseBufferCoords(event),start=this._model.finalSelectionStart,end=this._model.finalSelectionEnd;return!(!start||!end)&&this._areCoordsInSelection(coords,start,end)},SelectionManager.prototype._areCoordsInSelection=function(coords,start,end){return coords[1]>start[1]&&coords[1]<end[1]||start[1]===end[1]&&coords[1]===start[1]&&coords[0]>=start[0]&&coords[0]<end[0]||start[1]<end[1]&&coords[1]===end[1]&&coords[0]<end[0]||start[1]<end[1]&&coords[1]===start[1]&&coords[0]>=start[0]},SelectionManager.prototype.selectWordAtCursor=function(event){var coords=this._getMouseBufferCoords(event);coords&&(this._selectWordAt(coords,!1),this._model.selectionEnd=null,this.refresh(!0))},SelectionManager.prototype.selectAll=function(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()},SelectionManager.prototype.selectLines=function(start,end){this._model.clearSelection(),start=Math.max(start,0),end=Math.min(end,this._terminal.buffer.lines.length-1),this._model.selectionStart=[0,start],this._model.selectionEnd=[this._terminal.cols,end],this.refresh(),this._onSelectionChange.fire()},SelectionManager.prototype._onTrim=function(amount){this._model.onTrim(amount)&&this.refresh()},SelectionManager.prototype._getMouseBufferCoords=function(event){var coords=this._terminal.mouseHelper.getCoords(event,this._terminal.screenElement,this._charMeasure,this._terminal.cols,this._terminal.rows,!0);return coords?(coords[0]--,coords[1]--,coords[1]+=this._terminal.buffer.ydisp,coords):null},SelectionManager.prototype._getMouseEventScrollAmount=function(event){var offset=MouseHelper_1.MouseHelper.getCoordsRelativeToElement(event,this._terminal.screenElement)[1],terminalHeight=this._terminal.rows*Math.ceil(this._charMeasure.height*this._terminal.options.lineHeight);return 0<=offset&&offset<=terminalHeight?0:(terminalHeight<offset&&(offset-=terminalHeight),offset=Math.min(Math.max(offset,-50),50),(offset/=50)/Math.abs(offset)+Math.round(14*offset))},SelectionManager.prototype.shouldForceSelection=function(event){return Browser.isMac?event.altKey&&this._terminal.options.macOptionClickForcesSelection:event.shiftKey},SelectionManager.prototype.onMouseDown=function(event){if(this._mouseDownTimeStamp=event.timeStamp,(2!==event.button||!this.hasSelection)&&0===event.button){if(!this._enabled){if(!this.shouldForceSelection(event))return;event.stopPropagation()}event.preventDefault(),this._dragScrollAmount=0,this._enabled&&event.shiftKey?this._onIncrementalClick(event):1===event.detail?this._onSingleClick(event):2===event.detail?this._onDoubleClick(event):3===event.detail&&this._onTripleClick(event),this._addMouseDownListeners(),this.refresh(!0)}},SelectionManager.prototype._addMouseDownListeners=function(){var _this=this;this._terminal.element.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._terminal.element.ownerDocument.addEventListener("mouseup",this._mouseUpListener),this._dragScrollIntervalTimer=setInterval(function(){return _this._dragScroll()},50)},SelectionManager.prototype._removeMouseDownListeners=function(){this._terminal.element.ownerDocument&&(this._terminal.element.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._terminal.element.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=null},SelectionManager.prototype._onIncrementalClick=function(event){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(event))},SelectionManager.prototype._onSingleClick=function(event){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(event)?3:0,this._model.selectionStart=this._getMouseBufferCoords(event),this._model.selectionStart){this._model.selectionEnd=null;var line=this._buffer.lines.get(this._model.selectionStart[1]);line&&(line.length>=this._model.selectionStart[0]||0===line.hasWidth(this._model.selectionStart[0])&&this._model.selectionStart[0]++)}},SelectionManager.prototype._onDoubleClick=function(event){var coords=this._getMouseBufferCoords(event);coords&&(this._activeSelectionMode=1,this._selectWordAt(coords,!0))},SelectionManager.prototype._onTripleClick=function(event){var coords=this._getMouseBufferCoords(event);coords&&(this._activeSelectionMode=2,this._selectLineAt(coords[1]))},SelectionManager.prototype.shouldColumnSelect=function(event){return event.altKey&&!(Browser.isMac&&this._terminal.options.macOptionClickForcesSelection)},SelectionManager.prototype._onMouseMove=function(event){event.stopImmediatePropagation();var previousSelectionEnd=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;this._model.selectionEnd=this._getMouseBufferCoords(event),this._model.selectionEnd?(2===this._activeSelectionMode?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._terminal.cols:1===this._activeSelectionMode&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(event),3!==this._activeSelectionMode&&(0<this._dragScrollAmount?this._model.selectionEnd[0]=this._terminal.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0)),this._model.selectionEnd[1]<this._buffer.lines.length&&0===this._buffer.lines.get(this._model.selectionEnd[1]).hasWidth(this._model.selectionEnd[0])&&this._model.selectionEnd[0]++,previousSelectionEnd&&previousSelectionEnd[0]===this._model.selectionEnd[0]&&previousSelectionEnd[1]===this._model.selectionEnd[1]||this.refresh(!0)):this.refresh(!0)},SelectionManager.prototype._dragScroll=function(){this._dragScrollAmount&&(this._terminal.scrollLines(this._dragScrollAmount,!1),0<this._dragScrollAmount?(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=this._terminal.cols),this._model.selectionEnd[1]=Math.min(this._terminal.buffer.ydisp+this._terminal.rows,this._terminal.buffer.lines.length-1)):(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=this._terminal.buffer.ydisp),this.refresh())},SelectionManager.prototype._onMouseUp=function(event){var timeElapsed=event.timeStamp-this._mouseDownTimeStamp;this._removeMouseDownListeners(),this.selectionText.length<=1&&timeElapsed<500?new AltClickHandler_1.AltClickHandler(event,this._terminal).move():this.hasSelection&&this._onSelectionChange.fire()},SelectionManager.prototype._onBufferActivate=function(e){var _this=this;this.clearSelection(),this._trimListener&&this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim(function(amount){return _this._onTrim(amount)})},SelectionManager.prototype._convertViewportColToCharacterIndex=function(bufferLine,coords){for(var charIndex=coords[0],i=0;coords[0]>=i;i++){var length_1=bufferLine.loadCell(i,this._workCell).getChars().length;0===this._workCell.getWidth()?charIndex--:1<length_1&&coords[0]!==i&&(charIndex+=length_1-1)}return charIndex},SelectionManager.prototype.setSelection=function(col,row,length){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[col,row],this._model.selectionStartLength=length,this.refresh()},SelectionManager.prototype._getWordAt=function(coords,allowWhitespaceOnlySelection,followWrappedLinesAbove,followWrappedLinesBelow){if(void 0===followWrappedLinesAbove&&(followWrappedLinesAbove=!0),void 0===followWrappedLinesBelow&&(followWrappedLinesBelow=!0),coords[0]>=this._terminal.cols)return null;var bufferLine=this._buffer.lines.get(coords[1]);if(!bufferLine)return null;var line=this._buffer.translateBufferLineToString(coords[1],!1),startIndex=this._convertViewportColToCharacterIndex(bufferLine,coords),endIndex=startIndex,charOffset=coords[0]-startIndex,leftWideCharCount=0,rightWideCharCount=0,leftLongCharOffset=0,rightLongCharOffset=0;if(" "===line.charAt(startIndex)){for(;0<startIndex&&" "===line.charAt(startIndex-1);)startIndex--;for(;endIndex<line.length&&" "===line.charAt(endIndex+1);)endIndex++}else{var startCol=coords[0],endCol=coords[0];0===bufferLine.getWidth(startCol)&&(leftWideCharCount++,startCol--),2===bufferLine.getWidth(endCol)&&(rightWideCharCount++,endCol++);var length_2=bufferLine.getString(endCol).length;for(1<length_2&&(rightLongCharOffset+=length_2-1,endIndex+=length_2-1);0<startCol&&0<startIndex&&!this._isCharWordSeparator(bufferLine.loadCell(startCol-1,this._workCell));){bufferLine.loadCell(startCol-1,this._workCell);var length_3=this._workCell.getChars().length;0===this._workCell.getWidth()?(leftWideCharCount++,startCol--):1<length_3&&(leftLongCharOffset+=length_3-1,startIndex-=length_3-1),startIndex--,startCol--}for(;endCol<bufferLine.length&&endIndex+1<line.length&&!this._isCharWordSeparator(bufferLine.loadCell(endCol+1,this._workCell));){bufferLine.loadCell(endCol+1,this._workCell);var length_4=this._workCell.getChars().length;2===this._workCell.getWidth()?(rightWideCharCount++,endCol++):1<length_4&&(rightLongCharOffset+=length_4-1,endIndex+=length_4-1),endIndex++,endCol++}}endIndex++;var start=startIndex+charOffset-leftWideCharCount+leftLongCharOffset,length=Math.min(this._terminal.cols,endIndex-startIndex+leftWideCharCount+rightWideCharCount-leftLongCharOffset-rightLongCharOffset);if(!allowWhitespaceOnlySelection&&""===line.slice(startIndex,endIndex).trim())return null;if(followWrappedLinesAbove&&0===start&&32!==bufferLine.getCodePoint(0)){var previousBufferLine=this._buffer.lines.get(coords[1]-1);if(previousBufferLine&&bufferLine.isWrapped&&32!==previousBufferLine.getCodePoint(this._terminal.cols-1)){var previousLineWordPosition=this._getWordAt([this._terminal.cols-1,coords[1]-1],!1,!0,!1);if(previousLineWordPosition){var offset=this._terminal.cols-previousLineWordPosition.start;start-=offset,length+=offset}}}if(followWrappedLinesBelow&&start+length===this._terminal.cols&&32!==bufferLine.getCodePoint(this._terminal.cols-1)){var nextBufferLine=this._buffer.lines.get(coords[1]+1);if(nextBufferLine&&nextBufferLine.isWrapped&&32!==nextBufferLine.getCodePoint(0)){var nextLineWordPosition=this._getWordAt([0,coords[1]+1],!1,!1,!0);nextLineWordPosition&&(length+=nextLineWordPosition.length)}}return{start:start,length:length}},SelectionManager.prototype._selectWordAt=function(coords,allowWhitespaceOnlySelection){var wordPosition=this._getWordAt(coords,allowWhitespaceOnlySelection);if(wordPosition){for(;wordPosition.start<0;)wordPosition.start+=this._terminal.cols,coords[1]--;this._model.selectionStart=[wordPosition.start,coords[1]],this._model.selectionStartLength=wordPosition.length}},SelectionManager.prototype._selectToWordAt=function(coords){var wordPosition=this._getWordAt(coords,!0);if(wordPosition){for(var endRow=coords[1];wordPosition.start<0;)wordPosition.start+=this._terminal.cols,endRow--;if(!this._model.areSelectionValuesReversed())for(;wordPosition.start+wordPosition.length>this._terminal.cols;)wordPosition.length-=this._terminal.cols,endRow++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?wordPosition.start:wordPosition.start+wordPosition.length,endRow]}},SelectionManager.prototype._isCharWordSeparator=function(cell){return 0!==cell.getWidth()&&0<=" ()[]{}'\"".indexOf(cell.getChars())},SelectionManager.prototype._selectLineAt=function(line){var wrappedRange=this._buffer.getWrappedRangeForLine(line);this._model.selectionStart=[0,wrappedRange.first],this._model.selectionEnd=[this._terminal.cols,wrappedRange.last],this._model.selectionStartLength=0},SelectionManager}();exports.SelectionManager=SelectionManager},{"./BufferLine":7,"./MouseHelper":17,"./SelectionModel":20,"./common/EventEmitter2":29,"./common/Platform":31,"./handlers/AltClickHandler":37}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SelectionModel=function(){function SelectionModel(_terminal){this._terminal=_terminal,this.clearSelection()}return SelectionModel.prototype.clearSelection=function(){this.selectionStart=null,this.selectionEnd=null,this.isSelectAllActive=!1,this.selectionStartLength=0},Object.defineProperty(SelectionModel.prototype,"finalSelectionStart",{get:function(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart},enumerable:!0,configurable:!0}),Object.defineProperty(SelectionModel.prototype,"finalSelectionEnd",{get:function(){if(this.isSelectAllActive)return[this._terminal.cols,this._terminal.buffer.ybase+this._terminal.rows-1];if(!this.selectionStart)return null;if(this.selectionEnd&&!this.areSelectionValuesReversed())return this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]?[Math.max(this.selectionStart[0]+this.selectionStartLength,this.selectionEnd[0]),this.selectionEnd[1]]:this.selectionEnd;var startPlusLength=this.selectionStart[0]+this.selectionStartLength;return startPlusLength>this._terminal.cols?[startPlusLength%this._terminal.cols,this.selectionStart[1]+Math.floor(startPlusLength/this._terminal.cols)]:[startPlusLength,this.selectionStart[1]]},enumerable:!0,configurable:!0}),SelectionModel.prototype.areSelectionValuesReversed=function(){var start=this.selectionStart,end=this.selectionEnd;return!(!start||!end)&&(start[1]>end[1]||start[1]===end[1]&&start[0]>end[0])},SelectionModel.prototype.onTrim=function(amount){return this.selectionStart&&(this.selectionStart[1]-=amount),this.selectionEnd&&(this.selectionEnd[1]-=amount),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)},SelectionModel}();exports.SelectionModel=SelectionModel},{}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DEFAULT_BELL_SOUND="data:audio/wav;base64,UklGRigBAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQBAADpAFgCwAMlBZoG/wdmCcoKRAypDQ8PbRDBEQQTOxRtFYcWlBePGIUZXhoiG88bcBz7HHIdzh0WHlMeZx51HmkeUx4WHs8dah0AHXwc3hs9G4saxRnyGBIYGBcQFv8U4RPAEoYRQBACD70NWwwHC6gJOwjWBloF7gOBAhABkf8b/qv8R/ve+Xf4Ife79W/0JfPZ8Z/wde9N7ijtE+wU6xvqM+lb6H7nw+YX5mrlxuQz5Mzje+Ma49fioeKD4nXiYeJy4pHitOL04j/jn+MN5IPkFOWs5U3mDefM55/ogOl36m7rdOyE7abuyu8D8Unyj/Pg9D/2qfcb+Yn6/vuK/Qj/lAAlAg==";var SoundManager=function(){function SoundManager(_terminal){this._terminal=_terminal}return Object.defineProperty(SoundManager,"audioContext",{get:function(){if(!SoundManager._audioContext){var audioContextCtor=window.AudioContext||window.webkitAudioContext;if(!audioContextCtor)return console.warn("Web Audio API is not supported by this browser. Consider upgrading to the latest version"),null;SoundManager._audioContext=new audioContextCtor}return SoundManager._audioContext},enumerable:!0,configurable:!0}),SoundManager.prototype.playBellSound=function(){var ctx=SoundManager.audioContext;if(ctx){var bellAudioSource=ctx.createBufferSource();ctx.decodeAudioData(this._base64ToArrayBuffer(this._removeMimeType(this._terminal.options.bellSound)),function(buffer){bellAudioSource.buffer=buffer,bellAudioSource.connect(ctx.destination),bellAudioSource.start(0)})}},SoundManager.prototype._base64ToArrayBuffer=function(base64){for(var binaryString=window.atob(base64),len=binaryString.length,bytes=new Uint8Array(len),i=0;i<len;i++)bytes[i]=binaryString.charCodeAt(i);return bytes.buffer},SoundManager.prototype._removeMimeType=function(dataURI){return dataURI.split(",")[1]},SoundManager}();exports.SoundManager=SoundManager},{}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.blankLine="Blank line",exports.promptLabel="Terminal input",exports.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},{}],23:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var BufferSet_1=require("./BufferSet"),Buffer_1=require("./Buffer"),CompositionHelper_1=require("./CompositionHelper"),EventEmitter_1=require("./common/EventEmitter"),Viewport_1=require("./Viewport"),Clipboard_1=require("./Clipboard"),EscapeSequences_1=require("./common/data/EscapeSequences"),InputHandler_1=require("./InputHandler"),Renderer_1=require("./renderer/Renderer"),Linkifier_1=require("./Linkifier"),SelectionManager_1=require("./SelectionManager"),CharMeasure_1=require("./CharMeasure"),Browser=require("./common/Platform"),Lifecycle_1=require("./ui/Lifecycle"),Strings=require("./Strings"),MouseHelper_1=require("./MouseHelper"),SoundManager_1=require("./SoundManager"),MouseZoneManager_1=require("./MouseZoneManager"),AccessibilityManager_1=require("./AccessibilityManager"),ScreenDprMonitor_1=require("./ui/ScreenDprMonitor"),CharAtlasCache_1=require("./renderer/atlas/CharAtlasCache"),DomRenderer_1=require("./renderer/dom/DomRenderer"),Keyboard_1=require("./core/input/Keyboard"),Clone_1=require("./common/Clone"),EventEmitter2_1=require("./common/EventEmitter2"),WindowsMode_1=require("./WindowsMode"),document="undefined"!=typeof window?window.document:null,CONSTRUCTOR_ONLY_OPTIONS=["cols","rows"],DEFAULT_OPTIONS={cols:80,rows:24,convertEol:!1,termName:"xterm",cursorBlink:!1,cursorStyle:"block",bellSound:SoundManager_1.DEFAULT_BELL_SOUND,bellStyle:"none",drawBoldTextInBrightColors:!0,enableBold:!0,experimentalCharAtlas:"static",fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",lineHeight:1,letterSpacing:0,scrollback:1e3,screenKeys:!1,screenReaderMode:!1,debug:!1,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,cancelEvents:!1,disableStdin:!1,useFlowControl:!1,allowTransparency:!1,tabStopWidth:8,theme:null,rightClickSelectsWord:Browser.isMac,rendererType:"canvas",windowsMode:!1},Terminal=function(_super){function Terminal(options){void 0===options&&(options={});var _this=_super.call(this)||this;return _this.browser=Browser,_this._blankLine=null,_this._onCursorMove=new EventEmitter2_1.EventEmitter2,_this._onData=new EventEmitter2_1.EventEmitter2,_this._onKey=new EventEmitter2_1.EventEmitter2,_this._onLineFeed=new EventEmitter2_1.EventEmitter2,_this._onRender=new EventEmitter2_1.EventEmitter2,_this._onResize=new EventEmitter2_1.EventEmitter2,_this._onScroll=new EventEmitter2_1.EventEmitter2,_this._onSelectionChange=new EventEmitter2_1.EventEmitter2,_this._onTitleChange=new EventEmitter2_1.EventEmitter2,_this.options=Clone_1.clone(options),_this._setup(),_this.onCursorMove(function(){return _this.emit("cursormove")}),_this.onData(function(e){return _this.emit("data",e)}),_this.onKey(function(e){return _this.emit("key",e.key,e.domEvent)}),_this.onLineFeed(function(){return _this.emit("linefeed")}),_this.onRender(function(e){return _this.emit("refresh",e)}),_this.onResize(function(e){return _this.emit("resize",e)}),_this.onSelectionChange(function(){return _this.emit("selection")}),_this.onScroll(function(e){return _this.emit("scroll",e)}),_this.onTitleChange(function(e){return _this.emit("title",e)}),_this}return __extends(Terminal,_super),Object.defineProperty(Terminal.prototype,"onCursorMove",{get:function(){return this._onCursorMove.event},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onData",{get:function(){return this._onData.event},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onKey",{get:function(){return this._onKey.event},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onLineFeed",{get:function(){return this._onLineFeed.event},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onRender",{get:function(){return this._onRender.event},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onResize",{get:function(){return this._onResize.event},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onScroll",{get:function(){return this._onScroll.event},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onSelectionChange",{get:function(){return this._onSelectionChange.event},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onTitleChange",{get:function(){return this._onTitleChange.event},enumerable:!0,configurable:!0}),Terminal.prototype.dispose=function(){_super.prototype.dispose.call(this),this._windowsMode&&(this._windowsMode.dispose(),this._windowsMode=void 0),this._customKeyEventHandler=null,CharAtlasCache_1.removeTerminalFromCache(this),this.handler=function(){},this.write=function(){},this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)},Terminal.prototype.destroy=function(){this.dispose()},Terminal.prototype._setup=function(){var _this=this;Object.keys(DEFAULT_OPTIONS).forEach(function(key){null!==_this.options[key]&&void 0!==_this.options[key]||(_this.options[key]=DEFAULT_OPTIONS[key])}),this._parent=document?document.body:null,this.cols=Math.max(this.options.cols,2),this.rows=Math.max(this.options.rows,1),this.options.handler&&this.onData(this.options.handler),this.cursorState=0,this.cursorHidden=!1,this._customKeyEventHandler=null,this.applicationKeypad=!1,this.applicationCursor=!1,this.originMode=!1,this.insertMode=!1,this.wraparoundMode=!0,this.bracketedPasteMode=!1,this.charset=null,this.gcharset=null,this.glevel=0,this.charsets=[null],this.curAttrData=Buffer_1.DEFAULT_ATTR_DATA.clone(),this._eraseAttrData=Buffer_1.DEFAULT_ATTR_DATA.clone(),this.params=[],this.currentParam=0,this.writeBuffer=[],this._writeInProgress=!1,this._xoffSentToCatchUp=!1,this._userScrolling=!1,this._inputHandler=new InputHandler_1.InputHandler(this),this._inputHandler.onCursorMove(function(){return _this._onCursorMove.fire()}),this._inputHandler.onLineFeed(function(){return _this._onLineFeed.fire()}),this.register(this._inputHandler),this.renderer=this.renderer||null,this.selectionManager=this.selectionManager||null,this.linkifier=this.linkifier||new Linkifier_1.Linkifier(this),this._mouseZoneManager=this._mouseZoneManager||null,this.soundManager=this.soundManager||new SoundManager_1.SoundManager(this),this.buffers=new BufferSet_1.BufferSet(this),this.selectionManager&&(this.selectionManager.clearSelection(),this.selectionManager.initBuffersListeners()),this.options.windowsMode&&(this._windowsMode=WindowsMode_1.applyWindowsMode(this))},Object.defineProperty(Terminal.prototype,"buffer",{get:function(){return this.buffers.active},enumerable:!0,configurable:!0}),Terminal.prototype.eraseAttrData=function(){return this._eraseAttrData.bg&=-67108864,this._eraseAttrData.bg|=67108863&this.curAttrData.bg,this._eraseAttrData},Terminal.prototype.focus=function(){this.textarea&&this.textarea.focus({preventScroll:!0})},Object.defineProperty(Terminal.prototype,"isFocused",{get:function(){return document.activeElement===this.textarea&&document.hasFocus()},enumerable:!0,configurable:!0}),Terminal.prototype.getOption=function(key){if(!(key in DEFAULT_OPTIONS))throw new Error('No option with key "'+key+'"');return this.options[key]},Terminal.prototype.setOption=function(key,value){if(!(key in DEFAULT_OPTIONS))throw new Error('No option with key "'+key+'"');if(-1!==CONSTRUCTOR_ONLY_OPTIONS.indexOf(key)&&console.error('Option "'+key+'" can only be set in the constructor'),this.options[key]!==value){switch(key){case"bellStyle":value||(value="none");break;case"cursorStyle":value||(value="block");break;case"fontWeight":value||(value="normal");break;case"fontWeightBold":value||(value="bold");break;case"lineHeight":if(value<1)return void console.warn(key+" cannot be less than 1, value: "+value);case"rendererType":value||(value="canvas");break;case"tabStopWidth":if(value<1)return void console.warn(key+" cannot be less than 1, value: "+value);break;case"theme":if(this.renderer)return void this._setTheme(value);break;case"scrollback":if((value=Math.min(value,Buffer_1.MAX_BUFFER_SIZE))<0)return void console.warn(key+" cannot be less than 0, value: "+value);if(this.options[key]!==value){var newBufferLength=this.rows+value;if(this.buffer.lines.length>newBufferLength){var amountToTrim=this.buffer.lines.length-newBufferLength,needsRefresh=this.buffer.ydisp-amountToTrim<0;this.buffer.lines.trimStart(amountToTrim),this.buffer.ybase=Math.max(this.buffer.ybase-amountToTrim,0),this.buffer.ydisp=Math.max(this.buffer.ydisp-amountToTrim,0),needsRefresh&&this.refresh(0,this.rows-1)}}}switch(this.options[key]=value,key){case"fontFamily":case"fontSize":this.renderer&&(this.renderer.clear(),this.charMeasure.measure(this.options));break;case"drawBoldTextInBrightColors":case"experimentalCharAtlas":case"enableBold":case"letterSpacing":case"lineHeight":case"fontWeight":case"fontWeightBold":this.renderer&&(this.renderer.clear(),this.renderer.onResize(this.cols,this.rows),this.refresh(0,this.rows-1));break;case"rendererType":this.renderer&&(this.unregister(this.renderer),this.renderer.dispose(),this.renderer=null),this._setupRenderer(),this.renderer.onCharSizeChanged(),this._theme&&this.renderer.setTheme(this._theme),this.mouseHelper.setRenderer(this.renderer);break;case"scrollback":this.buffers.resize(this.cols,this.rows),this.viewport&&this.viewport.syncScrollArea();break;case"screenReaderMode":value?this._accessibilityManager||(this._accessibilityManager=new AccessibilityManager_1.AccessibilityManager(this)):this._accessibilityManager&&(this._accessibilityManager.dispose(),this._accessibilityManager=null);break;case"tabStopWidth":this.buffers.setupTabStops();break;case"windowsMode":value?this._windowsMode||(this._windowsMode=WindowsMode_1.applyWindowsMode(this)):this._windowsMode&&(this._windowsMode.dispose(),this._windowsMode=void 0)}this.renderer&&this.renderer.onOptionsChanged()}},Terminal.prototype._onTextAreaFocus=function(ev){this.sendFocus&&this.handler(EscapeSequences_1.C0.ESC+"[I"),this.updateCursorStyle(ev),this.element.classList.add("focus"),this.showCursor(),this.emit("focus")},Terminal.prototype.blur=function(){return this.textarea.blur()},Terminal.prototype._onTextAreaBlur=function(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.sendFocus&&this.handler(EscapeSequences_1.C0.ESC+"[O"),this.element.classList.remove("focus"),this.emit("blur")},Terminal.prototype._initGlobal=function(){var _this=this;this._bindKeys(),this.register(Lifecycle_1.addDisposableDomListener(this.element,"copy",function(event){_this.hasSelection()&&Clipboard_1.copyHandler(event,_this,_this.selectionManager)}));function pasteHandlerWrapper(event){return Clipboard_1.pasteHandler(event,_this)}this.register(Lifecycle_1.addDisposableDomListener(this.textarea,"paste",pasteHandlerWrapper)),this.register(Lifecycle_1.addDisposableDomListener(this.element,"paste",pasteHandlerWrapper)),Browser.isFirefox?this.register(Lifecycle_1.addDisposableDomListener(this.element,"mousedown",function(event){2===event.button&&Clipboard_1.rightClickHandler(event,_this,_this.selectionManager,_this.options.rightClickSelectsWord)})):this.register(Lifecycle_1.addDisposableDomListener(this.element,"contextmenu",function(event){Clipboard_1.rightClickHandler(event,_this,_this.selectionManager,_this.options.rightClickSelectsWord)})),Browser.isLinux&&this.register(Lifecycle_1.addDisposableDomListener(this.element,"auxclick",function(event){1===event.button&&Clipboard_1.moveTextAreaUnderMouseCursor(event,_this)}))},Terminal.prototype._bindKeys=function(){var _this=this,self=this;this.register(Lifecycle_1.addDisposableDomListener(this.element,"keydown",function(ev){document.activeElement===this&&self._keyDown(ev)},!0)),this.register(Lifecycle_1.addDisposableDomListener(this.element,"keypress",function(ev){document.activeElement===this&&self._keyPress(ev)},!0)),this.register(Lifecycle_1.addDisposableDomListener(this.element,"keyup",function(ev){!function(ev){return 16===ev.keyCode||17===ev.keyCode||18===ev.keyCode}(ev)&&_this.focus(),self._keyUp(ev)},!0)),this.register(Lifecycle_1.addDisposableDomListener(this.textarea,"keydown",function(ev){return _this._keyDown(ev)},!0)),this.register(Lifecycle_1.addDisposableDomListener(this.textarea,"keypress",function(ev){return _this._keyPress(ev)},!0)),this.register(Lifecycle_1.addDisposableDomListener(this.textarea,"compositionstart",function(){return _this._compositionHelper.compositionstart()})),this.register(Lifecycle_1.addDisposableDomListener(this.textarea,"compositionupdate",function(e){return _this._compositionHelper.compositionupdate(e)})),this.register(Lifecycle_1.addDisposableDomListener(this.textarea,"compositionend",function(){return _this._compositionHelper.compositionend()})),this.register(this.onRender(function(){return _this._compositionHelper.updateCompositionElements()})),this.register(this.onRender(function(e){return _this._queueLinkification(e.start,e.end)}))},Terminal.prototype.open=function(parent){var _this=this;if(this._parent=parent||this._parent,!this._parent)throw new Error("Terminal requires a parent element.");this._context=this._parent.ownerDocument.defaultView,this._document=this._parent.ownerDocument,this._screenDprMonitor=new ScreenDprMonitor_1.ScreenDprMonitor,this._screenDprMonitor.setListener(function(){return _this.emit("dprchange",window.devicePixelRatio)}),this.register(this._screenDprMonitor),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),this.element.setAttribute("tabindex","0"),this._parent.appendChild(this.element);var fragment=document.createDocumentFragment();this._viewportElement=document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),fragment.appendChild(this._viewportElement),this._viewportScrollArea=document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),fragment.appendChild(this.screenElement),this._mouseZoneManager=new MouseZoneManager_1.MouseZoneManager(this),this.register(this._mouseZoneManager),this.register(this.onScroll(function(){return _this._mouseZoneManager.clearAll()})),this.linkifier.attachToDom(this._mouseZoneManager),this.textarea=document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",Strings.promptLabel),this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this.register(Lifecycle_1.addDisposableDomListener(this.textarea,"focus",function(ev){return _this._onTextAreaFocus(ev)})),this.register(Lifecycle_1.addDisposableDomListener(this.textarea,"blur",function(){return _this._onTextAreaBlur()})),this._helperContainer.appendChild(this.textarea),this._compositionView=document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=new CompositionHelper_1.CompositionHelper(this.textarea,this._compositionView,this),this._helperContainer.appendChild(this._compositionView),this.charMeasure=new CharMeasure_1.CharMeasure(document,this._helperContainer),this.element.appendChild(fragment),this._setupRenderer(),this._theme=this.options.theme,this.options.theme=null,this.viewport=new Viewport_1.Viewport(this,this._viewportElement,this._viewportScrollArea,this.charMeasure),this.viewport.onThemeChanged(this.renderer.colorManager.colors),this.register(this.viewport),this.register(this.onCursorMove(function(){return _this.renderer.onCursorMove()})),this.register(this.onResize(function(){return _this.renderer.onResize(_this.cols,_this.rows)})),this.register(this.addDisposableListener("blur",function(){return _this.renderer.onBlur()})),this.register(this.addDisposableListener("focus",function(){return _this.renderer.onFocus()})),this.register(this.addDisposableListener("dprchange",function(){return _this.renderer.onWindowResize(window.devicePixelRatio)})),this.register(Lifecycle_1.addDisposableDomListener(window,"resize",function(){return _this.renderer.onWindowResize(window.devicePixelRatio)})),this.register(this.charMeasure.onCharSizeChanged(function(){return _this.renderer.onCharSizeChanged()})),this.register(this.renderer.onCanvasResize(function(){return _this.viewport.syncScrollArea()})),this.selectionManager=new SelectionManager_1.SelectionManager(this,this.charMeasure),this.register(this.selectionManager.onSelectionChange(function(){return _this._onSelectionChange.fire()})),this.register(Lifecycle_1.addDisposableDomListener(this.element,"mousedown",function(e){return _this.selectionManager.onMouseDown(e)})),this.register(this.selectionManager.onRedrawRequest(function(e){return _this.renderer.onSelectionChanged(e.start,e.end,e.columnSelectMode)})),this.register(this.selectionManager.onLinuxMouseSelection(function(text){_this.textarea.value=text,_this.textarea.focus(),_this.textarea.select()})),this.register(this.onScroll(function(){_this.viewport.syncScrollArea(),_this.selectionManager.refresh()})),this.register(Lifecycle_1.addDisposableDomListener(this._viewportElement,"scroll",function(){return _this.selectionManager.refresh()})),this.mouseHelper=new MouseHelper_1.MouseHelper(this.renderer),this.element.classList.toggle("enable-mouse-events",this.mouseEvents),this.mouseEvents?this.selectionManager.disable():this.selectionManager.enable(),this.options.screenReaderMode&&(this._accessibilityManager=new AccessibilityManager_1.AccessibilityManager(this)),this.charMeasure.measure(this.options),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()},Terminal.prototype._setupRenderer=function(){var _this=this;switch(this.options.rendererType){case"canvas":this.renderer=new Renderer_1.Renderer(this,this.options.theme);break;case"dom":this.renderer=new DomRenderer_1.DomRenderer(this,this.options.theme);break;default:throw new Error('Unrecognized rendererType "'+this.options.rendererType+'"')}this.renderer.onRender(function(e){return _this._onRender.fire(e)}),this.register(this.renderer)},Terminal.prototype._setTheme=function(theme){this._theme=theme;var colors=this.renderer.setTheme(theme);this.viewport&&this.viewport.onThemeChanged(colors)},Terminal.prototype.bindMouse=function(){var _this=this,el=this.element,self=this,pressed=32;function sendButton(ev){var button,pos;if(button=function(ev){var button,shift,meta,ctrl,mod;switch(ev.overrideType||ev.type){case"mousedown":button=null!==ev.button&&void 0!==ev.button?+ev.button:null!==ev.which&&void 0!==ev.which?ev.which-1:null,Browser.isMSIE&&(button=1===button?0:4===button?1:button);break;case"mouseup":button=3;break;case"DOMMouseScroll":button=ev.detail<0?64:65;break;case"wheel":button=ev.deltaY<0?64:65}shift=ev.shiftKey?4:0,meta=ev.metaKey?8:0,ctrl=ev.ctrlKey?16:0,mod=shift|meta|ctrl,self.vt200Mouse?mod&=ctrl:self.normalMouse||(mod=0);return button=32+(mod<<2)+button}(ev),pos=self.mouseHelper.getRawByteCoords(ev,self.screenElement,self.charMeasure,self.cols,self.rows))switch(sendEvent(button,pos),ev.overrideType||ev.type){case"mousedown":pressed=button;break;case"mouseup":pressed=32}}function encode(data,ch){if(self.utfMouse){if(2047<ch)return void data.push(2047);data.push(ch)}else{if(255===ch)return void data.push(0);127<ch&&(ch=127),data.push(ch)}}function sendEvent(button,pos){if(self._vt300Mouse){button&=3,pos.x-=32,pos.y-=32;var data_1=EscapeSequences_1.C0.ESC+"[24";if(0===button)data_1+="1";else if(1===button)data_1+="3";else if(2===button)data_1+="5";else{if(3===button)return;data_1+="0"}return data_1+="~["+pos.x+","+pos.y+"]\r",void self.handler(data_1)}if(self._decLocator)return button&=3,pos.x-=32,pos.y-=32,0===button?button=2:1===button?button=4:2===button?button=6:3===button&&(button=3),void self.handler(EscapeSequences_1.C0.ESC+"["+button+";"+(3===button?4:0)+";"+pos.y+";"+pos.x+";"+pos.page||"0&w");if(self.urxvtMouse)return pos.x-=32,pos.y-=32,pos.x++,pos.y++,void self.handler(EscapeSequences_1.C0.ESC+"["+button+";"+pos.x+";"+pos.y+"M");if(self.sgrMouse)return pos.x-=32,pos.y-=32,void self.handler(EscapeSequences_1.C0.ESC+"[<"+((3==(3&button)?-4&button:button)-32)+";"+pos.x+";"+pos.y+(3==(3&button)?"m":"M"));var data=[];encode(data,button),encode(data,pos.x),encode(data,pos.y),self.handler(EscapeSequences_1.C0.ESC+"[M"+String.fromCharCode.apply(String,data))}this.register(Lifecycle_1.addDisposableDomListener(el,"mousedown",function(ev){if(ev.preventDefault(),_this.focus(),_this.mouseEvents&&!_this.selectionManager.shouldForceSelection(ev)){if(sendButton(ev),_this.vt200Mouse)return ev.overrideType="mouseup",sendButton(ev),_this.cancel(ev);var moveHandler;_this.normalMouse&&(moveHandler=function(event){_this.normalMouse&&function(ev){var button=pressed,pos=self.mouseHelper.getRawByteCoords(ev,self.screenElement,self.charMeasure,self.cols,self.rows);pos&&sendEvent(button+=32,pos)}(event)},_this._document.addEventListener("mousemove",moveHandler));var handler=function(ev){return _this.normalMouse&&!_this.x10Mouse&&sendButton(ev),moveHandler&&(_this._document.removeEventListener("mousemove",moveHandler),moveHandler=null),_this._document.removeEventListener("mouseup",handler),_this.cancel(ev)};return _this._document.addEventListener("mouseup",handler),_this.cancel(ev)}})),this.register(Lifecycle_1.addDisposableDomListener(el,"wheel",function(ev){if(_this.mouseEvents)_this.x10Mouse||_this._vt300Mouse||_this._decLocator||(sendButton(ev),ev.preventDefault());else if(!_this.buffer.hasScrollback){var amount=_this.viewport.getLinesScrolled(ev);if(0===amount)return;for(var sequence=EscapeSequences_1.C0.ESC+(_this.applicationCursor?"O":"[")+(ev.deltaY<0?"A":"B"),data="",i=0;i<Math.abs(amount);i++)data+=sequence;_this.handler(data)}})),this.register(Lifecycle_1.addDisposableDomListener(el,"wheel",function(ev){if(!_this.mouseEvents)return _this.viewport.onWheel(ev),_this.cancel(ev)})),this.register(Lifecycle_1.addDisposableDomListener(el,"touchstart",function(ev){if(!_this.mouseEvents)return _this.viewport.onTouchStart(ev),_this.cancel(ev)})),this.register(Lifecycle_1.addDisposableDomListener(el,"touchmove",function(ev){if(!_this.mouseEvents)return _this.viewport.onTouchMove(ev),_this.cancel(ev)}))},Terminal.prototype.refresh=function(start,end){this.renderer&&this.renderer.refreshRows(start,end)},Terminal.prototype._queueLinkification=function(start,end){this.linkifier&&this.linkifier.linkifyRows(start,end)},Terminal.prototype.updateCursorStyle=function(ev){this.selectionManager&&this.selectionManager.shouldColumnSelect(ev)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")},Terminal.prototype.showCursor=function(){this.cursorState||(this.cursorState=1,this.refresh(this.buffer.y,this.buffer.y))},Terminal.prototype.scroll=function(isWrapped){var newLine;void 0===isWrapped&&(isWrapped=!1),newLine=this._blankLine;var eraseAttr=this.eraseAttrData();newLine&&newLine.length===this.cols&&newLine.getFg(0)===eraseAttr.fg&&newLine.getBg(0)===eraseAttr.bg||(newLine=this.buffer.getBlankLine(eraseAttr,isWrapped),this._blankLine=newLine),newLine.isWrapped=isWrapped;var topRow=this.buffer.ybase+this.buffer.scrollTop,bottomRow=this.buffer.ybase+this.buffer.scrollBottom;if(0===this.buffer.scrollTop){var willBufferBeTrimmed=this.buffer.lines.isFull;bottomRow===this.buffer.lines.length-1?willBufferBeTrimmed?this.buffer.lines.recycle().copyFrom(newLine):this.buffer.lines.push(newLine.clone()):this.buffer.lines.splice(bottomRow+1,0,newLine.clone()),willBufferBeTrimmed?this._userScrolling&&(this.buffer.ydisp=Math.max(this.buffer.ydisp-1,0)):(this.buffer.ybase++,this._userScrolling||this.buffer.ydisp++)}else{var scrollRegionHeight=bottomRow-topRow+1;this.buffer.lines.shiftElements(topRow+1,scrollRegionHeight-1,-1),this.buffer.lines.set(bottomRow,newLine.clone())}this._userScrolling||(this.buffer.ydisp=this.buffer.ybase),this.updateRange(this.buffer.scrollTop),this.updateRange(this.buffer.scrollBottom),this._onScroll.fire(this.buffer.ydisp)},Terminal.prototype.scrollLines=function(disp,suppressScrollEvent){if(disp<0){if(0===this.buffer.ydisp)return;this._userScrolling=!0}else disp+this.buffer.ydisp>=this.buffer.ybase&&(this._userScrolling=!1);var oldYdisp=this.buffer.ydisp;this.buffer.ydisp=Math.max(Math.min(this.buffer.ydisp+disp,this.buffer.ybase),0),oldYdisp!==this.buffer.ydisp&&(suppressScrollEvent||this._onScroll.fire(this.buffer.ydisp),this.refresh(0,this.rows-1))},Terminal.prototype.scrollPages=function(pageCount){this.scrollLines(pageCount*(this.rows-1))},Terminal.prototype.scrollToTop=function(){this.scrollLines(-this.buffer.ydisp)},Terminal.prototype.scrollToBottom=function(){this.scrollLines(this.buffer.ybase-this.buffer.ydisp)},Terminal.prototype.scrollToLine=function(line){var scrollAmount=line-this.buffer.ydisp;0!=scrollAmount&&this.scrollLines(scrollAmount)},Terminal.prototype.write=function(data){var _this=this;this._isDisposed||data&&(this.writeBuffer.push(data),this.options.useFlowControl&&!this._xoffSentToCatchUp&&5<=this.writeBuffer.length&&(this.handler(EscapeSequences_1.C0.DC3),this._xoffSentToCatchUp=!0),!this._writeInProgress&&0<this.writeBuffer.length&&(this._writeInProgress=!0,setTimeout(function(){_this._innerWrite()})))},Terminal.prototype._innerWrite=function(bufferOffset){var _this=this;void 0===bufferOffset&&(bufferOffset=0),this._isDisposed&&(this.writeBuffer=[]);for(var startTime=Date.now();this.writeBuffer.length>bufferOffset;){var data=this.writeBuffer[bufferOffset];if(bufferOffset++,this._xoffSentToCatchUp&&this.writeBuffer.length===bufferOffset&&(this.handler(EscapeSequences_1.C0.DC1),this._xoffSentToCatchUp=!1),this._refreshStart=this.buffer.y,this._refreshEnd=this.buffer.y,this._inputHandler.parse(data),this.updateRange(this.buffer.y),this.refresh(this._refreshStart,this._refreshEnd),12<=Date.now()-startTime)break}this.writeBuffer.length>bufferOffset?setTimeout(function(){return _this._innerWrite(bufferOffset)},0):(this._writeInProgress=!1,this.writeBuffer=[])},Terminal.prototype.writeln=function(data){this.write(data+"\r\n")},Terminal.prototype.attachCustomKeyEventHandler=function(customKeyEventHandler){this._customKeyEventHandler=customKeyEventHandler},Terminal.prototype.addCsiHandler=function(flag,callback){return this._inputHandler.addCsiHandler(flag,callback)},Terminal.prototype.addOscHandler=function(ident,callback){return this._inputHandler.addOscHandler(ident,callback)},Terminal.prototype.registerLinkMatcher=function(regex,handler,options){var matcherId=this.linkifier.registerLinkMatcher(regex,handler,options);return this.refresh(0,this.rows-1),matcherId},Terminal.prototype.deregisterLinkMatcher=function(matcherId){this.linkifier.deregisterLinkMatcher(matcherId)&&this.refresh(0,this.rows-1)},Terminal.prototype.registerCharacterJoiner=function(handler){var joinerId=this.renderer.registerCharacterJoiner(handler);return this.refresh(0,this.rows-1),joinerId},Terminal.prototype.deregisterCharacterJoiner=function(joinerId){this.renderer.deregisterCharacterJoiner(joinerId)&&this.refresh(0,this.rows-1)},Object.defineProperty(Terminal.prototype,"markers",{get:function(){return this.buffer.markers},enumerable:!0,configurable:!0}),Terminal.prototype.addMarker=function(cursorYOffset){if(this.buffer===this.buffers.normal)return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+cursorYOffset)},Terminal.prototype.hasSelection=function(){return!!this.selectionManager&&this.selectionManager.hasSelection},Terminal.prototype.getSelection=function(){return this.selectionManager?this.selectionManager.selectionText:""},Terminal.prototype.clearSelection=function(){this.selectionManager&&this.selectionManager.clearSelection()},Terminal.prototype.selectAll=function(){this.selectionManager&&this.selectionManager.selectAll()},Terminal.prototype.selectLines=function(start,end){this.selectionManager&&this.selectionManager.selectLines(start,end)},Terminal.prototype._keyDown=function(event){if(this._customKeyEventHandler&&!1===this._customKeyEventHandler(event))return!1;if(!this._compositionHelper.keydown(event))return this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;var result=Keyboard_1.evaluateKeyboardEvent(event,this.applicationCursor,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(event),3!==result.type&&2!==result.type)return 1===result.type&&this.selectAll(),!!this._isThirdLevelShift(this.browser,event)||(result.cancel&&this.cancel(event,!0),!result.key||(this.emit("keydown",event),this._onKey.fire({key:result.key,domEvent:event}),this.showCursor(),this.handler(result.key),this.cancel(event,!0)));var scrollCount=this.rows-1;return this.scrollLines(2===result.type?-scrollCount:scrollCount),this.cancel(event,!0)},Terminal.prototype._isThirdLevelShift=function(browser,ev){var thirdLevelKey=browser.isMac&&!this.options.macOptionIsMeta&&ev.altKey&&!ev.ctrlKey&&!ev.metaKey||browser.isMSWindows&&ev.altKey&&ev.ctrlKey&&!ev.metaKey;return"keypress"===ev.type?thirdLevelKey:thirdLevelKey&&(!ev.keyCode||47<ev.keyCode)},Terminal.prototype.setgLevel=function(g){this.glevel=g,this.charset=this.charsets[g]},Terminal.prototype.setgCharset=function(g,charset){this.charsets[g]=charset,this.glevel===g&&(this.charset=charset)},Terminal.prototype._keyUp=function(ev){this.updateCursorStyle(ev)},Terminal.prototype._keyPress=function(ev){var key;if(this._customKeyEventHandler&&!1===this._customKeyEventHandler(ev))return!1;if(this.cancel(ev),ev.charCode)key=ev.charCode;else if(null===ev.which||void 0===ev.which)key=ev.keyCode;else{if(0===ev.which||0===ev.charCode)return!1;key=ev.which}return!(!key||(ev.altKey||ev.ctrlKey||ev.metaKey)&&!this._isThirdLevelShift(this.browser,ev))&&(key=String.fromCharCode(key),this.emit("keypress",key,ev),this._onKey.fire({key:key,domEvent:ev}),this.showCursor(),this.handler(key),!0)},Terminal.prototype.bell=function(){var _this=this;this.emit("bell"),this._soundBell()&&this.soundManager.playBellSound(),this._visualBell()&&(this.element.classList.add("visual-bell-active"),clearTimeout(this._visualBellTimer),this._visualBellTimer=window.setTimeout(function(){_this.element.classList.remove("visual-bell-active")},200))},Terminal.prototype.log=function(text,data){this.options.debug&&this._context.console&&this._context.console.log&&this._context.console.log(text,data)},Terminal.prototype.error=function(text,data){this.options.debug&&this._context.console&&this._context.console.error&&this._context.console.error(text,data)},Terminal.prototype.resize=function(x,y){isNaN(x)||isNaN(y)||(x!==this.cols||y!==this.rows?(x<2&&(x=2),y<1&&(y=1),this.buffers.resize(x,y),this.cols=x,this.rows=y,this.buffers.setupTabStops(this.cols),this.charMeasure&&this.charMeasure.measure(this.options),this.refresh(0,this.rows-1),this._onResize.fire({cols:x,rows:y})):!this.charMeasure||this.charMeasure.width&&this.charMeasure.height||this.charMeasure.measure(this.options))},Terminal.prototype.updateRange=function(y){y<this._refreshStart&&(this._refreshStart=y),y>this._refreshEnd&&(this._refreshEnd=y)},Terminal.prototype.maxRange=function(){this._refreshStart=0,this._refreshEnd=this.rows-1},Terminal.prototype.clear=function(){if(0!==this.buffer.ybase||0!==this.buffer.y){this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(var i=1;i<this.rows;i++)this.buffer.lines.push(this.buffer.getBlankLine(Buffer_1.DEFAULT_ATTR_DATA));this.refresh(0,this.rows-1),this._onScroll.fire(this.buffer.ydisp)}},Terminal.prototype.is=function(term){return 0===(this.options.termName+"").indexOf(term)},Terminal.prototype.handler=function(data){this.options.disableStdin||(this.selectionManager&&this.selectionManager.hasSelection&&this.selectionManager.clearSelection(),this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),this._onData.fire(data))},Terminal.prototype.handleTitle=function(title){this._onTitleChange.fire(title)},Terminal.prototype.index=function(){this.buffer.y++,this.buffer.y>this.buffer.scrollBottom&&(this.buffer.y--,this.scroll()),this.buffer.x>=this.cols&&this.buffer.x--},Terminal.prototype.reverseIndex=function(){if(this.buffer.y===this.buffer.scrollTop){var scrollRegionHeight=this.buffer.scrollBottom-this.buffer.scrollTop;this.buffer.lines.shiftElements(this.buffer.y+this.buffer.ybase,scrollRegionHeight,1),this.buffer.lines.set(this.buffer.y+this.buffer.ybase,this.buffer.getBlankLine(this.eraseAttrData())),this.updateRange(this.buffer.scrollTop),this.updateRange(this.buffer.scrollBottom)}else this.buffer.y--},Terminal.prototype.reset=function(){this.options.rows=this.rows,this.options.cols=this.cols;var customKeyEventHandler=this._customKeyEventHandler,inputHandler=this._inputHandler,cursorState=this.cursorState;this._setup(),this._customKeyEventHandler=customKeyEventHandler,this._inputHandler=inputHandler,this.cursorState=cursorState,this.refresh(0,this.rows-1),this.viewport&&this.viewport.syncScrollArea()},Terminal.prototype.tabSet=function(){this.buffer.tabs[this.buffer.x]=!0},Terminal.prototype.cancel=function(ev,force){if(this.options.cancelEvents||force)return ev.preventDefault(),ev.stopPropagation(),!1},Terminal.prototype._visualBell=function(){return!1},Terminal.prototype._soundBell=function(){return"sound"===this.options.bellStyle},Terminal}(EventEmitter_1.EventEmitter);exports.Terminal=Terminal},{"./AccessibilityManager":5,"./Buffer":6,"./BufferSet":9,"./CharMeasure":10,"./Clipboard":12,"./CompositionHelper":13,"./InputHandler":15,"./Linkifier":16,"./MouseHelper":17,"./MouseZoneManager":18,"./SelectionManager":19,"./SoundManager":21,"./Strings":22,"./Viewport":24,"./WindowsMode":25,"./common/Clone":27,"./common/EventEmitter":28,"./common/EventEmitter2":29,"./common/Platform":31,"./common/data/EscapeSequences":33,"./core/input/Keyboard":35,"./renderer/Renderer":45,"./renderer/atlas/CharAtlasCache":49,"./renderer/dom/DomRenderer":57,"./ui/Lifecycle":59,"./ui/ScreenDprMonitor":61}],24:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Lifecycle_1=require("./common/Lifecycle"),Lifecycle_2=require("./ui/Lifecycle"),Viewport=function(_super){function Viewport(_terminal,_viewportElement,_scrollArea,_charMeasure){var _this=_super.call(this)||this;return _this._terminal=_terminal,_this._viewportElement=_viewportElement,_this._scrollArea=_scrollArea,_this._charMeasure=_charMeasure,_this.scrollBarWidth=0,_this._currentRowHeight=0,_this._lastRecordedBufferLength=0,_this._lastRecordedViewportHeight=0,_this._lastRecordedBufferHeight=0,_this._lastScrollTop=0,_this._wheelPartialScroll=0,_this._refreshAnimationFrame=null,_this._ignoreNextScrollEvent=!1,_this.scrollBarWidth=_this._viewportElement.offsetWidth-_this._scrollArea.offsetWidth||15,_this.register(Lifecycle_2.addDisposableDomListener(_this._viewportElement,"scroll",_this._onScroll.bind(_this))),setTimeout(function(){return _this.syncScrollArea()},0),_this}return __extends(Viewport,_super),Viewport.prototype.onThemeChanged=function(colors){this._viewportElement.style.backgroundColor=colors.background.css},Viewport.prototype._refresh=function(){var _this=this;null===this._refreshAnimationFrame&&(this._refreshAnimationFrame=requestAnimationFrame(function(){return _this._innerRefresh()}))},Viewport.prototype._innerRefresh=function(){if(0<this._charMeasure.height){this._currentRowHeight=this._terminal.renderer.dimensions.scaledCellHeight/window.devicePixelRatio,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;var newBufferHeight=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._terminal.renderer.dimensions.canvasHeight);this._lastRecordedBufferHeight!==newBufferHeight&&(this._lastRecordedBufferHeight=newBufferHeight,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}var scrollTop=this._terminal.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==scrollTop&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=scrollTop),this._refreshAnimationFrame=null},Viewport.prototype.syncScrollArea=function(){if(this._lastRecordedBufferLength!==this._terminal.buffer.lines.length)return this._lastRecordedBufferLength=this._terminal.buffer.lines.length,void this._refresh();if(this._lastRecordedViewportHeight===this._terminal.renderer.dimensions.canvasHeight){var newScrollTop=this._terminal.buffer.ydisp*this._currentRowHeight;this._lastScrollTop===newScrollTop&&this._lastScrollTop===this._viewportElement.scrollTop&&this._terminal.renderer.dimensions.scaledCellHeight/window.devicePixelRatio===this._currentRowHeight||this._refresh()}else this._refresh()},Viewport.prototype._onScroll=function(ev){if(this._lastScrollTop=this._viewportElement.scrollTop,this._viewportElement.offsetParent)if(this._ignoreNextScrollEvent)this._ignoreNextScrollEvent=!1;else{var diff=Math.round(this._lastScrollTop/this._currentRowHeight)-this._terminal.buffer.ydisp;this._terminal.scrollLines(diff,!0)}},Viewport.prototype.onWheel=function(ev){var amount=this._getPixelsScrolled(ev);0!==amount&&(this._viewportElement.scrollTop+=amount,ev.preventDefault())},Viewport.prototype._getPixelsScrolled=function(ev){if(0===ev.deltaY)return 0;var amount=ev.deltaY;return ev.deltaMode===WheelEvent.DOM_DELTA_LINE?amount*=this._currentRowHeight:ev.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(amount*=this._currentRowHeight*this._terminal.rows),amount},Viewport.prototype.getLinesScrolled=function(ev){if(0===ev.deltaY)return 0;var amount=ev.deltaY;return ev.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(amount/=this._currentRowHeight+0,this._wheelPartialScroll+=amount,amount=Math.floor(Math.abs(this._wheelPartialScroll))*(0<this._wheelPartialScroll?1:-1),this._wheelPartialScroll%=1):ev.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(amount*=this._terminal.rows),amount},Viewport.prototype.onTouchStart=function(ev){this._lastTouchY=ev.touches[0].pageY},Viewport.prototype.onTouchMove=function(ev){var deltaY=this._lastTouchY-ev.touches[0].pageY;this._lastTouchY=ev.touches[0].pageY,0!=deltaY&&(this._viewportElement.scrollTop+=deltaY,ev.preventDefault())},Viewport}(Lifecycle_1.Disposable);exports.Viewport=Viewport},{"./common/Lifecycle":30,"./ui/Lifecycle":59}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Buffer_1=require("./Buffer");exports.applyWindowsMode=function(terminal){return terminal.onLineFeed(function(){var lastChar=terminal.buffer.lines.get(terminal.buffer.ybase+terminal.buffer.y-1).get(terminal.cols-1);lastChar[Buffer_1.CHAR_DATA_CODE_INDEX]!==Buffer_1.NULL_CELL_CODE&&lastChar[Buffer_1.CHAR_DATA_CODE_INDEX]!==Buffer_1.WHITESPACE_CELL_CODE&&(terminal.buffer.lines.get(terminal.buffer.ybase+terminal.buffer.y).isWrapped=!0)})}},{"./Buffer":6}],26:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var EventEmitter2_1=require("./EventEmitter2"),CircularList=function(){function CircularList(_maxLength){this._maxLength=_maxLength,this.onDeleteEmitter=new EventEmitter2_1.EventEmitter2,this.onInsertEmitter=new EventEmitter2_1.EventEmitter2,this.onTrimEmitter=new EventEmitter2_1.EventEmitter2,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}return Object.defineProperty(CircularList.prototype,"onDelete",{get:function(){return this.onDeleteEmitter.event},enumerable:!0,configurable:!0}),Object.defineProperty(CircularList.prototype,"onInsert",{get:function(){return this.onInsertEmitter.event},enumerable:!0,configurable:!0}),Object.defineProperty(CircularList.prototype,"onTrim",{get:function(){return this.onTrimEmitter.event},enumerable:!0,configurable:!0}),Object.defineProperty(CircularList.prototype,"maxLength",{get:function(){return this._maxLength},set:function(newMaxLength){if(this._maxLength!==newMaxLength){for(var newArray=new Array(newMaxLength),i=0;i<Math.min(newMaxLength,this.length);i++)newArray[i]=this._array[this._getCyclicIndex(i)];this._array=newArray,this._maxLength=newMaxLength,this._startIndex=0}},enumerable:!0,configurable:!0}),Object.defineProperty(CircularList.prototype,"length",{get:function(){return this._length},set:function(newLength){if(newLength>this._length)for(var i=this._length;i<newLength;i++)this._array[i]=void 0;this._length=newLength},enumerable:!0,configurable:!0}),CircularList.prototype.get=function(index){return this._array[this._getCyclicIndex(index)]},CircularList.prototype.set=function(index,value){this._array[this._getCyclicIndex(index)]=value},CircularList.prototype.push=function(value){this._array[this._getCyclicIndex(this._length)]=value,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++},CircularList.prototype.recycle=function(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]},Object.defineProperty(CircularList.prototype,"isFull",{get:function(){return this._length===this._maxLength},enumerable:!0,configurable:!0}),CircularList.prototype.pop=function(){return this._array[this._getCyclicIndex(this._length---1)]},CircularList.prototype.splice=function(start,deleteCount){for(var items=[],_i=2;_i<arguments.length;_i++)items[_i-2]=arguments[_i];if(deleteCount){for(var i=start;i<this._length-deleteCount;i++)this._array[this._getCyclicIndex(i)]=this._array[this._getCyclicIndex(i+deleteCount)];this._length-=deleteCount}for(i=this._length-1;start<=i;i--)this._array[this._getCyclicIndex(i+items.length)]=this._array[this._getCyclicIndex(i)];for(i=0;i<items.length;i++)this._array[this._getCyclicIndex(start+i)]=items[i];if(this._length+items.length>this._maxLength){var countToTrim=this._length+items.length-this._maxLength;this._startIndex+=countToTrim,this._length=this._maxLength,this.onTrimEmitter.fire(countToTrim)}else this._length+=items.length},CircularList.prototype.trimStart=function(count){count>this._length&&(count=this._length),this._startIndex+=count,this._length-=count,this.onTrimEmitter.fire(count)},CircularList.prototype.shiftElements=function(start,count,offset){if(!(count<=0)){if(start<0||start>=this._length)throw new Error("start argument out of range");if(start+offset<0)throw new Error("Cannot shift elements in list beyond index 0");if(0<offset){for(var i=count-1;0<=i;i--)this.set(start+i+offset,this.get(start+i));var expandListBy=start+count+offset-this._length;if(0<expandListBy)for(this._length+=expandListBy;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(i=0;i<count;i++)this.set(start+i+offset,this.get(start+i))}},CircularList.prototype._getCyclicIndex=function(index){return(this._startIndex+index)%this._maxLength},CircularList}();exports.CircularList=CircularList},{"./EventEmitter2":29}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clone=function clone(val,depth){if(void 0===depth&&(depth=5),"object"!=typeof val)return val;if(null===val)return null;var clonedObject=Array.isArray(val)?[]:{};for(var key in val)clonedObject[key]=depth<=1?val[key]:clone(val[key],depth-1);return clonedObject}},{}],28:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var EventEmitter=function(_super){function EventEmitter(){var _this=_super.call(this)||this;return _this._events=_this._events||{},_this}return __extends(EventEmitter,_super),EventEmitter.prototype.on=function(type,listener){this._events[type]=this._events[type]||[],this._events[type].push(listener)},EventEmitter.prototype.addDisposableListener=function(type,handler){var _this=this;this.on(type,handler);var disposed=!1;return{dispose:function(){disposed||(_this.off(type,handler),disposed=!0)}}},EventEmitter.prototype.off=function(type,listener){if(this._events[type])for(var obj=this._events[type],i=obj.length;i--;)if(obj[i]===listener)return void obj.splice(i,1)},EventEmitter.prototype.removeAllListeners=function(type){this._events[type]&&delete this._events[type]},EventEmitter.prototype.emit=function(type){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];if(this._events[type])for(var obj=this._events[type],i=0;i<obj.length;i++)obj[i].apply(this,args)},EventEmitter.prototype.emitMayRemoveListeners=function(type){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];if(this._events[type])for(var obj=this._events[type],length=obj.length,i=0;i<obj.length;i++)obj[i].apply(this,args),i-=length-obj.length,length=obj.length},EventEmitter.prototype.listeners=function(type){return this._events[type]||[]},EventEmitter.prototype.dispose=function(){_super.prototype.dispose.call(this),this._events={}},EventEmitter}(require("./Lifecycle").Disposable);exports.EventEmitter=EventEmitter},{"./Lifecycle":30}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var EventEmitter2=function(){function EventEmitter2(){this._listeners=[]}return Object.defineProperty(EventEmitter2.prototype,"event",{get:function(){var _this=this;return this._event||(this._event=function(listener){return _this._listeners.push(listener),{dispose:function(){for(var i=0;i<_this._listeners.length;i++)if(_this._listeners[i]===listener)return void _this._listeners.splice(i,1)}}}),this._event},enumerable:!0,configurable:!0}),EventEmitter2.prototype.fire=function(data){for(var queue=[],i=0;i<this._listeners.length;i++)queue.push(this._listeners[i]);for(i=0;i<queue.length;i++)queue[i].call(void 0,data)},EventEmitter2}();exports.EventEmitter2=EventEmitter2},{}],30:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Disposable=function(){function Disposable(){this._disposables=[],this._isDisposed=!1}return Disposable.prototype.dispose=function(){this._isDisposed=!0,this._disposables.forEach(function(d){return d.dispose()}),this._disposables.length=0},Disposable.prototype.register=function(d){this._disposables.push(d)},Disposable.prototype.unregister=function(d){var index=this._disposables.indexOf(d);-1!==index&&this._disposables.splice(index,1)},Disposable}();exports.Disposable=Disposable},{}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var isNode="undefined"==typeof navigator,userAgent=isNode?"node":navigator.userAgent,platform=isNode?"node":navigator.platform;function contains(arr,el){return 0<=arr.indexOf(el)}exports.isFirefox=!!~userAgent.indexOf("Firefox"),exports.isSafari=/^((?!chrome|android).)*safari/i.test(userAgent),exports.isMSIE=!!~userAgent.indexOf("MSIE")||!!~userAgent.indexOf("Trident"),exports.isMac=contains(["Macintosh","MacIntel","MacPPC","Mac68K"],platform),exports.isIpad="iPad"===platform,exports.isIphone="iPhone"===platform,exports.isMSWindows=contains(["Windows","Win16","Win32","WinCE"],platform),exports.isLinux=0<=platform.indexOf("Linux")},{}],32:[function(require,module,exports){"use strict";function fillFallback(array,value,start,end){if(void 0===start&&(start=0),void 0===end&&(end=array.length),start>=array.length)return array;start=(array.length+start)%array.length,end=end>=array.length?array.length:(array.length+end)%array.length;for(var i=start;i<end;++i)array[i]=value;return array}Object.defineProperty(exports,"__esModule",{value:!0}),exports.fill=function(array,value,start,end){return array.fill?array.fill(value,start,end):fillFallback(array,value,start,end)},exports.fillFallback=fillFallback,exports.concat=function(a,b){var result=new a.constructor(a.length+b.length);return result.set(a),result.set(b,a.length),result}},{}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(C0){C0.NUL="\0",C0.SOH="",C0.STX="",C0.ETX="",C0.EOT="",C0.ENQ="",C0.ACK="",C0.BEL="",C0.BS="\b",C0.HT="\t",C0.LF="\n",C0.VT="\v",C0.FF="\f",C0.CR="\r",C0.SO="",C0.SI="",C0.DLE="",C0.DC1="",C0.DC2="",C0.DC3="",C0.DC4="",C0.NAK="",C0.SYN="",C0.ETB="",C0.CAN="",C0.EM="",C0.SUB="",C0.ESC="",C0.FS="",C0.GS="",C0.RS="",C0.US="",C0.SP=" ",C0.DEL=""}(exports.C0||(exports.C0={})),function(C1){C1.PAD="",C1.HOP="",C1.BPH="",C1.NBH="",C1.IND="",C1.NEL="",C1.SSA="",C1.ESA="",C1.HTS="",C1.HTJ="",C1.VTS="",C1.PLD="",C1.PLU="",C1.RI="",C1.SS2="",C1.SS3="",C1.DCS="",C1.PU1="",C1.PU2="",C1.STS="",C1.CCH="",C1.MW="",C1.SPA="",C1.EPA="",C1.SOS="",C1.SGCI="",C1.SCI="",C1.CSI="",C1.ST="",C1.OSC="",C1.PM="",C1.APC=""}(exports.C1||(exports.C1={}))},{}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CHARSETS={},exports.DEFAULT_CHARSET=exports.CHARSETS.B,exports.CHARSETS[0]={"`":"◆",a:"▒",b:"\t",c:"\f",d:"\r",e:"\n",f:"°",g:"±",h:"␤",i:"\v",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},exports.CHARSETS.A={"#":"£"},exports.CHARSETS.B=null,exports.CHARSETS[4]={"#":"£","@":"¾","[":"ij","\\":"½","]":"|","{":"¨","|":"f","}":"¼","~":"´"},exports.CHARSETS.C=exports.CHARSETS[5]={"[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},exports.CHARSETS.R={"#":"£","@":"à","[":"°","\\":"ç","]":"§","{":"é","|":"ù","}":"è","~":"¨"},exports.CHARSETS.Q={"@":"à","[":"â","\\":"ç","]":"ê","^":"î","`":"ô","{":"é","|":"ù","}":"è","~":"û"},exports.CHARSETS.K={"@":"§","[":"Ä","\\":"Ö","]":"Ü","{":"ä","|":"ö","}":"ü","~":"ß"},exports.CHARSETS.Y={"#":"£","@":"§","[":"°","\\":"ç","]":"é","`":"ù","{":"à","|":"ò","}":"è","~":"ì"},exports.CHARSETS.E=exports.CHARSETS[6]={"@":"Ä","[":"Æ","\\":"Ø","]":"Å","^":"Ü","`":"ä","{":"æ","|":"ø","}":"å","~":"ü"},exports.CHARSETS.Z={"#":"£","@":"§","[":"¡","\\":"Ñ","]":"¿","{":"°","|":"ñ","}":"ç"},exports.CHARSETS.H=exports.CHARSETS[7]={"@":"É","[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},exports.CHARSETS["="]={"#":"ù","@":"à","[":"é","\\":"ç","]":"ê","^":"î",_:"è","`":"ô","{":"ä","|":"ö","}":"ü","~":"û"}},{}],35:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var EscapeSequences_1=require("../../common/data/EscapeSequences"),KEYCODE_KEY_MAPPINGS={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};exports.evaluateKeyboardEvent=function(ev,applicationCursorMode,isMac,macOptionIsMeta){var result={type:0,cancel:!1,key:void 0},modifiers=(ev.shiftKey?1:0)|(ev.altKey?2:0)|(ev.ctrlKey?4:0)|(ev.metaKey?8:0);switch(ev.keyCode){case 0:"UIKeyInputUpArrow"===ev.key?result.key=applicationCursorMode?EscapeSequences_1.C0.ESC+"OA":EscapeSequences_1.C0.ESC+"[A":"UIKeyInputLeftArrow"===ev.key?result.key=applicationCursorMode?EscapeSequences_1.C0.ESC+"OD":EscapeSequences_1.C0.ESC+"[D":"UIKeyInputRightArrow"===ev.key?result.key=applicationCursorMode?EscapeSequences_1.C0.ESC+"OC":EscapeSequences_1.C0.ESC+"[C":"UIKeyInputDownArrow"===ev.key&&(result.key=applicationCursorMode?EscapeSequences_1.C0.ESC+"OB":EscapeSequences_1.C0.ESC+"[B");break;case 8:if(ev.shiftKey){result.key=EscapeSequences_1.C0.BS;break}if(ev.altKey){result.key=EscapeSequences_1.C0.ESC+EscapeSequences_1.C0.DEL;break}result.key=EscapeSequences_1.C0.DEL;break;case 9:if(ev.shiftKey){result.key=EscapeSequences_1.C0.ESC+"[Z";break}result.key=EscapeSequences_1.C0.HT,result.cancel=!0;break;case 13:result.key=EscapeSequences_1.C0.CR,result.cancel=!0;break;case 27:result.key=EscapeSequences_1.C0.ESC,result.cancel=!0;break;case 37:modifiers?(result.key=EscapeSequences_1.C0.ESC+"[1;"+(1+modifiers)+"D",result.key===EscapeSequences_1.C0.ESC+"[1;3D"&&(result.key=isMac?EscapeSequences_1.C0.ESC+"b":EscapeSequences_1.C0.ESC+"[1;5D")):result.key=applicationCursorMode?EscapeSequences_1.C0.ESC+"OD":EscapeSequences_1.C0.ESC+"[D";break;case 39:modifiers?(result.key=EscapeSequences_1.C0.ESC+"[1;"+(1+modifiers)+"C",result.key===EscapeSequences_1.C0.ESC+"[1;3C"&&(result.key=isMac?EscapeSequences_1.C0.ESC+"f":EscapeSequences_1.C0.ESC+"[1;5C")):result.key=applicationCursorMode?EscapeSequences_1.C0.ESC+"OC":EscapeSequences_1.C0.ESC+"[C";break;case 38:modifiers?(result.key=EscapeSequences_1.C0.ESC+"[1;"+(1+modifiers)+"A",result.key===EscapeSequences_1.C0.ESC+"[1;3A"&&(result.key=EscapeSequences_1.C0.ESC+"[1;5A")):result.key=applicationCursorMode?EscapeSequences_1.C0.ESC+"OA":EscapeSequences_1.C0.ESC+"[A";break;case 40:modifiers?(result.key=EscapeSequences_1.C0.ESC+"[1;"+(1+modifiers)+"B",result.key===EscapeSequences_1.C0.ESC+"[1;3B"&&(result.key=EscapeSequences_1.C0.ESC+"[1;5B")):result.key=applicationCursorMode?EscapeSequences_1.C0.ESC+"OB":EscapeSequences_1.C0.ESC+"[B";break;case 45:ev.shiftKey||ev.ctrlKey||(result.key=EscapeSequences_1.C0.ESC+"[2~");break;case 46:result.key=modifiers?EscapeSequences_1.C0.ESC+"[3;"+(1+modifiers)+"~":EscapeSequences_1.C0.ESC+"[3~";break;case 36:result.key=modifiers?EscapeSequences_1.C0.ESC+"[1;"+(1+modifiers)+"H":applicationCursorMode?EscapeSequences_1.C0.ESC+"OH":EscapeSequences_1.C0.ESC+"[H";break;case 35:result.key=modifiers?EscapeSequences_1.C0.ESC+"[1;"+(1+modifiers)+"F":applicationCursorMode?EscapeSequences_1.C0.ESC+"OF":EscapeSequences_1.C0.ESC+"[F";break;case 33:ev.shiftKey?result.type=2:result.key=EscapeSequences_1.C0.ESC+"[5~";break;case 34:ev.shiftKey?result.type=3:result.key=EscapeSequences_1.C0.ESC+"[6~";break;case 112:result.key=modifiers?EscapeSequences_1.C0.ESC+"[1;"+(1+modifiers)+"P":EscapeSequences_1.C0.ESC+"OP";break;case 113:result.key=modifiers?EscapeSequences_1.C0.ESC+"[1;"+(1+modifiers)+"Q":EscapeSequences_1.C0.ESC+"OQ";break;case 114:result.key=modifiers?EscapeSequences_1.C0.ESC+"[1;"+(1+modifiers)+"R":EscapeSequences_1.C0.ESC+"OR";break;case 115:result.key=modifiers?EscapeSequences_1.C0.ESC+"[1;"+(1+modifiers)+"S":EscapeSequences_1.C0.ESC+"OS";break;case 116:result.key=modifiers?EscapeSequences_1.C0.ESC+"[15;"+(1+modifiers)+"~":EscapeSequences_1.C0.ESC+"[15~";break;case 117:result.key=modifiers?EscapeSequences_1.C0.ESC+"[17;"+(1+modifiers)+"~":EscapeSequences_1.C0.ESC+"[17~";break;case 118:result.key=modifiers?EscapeSequences_1.C0.ESC+"[18;"+(1+modifiers)+"~":EscapeSequences_1.C0.ESC+"[18~";break;case 119:result.key=modifiers?EscapeSequences_1.C0.ESC+"[19;"+(1+modifiers)+"~":EscapeSequences_1.C0.ESC+"[19~";break;case 120:result.key=modifiers?EscapeSequences_1.C0.ESC+"[20;"+(1+modifiers)+"~":EscapeSequences_1.C0.ESC+"[20~";break;case 121:result.key=modifiers?EscapeSequences_1.C0.ESC+"[21;"+(1+modifiers)+"~":EscapeSequences_1.C0.ESC+"[21~";break;case 122:result.key=modifiers?EscapeSequences_1.C0.ESC+"[23;"+(1+modifiers)+"~":EscapeSequences_1.C0.ESC+"[23~";break;case 123:result.key=modifiers?EscapeSequences_1.C0.ESC+"[24;"+(1+modifiers)+"~":EscapeSequences_1.C0.ESC+"[24~";break;default:if(!ev.ctrlKey||ev.shiftKey||ev.altKey||ev.metaKey)if(isMac&&!macOptionIsMeta||!ev.altKey||ev.metaKey)isMac&&!ev.altKey&&!ev.ctrlKey&&ev.metaKey?65===ev.keyCode&&(result.type=1):ev.key&&!ev.ctrlKey&&!ev.altKey&&!ev.metaKey&&48<=ev.keyCode&&1===ev.key.length?result.key=ev.key:ev.key&&ev.ctrlKey&&"_"===ev.key&&(result.key=EscapeSequences_1.C0.US);else{var keyMapping=KEYCODE_KEY_MAPPINGS[ev.keyCode],key=keyMapping&&keyMapping[ev.shiftKey?1:0];if(key)result.key=EscapeSequences_1.C0.ESC+key;else if(65<=ev.keyCode&&ev.keyCode<=90){var keyCode=ev.ctrlKey?ev.keyCode-64:ev.keyCode+32;result.key=EscapeSequences_1.C0.ESC+String.fromCharCode(keyCode)}}else 65<=ev.keyCode&&ev.keyCode<=90?result.key=String.fromCharCode(ev.keyCode-64):32===ev.keyCode?result.key=String.fromCharCode(0):51<=ev.keyCode&&ev.keyCode<=55?result.key=String.fromCharCode(ev.keyCode-51+27):56===ev.keyCode?result.key=String.fromCharCode(127):219===ev.keyCode?result.key=String.fromCharCode(27):220===ev.keyCode?result.key=String.fromCharCode(28):221===ev.keyCode&&(result.key=String.fromCharCode(29))}return result}},{"../../common/data/EscapeSequences":33}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var StringToUtf32=function(){function StringToUtf32(){this._interim=0}return StringToUtf32.prototype.clear=function(){this._interim=0},StringToUtf32.prototype.decode=function(input,target){var length=input.length;if(!length)return 0;var size=0,startPos=0;this._interim&&(56320<=(second=input.charCodeAt(startPos++))&&second<=57343?target[size++]=1024*(this._interim-55296)+second-56320+65536:(target[size++]=this._interim,target[size++]=second),this._interim=0);for(var i=startPos;i<length;++i){var code=input.charCodeAt(i);if(55296<=code&&code<=56319){if(++i>=length)return this._interim=code,size;var second;56320<=(second=input.charCodeAt(i))&&second<=57343?target[size++]=1024*(code-55296)+second-56320+65536:(target[size++]=code,target[size++]=second)}else target[size++]=code}return size},StringToUtf32}();exports.StringToUtf32=StringToUtf32,exports.stringFromCodePoint=function(codePoint){return 65535<codePoint?(codePoint-=65536,String.fromCharCode(55296+(codePoint>>10))+String.fromCharCode(codePoint%1024+56320)):String.fromCharCode(codePoint)},exports.utf32ToString=function(data,start,end){void 0===start&&(start=0),void 0===end&&(end=data.length);for(var result="",i=start;i<end;++i){var codepoint=data[i];65535<codepoint?(codepoint-=65536,result+=String.fromCharCode(55296+(codepoint>>10))+String.fromCharCode(codepoint%1024+56320)):result+=String.fromCharCode(codepoint)}return result}},{}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var EscapeSequences_1=require("../common/data/EscapeSequences"),AltClickHandler=function(){function AltClickHandler(_mouseEvent,_terminal){var _a;this._mouseEvent=_mouseEvent,this._terminal=_terminal,this._lines=this._terminal.buffer.lines,this._startCol=this._terminal.buffer.x,this._startRow=this._terminal.buffer.y;var coordinates=this._terminal.mouseHelper.getCoords(this._mouseEvent,this._terminal.element,this._terminal.charMeasure,this._terminal.cols,this._terminal.rows,!1);coordinates&&(_a=coordinates.map(function(coordinate){return coordinate-1}),this._endCol=_a[0],this._endRow=_a[1])}return AltClickHandler.prototype.move=function(){this._mouseEvent.altKey&&void 0!==this._endCol&&void 0!==this._endRow&&this._terminal.handler(this._arrowSequences())},AltClickHandler.prototype._arrowSequences=function(){return this._terminal.buffer.hasScrollback?this._moveHorizontallyOnly():this._resetStartingRow()+this._moveToRequestedRow()+this._moveToRequestedCol()},AltClickHandler.prototype._resetStartingRow=function(){return 0===this._moveToRequestedRow().length?"":repeat(this._bufferLine(this._startCol,this._startRow,this._startCol,this._startRow-this._wrappedRowsForRow(this._startRow),!1).length,this._sequence("D"))},AltClickHandler.prototype._moveToRequestedRow=function(){var startRow=this._startRow-this._wrappedRowsForRow(this._startRow),endRow=this._endRow-this._wrappedRowsForRow(this._endRow);return repeat(Math.abs(startRow-endRow)-this._wrappedRowsCount(),this._sequence(this._verticalDirection()))},AltClickHandler.prototype._moveToRequestedCol=function(){var startRow;startRow=0<this._moveToRequestedRow().length?this._endRow-this._wrappedRowsForRow(this._endRow):this._startRow;var endRow=this._endRow,direction=this._horizontalDirection();return repeat(this._bufferLine(this._startCol,startRow,this._endCol,endRow,"C"===direction).length,this._sequence(direction))},AltClickHandler.prototype._moveHorizontallyOnly=function(){var direction=this._horizontalDirection();return repeat(Math.abs(this._startCol-this._endCol),this._sequence(direction))},AltClickHandler.prototype._wrappedRowsCount=function(){for(var wrappedRows=0,startRow=this._startRow-this._wrappedRowsForRow(this._startRow),endRow=this._endRow-this._wrappedRowsForRow(this._endRow),i=0;i<Math.abs(startRow-endRow);i++){var direction="A"===this._verticalDirection()?-1:1;this._lines.get(startRow+direction*i).isWrapped&&wrappedRows++}return wrappedRows},AltClickHandler.prototype._wrappedRowsForRow=function(currentRow){for(var rowCount=0,lineWraps=this._lines.get(currentRow).isWrapped;lineWraps&&0<=currentRow&&currentRow<this._terminal.rows;)rowCount++,currentRow--,lineWraps=this._lines.get(currentRow).isWrapped;return rowCount},AltClickHandler.prototype._horizontalDirection=function(){var startRow;return startRow=0<this._moveToRequestedRow().length?this._endRow-this._wrappedRowsForRow(this._endRow):this._startRow,this._startCol<this._endCol&&startRow<=this._endRow||this._startCol>=this._endCol&&startRow<this._endRow?"C":"D"},AltClickHandler.prototype._verticalDirection=function(){return this._startRow>this._endRow?"A":"B"},AltClickHandler.prototype._bufferLine=function(startCol,startRow,endCol,endRow,forward){for(var currentCol=startCol,currentRow=startRow,bufferStr="";currentCol!==endCol||currentRow!==endRow;)currentCol+=forward?1:-1,forward&&currentCol>this._terminal.cols-1?(bufferStr+=this._terminal.buffer.translateBufferLineToString(currentRow,!1,startCol,currentCol),startCol=currentCol=0,currentRow++):!forward&&currentCol<0&&(bufferStr+=this._terminal.buffer.translateBufferLineToString(currentRow,!1,0,startCol+1),startCol=currentCol=this._terminal.cols-1,currentRow--);return bufferStr+this._terminal.buffer.translateBufferLineToString(currentRow,!1,startCol,currentCol)},AltClickHandler.prototype._sequence=function(direction){var mod=this._terminal.applicationCursor?"O":"[";return EscapeSequences_1.C0.ESC+mod+direction},AltClickHandler}();function repeat(count,str){count=Math.floor(count);for(var rpt="",i=0;i<count;i++)rpt+=str;return rpt}exports.AltClickHandler=AltClickHandler},{"../common/data/EscapeSequences":33}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Terminal_1=require("../Terminal"),Strings=require("../Strings"),Terminal=function(){function Terminal(options){this._core=new Terminal_1.Terminal(options)}return Object.defineProperty(Terminal.prototype,"onCursorMove",{get:function(){return this._core.onCursorMove},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onLineFeed",{get:function(){return this._core.onLineFeed},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onSelectionChange",{get:function(){return this._core.onSelectionChange},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onData",{get:function(){return this._core.onData},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onTitleChange",{get:function(){return this._core.onTitleChange},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onScroll",{get:function(){return this._core.onScroll},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onKey",{get:function(){return this._core.onKey},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onRender",{get:function(){return this._core.onRender},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"onResize",{get:function(){return this._core.onResize},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"element",{get:function(){return this._core.element},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"textarea",{get:function(){return this._core.textarea},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"rows",{get:function(){return this._core.rows},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"cols",{get:function(){return this._core.cols},enumerable:!0,configurable:!0}),Object.defineProperty(Terminal.prototype,"markers",{get:function(){return this._core.markers},enumerable:!0,configurable:!0}),Terminal.prototype.blur=function(){this._core.blur()},Terminal.prototype.focus=function(){this._core.focus()},Terminal.prototype.on=function(type,listener){this._core.on(type,listener)},Terminal.prototype.off=function(type,listener){this._core.off(type,listener)},Terminal.prototype.emit=function(type,data){this._core.emit(type,data)},Terminal.prototype.addDisposableListener=function(type,handler){return this._core.addDisposableListener(type,handler)},Terminal.prototype.resize=function(columns,rows){this._core.resize(columns,rows)},Terminal.prototype.writeln=function(data){this._core.writeln(data)},Terminal.prototype.open=function(parent){this._core.open(parent)},Terminal.prototype.attachCustomKeyEventHandler=function(customKeyEventHandler){this._core.attachCustomKeyEventHandler(customKeyEventHandler)},Terminal.prototype.addCsiHandler=function(flag,callback){return this._core.addCsiHandler(flag,callback)},Terminal.prototype.addOscHandler=function(ident,callback){return this._core.addOscHandler(ident,callback)},Terminal.prototype.registerLinkMatcher=function(regex,handler,options){return this._core.registerLinkMatcher(regex,handler,options)},Terminal.prototype.deregisterLinkMatcher=function(matcherId){this._core.deregisterLinkMatcher(matcherId)},Terminal.prototype.registerCharacterJoiner=function(handler){return this._core.registerCharacterJoiner(handler)},Terminal.prototype.deregisterCharacterJoiner=function(joinerId){this._core.deregisterCharacterJoiner(joinerId)},Terminal.prototype.addMarker=function(cursorYOffset){return this._core.addMarker(cursorYOffset)},Terminal.prototype.hasSelection=function(){return this._core.hasSelection()},Terminal.prototype.getSelection=function(){return this._core.getSelection()},Terminal.prototype.clearSelection=function(){this._core.clearSelection()},Terminal.prototype.selectAll=function(){this._core.selectAll()},Terminal.prototype.selectLines=function(start,end){this._core.selectLines(start,end)},Terminal.prototype.dispose=function(){this._core.dispose()},Terminal.prototype.destroy=function(){this._core.destroy()},Terminal.prototype.scrollLines=function(amount){this._core.scrollLines(amount)},Terminal.prototype.scrollPages=function(pageCount){this._core.scrollPages(pageCount)},Terminal.prototype.scrollToTop=function(){this._core.scrollToTop()},Terminal.prototype.scrollToBottom=function(){this._core.scrollToBottom()},Terminal.prototype.scrollToLine=function(line){this._core.scrollToLine(line)},Terminal.prototype.clear=function(){this._core.clear()},Terminal.prototype.write=function(data){this._core.write(data)},Terminal.prototype.getOption=function(key){return this._core.getOption(key)},Terminal.prototype.setOption=function(key,value){this._core.setOption(key,value)},Terminal.prototype.refresh=function(start,end){this._core.refresh(start,end)},Terminal.prototype.reset=function(){this._core.reset()},Terminal.applyAddon=function(addon){addon.apply(Terminal)},Object.defineProperty(Terminal,"strings",{get:function(){return Strings},enumerable:!0,configurable:!0}),Terminal}();exports.Terminal=Terminal},{"../Strings":22,"../Terminal":23}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Types_1=require("./atlas/Types"),CharAtlasCache_1=require("./atlas/CharAtlasCache"),BufferLine_1=require("../BufferLine"),Buffer_1=require("../Buffer"),CharacterJoinerRegistry_1=require("./CharacterJoinerRegistry"),BaseRenderLayer=function(){function BaseRenderLayer(_container,id,zIndex,_alpha,_colors){this._container=_container,this._alpha=_alpha,this._colors=_colors,this._scaledCharWidth=0,this._scaledCharHeight=0,this._scaledCellWidth=0,this._scaledCellHeight=0,this._scaledCharLeft=0,this._scaledCharTop=0,this._currentGlyphIdentifier={chars:"",code:0,bg:0,fg:0,bold:!1,dim:!1,italic:!1},this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-"+id+"-layer"),this._canvas.style.zIndex=zIndex.toString(),this._initCanvas(),this._container.appendChild(this._canvas)}return BaseRenderLayer.prototype.dispose=function(){this._container.removeChild(this._canvas),this._charAtlas&&this._charAtlas.dispose()},BaseRenderLayer.prototype._initCanvas=function(){this._ctx=this._canvas.getContext("2d",{alpha:this._alpha}),this._alpha||this.clearAll()},BaseRenderLayer.prototype.onOptionsChanged=function(terminal){},BaseRenderLayer.prototype.onBlur=function(terminal){},BaseRenderLayer.prototype.onFocus=function(terminal){},BaseRenderLayer.prototype.onCursorMove=function(terminal){},BaseRenderLayer.prototype.onGridChanged=function(terminal,startRow,endRow){},BaseRenderLayer.prototype.onSelectionChanged=function(terminal,start,end,columnSelectMode){void 0===columnSelectMode&&(columnSelectMode=!1)},BaseRenderLayer.prototype.onThemeChanged=function(terminal,colorSet){this._refreshCharAtlas(terminal,colorSet)},BaseRenderLayer.prototype.setTransparency=function(terminal,alpha){if(alpha!==this._alpha){var oldCanvas=this._canvas;this._alpha=alpha,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,oldCanvas),this._refreshCharAtlas(terminal,this._colors),this.onGridChanged(terminal,0,terminal.rows-1)}},BaseRenderLayer.prototype._refreshCharAtlas=function(terminal,colorSet){this._scaledCharWidth<=0&&this._scaledCharHeight<=0||(this._charAtlas=CharAtlasCache_1.acquireCharAtlas(terminal,colorSet,this._scaledCharWidth,this._scaledCharHeight),this._charAtlas.warmUp())},BaseRenderLayer.prototype.resize=function(terminal,dim){this._scaledCellWidth=dim.scaledCellWidth,this._scaledCellHeight=dim.scaledCellHeight,this._scaledCharWidth=dim.scaledCharWidth,this._scaledCharHeight=dim.scaledCharHeight,this._scaledCharLeft=dim.scaledCharLeft,this._scaledCharTop=dim.scaledCharTop,this._canvas.width=dim.scaledCanvasWidth,this._canvas.height=dim.scaledCanvasHeight,this._canvas.style.width=dim.canvasWidth+"px",this._canvas.style.height=dim.canvasHeight+"px",this._alpha||this.clearAll(),this._refreshCharAtlas(terminal,this._colors)},BaseRenderLayer.prototype.fillCells=function(x,y,width,height){this._ctx.fillRect(x*this._scaledCellWidth,y*this._scaledCellHeight,width*this._scaledCellWidth,height*this._scaledCellHeight)},BaseRenderLayer.prototype.fillBottomLineAtCells=function(x,y,width){void 0===width&&(width=1),this._ctx.fillRect(x*this._scaledCellWidth,(y+1)*this._scaledCellHeight-window.devicePixelRatio-1,width*this._scaledCellWidth,window.devicePixelRatio)},BaseRenderLayer.prototype.fillLeftLineAtCell=function(x,y){this._ctx.fillRect(x*this._scaledCellWidth,y*this._scaledCellHeight,window.devicePixelRatio,this._scaledCellHeight)},BaseRenderLayer.prototype.strokeRectAtCell=function(x,y,width,height){this._ctx.lineWidth=window.devicePixelRatio,this._ctx.strokeRect(x*this._scaledCellWidth+window.devicePixelRatio/2,y*this._scaledCellHeight+window.devicePixelRatio/2,width*this._scaledCellWidth-window.devicePixelRatio,height*this._scaledCellHeight-window.devicePixelRatio)},BaseRenderLayer.prototype.clearAll=function(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))},BaseRenderLayer.prototype.clearCells=function(x,y,width,height){this._alpha?this._ctx.clearRect(x*this._scaledCellWidth,y*this._scaledCellHeight,width*this._scaledCellWidth,height*this._scaledCellHeight):(this._ctx.fillStyle=this._colors.background.css,this._ctx.fillRect(x*this._scaledCellWidth,y*this._scaledCellHeight,width*this._scaledCellWidth,height*this._scaledCellHeight))},BaseRenderLayer.prototype.fillCharTrueColor=function(terminal,cell,x,y){this._ctx.font=this._getFont(terminal,!1,!1),this._ctx.textBaseline="middle",this._clipRow(terminal,y),this._ctx.fillText(cell.getChars(),x*this._scaledCellWidth+this._scaledCharLeft,y*this._scaledCellHeight+this._scaledCharTop+this._scaledCharHeight/2)},BaseRenderLayer.prototype.drawChars=function(terminal,cell,x,y){var fg,bg;cell.isFgRGB()||cell.isBgRGB()||cell instanceof CharacterJoinerRegistry_1.JoinedCellData?this._drawUncachedChars(terminal,cell,x,y):(cell.isInverse()?(fg=cell.isBgDefault()?Types_1.INVERTED_DEFAULT_COLOR:cell.getBgColor(),bg=cell.isFgDefault()?Types_1.INVERTED_DEFAULT_COLOR:cell.getFgColor()):(bg=cell.isBgDefault()?Types_1.DEFAULT_COLOR:cell.getBgColor(),fg=cell.isFgDefault()?Types_1.DEFAULT_COLOR:cell.getFgColor()),fg+=terminal.options.drawBoldTextInBrightColors&&cell.isBold()&&fg<8&&fg!==Types_1.INVERTED_DEFAULT_COLOR?8:0,this._currentGlyphIdentifier.chars=cell.getChars()||Buffer_1.WHITESPACE_CELL_CHAR,this._currentGlyphIdentifier.code=cell.getCode()||Buffer_1.WHITESPACE_CELL_CODE,this._currentGlyphIdentifier.bg=bg,this._currentGlyphIdentifier.fg=fg,this._currentGlyphIdentifier.bold=cell.isBold()&&terminal.options.enableBold,this._currentGlyphIdentifier.dim=!!cell.isDim(),this._currentGlyphIdentifier.italic=!!cell.isItalic(),this._charAtlas&&this._charAtlas.draw(this._ctx,this._currentGlyphIdentifier,x*this._scaledCellWidth+this._scaledCharLeft,y*this._scaledCellHeight+this._scaledCharTop)||this._drawUncachedChars(terminal,cell,x,y))},BaseRenderLayer.prototype._drawUncachedChars=function(terminal,cell,x,y){if(this._ctx.save(),this._ctx.font=this._getFont(terminal,cell.isBold()&&terminal.options.enableBold,!!cell.isItalic()),this._ctx.textBaseline="middle",cell.isInverse())cell.isBgDefault()?this._ctx.fillStyle=this._colors.background.css:cell.isBgRGB()?this._ctx.fillStyle="rgb("+BufferLine_1.AttributeData.toColorRGB(cell.getBgColor()).join(",")+")":this._ctx.fillStyle=this._colors.ansi[cell.getBgColor()].css;else if(cell.isFgDefault())this._ctx.fillStyle=this._colors.foreground.css;else if(cell.isFgRGB())this._ctx.fillStyle="rgb("+BufferLine_1.AttributeData.toColorRGB(cell.getFgColor()).join(",")+")";else{var fg=cell.getFgColor();terminal.options.drawBoldTextInBrightColors&&cell.isBold()&&fg<8&&(fg+=8),this._ctx.fillStyle=this._colors.ansi[fg].css}this._clipRow(terminal,y),cell.isDim()&&(this._ctx.globalAlpha=Types_1.DIM_OPACITY),this._ctx.fillText(cell.getChars(),x*this._scaledCellWidth+this._scaledCharLeft,y*this._scaledCellHeight+this._scaledCharTop+this._scaledCharHeight/2),this._ctx.restore()},BaseRenderLayer.prototype._clipRow=function(terminal,y){this._ctx.beginPath(),this._ctx.rect(0,y*this._scaledCellHeight,terminal.cols*this._scaledCellWidth,this._scaledCellHeight),this._ctx.clip()},BaseRenderLayer.prototype._getFont=function(terminal,isBold,isItalic){return(isItalic?"italic":"")+" "+(isBold?terminal.options.fontWeightBold:terminal.options.fontWeight)+" "+terminal.options.fontSize*window.devicePixelRatio+"px "+terminal.options.fontFamily},BaseRenderLayer}();exports.BaseRenderLayer=BaseRenderLayer},{"../Buffer":6,"../BufferLine":7,"./CharacterJoinerRegistry":40,"./atlas/CharAtlasCache":49,"./atlas/Types":56}],40:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var BufferLine_1=require("../BufferLine"),Buffer_1=require("../Buffer"),JoinedCellData=function(_super){function JoinedCellData(firstCell,chars,width){var _this=_super.call(this)||this;return _this.content=0,_this.combinedData="",_this.fg=firstCell.fg,_this.bg=firstCell.bg,_this.combinedData=chars,_this._width=width,_this}return __extends(JoinedCellData,_super),JoinedCellData.prototype.isCombined=function(){return 2097152},JoinedCellData.prototype.getWidth=function(){return this._width},JoinedCellData.prototype.getChars=function(){return this.combinedData},JoinedCellData.prototype.getCode=function(){return 2097151},JoinedCellData.prototype.setFromCharData=function(value){throw new Error("not implemented")},JoinedCellData.prototype.getAsCharData=function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]},JoinedCellData}(BufferLine_1.AttributeData);exports.JoinedCellData=JoinedCellData;var CharacterJoinerRegistry=function(){function CharacterJoinerRegistry(_terminal){this._terminal=_terminal,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new BufferLine_1.CellData}return CharacterJoinerRegistry.prototype.registerCharacterJoiner=function(handler){var joiner={id:this._nextCharacterJoinerId++,handler:handler};return this._characterJoiners.push(joiner),joiner.id},CharacterJoinerRegistry.prototype.deregisterCharacterJoiner=function(joinerId){for(var i=0;i<this._characterJoiners.length;i++)if(this._characterJoiners[i].id===joinerId)return this._characterJoiners.splice(i,1),!0;return!1},CharacterJoinerRegistry.prototype.getJoinedCharacters=function(row){if(0===this._characterJoiners.length)return[];var line=this._terminal.buffer.lines.get(row);if(0===line.length)return[];for(var ranges=[],lineStr=line.translateToString(!0),rangeStartColumn=0,currentStringIndex=0,rangeStartStringIndex=0,rangeAttrFG=line.getFg(0),rangeAttrBG=line.getBg(0),x=0;x<line.getTrimmedLength();x++)if(line.loadCell(x,this._workCell),0!==this._workCell.getWidth()){if(this._workCell.fg!==rangeAttrFG||this._workCell.bg!==rangeAttrBG){if(1<x-rangeStartColumn)for(var joinedRanges=this._getJoinedRanges(lineStr,rangeStartStringIndex,currentStringIndex,line,rangeStartColumn),i=0;i<joinedRanges.length;i++)ranges.push(joinedRanges[i]);rangeStartColumn=x,rangeStartStringIndex=currentStringIndex,rangeAttrFG=this._workCell.fg,rangeAttrBG=this._workCell.bg}currentStringIndex+=this._workCell.getChars().length||Buffer_1.WHITESPACE_CELL_CHAR.length}if(1<this._terminal.cols-rangeStartColumn)for(joinedRanges=this._getJoinedRanges(lineStr,rangeStartStringIndex,currentStringIndex,line,rangeStartColumn),i=0;i<joinedRanges.length;i++)ranges.push(joinedRanges[i]);return ranges},CharacterJoinerRegistry.prototype._getJoinedRanges=function(line,startIndex,endIndex,lineData,startCol){for(var text=line.substring(startIndex,endIndex),joinedRanges=this._characterJoiners[0].handler(text),i=1;i<this._characterJoiners.length;i++)for(var joinerRanges=this._characterJoiners[i].handler(text),j=0;j<joinerRanges.length;j++)CharacterJoinerRegistry._mergeRanges(joinedRanges,joinerRanges[j]);return this._stringRangesToCellRanges(joinedRanges,lineData,startCol),joinedRanges},CharacterJoinerRegistry.prototype._stringRangesToCellRanges=function(ranges,line,startCol){var currentRangeIndex=0,currentRangeStarted=!1,currentStringIndex=0,currentRange=ranges[currentRangeIndex];if(currentRange){for(var x=startCol;x<this._terminal.cols;x++){var width=line.getWidth(x),length_1=line.getString(x).length||Buffer_1.WHITESPACE_CELL_CHAR.length;if(0!==width){if(!currentRangeStarted&&currentRange[0]<=currentStringIndex&&(currentRange[0]=x,currentRangeStarted=!0),currentRange[1]<=currentStringIndex){if(currentRange[1]=x,!(currentRange=ranges[++currentRangeIndex]))break;currentRangeStarted=currentRange[0]<=currentStringIndex&&(currentRange[0]=x,!0)}currentStringIndex+=length_1}}currentRange&&(currentRange[1]=this._terminal.cols)}},CharacterJoinerRegistry._mergeRanges=function(ranges,newRange){for(var inRange=!1,i=0;i<ranges.length;i++){var range=ranges[i];if(inRange){if(newRange[1]<=range[0])return ranges[i-1][1]=newRange[1],ranges;if(newRange[1]<=range[1])return ranges[i-1][1]=Math.max(newRange[1],range[1]),ranges.splice(i,1),inRange=!1,ranges;ranges.splice(i,1),i--}else{if(newRange[1]<=range[0])return ranges.splice(i,0,newRange),ranges;if(newRange[1]<=range[1])return range[0]=Math.min(newRange[0],range[0]),ranges;newRange[0]<range[1]&&(range[0]=Math.min(newRange[0],range[0]),inRange=!0)}}return inRange?ranges[ranges.length-1][1]=newRange[1]:ranges.push(newRange),ranges},CharacterJoinerRegistry}();exports.CharacterJoinerRegistry=CharacterJoinerRegistry},{"../Buffer":6,"../BufferLine":7}],41:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DEFAULT_FOREGROUND=fromHex("#ffffff"),DEFAULT_BACKGROUND=fromHex("#000000"),DEFAULT_CURSOR=fromHex("#ffffff"),DEFAULT_CURSOR_ACCENT=fromHex("#000000"),DEFAULT_SELECTION={css:"rgba(255, 255, 255, 0.3)",rgba:4294967159};function fromHex(css){return{css:css,rgba:parseInt(css.slice(1),16)<<8|255}}function toPaddedHex(c){var s=c.toString(16);return s.length<2?"0"+s:s}exports.DEFAULT_ANSI_COLORS=function(){for(var colors=[fromHex("#2e3436"),fromHex("#cc0000"),fromHex("#4e9a06"),fromHex("#c4a000"),fromHex("#3465a4"),fromHex("#75507b"),fromHex("#06989a"),fromHex("#d3d7cf"),fromHex("#555753"),fromHex("#ef2929"),fromHex("#8ae234"),fromHex("#fce94f"),fromHex("#729fcf"),fromHex("#ad7fa8"),fromHex("#34e2e2"),fromHex("#eeeeec")],v=[0,95,135,175,215,255],i=0;i<216;i++){var r=v[i/36%6|0],g=v[i/6%6|0],b=v[i%6];colors.push({css:"#"+toPaddedHex(r)+toPaddedHex(g)+toPaddedHex(b),rgba:(r<<24|g<<16|b<<8|255)>>>0})}for(i=0;i<24;i++){var c=8+10*i,ch=toPaddedHex(c);colors.push({css:"#"+ch+ch+ch,rgba:(c<<24|c<<16|c<<8|255)>>>0})}return colors}();var ColorManager=function(){function ColorManager(document,allowTransparency){this.allowTransparency=allowTransparency;var canvas=document.createElement("canvas");canvas.width=1,canvas.height=1,this._ctx=canvas.getContext("2d"),this._ctx.globalCompositeOperation="copy",this._litmusColor=this._ctx.createLinearGradient(0,0,1,1),this.colors={foreground:DEFAULT_FOREGROUND,background:DEFAULT_BACKGROUND,cursor:DEFAULT_CURSOR,cursorAccent:DEFAULT_CURSOR_ACCENT,selection:DEFAULT_SELECTION,ansi:exports.DEFAULT_ANSI_COLORS.slice()}}return ColorManager.prototype.setTheme=function(theme){this.colors.foreground=this._parseColor(theme.foreground,DEFAULT_FOREGROUND),this.colors.background=this._parseColor(theme.background,DEFAULT_BACKGROUND),this.colors.cursor=this._parseColor(theme.cursor,DEFAULT_CURSOR,!0),this.colors.cursorAccent=this._parseColor(theme.cursorAccent,DEFAULT_CURSOR_ACCENT,!0),this.colors.selection=this._parseColor(theme.selection,DEFAULT_SELECTION,!0),this.colors.ansi[0]=this._parseColor(theme.black,exports.DEFAULT_ANSI_COLORS[0]),this.colors.ansi[1]=this._parseColor(theme.red,exports.DEFAULT_ANSI_COLORS[1]),this.colors.ansi[2]=this._parseColor(theme.green,exports.DEFAULT_ANSI_COLORS[2]),this.colors.ansi[3]=this._parseColor(theme.yellow,exports.DEFAULT_ANSI_COLORS[3]),this.colors.ansi[4]=this._parseColor(theme.blue,exports.DEFAULT_ANSI_COLORS[4]),this.colors.ansi[5]=this._parseColor(theme.magenta,exports.DEFAULT_ANSI_COLORS[5]),this.colors.ansi[6]=this._parseColor(theme.cyan,exports.DEFAULT_ANSI_COLORS[6]),this.colors.ansi[7]=this._parseColor(theme.white,exports.DEFAULT_ANSI_COLORS[7]),this.colors.ansi[8]=this._parseColor(theme.brightBlack,exports.DEFAULT_ANSI_COLORS[8]),this.colors.ansi[9]=this._parseColor(theme.brightRed,exports.DEFAULT_ANSI_COLORS[9]),this.colors.ansi[10]=this._parseColor(theme.brightGreen,exports.DEFAULT_ANSI_COLORS[10]),this.colors.ansi[11]=this._parseColor(theme.brightYellow,exports.DEFAULT_ANSI_COLORS[11]),this.colors.ansi[12]=this._parseColor(theme.brightBlue,exports.DEFAULT_ANSI_COLORS[12]),this.colors.ansi[13]=this._parseColor(theme.brightMagenta,exports.DEFAULT_ANSI_COLORS[13]),this.colors.ansi[14]=this._parseColor(theme.brightCyan,exports.DEFAULT_ANSI_COLORS[14]),this.colors.ansi[15]=this._parseColor(theme.brightWhite,exports.DEFAULT_ANSI_COLORS[15])},ColorManager.prototype._parseColor=function(css,fallback,allowTransparency){if(void 0===allowTransparency&&(allowTransparency=this.allowTransparency),!css)return fallback;if(this._ctx.fillStyle=this._litmusColor,this._ctx.fillStyle=css,"string"!=typeof this._ctx.fillStyle)return console.warn("Color: "+css+" is invalid using fallback "+fallback.css),fallback;this._ctx.fillRect(0,0,1,1);var data=this._ctx.getImageData(0,0,1,1).data;return allowTransparency||255===data[3]?{css:css,rgba:(data[0]<<24|data[1]<<16|data[2]<<8|data[3])>>>0}:(console.warn("Color: "+css+" is using transparency, but allowTransparency is false. Using fallback "+fallback.css+"."),fallback)},ColorManager}();exports.ColorManager=ColorManager},{}],42:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var BaseRenderLayer_1=require("./BaseRenderLayer"),BufferLine_1=require("../BufferLine"),CursorRenderLayer=function(_super){function CursorRenderLayer(container,zIndex,colors){var _this=_super.call(this,container,"cursor",zIndex,!0,colors)||this;return _this._cell=new BufferLine_1.CellData,_this._state={x:null,y:null,isFocused:null,style:null,width:null},_this._cursorRenderers={bar:_this._renderBarCursor.bind(_this),block:_this._renderBlockCursor.bind(_this),underline:_this._renderUnderlineCursor.bind(_this)},_this}return __extends(CursorRenderLayer,_super),CursorRenderLayer.prototype.resize=function(terminal,dim){_super.prototype.resize.call(this,terminal,dim),this._state={x:null,y:null,isFocused:null,style:null,width:null}},CursorRenderLayer.prototype.reset=function(terminal){this._clearCursor(),this._cursorBlinkStateManager&&(this._cursorBlinkStateManager.dispose(),this._cursorBlinkStateManager=null,this.onOptionsChanged(terminal))},CursorRenderLayer.prototype.onBlur=function(terminal){this._cursorBlinkStateManager&&this._cursorBlinkStateManager.pause(),terminal.refresh(terminal.buffer.y,terminal.buffer.y)},CursorRenderLayer.prototype.onFocus=function(terminal){this._cursorBlinkStateManager?this._cursorBlinkStateManager.resume(terminal):terminal.refresh(terminal.buffer.y,terminal.buffer.y)},CursorRenderLayer.prototype.onOptionsChanged=function(terminal){var _this=this;terminal.options.cursorBlink?this._cursorBlinkStateManager||(this._cursorBlinkStateManager=new CursorBlinkStateManager(terminal,function(){_this._render(terminal,!0)})):(this._cursorBlinkStateManager&&(this._cursorBlinkStateManager.dispose(),this._cursorBlinkStateManager=null),terminal.refresh(terminal.buffer.y,terminal.buffer.y))},CursorRenderLayer.prototype.onCursorMove=function(terminal){this._cursorBlinkStateManager&&this._cursorBlinkStateManager.restartBlinkAnimation(terminal)},CursorRenderLayer.prototype.onGridChanged=function(terminal,startRow,endRow){!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isPaused?this._render(terminal,!1):this._cursorBlinkStateManager.restartBlinkAnimation(terminal)},CursorRenderLayer.prototype._render=function(terminal,triggeredByAnimationFrame){if(terminal.cursorState&&!terminal.cursorHidden){var cursorY=terminal.buffer.ybase+terminal.buffer.y,viewportRelativeCursorY=cursorY-terminal.buffer.ydisp;if(viewportRelativeCursorY<0||viewportRelativeCursorY>=terminal.rows)this._clearCursor();else if(terminal.buffer.lines.get(cursorY).loadCell(terminal.buffer.x,this._cell),void 0!==this._cell.content){if(!terminal.isFocused)return this._clearCursor(),this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._renderBlurCursor(terminal,terminal.buffer.x,viewportRelativeCursorY,this._cell),this._ctx.restore(),this._state.x=terminal.buffer.x,this._state.y=viewportRelativeCursorY,this._state.isFocused=!1,this._state.style=terminal.options.cursorStyle,void(this._state.width=this._cell.getWidth());if(!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isCursorVisible){if(this._state){if(this._state.x===terminal.buffer.x&&this._state.y===viewportRelativeCursorY&&this._state.isFocused===terminal.isFocused&&this._state.style===terminal.options.cursorStyle&&this._state.width===this._cell.getWidth())return;this._clearCursor()}this._ctx.save(),this._cursorRenderers[terminal.options.cursorStyle||"block"](terminal,terminal.buffer.x,viewportRelativeCursorY,this._cell),this._ctx.restore(),this._state.x=terminal.buffer.x,this._state.y=viewportRelativeCursorY,this._state.isFocused=!1,this._state.style=terminal.options.cursorStyle,this._state.width=this._cell.getWidth()}else this._clearCursor()}}else this._clearCursor()},CursorRenderLayer.prototype._clearCursor=function(){this._state&&(this.clearCells(this._state.x,this._state.y,this._state.width,1),this._state={x:null,y:null,isFocused:null,style:null,width:null})},CursorRenderLayer.prototype._renderBarCursor=function(terminal,x,y,cell){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this.fillLeftLineAtCell(x,y),this._ctx.restore()},CursorRenderLayer.prototype._renderBlockCursor=function(terminal,x,y,cell){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this.fillCells(x,y,cell.getWidth(),1),this._ctx.fillStyle=this._colors.cursorAccent.css,this.fillCharTrueColor(terminal,cell,x,y),this._ctx.restore()},CursorRenderLayer.prototype._renderUnderlineCursor=function(terminal,x,y,cell){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this.fillBottomLineAtCells(x,y),this._ctx.restore()},CursorRenderLayer.prototype._renderBlurCursor=function(terminal,x,y,cell){this._ctx.save(),this._ctx.strokeStyle=this._colors.cursor.css,this.strokeRectAtCell(x,y,cell.getWidth(),1),this._ctx.restore()},CursorRenderLayer}(BaseRenderLayer_1.BaseRenderLayer);exports.CursorRenderLayer=CursorRenderLayer;var CursorBlinkStateManager=function(){function CursorBlinkStateManager(terminal,_renderCallback){this._renderCallback=_renderCallback,this.isCursorVisible=!0,terminal.isFocused&&this._restartInterval()}return Object.defineProperty(CursorBlinkStateManager.prototype,"isPaused",{get:function(){return!(this._blinkStartTimeout||this._blinkInterval)},enumerable:!0,configurable:!0}),CursorBlinkStateManager.prototype.dispose=function(){this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=null),this._blinkStartTimeout&&(window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=null),this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=null)},CursorBlinkStateManager.prototype.restartBlinkAnimation=function(terminal){var _this=this;this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=window.requestAnimationFrame(function(){_this._renderCallback(),_this._animationFrame=null})))},CursorBlinkStateManager.prototype._restartInterval=function(timeToStart){var _this=this;void 0===timeToStart&&(timeToStart=600),this._blinkInterval&&window.clearInterval(this._blinkInterval),this._blinkStartTimeout=setTimeout(function(){if(_this._animationTimeRestarted){var time=600-(Date.now()-_this._animationTimeRestarted);if(_this._animationTimeRestarted=null,0<time)return void _this._restartInterval(time)}_this.isCursorVisible=!1,_this._animationFrame=window.requestAnimationFrame(function(){_this._renderCallback(),_this._animationFrame=null}),_this._blinkInterval=setInterval(function(){if(_this._animationTimeRestarted){var time=600-(Date.now()-_this._animationTimeRestarted);return _this._animationTimeRestarted=null,void _this._restartInterval(time)}_this.isCursorVisible=!_this.isCursorVisible,_this._animationFrame=window.requestAnimationFrame(function(){_this._renderCallback(),_this._animationFrame=null})},600)},timeToStart)},CursorBlinkStateManager.prototype.pause=function(){this.isCursorVisible=!0,this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=null),this._blinkStartTimeout&&(window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=null),this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=null)},CursorBlinkStateManager.prototype.resume=function(terminal){this._animationTimeRestarted=null,this._restartInterval(),this.restartBlinkAnimation(terminal)},CursorBlinkStateManager}()},{"../BufferLine":7,"./BaseRenderLayer":39}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var GridCache=function(){function GridCache(){this.cache=[]}return GridCache.prototype.resize=function(width,height){for(var x=0;x<width;x++){this.cache.length<=x&&this.cache.push([]);for(var y=this.cache[x].length;y<height;y++)this.cache[x].push(null);this.cache[x].length=height}this.cache.length=width},GridCache.prototype.clear=function(){for(var x=0;x<this.cache.length;x++)for(var y=0;y<this.cache[x].length;y++)this.cache[x][y]=null},GridCache}();exports.GridCache=GridCache},{}],44:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var BaseRenderLayer_1=require("./BaseRenderLayer"),Types_1=require("./atlas/Types"),CharAtlasUtils_1=require("./atlas/CharAtlasUtils"),LinkRenderLayer=function(_super){function LinkRenderLayer(container,zIndex,colors,terminal){var _this=_super.call(this,container,"link",zIndex,!0,colors)||this;return _this._state=null,terminal.linkifier.onLinkHover(function(e){return _this._onLinkHover(e)}),terminal.linkifier.onLinkLeave(function(e){return _this._onLinkLeave(e)}),_this}return __extends(LinkRenderLayer,_super),LinkRenderLayer.prototype.resize=function(terminal,dim){_super.prototype.resize.call(this,terminal,dim),this._state=null},LinkRenderLayer.prototype.reset=function(terminal){this._clearCurrentLink()},LinkRenderLayer.prototype._clearCurrentLink=function(){if(this._state){this.clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);var middleRowCount=this._state.y2-this._state.y1-1;0<middleRowCount&&this.clearCells(0,this._state.y1+1,this._state.cols,middleRowCount),this.clearCells(0,this._state.y2,this._state.x2,1),this._state=null}},LinkRenderLayer.prototype._onLinkHover=function(e){if(e.fg===Types_1.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._colors.background.css:CharAtlasUtils_1.is256Color(e.fg)?this._ctx.fillStyle=this._colors.ansi[e.fg].css:this._ctx.fillStyle=this._colors.foreground.css,e.y1===e.y2)this.fillBottomLineAtCells(e.x1,e.y1,e.x2-e.x1);else{this.fillBottomLineAtCells(e.x1,e.y1,e.cols-e.x1);for(var y=e.y1+1;y<e.y2;y++)this.fillBottomLineAtCells(0,y,e.cols);this.fillBottomLineAtCells(0,e.y2,e.x2)}this._state=e},LinkRenderLayer.prototype._onLinkLeave=function(e){this._clearCurrentLink()},LinkRenderLayer}(BaseRenderLayer_1.BaseRenderLayer);exports.LinkRenderLayer=LinkRenderLayer},{"./BaseRenderLayer":39,"./atlas/CharAtlasUtils":51,"./atlas/Types":56}],45:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var TextRenderLayer_1=require("./TextRenderLayer"),SelectionRenderLayer_1=require("./SelectionRenderLayer"),CursorRenderLayer_1=require("./CursorRenderLayer"),ColorManager_1=require("./ColorManager"),LinkRenderLayer_1=require("./LinkRenderLayer"),RenderDebouncer_1=require("../ui/RenderDebouncer"),ScreenDprMonitor_1=require("../ui/ScreenDprMonitor"),CharacterJoinerRegistry_1=require("../renderer/CharacterJoinerRegistry"),EventEmitter2_1=require("../common/EventEmitter2"),Renderer=function(_super){function Renderer(_terminal,theme){var _this=_super.call(this)||this;_this._terminal=_terminal,_this._isPaused=!1,_this._needsFullRefresh=!1,_this._onCanvasResize=new EventEmitter2_1.EventEmitter2,_this._onRender=new EventEmitter2_1.EventEmitter2;var allowTransparency=_this._terminal.options.allowTransparency;if(_this.colorManager=new ColorManager_1.ColorManager(document,allowTransparency),_this._characterJoinerRegistry=new CharacterJoinerRegistry_1.CharacterJoinerRegistry(_terminal),theme&&_this.colorManager.setTheme(theme),_this._renderLayers=[new TextRenderLayer_1.TextRenderLayer(_this._terminal.screenElement,0,_this.colorManager.colors,_this._characterJoinerRegistry,allowTransparency),new SelectionRenderLayer_1.SelectionRenderLayer(_this._terminal.screenElement,1,_this.colorManager.colors),new LinkRenderLayer_1.LinkRenderLayer(_this._terminal.screenElement,2,_this.colorManager.colors,_this._terminal),new CursorRenderLayer_1.CursorRenderLayer(_this._terminal.screenElement,3,_this.colorManager.colors)],_this.dimensions={scaledCharWidth:null,scaledCharHeight:null,scaledCellWidth:null,scaledCellHeight:null,scaledCharLeft:null,scaledCharTop:null,scaledCanvasWidth:null,scaledCanvasHeight:null,canvasWidth:null,canvasHeight:null,actualCellWidth:null,actualCellHeight:null},_this._devicePixelRatio=window.devicePixelRatio,_this._updateDimensions(),_this.onOptionsChanged(),_this._renderDebouncer=new RenderDebouncer_1.RenderDebouncer(_this._renderRows.bind(_this)),_this._screenDprMonitor=new ScreenDprMonitor_1.ScreenDprMonitor,_this._screenDprMonitor.setListener(function(){return _this.onWindowResize(window.devicePixelRatio)}),_this.register(_this._screenDprMonitor),"IntersectionObserver"in window){var observer_1=new IntersectionObserver(function(e){return _this.onIntersectionChange(e[e.length-1])},{threshold:0});observer_1.observe(_this._terminal.element),_this.register({dispose:function(){return observer_1.disconnect()}})}return _this}return __extends(Renderer,_super),Object.defineProperty(Renderer.prototype,"onCanvasResize",{get:function(){return this._onCanvasResize.event},enumerable:!0,configurable:!0}),Object.defineProperty(Renderer.prototype,"onRender",{get:function(){return this._onRender.event},enumerable:!0,configurable:!0}),Renderer.prototype.dispose=function(){_super.prototype.dispose.call(this),this._renderLayers.forEach(function(l){return l.dispose()})},Renderer.prototype.onIntersectionChange=function(entry){this._isPaused=0===entry.intersectionRatio,!this._isPaused&&this._needsFullRefresh&&(this._terminal.refresh(0,this._terminal.rows-1),this._needsFullRefresh=!1)},Renderer.prototype.onWindowResize=function(devicePixelRatio){this._devicePixelRatio!==devicePixelRatio&&(this._devicePixelRatio=devicePixelRatio,this.onResize(this._terminal.cols,this._terminal.rows))},Renderer.prototype.setTheme=function(theme){var _this=this;return this.colorManager.setTheme(theme),this._renderLayers.forEach(function(l){l.onThemeChanged(_this._terminal,_this.colorManager.colors),l.reset(_this._terminal)}),this._isPaused?this._needsFullRefresh=!0:this._terminal.refresh(0,this._terminal.rows-1),this.colorManager.colors},Renderer.prototype.onResize=function(cols,rows){var _this=this;this._updateDimensions(),this._renderLayers.forEach(function(l){return l.resize(_this._terminal,_this.dimensions)}),this._isPaused?this._needsFullRefresh=!0:this._terminal.refresh(0,this._terminal.rows-1),this._terminal.screenElement.style.width=this.dimensions.canvasWidth+"px",this._terminal.screenElement.style.height=this.dimensions.canvasHeight+"px",this._onCanvasResize.fire({width:this.dimensions.canvasWidth,height:this.dimensions.canvasHeight})},Renderer.prototype.onCharSizeChanged=function(){this.onResize(this._terminal.cols,this._terminal.rows)},Renderer.prototype.onBlur=function(){var _this=this;this._runOperation(function(l){return l.onBlur(_this._terminal)})},Renderer.prototype.onFocus=function(){var _this=this;this._runOperation(function(l){return l.onFocus(_this._terminal)})},Renderer.prototype.onSelectionChanged=function(start,end,columnSelectMode){var _this=this;void 0===columnSelectMode&&(columnSelectMode=!1),this._runOperation(function(l){return l.onSelectionChanged(_this._terminal,start,end,columnSelectMode)})},Renderer.prototype.onCursorMove=function(){var _this=this;this._runOperation(function(l){return l.onCursorMove(_this._terminal)})},Renderer.prototype.onOptionsChanged=function(){var _this=this;this.colorManager.allowTransparency=this._terminal.options.allowTransparency,this._runOperation(function(l){return l.onOptionsChanged(_this._terminal)})},Renderer.prototype.clear=function(){var _this=this;this._runOperation(function(l){return l.reset(_this._terminal)})},Renderer.prototype._runOperation=function(operation){this._isPaused?this._needsFullRefresh=!0:this._renderLayers.forEach(function(l){return operation(l)})},Renderer.prototype.refreshRows=function(start,end){this._isPaused?this._needsFullRefresh=!0:this._renderDebouncer.refresh(start,end,this._terminal.rows)},Renderer.prototype._renderRows=function(start,end){var _this=this;this._renderLayers.forEach(function(l){return l.onGridChanged(_this._terminal,start,end)}),this._onRender.fire({start:start,end:end})},Renderer.prototype._updateDimensions=function(){this._terminal.charMeasure.width&&this._terminal.charMeasure.height&&(this.dimensions.scaledCharWidth=Math.floor(this._terminal.charMeasure.width*window.devicePixelRatio),this.dimensions.scaledCharHeight=Math.ceil(this._terminal.charMeasure.height*window.devicePixelRatio),this.dimensions.scaledCellHeight=Math.floor(this.dimensions.scaledCharHeight*this._terminal.options.lineHeight),this.dimensions.scaledCharTop=1===this._terminal.options.lineHeight?0:Math.round((this.dimensions.scaledCellHeight-this.dimensions.scaledCharHeight)/2),this.dimensions.scaledCellWidth=this.dimensions.scaledCharWidth+Math.round(this._terminal.options.letterSpacing),this.dimensions.scaledCharLeft=Math.floor(this._terminal.options.letterSpacing/2),this.dimensions.scaledCanvasHeight=this._terminal.rows*this.dimensions.scaledCellHeight,this.dimensions.scaledCanvasWidth=this._terminal.cols*this.dimensions.scaledCellWidth,this.dimensions.canvasHeight=Math.round(this.dimensions.scaledCanvasHeight/window.devicePixelRatio),this.dimensions.canvasWidth=Math.round(this.dimensions.scaledCanvasWidth/window.devicePixelRatio),this.dimensions.actualCellHeight=this.dimensions.canvasHeight/this._terminal.rows,this.dimensions.actualCellWidth=this.dimensions.canvasWidth/this._terminal.cols)},Renderer.prototype.registerCharacterJoiner=function(handler){return this._characterJoinerRegistry.registerCharacterJoiner(handler)},Renderer.prototype.deregisterCharacterJoiner=function(joinerId){return this._characterJoinerRegistry.deregisterCharacterJoiner(joinerId)},Renderer}(require("../common/Lifecycle").Disposable);exports.Renderer=Renderer},{"../common/EventEmitter2":29,"../common/Lifecycle":30,"../renderer/CharacterJoinerRegistry":40,"../ui/RenderDebouncer":60,"../ui/ScreenDprMonitor":61,"./ColorManager":41,"./CursorRenderLayer":42,"./LinkRenderLayer":44,"./SelectionRenderLayer":46,"./TextRenderLayer":47}],46:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var SelectionRenderLayer=function(_super){function SelectionRenderLayer(container,zIndex,colors){var _this=_super.call(this,container,"selection",zIndex,!0,colors)||this;return _this._clearState(),_this}return __extends(SelectionRenderLayer,_super),SelectionRenderLayer.prototype._clearState=function(){this._state={start:null,end:null,columnSelectMode:null,ydisp:null}},SelectionRenderLayer.prototype.resize=function(terminal,dim){_super.prototype.resize.call(this,terminal,dim),this._clearState()},SelectionRenderLayer.prototype.reset=function(terminal){this._state.start&&this._state.end&&(this._clearState(),this.clearAll())},SelectionRenderLayer.prototype.onSelectionChanged=function(terminal,start,end,columnSelectMode){if(this._didStateChange(start,end,columnSelectMode,terminal.buffer.ydisp))if(this.clearAll(),start&&end){var viewportStartRow=start[1]-terminal.buffer.ydisp,viewportEndRow=end[1]-terminal.buffer.ydisp,viewportCappedStartRow=Math.max(viewportStartRow,0),viewportCappedEndRow=Math.min(viewportEndRow,terminal.rows-1);if(!(viewportCappedStartRow>=terminal.rows||viewportCappedEndRow<0)){if(this._ctx.fillStyle=this._colors.selection.css,columnSelectMode){var startCol=start[0],width=end[0]-startCol,height=viewportCappedEndRow-viewportCappedStartRow+1;this.fillCells(startCol,viewportCappedStartRow,width,height)}else{startCol=viewportStartRow===viewportCappedStartRow?start[0]:0;var startRowEndCol=viewportCappedStartRow===viewportCappedEndRow?end[0]:terminal.cols;this.fillCells(startCol,viewportCappedStartRow,startRowEndCol-startCol,1);var middleRowsCount=Math.max(viewportCappedEndRow-viewportCappedStartRow-1,0);if(this.fillCells(0,viewportCappedStartRow+1,terminal.cols,middleRowsCount),viewportCappedStartRow!==viewportCappedEndRow){var endCol=viewportEndRow===viewportCappedEndRow?end[0]:terminal.cols;this.fillCells(0,viewportCappedEndRow,endCol,1)}}this._state.start=[start[0],start[1]],this._state.end=[end[0],end[1]],this._state.columnSelectMode=columnSelectMode,this._state.ydisp=terminal.buffer.ydisp}}else this._clearState()},SelectionRenderLayer.prototype._didStateChange=function(start,end,columnSelectMode,ydisp){return!this._areCoordinatesEqual(start,this._state.start)||!this._areCoordinatesEqual(end,this._state.end)||columnSelectMode!==this._state.columnSelectMode||ydisp!==this._state.ydisp},SelectionRenderLayer.prototype._areCoordinatesEqual=function(coord1,coord2){return!(!coord1||!coord2)&&(coord1[0]===coord2[0]&&coord1[1]===coord2[1])},SelectionRenderLayer}(require("./BaseRenderLayer").BaseRenderLayer);exports.SelectionRenderLayer=SelectionRenderLayer},{"./BaseRenderLayer":39}],47:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Buffer_1=require("../Buffer"),GridCache_1=require("./GridCache"),BaseRenderLayer_1=require("./BaseRenderLayer"),BufferLine_1=require("../BufferLine"),CharacterJoinerRegistry_1=require("./CharacterJoinerRegistry"),TextRenderLayer=function(_super){function TextRenderLayer(container,zIndex,colors,characterJoinerRegistry,alpha){var _this=_super.call(this,container,"text",zIndex,alpha,colors)||this;return _this._characterOverlapCache={},_this._workCell=new BufferLine_1.CellData,_this._state=new GridCache_1.GridCache,_this._characterJoinerRegistry=characterJoinerRegistry,_this}return __extends(TextRenderLayer,_super),TextRenderLayer.prototype.resize=function(terminal,dim){_super.prototype.resize.call(this,terminal,dim);var terminalFont=this._getFont(terminal,!1,!1);this._characterWidth===dim.scaledCharWidth&&this._characterFont===terminalFont||(this._characterWidth=dim.scaledCharWidth,this._characterFont=terminalFont,this._characterOverlapCache={}),this._state.clear(),this._state.resize(terminal.cols,terminal.rows)},TextRenderLayer.prototype.reset=function(terminal){this._state.clear(),this.clearAll()},TextRenderLayer.prototype._forEachCell=function(terminal,firstRow,lastRow,joinerRegistry,callback){for(var y=firstRow;y<=lastRow;y++)for(var row=y+terminal.buffer.ydisp,line=terminal.buffer.lines.get(row),joinedRanges=joinerRegistry?joinerRegistry.getJoinedCharacters(row):[],x=0;x<terminal.cols;x++){line.loadCell(x,this._workCell);var cell=this._workCell,isJoined=!1,lastCharX=x;if(0!==cell.getWidth()){if(0<joinedRanges.length&&x===joinedRanges[0][0]){isJoined=!0;var range=joinedRanges.shift();cell=new CharacterJoinerRegistry_1.JoinedCellData(this._workCell,line.translateToString(!0,range[0],range[1]),range[1]-range[0]),lastCharX=range[1]-1}!isJoined&&this._isOverlapping(cell)&&lastCharX<line.length-1&&line.getCodePoint(lastCharX+1)===Buffer_1.NULL_CELL_CODE&&(cell.content&=-12582913,cell.content|=2<<22),callback(cell,x,y),x=lastCharX}}},TextRenderLayer.prototype._drawBackground=function(terminal,firstRow,lastRow){var _this=this,ctx=this._ctx,cols=terminal.cols,startX=0,startY=0,prevFillStyle=null;ctx.save(),this._forEachCell(terminal,firstRow,lastRow,null,function(cell,x,y){var nextFillStyle=null;cell.isInverse()?nextFillStyle=cell.isFgDefault()?_this._colors.foreground.css:cell.isFgRGB()?"rgb("+BufferLine_1.AttributeData.toColorRGB(cell.getFgColor()).join(",")+")":_this._colors.ansi[cell.getFgColor()].css:cell.isBgRGB()?nextFillStyle="rgb("+BufferLine_1.AttributeData.toColorRGB(cell.getBgColor()).join(",")+")":cell.isBgPalette()&&(nextFillStyle=_this._colors.ansi[cell.getBgColor()].css),null===prevFillStyle&&(startX=x,startY=y),y!==startY?(ctx.fillStyle=prevFillStyle,_this.fillCells(startX,startY,cols-startX,1),startX=x,startY=y):prevFillStyle!==nextFillStyle&&(ctx.fillStyle=prevFillStyle,_this.fillCells(startX,startY,x-startX,1),startX=x,startY=y),prevFillStyle=nextFillStyle}),null!==prevFillStyle&&(ctx.fillStyle=prevFillStyle,this.fillCells(startX,startY,cols-startX,1)),ctx.restore()},TextRenderLayer.prototype._drawForeground=function(terminal,firstRow,lastRow){var _this=this;this._forEachCell(terminal,firstRow,lastRow,this._characterJoinerRegistry,function(cell,x,y){if(!cell.isInvisible()){if(cell.isUnderline()){if(_this._ctx.save(),cell.isInverse())cell.isBgDefault()?_this._ctx.fillStyle=_this._colors.background.css:cell.isBgRGB()?_this._ctx.fillStyle="rgb("+BufferLine_1.AttributeData.toColorRGB(cell.getBgColor()).join(",")+")":_this._ctx.fillStyle=_this._colors.ansi[cell.getBgColor()].css;else if(cell.isFgDefault())_this._ctx.fillStyle=_this._colors.foreground.css;else if(cell.isFgRGB())_this._ctx.fillStyle="rgb("+BufferLine_1.AttributeData.toColorRGB(cell.getFgColor()).join(",")+")";else{var fg=cell.getFgColor();terminal.options.drawBoldTextInBrightColors&&cell.isBold()&&fg<8&&(fg+=8),_this._ctx.fillStyle=_this._colors.ansi[fg].css}_this.fillBottomLineAtCells(x,y,cell.getWidth()),_this._ctx.restore()}_this.drawChars(terminal,cell,x,y)}})},TextRenderLayer.prototype.onGridChanged=function(terminal,firstRow,lastRow){0!==this._state.cache.length&&(this._charAtlas&&this._charAtlas.beginFrame(),this.clearCells(0,firstRow,terminal.cols,lastRow-firstRow+1),this._drawBackground(terminal,firstRow,lastRow),this._drawForeground(terminal,firstRow,lastRow))},TextRenderLayer.prototype.onOptionsChanged=function(terminal){this.setTransparency(terminal,terminal.options.allowTransparency)},TextRenderLayer.prototype._isOverlapping=function(cell){if(1!==cell.getWidth())return!1;if(cell.getCode()<256)return!1;var chars=cell.getChars();if(this._characterOverlapCache.hasOwnProperty(chars))return this._characterOverlapCache[chars];this._ctx.save(),this._ctx.font=this._characterFont;var overlaps=Math.floor(this._ctx.measureText(chars).width)>this._characterWidth;return this._ctx.restore(),this._characterOverlapCache[chars]=overlaps},TextRenderLayer}(BaseRenderLayer_1.BaseRenderLayer);exports.TextRenderLayer=TextRenderLayer},{"../Buffer":6,"../BufferLine":7,"./BaseRenderLayer":39,"./CharacterJoinerRegistry":40,"./GridCache":43}],48:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var BaseCharAtlas=function(){function BaseCharAtlas(){this._didWarmUp=!1}return BaseCharAtlas.prototype.dispose=function(){},BaseCharAtlas.prototype.warmUp=function(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)},BaseCharAtlas.prototype._doWarmUp=function(){},BaseCharAtlas.prototype.beginFrame=function(){},BaseCharAtlas}();exports.default=BaseCharAtlas},{}],49:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var CharAtlasUtils_1=require("./CharAtlasUtils"),DynamicCharAtlas_1=require("./DynamicCharAtlas"),NoneCharAtlas_1=require("./NoneCharAtlas"),StaticCharAtlas_1=require("./StaticCharAtlas"),charAtlasImplementations={none:NoneCharAtlas_1.default,static:StaticCharAtlas_1.default,dynamic:DynamicCharAtlas_1.default},charAtlasCache=[];exports.acquireCharAtlas=function(terminal,colors,scaledCharWidth,scaledCharHeight){for(var newConfig=CharAtlasUtils_1.generateConfig(scaledCharWidth,scaledCharHeight,terminal,colors),i=0;i<charAtlasCache.length;i++){var ownedByIndex=(entry=charAtlasCache[i]).ownedBy.indexOf(terminal);if(0<=ownedByIndex){if(CharAtlasUtils_1.configEquals(entry.config,newConfig))return entry.atlas;1===entry.ownedBy.length?(entry.atlas.dispose(),charAtlasCache.splice(i,1)):entry.ownedBy.splice(ownedByIndex,1);break}}for(i=0;i<charAtlasCache.length;i++){var entry=charAtlasCache[i];if(CharAtlasUtils_1.configEquals(entry.config,newConfig))return entry.ownedBy.push(terminal),entry.atlas}var newEntry={atlas:new charAtlasImplementations[terminal.options.experimentalCharAtlas](document,newConfig),config:newConfig,ownedBy:[terminal]};return charAtlasCache.push(newEntry),newEntry.atlas},exports.removeTerminalFromCache=function(terminal){for(var i=0;i<charAtlasCache.length;i++){var index=charAtlasCache[i].ownedBy.indexOf(terminal);if(-1!==index){1===charAtlasCache[i].ownedBy.length?(charAtlasCache[i].atlas.dispose(),charAtlasCache.splice(i,1)):charAtlasCache[i].ownedBy.splice(index,1);break}}}},{"./CharAtlasUtils":51,"./DynamicCharAtlas":52,"./NoneCharAtlas":54,"./StaticCharAtlas":55}],50:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Platform_1=require("../../common/Platform"),Types_1=require("./Types");function clearColor(imageData,color){for(var isEmpty=!0,r=color.rgba>>>24,g=color.rgba>>>16&255,b=color.rgba>>>8&255,offset=0;offset<imageData.data.length;offset+=4)imageData.data[offset]===r&&imageData.data[offset+1]===g&&imageData.data[offset+2]===b?imageData.data[offset+3]=0:isEmpty=!1;return isEmpty}function getFont(fontWeight,config){return fontWeight+" "+config.fontSize*config.devicePixelRatio+"px "+config.fontFamily}exports.generateStaticCharAtlasTexture=function(context,canvasFactory,config){var cellWidth=config.scaledCharWidth+Types_1.CHAR_ATLAS_CELL_SPACING,cellHeight=config.scaledCharHeight+Types_1.CHAR_ATLAS_CELL_SPACING,canvas=canvasFactory(255*cellWidth,34*cellHeight),ctx=canvas.getContext("2d",{alpha:config.allowTransparency});ctx.fillStyle=config.colors.background.css,ctx.fillRect(0,0,canvas.width,canvas.height),ctx.save(),ctx.fillStyle=config.colors.foreground.css,ctx.font=getFont(config.fontWeight,config),ctx.textBaseline="middle";for(var i=0;i<256;i++)ctx.save(),ctx.beginPath(),ctx.rect(i*cellWidth,0,cellWidth,cellHeight),ctx.clip(),ctx.fillText(String.fromCharCode(i),i*cellWidth,cellHeight/2),ctx.restore();for(ctx.save(),ctx.font=getFont(config.fontWeightBold,config),i=0;i<256;i++)ctx.save(),ctx.beginPath(),ctx.rect(i*cellWidth,cellHeight,cellWidth,cellHeight),ctx.clip(),ctx.fillText(String.fromCharCode(i),i*cellWidth,1.5*cellHeight),ctx.restore();ctx.restore(),ctx.font=getFont(config.fontWeight,config);for(var colorIndex=0;colorIndex<16;colorIndex++){var y=(colorIndex+2)*cellHeight;for(i=0;i<256;i++)ctx.save(),ctx.beginPath(),ctx.rect(i*cellWidth,y,cellWidth,cellHeight),ctx.clip(),ctx.fillStyle=config.colors.ansi[colorIndex].css,ctx.fillText(String.fromCharCode(i),i*cellWidth,y+cellHeight/2),ctx.restore()}for(ctx.font=getFont(config.fontWeightBold,config),colorIndex=0;colorIndex<16;colorIndex++)for(y=(colorIndex+2+16)*cellHeight,i=0;i<256;i++)ctx.save(),ctx.beginPath(),ctx.rect(i*cellWidth,y,cellWidth,cellHeight),ctx.clip(),ctx.fillStyle=config.colors.ansi[colorIndex].css,ctx.fillText(String.fromCharCode(i),i*cellWidth,y+cellHeight/2),ctx.restore();if(ctx.restore(),!("createImageBitmap"in context)||Platform_1.isFirefox||Platform_1.isSafari)return canvas;var charAtlasImageData=ctx.getImageData(0,0,canvas.width,canvas.height);return clearColor(charAtlasImageData,config.colors.background),context.createImageBitmap(charAtlasImageData)},exports.clearColor=clearColor},{"../../common/Platform":31,"./Types":56}],51:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Types_1=require("./Types");exports.generateConfig=function(scaledCharWidth,scaledCharHeight,terminal,colors){var clonedColors={foreground:colors.foreground,background:colors.background,cursor:null,cursorAccent:null,selection:null,ansi:colors.ansi.slice(0,16)};return{type:terminal.options.experimentalCharAtlas,devicePixelRatio:window.devicePixelRatio,scaledCharWidth:scaledCharWidth,scaledCharHeight:scaledCharHeight,fontFamily:terminal.options.fontFamily,fontSize:terminal.options.fontSize,fontWeight:terminal.options.fontWeight,fontWeightBold:terminal.options.fontWeightBold,allowTransparency:terminal.options.allowTransparency,colors:clonedColors}},exports.configEquals=function(a,b){for(var i=0;i<a.colors.ansi.length;i++)if(a.colors.ansi[i].rgba!==b.colors.ansi[i].rgba)return!1;return a.type===b.type&&a.devicePixelRatio===b.devicePixelRatio&&a.fontFamily===b.fontFamily&&a.fontSize===b.fontSize&&a.fontWeight===b.fontWeight&&a.fontWeightBold===b.fontWeightBold&&a.allowTransparency===b.allowTransparency&&a.scaledCharWidth===b.scaledCharWidth&&a.scaledCharHeight===b.scaledCharHeight&&a.colors.foreground===b.colors.foreground&&a.colors.background===b.colors.background},exports.is256Color=function(colorCode){return colorCode<Types_1.DEFAULT_COLOR}},{"./Types":56}],52:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Types_1=require("./Types"),BaseCharAtlas_1=require("./BaseCharAtlas"),ColorManager_1=require("../ColorManager"),CharAtlasGenerator_1=require("./CharAtlasGenerator"),LRUMap_1=require("./LRUMap"),Platform_1=require("../../common/Platform"),TRANSPARENT_COLOR={css:"rgba(0, 0, 0, 0)",rgba:0};function getGlyphCacheKey(glyph){return glyph.code<<21|glyph.bg<<12|glyph.fg<<3|(glyph.bold?0:4)+(glyph.dim?0:2)+(glyph.italic?0:1)}exports.getGlyphCacheKey=getGlyphCacheKey;var DynamicCharAtlas=function(_super){function DynamicCharAtlas(document,_config){var _this=_super.call(this)||this;_this._config=_config,_this._drawToCacheCount=0,_this._glyphsWaitingOnBitmap=[],_this._bitmapCommitTimeout=null,_this._bitmap=null,_this._cacheCanvas=document.createElement("canvas"),_this._cacheCanvas.width=1024,_this._cacheCanvas.height=1024,_this._cacheCtx=_this._cacheCanvas.getContext("2d",{alpha:!0});var tmpCanvas=document.createElement("canvas");tmpCanvas.width=_this._config.scaledCharWidth,tmpCanvas.height=_this._config.scaledCharHeight,_this._tmpCtx=tmpCanvas.getContext("2d",{alpha:_this._config.allowTransparency}),_this._width=Math.floor(1024/_this._config.scaledCharWidth),_this._height=Math.floor(1024/_this._config.scaledCharHeight);var capacity=_this._width*_this._height;return _this._cacheMap=new LRUMap_1.default(capacity),_this._cacheMap.prealloc(capacity),_this}return __extends(DynamicCharAtlas,_super),DynamicCharAtlas.prototype.dispose=function(){null!==this._bitmapCommitTimeout&&(window.clearTimeout(this._bitmapCommitTimeout),this._bitmapCommitTimeout=null)},DynamicCharAtlas.prototype.beginFrame=function(){this._drawToCacheCount=0},DynamicCharAtlas.prototype.draw=function(ctx,glyph,x,y){if(32===glyph.code)return!0;if(!this._canCache(glyph))return!1;var glyphKey=getGlyphCacheKey(glyph),cacheValue=this._cacheMap.get(glyphKey);if(null!=cacheValue)return this._drawFromCache(ctx,cacheValue,x,y),!0;if(this._drawToCacheCount<100){var index=void 0;index=this._cacheMap.size<this._cacheMap.capacity?this._cacheMap.size:this._cacheMap.peek().index;var cacheValue_1=this._drawToCache(glyph,index);return this._cacheMap.set(glyphKey,cacheValue_1),this._drawFromCache(ctx,cacheValue_1,x,y),!0}return!1},DynamicCharAtlas.prototype._canCache=function(glyph){return glyph.code<256},DynamicCharAtlas.prototype._toCoordinateX=function(index){return index%this._width*this._config.scaledCharWidth},DynamicCharAtlas.prototype._toCoordinateY=function(index){return Math.floor(index/this._width)*this._config.scaledCharHeight},DynamicCharAtlas.prototype._drawFromCache=function(ctx,cacheValue,x,y){if(!cacheValue.isEmpty){var cacheX=this._toCoordinateX(cacheValue.index),cacheY=this._toCoordinateY(cacheValue.index);ctx.drawImage(cacheValue.inBitmap?this._bitmap:this._cacheCanvas,cacheX,cacheY,this._config.scaledCharWidth,this._config.scaledCharHeight,x,y,this._config.scaledCharWidth,this._config.scaledCharHeight)}},DynamicCharAtlas.prototype._getColorFromAnsiIndex=function(idx){return idx<this._config.colors.ansi.length?this._config.colors.ansi[idx]:ColorManager_1.DEFAULT_ANSI_COLORS[idx]},DynamicCharAtlas.prototype._getBackgroundColor=function(glyph){return this._config.allowTransparency?TRANSPARENT_COLOR:glyph.bg===Types_1.INVERTED_DEFAULT_COLOR?this._config.colors.foreground:glyph.bg<256?this._getColorFromAnsiIndex(glyph.bg):this._config.colors.background},DynamicCharAtlas.prototype._getForegroundColor=function(glyph){return glyph.fg===Types_1.INVERTED_DEFAULT_COLOR?this._config.colors.background:glyph.fg<256?this._getColorFromAnsiIndex(glyph.fg):this._config.colors.foreground},DynamicCharAtlas.prototype._drawToCache=function(glyph,index){this._drawToCacheCount++,this._tmpCtx.save();var backgroundColor=this._getBackgroundColor(glyph);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=backgroundColor.css,this._tmpCtx.fillRect(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight),this._tmpCtx.globalCompositeOperation="source-over";var fontWeight=glyph.bold?this._config.fontWeightBold:this._config.fontWeight,fontStyle=glyph.italic?"italic":"";this._tmpCtx.font=fontStyle+" "+fontWeight+" "+this._config.fontSize*this._config.devicePixelRatio+"px "+this._config.fontFamily,this._tmpCtx.textBaseline="middle",this._tmpCtx.fillStyle=this._getForegroundColor(glyph).css,glyph.dim&&(this._tmpCtx.globalAlpha=Types_1.DIM_OPACITY),this._tmpCtx.fillText(glyph.chars,0,this._config.scaledCharHeight/2),this._tmpCtx.restore();var imageData=this._tmpCtx.getImageData(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight),isEmpty=!1;this._config.allowTransparency||(isEmpty=CharAtlasGenerator_1.clearColor(imageData,backgroundColor));var x=this._toCoordinateX(index),y=this._toCoordinateY(index);this._cacheCtx.putImageData(imageData,x,y);var cacheValue={index:index,isEmpty:isEmpty,inBitmap:!1};return this._addGlyphToBitmap(cacheValue),cacheValue},DynamicCharAtlas.prototype._addGlyphToBitmap=function(cacheValue){var _this=this;"createImageBitmap"in window&&!Platform_1.isFirefox&&!Platform_1.isSafari&&(this._glyphsWaitingOnBitmap.push(cacheValue),null===this._bitmapCommitTimeout&&(this._bitmapCommitTimeout=window.setTimeout(function(){return _this._generateBitmap()},100)))},DynamicCharAtlas.prototype._generateBitmap=function(){var _this=this,glyphsMovingToBitmap=this._glyphsWaitingOnBitmap;this._glyphsWaitingOnBitmap=[],window.createImageBitmap(this._cacheCanvas).then(function(bitmap){_this._bitmap=bitmap;for(var i=0;i<glyphsMovingToBitmap.length;i++){glyphsMovingToBitmap[i].inBitmap=!0}}),this._bitmapCommitTimeout=null},DynamicCharAtlas}(BaseCharAtlas_1.default);exports.default=DynamicCharAtlas},{"../../common/Platform":31,"../ColorManager":41,"./BaseCharAtlas":48,"./CharAtlasGenerator":50,"./LRUMap":53,"./Types":56}],53:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var LRUMap=function(){function LRUMap(capacity){this.capacity=capacity,this._map={},this._head=null,this._tail=null,this._nodePool=[],this.size=0}return LRUMap.prototype._unlinkNode=function(node){var prev=node.prev,next=node.next;node===this._head&&(this._head=next),node===this._tail&&(this._tail=prev),null!==prev&&(prev.next=next),null!==next&&(next.prev=prev)},LRUMap.prototype._appendNode=function(node){var tail=this._tail;null!==tail&&(tail.next=node),node.prev=tail,node.next=null,this._tail=node,null===this._head&&(this._head=node)},LRUMap.prototype.prealloc=function(count){for(var nodePool=this._nodePool,i=0;i<count;i++)nodePool.push({prev:null,next:null,key:null,value:null})},LRUMap.prototype.get=function(key){var node=this._map[key];return void 0!==node?(this._unlinkNode(node),this._appendNode(node),node.value):null},LRUMap.prototype.peekValue=function(key){var node=this._map[key];return void 0!==node?node.value:null},LRUMap.prototype.peek=function(){var head=this._head;return null===head?null:head.value},LRUMap.prototype.set=function(key,value){var node=this._map[key];if(void 0!==node)node=this._map[key],this._unlinkNode(node),node.value=value;else if(this.size>=this.capacity)node=this._head,this._unlinkNode(node),delete this._map[node.key],node.key=key,node.value=value,this._map[key]=node;else{var nodePool=this._nodePool;0<nodePool.length?((node=nodePool.pop()).key=key,node.value=value):node={prev:null,next:null,key:key,value:value},this._map[key]=node,this.size++}this._appendNode(node)},LRUMap}();exports.default=LRUMap},{}],54:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var NoneCharAtlas=function(_super){function NoneCharAtlas(document,config){return _super.call(this)||this}return __extends(NoneCharAtlas,_super),NoneCharAtlas.prototype.draw=function(ctx,glyph,x,y){return!1},NoneCharAtlas}(require("./BaseCharAtlas").default);exports.default=NoneCharAtlas},{"./BaseCharAtlas":48}],55:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var Types_1=require("./Types"),CharAtlasGenerator_1=require("./CharAtlasGenerator"),BaseCharAtlas_1=require("./BaseCharAtlas"),CharAtlasUtils_1=require("./CharAtlasUtils"),StaticCharAtlas=function(_super){function StaticCharAtlas(_document,_config){var _this=_super.call(this)||this;return _this._document=_document,_this._config=_config,_this._canvasFactory=function(width,height){var canvas=_this._document.createElement("canvas");return canvas.width=width,canvas.height=height,canvas},_this}return __extends(StaticCharAtlas,_super),StaticCharAtlas.prototype._doWarmUp=function(){var _this=this,result=CharAtlasGenerator_1.generateStaticCharAtlasTexture(window,this._canvasFactory,this._config);result instanceof HTMLCanvasElement?this._texture=result:result.then(function(texture){_this._texture=texture})},StaticCharAtlas.prototype._isCached=function(glyph,colorIndex){var isAscii=glyph.code<256,isBasicColor=glyph.fg<16,isDefaultColor=glyph.fg===Types_1.DEFAULT_COLOR,isDefaultBackground=glyph.bg===Types_1.DEFAULT_COLOR;return isAscii&&(isBasicColor||isDefaultColor)&&isDefaultBackground&&!glyph.italic},StaticCharAtlas.prototype.draw=function(ctx,glyph,x,y){if(null===this._texture||void 0===this._texture)return!1;var colorIndex=0;if(CharAtlasUtils_1.is256Color(glyph.fg)?colorIndex=2+glyph.fg+(glyph.bold?16:0):glyph.fg===Types_1.DEFAULT_COLOR&&glyph.bold&&(colorIndex=1),!this._isCached(glyph,colorIndex))return!1;ctx.save();var charAtlasCellWidth=this._config.scaledCharWidth+Types_1.CHAR_ATLAS_CELL_SPACING,charAtlasCellHeight=this._config.scaledCharHeight+Types_1.CHAR_ATLAS_CELL_SPACING;return glyph.dim&&(ctx.globalAlpha=Types_1.DIM_OPACITY),ctx.drawImage(this._texture,glyph.code*charAtlasCellWidth,colorIndex*charAtlasCellHeight,charAtlasCellWidth,this._config.scaledCharHeight,x,y,charAtlasCellWidth,this._config.scaledCharHeight),ctx.restore(),!0},StaticCharAtlas}(BaseCharAtlas_1.default);exports.default=StaticCharAtlas},{"./BaseCharAtlas":48,"./CharAtlasGenerator":50,"./CharAtlasUtils":51,"./Types":56}],56:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DEFAULT_COLOR=256,exports.INVERTED_DEFAULT_COLOR=257,exports.DIM_OPACITY=.5,exports.CHAR_ATLAS_CELL_SPACING=1},{}],57:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var ColorManager_1=require("../ColorManager"),RenderDebouncer_1=require("../../ui/RenderDebouncer"),DomRendererRowFactory_1=require("./DomRendererRowFactory"),Types_1=require("../atlas/Types"),EventEmitter2_1=require("../../common/EventEmitter2"),Lifecycle_1=require("../../common/Lifecycle"),nextTerminalId=1,DomRenderer=function(_super){function DomRenderer(_terminal,theme){var _this=_super.call(this)||this;_this._terminal=_terminal,_this._terminalClass=nextTerminalId++,_this._rowElements=[],_this._onCanvasResize=new EventEmitter2_1.EventEmitter2,_this._onRender=new EventEmitter2_1.EventEmitter2;var allowTransparency=_this._terminal.options.allowTransparency;return _this.colorManager=new ColorManager_1.ColorManager(document,allowTransparency),_this.setTheme(theme),_this._rowContainer=document.createElement("div"),_this._rowContainer.classList.add("xterm-rows"),_this._rowContainer.style.lineHeight="normal",_this._rowContainer.setAttribute("aria-hidden","true"),_this._refreshRowElements(_this._terminal.cols,_this._terminal.rows),_this._selectionContainer=document.createElement("div"),_this._selectionContainer.classList.add("xterm-selection"),_this._selectionContainer.setAttribute("aria-hidden","true"),_this.dimensions={scaledCharWidth:null,scaledCharHeight:null,scaledCellWidth:null,scaledCellHeight:null,scaledCharLeft:null,scaledCharTop:null,scaledCanvasWidth:null,scaledCanvasHeight:null,canvasWidth:null,canvasHeight:null,actualCellWidth:null,actualCellHeight:null},_this._updateDimensions(),_this._renderDebouncer=new RenderDebouncer_1.RenderDebouncer(_this._renderRows.bind(_this)),_this._rowFactory=new DomRendererRowFactory_1.DomRendererRowFactory(_terminal.options,document),_this._terminal.element.classList.add("xterm-dom-renderer-owner-"+_this._terminalClass),_this._terminal.screenElement.appendChild(_this._rowContainer),_this._terminal.screenElement.appendChild(_this._selectionContainer),_this._terminal.linkifier.onLinkHover(function(e){return _this._onLinkHover(e)}),_this._terminal.linkifier.onLinkLeave(function(e){return _this._onLinkLeave(e)}),_this}return __extends(DomRenderer,_super),Object.defineProperty(DomRenderer.prototype,"onCanvasResize",{get:function(){return this._onCanvasResize.event},enumerable:!0,configurable:!0}),Object.defineProperty(DomRenderer.prototype,"onRender",{get:function(){return this._onRender.event},enumerable:!0,configurable:!0}),DomRenderer.prototype.dispose=function(){this._terminal.element.classList.remove("xterm-dom-renderer-owner-"+this._terminalClass),this._terminal.screenElement.removeChild(this._rowContainer),this._terminal.screenElement.removeChild(this._selectionContainer),this._terminal.screenElement.removeChild(this._themeStyleElement),this._terminal.screenElement.removeChild(this._dimensionsStyleElement),_super.prototype.dispose.call(this)},DomRenderer.prototype._updateDimensions=function(){var _this=this;this.dimensions.scaledCharWidth=Math.floor(this._terminal.charMeasure.width*window.devicePixelRatio),this.dimensions.scaledCharHeight=Math.ceil(this._terminal.charMeasure.height*window.devicePixelRatio),this.dimensions.scaledCellWidth=this.dimensions.scaledCharWidth+Math.round(this._terminal.options.letterSpacing),this.dimensions.scaledCellHeight=Math.floor(this.dimensions.scaledCharHeight*this._terminal.options.lineHeight),this.dimensions.scaledCharLeft=0,this.dimensions.scaledCharTop=0,this.dimensions.scaledCanvasWidth=this.dimensions.scaledCellWidth*this._terminal.cols,this.dimensions.scaledCanvasHeight=this.dimensions.scaledCellHeight*this._terminal.rows,this.dimensions.canvasWidth=Math.round(this.dimensions.scaledCanvasWidth/window.devicePixelRatio),this.dimensions.canvasHeight=Math.round(this.dimensions.scaledCanvasHeight/window.devicePixelRatio),this.dimensions.actualCellWidth=this.dimensions.canvasWidth/this._terminal.cols,this.dimensions.actualCellHeight=this.dimensions.canvasHeight/this._terminal.rows,this._rowElements.forEach(function(element){element.style.width=_this.dimensions.canvasWidth+"px",element.style.height=_this.dimensions.actualCellHeight+"px",element.style.lineHeight=_this.dimensions.actualCellHeight+"px",element.style.overflow="hidden"}),this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._terminal.screenElement.appendChild(this._dimensionsStyleElement));var styles=this._terminalSelector+" .xterm-rows span { display: inline-block; height: 100%; vertical-align: top; width: "+this.dimensions.actualCellWidth+"px}";this._dimensionsStyleElement.innerHTML=styles,this._selectionContainer.style.height=this._terminal._viewportElement.style.height,this._terminal.screenElement.style.width=this.dimensions.canvasWidth+"px",this._terminal.screenElement.style.height=this.dimensions.canvasHeight+"px"},DomRenderer.prototype.setTheme=function(theme){var _this=this;theme&&this.colorManager.setTheme(theme),this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._terminal.screenElement.appendChild(this._themeStyleElement));var styles=this._terminalSelector+" .xterm-rows { color: "+this.colorManager.colors.foreground.css+"; background-color: "+this.colorManager.colors.background.css+"; font-family: "+this._terminal.getOption("fontFamily")+"; font-size: "+this._terminal.getOption("fontSize")+"px;}";return styles+=this._terminalSelector+" span:not(."+DomRendererRowFactory_1.BOLD_CLASS+") { font-weight: "+this._terminal.options.fontWeight+";}"+this._terminalSelector+" span."+DomRendererRowFactory_1.BOLD_CLASS+" { font-weight: "+this._terminal.options.fontWeightBold+";}"+this._terminalSelector+" span."+DomRendererRowFactory_1.ITALIC_CLASS+" { font-style: italic;}",styles+="@keyframes blink { 0% { opacity: 1.0; } 50% { opacity: 0.0; } 100% { opacity: 1.0; }}",styles+=this._terminalSelector+" .xterm-rows:not(.xterm-focus) ."+DomRendererRowFactory_1.CURSOR_CLASS+" { outline: 1px solid "+this.colorManager.colors.cursor.css+"; outline-offset: -1px;}"+this._terminalSelector+" .xterm-rows.xterm-focus ."+DomRendererRowFactory_1.CURSOR_CLASS+"."+DomRendererRowFactory_1.CURSOR_BLINK_CLASS+" { animation: blink 1s step-end infinite;}"+this._terminalSelector+" .xterm-rows.xterm-focus ."+DomRendererRowFactory_1.CURSOR_CLASS+"."+DomRendererRowFactory_1.CURSOR_STYLE_BLOCK_CLASS+" { background-color: "+this.colorManager.colors.cursor.css+"; color: "+this.colorManager.colors.cursorAccent.css+";}"+this._terminalSelector+" .xterm-rows.xterm-focus ."+DomRendererRowFactory_1.CURSOR_CLASS+"."+DomRendererRowFactory_1.CURSOR_STYLE_BAR_CLASS+" { box-shadow: 1px 0 0 "+this.colorManager.colors.cursor.css+" inset;}"+this._terminalSelector+" .xterm-rows.xterm-focus ."+DomRendererRowFactory_1.CURSOR_CLASS+"."+DomRendererRowFactory_1.CURSOR_STYLE_UNDERLINE_CLASS+" { box-shadow: 0 -1px 0 "+this.colorManager.colors.cursor.css+" inset;}",styles+=this._terminalSelector+" .xterm-selection { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}"+this._terminalSelector+" .xterm-selection div { position: absolute; background-color: "+this.colorManager.colors.selection.css+";}",this.colorManager.colors.ansi.forEach(function(c,i){styles+=_this._terminalSelector+" .xterm-fg-"+i+" { color: "+c.css+"; }"+_this._terminalSelector+" .xterm-bg-"+i+" { background-color: "+c.css+"; }"}),styles+=this._terminalSelector+" .xterm-fg-"+Types_1.INVERTED_DEFAULT_COLOR+" { color: "+this.colorManager.colors.background.css+"; }"+this._terminalSelector+" .xterm-bg-"+Types_1.INVERTED_DEFAULT_COLOR+" { background-color: "+this.colorManager.colors.foreground.css+"; }",this._themeStyleElement.innerHTML=styles,this.colorManager.colors},DomRenderer.prototype.onWindowResize=function(devicePixelRatio){this._updateDimensions()},DomRenderer.prototype._refreshRowElements=function(cols,rows){for(var i=this._rowElements.length;i<=rows;i++){var row=document.createElement("div");this._rowContainer.appendChild(row),this._rowElements.push(row)}for(;this._rowElements.length>rows;)this._rowContainer.removeChild(this._rowElements.pop())},DomRenderer.prototype.onResize=function(cols,rows){this._refreshRowElements(cols,rows),this._updateDimensions(),this._onCanvasResize.fire({width:this.dimensions.canvasWidth,height:this.dimensions.canvasHeight})},DomRenderer.prototype.onCharSizeChanged=function(){this._updateDimensions()},DomRenderer.prototype.onBlur=function(){this._rowContainer.classList.remove("xterm-focus")},DomRenderer.prototype.onFocus=function(){this._rowContainer.classList.add("xterm-focus")},DomRenderer.prototype.onSelectionChanged=function(start,end,columnSelectMode){for(;this._selectionContainer.children.length;)this._selectionContainer.removeChild(this._selectionContainer.children[0]);if(start&&end){var viewportStartRow=start[1]-this._terminal.buffer.ydisp,viewportEndRow=end[1]-this._terminal.buffer.ydisp,viewportCappedStartRow=Math.max(viewportStartRow,0),viewportCappedEndRow=Math.min(viewportEndRow,this._terminal.rows-1);if(!(viewportCappedStartRow>=this._terminal.rows||viewportCappedEndRow<0)){var documentFragment=document.createDocumentFragment();if(columnSelectMode)documentFragment.appendChild(this._createSelectionElement(viewportCappedStartRow,start[0],end[0],viewportCappedEndRow-viewportCappedStartRow+1));else{var startCol=viewportStartRow===viewportCappedStartRow?start[0]:0,endCol=viewportCappedStartRow===viewportCappedEndRow?end[0]:this._terminal.cols;documentFragment.appendChild(this._createSelectionElement(viewportCappedStartRow,startCol,endCol));var middleRowsCount=viewportCappedEndRow-viewportCappedStartRow-1;if(documentFragment.appendChild(this._createSelectionElement(viewportCappedStartRow+1,0,this._terminal.cols,middleRowsCount)),viewportCappedStartRow!==viewportCappedEndRow){var endCol_1=viewportEndRow===viewportCappedEndRow?end[0]:this._terminal.cols;documentFragment.appendChild(this._createSelectionElement(viewportCappedEndRow,0,endCol_1))}}this._selectionContainer.appendChild(documentFragment)}}},DomRenderer.prototype._createSelectionElement=function(row,colStart,colEnd,rowCount){void 0===rowCount&&(rowCount=1);var element=document.createElement("div");return element.style.height=rowCount*this.dimensions.actualCellHeight+"px",element.style.top=row*this.dimensions.actualCellHeight+"px",element.style.left=colStart*this.dimensions.actualCellWidth+"px",element.style.width=this.dimensions.actualCellWidth*(colEnd-colStart)+"px",element},DomRenderer.prototype.onCursorMove=function(){},DomRenderer.prototype.onOptionsChanged=function(){this._updateDimensions(),this.setTheme(void 0),this._terminal.refresh(0,this._terminal.rows-1)},DomRenderer.prototype.clear=function(){this._rowElements.forEach(function(e){return e.innerHTML=""})},DomRenderer.prototype.refreshRows=function(start,end){this._renderDebouncer.refresh(start,end,this._terminal.rows)},DomRenderer.prototype._renderRows=function(start,end){for(var terminal=this._terminal,cursorAbsoluteY=terminal.buffer.ybase+terminal.buffer.y,cursorX=this._terminal.buffer.x,cursorBlink=this._terminal.options.cursorBlink,y=start;y<=end;y++){var rowElement=this._rowElements[y];rowElement.innerHTML="";var row=y+terminal.buffer.ydisp,lineData=terminal.buffer.lines.get(row),cursorStyle=terminal.options.cursorStyle;rowElement.appendChild(this._rowFactory.createRow(lineData,row===cursorAbsoluteY,cursorStyle,cursorX,cursorBlink,this.dimensions.actualCellWidth,terminal.cols))}this._onRender.fire({start:start,end:end})},Object.defineProperty(DomRenderer.prototype,"_terminalSelector",{get:function(){return".xterm-dom-renderer-owner-"+this._terminalClass},enumerable:!0,configurable:!0}),DomRenderer.prototype.registerCharacterJoiner=function(handler){return-1},DomRenderer.prototype.deregisterCharacterJoiner=function(joinerId){return!1},DomRenderer.prototype._onLinkHover=function(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)},DomRenderer.prototype._onLinkLeave=function(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)},DomRenderer.prototype._setCellUnderline=function(x,x2,y,y2,cols,enabled){for(;x!==x2||y!==y2;){var row=this._rowElements[y];if(!row)return;var span=row.children[x];span&&(span.style.textDecoration=enabled?"underline":"none"),++x>=cols&&(x=0,y++)}},DomRenderer}(Lifecycle_1.Disposable);exports.DomRenderer=DomRenderer},{"../../common/EventEmitter2":29,"../../common/Lifecycle":30,"../../ui/RenderDebouncer":60,"../ColorManager":41,"../atlas/Types":56,"./DomRendererRowFactory":58}],58:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Buffer_1=require("../../Buffer"),Types_1=require("../atlas/Types"),BufferLine_1=require("../../BufferLine");exports.BOLD_CLASS="xterm-bold",exports.DIM_CLASS="xterm-dim",exports.ITALIC_CLASS="xterm-italic",exports.UNDERLINE_CLASS="xterm-underline",exports.CURSOR_CLASS="xterm-cursor",exports.CURSOR_BLINK_CLASS="xterm-cursor-blink",exports.CURSOR_STYLE_BLOCK_CLASS="xterm-cursor-block",exports.CURSOR_STYLE_BAR_CLASS="xterm-cursor-bar",exports.CURSOR_STYLE_UNDERLINE_CLASS="xterm-cursor-underline";var DomRendererRowFactory=function(){function DomRendererRowFactory(_terminalOptions,_document){this._terminalOptions=_terminalOptions,this._document=_document,this._workCell=new BufferLine_1.CellData}return DomRendererRowFactory.prototype.createRow=function(lineData,isCursorRow,cursorStyle,cursorX,cursorBlink,cellWidth,cols){for(var fragment=this._document.createDocumentFragment(),lineLength=0,x=Math.min(lineData.length,cols)-1;0<=x;x--)if(lineData.loadCell(x,this._workCell).getCode()!==Buffer_1.NULL_CELL_CODE||isCursorRow&&x===cursorX){lineLength=x+1;break}for(x=0;x<lineLength;x++){lineData.loadCell(x,this._workCell);var width=this._workCell.getWidth();if(0!==width){var charElement=this._document.createElement("span");if(1<width&&(charElement.style.width=cellWidth*width+"px"),isCursorRow&&x===cursorX)switch(charElement.classList.add(exports.CURSOR_CLASS),cursorBlink&&charElement.classList.add(exports.CURSOR_BLINK_CLASS),cursorStyle){case"bar":charElement.classList.add(exports.CURSOR_STYLE_BAR_CLASS);break;case"underline":charElement.classList.add(exports.CURSOR_STYLE_UNDERLINE_CLASS);break;default:charElement.classList.add(exports.CURSOR_STYLE_BLOCK_CLASS)}this._workCell.isBold()&&this._terminalOptions.enableBold&&charElement.classList.add(exports.BOLD_CLASS),this._workCell.isItalic()&&charElement.classList.add(exports.ITALIC_CLASS),this._workCell.isDim()&&charElement.classList.add(exports.DIM_CLASS),this._workCell.isUnderline()&&charElement.classList.add(exports.UNDERLINE_CLASS),charElement.textContent=this._workCell.getChars()||Buffer_1.WHITESPACE_CELL_CHAR;var swapColor=this._workCell.isInverse();if(this._workCell.isFgRGB()){var style=charElement.getAttribute("style")||"";style+=(swapColor?"background-":"")+"color:rgb("+BufferLine_1.AttributeData.toColorRGB(this._workCell.getFgColor()).join(",")+");",charElement.setAttribute("style",style)}else if(this._workCell.isFgPalette()){var fg=this._workCell.getFgColor();this._workCell.isBold()&&fg<8&&!swapColor&&this._terminalOptions.enableBold&&this._terminalOptions.drawBoldTextInBrightColors&&(fg+=8),charElement.classList.add("xterm-"+(swapColor?"b":"f")+"g-"+fg)}else swapColor&&charElement.classList.add("xterm-bg-"+Types_1.INVERTED_DEFAULT_COLOR);if(this._workCell.isBgRGB()){style=charElement.getAttribute("style")||"";style+=(swapColor?"":"background-")+"color:rgb("+BufferLine_1.AttributeData.toColorRGB(this._workCell.getBgColor()).join(",")+");",charElement.setAttribute("style",style)}else this._workCell.isBgPalette()?charElement.classList.add("xterm-"+(swapColor?"f":"b")+"g-"+this._workCell.getBgColor()):swapColor&&charElement.classList.add("xterm-fg-"+Types_1.INVERTED_DEFAULT_COLOR);fragment.appendChild(charElement)}}return fragment},DomRendererRowFactory}();exports.DomRendererRowFactory=DomRendererRowFactory},{"../../Buffer":6,"../../BufferLine":7,"../atlas/Types":56}],59:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.addDisposableDomListener=function(node,type,handler,useCapture){return node.addEventListener(type,handler,useCapture),{dispose:function(){handler&&node.removeEventListener(type,handler,useCapture)}}}},{}],60:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var RenderDebouncer=function(){function RenderDebouncer(_renderCallback){this._renderCallback=_renderCallback}return RenderDebouncer.prototype.dispose=function(){this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)},RenderDebouncer.prototype.refresh=function(rowStart,rowEnd,rowCount){var _this=this;this._rowCount=rowCount,rowStart=void 0!==rowStart?rowStart:0,rowEnd=void 0!==rowEnd?rowEnd:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,rowStart):rowStart,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,rowEnd):rowEnd,this._animationFrame||(this._animationFrame=window.requestAnimationFrame(function(){return _this._innerRefresh()}))},RenderDebouncer.prototype._innerRefresh=function(){void 0!==this._rowStart&&void 0!==this._rowEnd&&void 0!==this._rowCount&&(this._rowStart=Math.max(this._rowStart,0),this._rowEnd=Math.min(this._rowEnd,this._rowCount-1),this._renderCallback(this._rowStart,this._rowEnd),this._rowStart=void 0,this._rowEnd=void 0,this._animationFrame=void 0)},RenderDebouncer}();exports.RenderDebouncer=RenderDebouncer},{}],61:[function(require,module,exports){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var ScreenDprMonitor=function(_super){function ScreenDprMonitor(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this._currentDevicePixelRatio=window.devicePixelRatio,_this}return __extends(ScreenDprMonitor,_super),ScreenDprMonitor.prototype.setListener=function(listener){var _this=this;this._listener&&this.clearListener(),this._listener=listener,this._outerListener=function(){_this._listener&&(_this._listener(window.devicePixelRatio,_this._currentDevicePixelRatio),_this._updateDpr())},this._updateDpr()},ScreenDprMonitor.prototype.dispose=function(){_super.prototype.dispose.call(this),this.clearListener()},ScreenDprMonitor.prototype._updateDpr=function(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._currentDevicePixelRatio=window.devicePixelRatio,this._resolutionMediaMatchList=window.matchMedia("screen and (resolution: "+window.devicePixelRatio+"dppx)"),this._resolutionMediaMatchList.addListener(this._outerListener))},ScreenDprMonitor.prototype.clearListener=function(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)},ScreenDprMonitor}(require("../common/Lifecycle").Disposable);exports.ScreenDprMonitor=ScreenDprMonitor},{"../common/Lifecycle":30}],62:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TERMINAL_OPTIONS={cols:80,rows:24,allowTransparency:!0,cursorBlink:!0,theme:{background:"transparent"},scrollback:0}},{}],63:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MAX=300,exports.MAX_PER_QUARTER=exports.MAX/4,exports.RADIUS=100,exports.CIRCUNFERENCE=2*Math.PI*exports.RADIUS,exports.MAXIMUM_DISTANCE_IN_QUARTER=exports.CIRCUNFERENCE/2,exports.HEIGHT_MAP=[{i:0,z:0},{i:1*exports.MAX/8,z:-25},{i:2*exports.MAX/8,z:0},{i:3*exports.MAX/8,z:0},{i:4*exports.MAX/8,z:0},{i:5*exports.MAX/8,z:25},{i:6*exports.MAX/8,z:0},{i:7*exports.MAX/8,z:0}]},{}],64:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var constants_1=require("./constants");function easeInOutQuad(t){return t<.5?2*t*t:(4-2*t)*t-1}function getHeight(i){var smallest,biggest;if(constants_1.HEIGHT_MAP.forEach(function(h){h.i<=i&&(smallest=h)}),constants_1.HEIGHT_MAP.forEach(function(h){h.i>i&&!biggest&&(biggest=h)}),biggest||(biggest=constants_1.HEIGHT_MAP[0]),null==smallest)throw Error("Smallest from this position not found");if(smallest.i==i)return smallest.z;if(biggest.i==i)return biggest.z;var beg=smallest.i,dif=(0==biggest.i?constants_1.MAX-1:biggest.i)-beg,height_dif=biggest.z-smallest.z,z=height_dif/dif*(i-smallest.i);return smallest.z+(0==height_dif?0:easeInOutQuad(Math.abs(z/height_dif)))*height_dif}exports.easeInOutQuad=easeInOutQuad,exports.toMeshPos=function(i){return i<constants_1.MAX/4?i:i<2*constants_1.MAX/4?4*constants_1.MAX/4-i%constants_1.MAX_PER_QUARTER-1:i<3*constants_1.MAX/4?i:2*constants_1.MAX/4-i%constants_1.MAX_PER_QUARTER-1},exports.getHeight=getHeight,exports.getPosition=function(i){return i>=3*constants_1.MAX/4?{x:constants_1.MAXIMUM_DISTANCE_IN_QUARTER/2+constants_1.RADIUS*Math.sin(i%constants_1.MAX_PER_QUARTER*(180/constants_1.MAX_PER_QUARTER)*Math.PI/180),y:getHeight(i),z:constants_1.RADIUS*Math.cos(i%constants_1.MAX_PER_QUARTER*(180/constants_1.MAX_PER_QUARTER)*Math.PI/180)}:i>=2*constants_1.MAX/4?{x:-constants_1.MAXIMUM_DISTANCE_IN_QUARTER/constants_1.MAX_PER_QUARTER+constants_1.MAXIMUM_DISTANCE_IN_QUARTER/2-i%constants_1.MAX_PER_QUARTER*constants_1.MAXIMUM_DISTANCE_IN_QUARTER/constants_1.MAX_PER_QUARTER,y:getHeight(i),z:constants_1.RADIUS}:i>=constants_1.MAX/4?{x:-constants_1.MAXIMUM_DISTANCE_IN_QUARTER/2+constants_1.RADIUS*Math.sin(i%constants_1.MAX_PER_QUARTER*(180/constants_1.MAX_PER_QUARTER)*Math.PI/180+Math.PI),y:getHeight(i),z:constants_1.RADIUS*Math.cos(i%constants_1.MAX_PER_QUARTER*(180/constants_1.MAX_PER_QUARTER)*Math.PI/180+Math.PI)}:{x:constants_1.MAXIMUM_DISTANCE_IN_QUARTER/constants_1.MAX_PER_QUARTER+-constants_1.MAXIMUM_DISTANCE_IN_QUARTER/2+i*constants_1.MAXIMUM_DISTANCE_IN_QUARTER/constants_1.MAX_PER_QUARTER,y:getHeight(i),z:-constants_1.RADIUS}}},{"./constants":63}],65:[function(require,module,exports){"use strict";var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var THREE=__importStar(require("three")),_cache={};exports.getMaterial=function(r,g,b){var color=r<<16|g<<8|b;return null==_cache[color]&&(_cache[color]=new THREE.MeshPhongMaterial({color:color,flatShading:!0})),_cache[color]}},{three:3}],66:[function(require,module,exports){"use strict";var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var constants_1=require("./constants"),THREE=__importStar(require("three"));require("three/examples/js/WebGL");var helpers_1=require("./helpers"),material_cache_1=require("./material_cache"),three_orbitcontrols_ts_1=require("three-orbitcontrols-ts"),RendererLoop=function(){function RendererLoop(writeln){var _this=this;this.meshes=[],this.lit={},this.printDebugInfo=function(){for(var list=[],i=0;i<constants_1.MAX;i++)list.push(helpers_1.getHeight(i));console.log(list),console.log(JSON.stringify(list))},this.process=function(_data){var data=_data.substr(1,_data.length-1);return data.startsWith("l")?(_this.processLight(data),!0):data.startsWith("r")?(_this.reset(),!0):!!data.startsWith("show")&&(_this.lightenMeshes(),_this.render(),!0)},this.light=function(i,r,g,b){_this.lit[i]={r:r,g:g,b:b}},this.processLight=function(data){var arr=data.split("-"),i=parseInt(arr[1]),c=parseInt(arr[2]),b=255&c,g=(65280&c)>>8,r=(255<<16&c)>>16;_this.light(i,r,g,b)},this.reset=function(){for(var i=0;i<constants_1.MAX;i++)_this.lit[i]={r:0,g:0,b:0}},this.animate=function(){_this.controls.update(),_this.render()},this.lightenMeshes=function(){Object.keys(_this.lit).forEach(function(key){var lit=_this.lit[parseInt(key)];_this.meshes[helpers_1.toMeshPos(parseInt(key)%constants_1.MAX)].material=material_cache_1.getMaterial(lit.r,lit.g,lit.b)})},this.render=function(){_this.renderer.render(_this.scene,_this.camera)},this.onWindowResize=function(){_this.camera.aspect=window.innerWidth/window.innerHeight,_this.camera.updateProjectionMatrix(),_this.renderer.setSize(window.innerWidth,window.innerHeight)},function(writeln){writeln("Simulador da fita em loop de 300 leds do Neopixels."),writeln("O código para subir no arduino e rodar neste simulador"),writeln("pode ser encontrado em:"),writeln("https://github.com/degroote22/loop-webusb-sim/blob/d0237eb1d09590c3a038aa723da472f2b663e46d/sketches_loop/test1/test1.ino"),writeln(""),writeln("Não se esqueça de instalar ou baixar a biblioteca WEBUSB para arduino, que está disponível em: "),writeln("https://github.com/webusb/arduino/tree/d7af7a03fbd263f717feca0b2131ef9cd99b77ca/library/WebUSB"),writeln(""),writeln("WebUSB só funciona em: Arduino Leonardo, Arduino/Genuino Micro, Arduino/Genuino Zero, Arduino MKR1000, Arduino MKRZero, Arduino MKRFox1200, Adafruit Feather 32u4"),writeln("")}(writeln);for(var i=0;i<constants_1.MAX;i++)this.lit[i]={r:0,g:0,b:0};this.scene=new THREE.Scene,this.scene.background=new THREE.Color(4473924),this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1e3),this.camera.position.set(400,200,0),this.controls=new three_orbitcontrols_ts_1.OrbitControls(this.camera,this.renderer.domElement),this.controls.addEventListener("change",this.render),this.controls.enableDamping=!0,this.controls.dampingFactor=.25,this.controls.minDistance=100,this.controls.maxDistance=500,this.controls.maxPolarAngle=Math.PI/2,this.createMeshes(),this.createLights(),window.addEventListener("resize",this.onWindowResize,!1),this.lightenMeshes(),this.render()}return RendererLoop.prototype.createLights=function(){var light=new THREE.DirectionalLight(16777215);light.position.set(1,1,1),this.scene.add(light);var light3=new THREE.AmbientLight(2236962);this.scene.add(light3)},RendererLoop.prototype.createMeshes=function(){var table_geometry=new THREE.PlaneGeometry(700,300),table_material=material_cache_1.getMaterial(255,255,255),table_mesh=new THREE.Mesh(table_geometry,table_material);table_mesh.position.x=0,table_mesh.position.y=-50,table_mesh.position.z=0,table_mesh.rotateX(-Math.PI/2),this.scene.add(table_mesh);for(var geometry=new THREE.SphereGeometry(2,8,8),material=material_cache_1.getMaterial(0,0,0),line_material=material_cache_1.getMaterial(191,191,191),i=0;i<constants_1.MAX;i++){var mesh=new THREE.Mesh(geometry,material),pos=helpers_1.getPosition(i);mesh.position.x=pos.x,mesh.position.y=pos.y,mesh.position.z=pos.z,mesh.updateMatrix(),mesh.matrixAutoUpdate=!1,this.scene.add(mesh),this.meshes.push(mesh);var line_geometry=new THREE.CylinderGeometry(1,1,50+pos.y),line_mesh=new THREE.Mesh(line_geometry,line_material);line_mesh.position.x=pos.x,line_mesh.position.y=(pos.y-50)/2,line_mesh.position.z=pos.z,this.scene.add(line_mesh)}},RendererLoop}();exports.RendererLoop=RendererLoop},{"./constants":63,"./helpers":64,"./material_cache":65,three:3,"three-orbitcontrols-ts":1,"three/examples/js/WebGL":4}],67:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var serial_1=require("./serial"),xterm_1=require("xterm"),renderer_1=require("./loop/renderer"),constants_1=require("./constants"),renderer_2=require("./table/renderer");var Main=function(){function Main(){var _this=this;if(this.arduinoPort=void 0,this.textEncoder=new TextEncoder,this.terminal=new xterm_1.Terminal(constants_1.TERMINAL_OPTIONS),this.connectButton=document.getElementById("connect"),this.terminalRendererEelement=document.getElementById("terminal"),this.connect=function(){if(null==_this.arduinoPort)throw Error("Port not registered when connecting");_this.terminal.writeln("Conectando a "+_this.arduinoPort.device_.productName+"..."),_this.arduinoPort.connect().then(function(){if(console.log(_this.arduinoPort),_this.terminal.writeln("Conectado."),null==_this.connectButton)throw Error("Connect button not found");if(_this.connectButton.textContent="Desconectar",null==_this.arduinoPort)throw Error("Port not registered when connecting");_this.arduinoPort.setCallbacks(function(data){var dataDecoded=(new TextDecoder).decode(data);_this.processDecodedData(dataDecoded)||_this.terminal.write("Recebido: "+dataDecoded)},function(error){_this.terminal.writeln("Erro ao receber: "+error)})},function(error){_this.terminal.writeln("Erro de conexão: "+error)})},this.processDecodedData=function(data){return!!data.startsWith("_")&&_this.renderer.process(data)},this.printHeightList=function(){_this.renderer.printDebugInfo()},!this.terminalRendererEelement)throw Error("No element with id 'terminal' found when openning terminal");this.terminal.open(this.terminalRendererEelement),this.registerTerminalKeyboardToSerial(),this.registerClickHandlers(),this.tryConnectingToArduino(),this.renderer=function(_a){var writeln=_a.writeln;if("LOOP"===window.renderer_type)return new renderer_1.RendererLoop(writeln);if("TABLE"===window.renderer_type)return new renderer_2.RendererTable(writeln);throw Error("It wasn't possible to determine the type of renderer based on window.renderer_type")}({writeln:function(s){_this.terminal.writeln(s)}})}return Main.prototype.registerTerminalKeyboardToSerial=function(){var _this=this;this.terminal.onData(function(str){void 0!==_this.arduinoPort&&_this.arduinoPort.send(_this.textEncoder.encode(str)).catch(function(error){_this.terminal.writeln("Erro de envio: "+error)})})},Main.prototype.registerClickHandlers=function(){var _this=this;if(null==this.connectButton)throw Error("Connect button not found");this.connectButton.addEventListener("click",function(){if(_this.arduinoPort){if(_this.arduinoPort.disconnect(),null==_this.connectButton)throw Error("Connect button not found");_this.connectButton.textContent="Conectar",_this.arduinoPort=void 0}else serial_1.Serial.requestPort().then(function(selectedPort){_this.arduinoPort=selectedPort,_this.connect()}).catch(function(error){_this.terminal.writeln("Erro de conexão: "+error)})})},Main.prototype.tryConnectingToArduino=function(){var _this=this;serial_1.Serial.getPorts().then(function(ports){0==ports.length?_this.terminal.writeln("Nenhum dispositivo encontrado."):(_this.arduinoPort=ports[0],_this.connect())})},Main}();document.addEventListener("DOMContentLoaded",function(_event){(new Main).printHeightList()})},{"./constants":62,"./loop/renderer":66,"./serial":68,"./table/renderer":71,xterm:38}],68:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Serial=function(){function Serial(){}return Serial.getPorts=function(){return navigator.usb.getDevices().then(function(devices){return devices.map(function(device){return new Port(device)})})},Serial.requestPort=function(){return navigator.usb.requestDevice({filters:[{vendorId:9025,productId:32822},{vendorId:9025,productId:32823},{vendorId:9025,productId:32845},{vendorId:9025,productId:32846},{vendorId:9025,productId:32847},{vendorId:9025,productId:32848}]}).then(function(device){return new Port(device)})},Serial}();exports.Serial=Serial;var Port=function(device){var _this=this;this.setCallbacks=function(onReceive,onReceiveError){_this.onReceive=onReceive,_this.onReceiveError=onReceiveError},this.connect=function(){var readLoop=function(){_this.device_.transferIn(_this.endpointIn_,64).then(function(result){if(!_this.onReceive)throw Error("No onReceive callback registered");_this.onReceive(result.data),readLoop()},function(error){if(!_this.onReceiveError)throw Error("No onReceiveError callback registered");_this.onReceiveError(error)})};return _this.device_.open().then(function(){if(null===_this.device_.configuration)return _this.device_.selectConfiguration(1)}).then(function(){if(!_this.device_.configuration)throw Error("Device has no configuration object");_this.device_.configuration.interfaces.forEach(function(element){element.alternates.forEach(function(elementalt){255==elementalt.interfaceClass&&(_this.interfaceNumber_=element.interfaceNumber,elementalt.endpoints.forEach(function(elementendpoint){"out"==elementendpoint.direction&&(_this.endpointOut_=elementendpoint.endpointNumber),"in"==elementendpoint.direction&&(_this.endpointIn_=elementendpoint.endpointNumber)}))})})}).then(function(){return _this.device_.claimInterface(_this.interfaceNumber_)}).then(function(){return _this.device_.selectAlternateInterface(_this.interfaceNumber_,0)}).then(function(){return _this.device_.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:1,index:_this.interfaceNumber_})}).then(function(){readLoop()})},this.disconnect=function(){return _this.device_.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:0,index:_this.interfaceNumber_}).then(function(){return _this.device_.close()})},this.send=function(data){return _this.device_.transferOut(_this.endpointOut_,data)},this.device_=device,this.interfaceNumber_=2,this.endpointIn_=5,this.endpointOut_=4};exports.Port=Port},{}],69:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MAX=12},{}],70:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pad0=function(s){return 1==s.length?"0"+s:s}},{}],71:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var helpers_1=require("./helpers"),constants_1=require("./constants"),RendererTable=function(){function RendererTable(writeln){var _this=this;this.lit={},this.printDebugInfo=function(){},this.process=function(_data){var data=_data.substr(1,_data.length-1);return data.startsWith("l")?(_this.processLight(data),!0):data.startsWith("r")?(_this.reset(),!0):!!data.startsWith("show")&&(_this.render(),!0)},this.light=function(i,r,g,b){_this.lit[i]={r:r,g:g,b:b}},this.processLight=function(data){var arr=data.split("-"),j=function(i){var row=Math.floor(i/12),column=i%12;return 12*row+(row%2==0?column:11-column)}(parseInt(arr[1])),c=parseInt(arr[2]),b=255&c,g=(65280&c)>>8,r=(255<<16&c)>>16;_this.light(j,r,g,b)},function(writeln){writeln("Simulador da mesa 12x12 do Neopixels."),writeln("O código para subir no arduino e rodar neste simulador"),writeln("pode ser encontrado em:"),writeln("https://github.com/degroote22/loop-webusb-sim/blob/d0237eb1d09590c3a038aa723da472f2b663e46d/sketches_table/test1/test1.ino"),writeln(""),writeln("Não se esqueça de instalar ou baixar a biblioteca WEBUSB para arduino, que está disponível em: "),writeln("https://github.com/webusb/arduino/tree/d7af7a03fbd263f717feca0b2131ef9cd99b77ca/library/WebUSB"),writeln(""),writeln("WebUSB só funciona em: Arduino Leonardo, Arduino/Genuino Micro, Arduino/Genuino Zero, Arduino MKR1000, Arduino MKRZero, Arduino MKRFox1200, Adafruit Feather 32u4"),writeln("")}(writeln);for(var i_1=0;i_1<constants_1.MAX*constants_1.MAX;i_1++)this.lit[i_1]={r:0,g:0,b:0};var grid=document.createElement("div");grid.id="grid";for(var i=0;i<constants_1.MAX;i++){var row=document.createElement("div");row.className="row";for(var x=0;x<constants_1.MAX;x++){var cell=document.createElement("div");cell.className="gridsquare";var gsn=i*constants_1.MAX+x;cell.id="gs-"+gsn,cell.style.backgroundColor="#000000",row.appendChild(cell)}grid.appendChild(row)}document.body.appendChild(grid)}return RendererTable.prototype.render=function(){for(var i=0;i<constants_1.MAX;i++)for(var j=0;j<constants_1.MAX;j++){var _a=this.lit[decodeGrid(i,j)],r=_a.r,g=_a.g,b=_a.b,decoded=decodeGrid(i,j),element=document.getElementById("gs-"+decoded),bg="#"+helpers_1.pad0(r.toString(16))+helpers_1.pad0(g.toString(16))+helpers_1.pad0(b.toString(16));if(!element)throw Error("Nao achou a célula numero "+decoded);element.style.backgroundColor=bg}},RendererTable.prototype.reset=function(){for(var i=0;i<constants_1.MAX;i++)for(var j=0;j<constants_1.MAX;j++){var gsn=decodeGrid(i,j),element=document.getElementById("gs-"+gsn);if(!element)throw Error("Nao achou a célula numero "+gsn);element.style.backgroundColor="#000000"}},RendererTable}();function decodeGrid(i,j){return i*constants_1.MAX+j}exports.RendererTable=RendererTable},{"./constants":69,"./helpers":70}]},{},[67]);
